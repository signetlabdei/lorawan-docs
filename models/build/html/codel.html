

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>CoDel queue disc &#8212; Model Library</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FqCoDel queue disc" href="fq-codel.html" />
    <link rel="prev" title="RED queue disc" href="red.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico" 
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="html";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>
      

  </head><body>
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0" width="100%">
      <tbody>
	<tr style="height: 56px;">
	  <td id="projectlogo">
	    <a id="ns3_home1"
	       href="http://www.nsnam.org/">
	       <img alt="ns-3 Logo"
		    src="_static/ns-3-inverted-notext-small.png"/>
	    </a>
	  </td>
	  <td id="projecttext">
	    <div id="projectbrief">A Discrete-Event Network Simulator</div>
	      <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
	  </td>
	      
	  <td id="ns3-menu">
	    <div class="menu">
	      <ul >
	        <li><a id="ns3_home2"
		       href="http://www.nsnam.org/"
		       >&nbsp;&nbsp;Home</a>
	        </li>
	        <li><span
		      onmouseover="mopen('mTuts')" 
		      onmouseout="mclosetime()"
			>Tutorials &nbsp;&#x25BC;</span>
		    <div id="mTuts" 
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_tut"
			 href="/docs/tutorial/html/index.html"
			  >English</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDocs')" 
		      onmouseout="mclosetime()"
			>Docs &nbsp;&nbsp;&nbsp;&#x25BC;</span>
		    <div id="mDocs"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_wiki"
			 href="http://www.nsnam.org/wiki"
			 >Wiki</a><br/>
		      <a id="ns3_man"
			 href="/docs/manual/html/index.html"
			 >Manual</a><br/>
		      <a id="ns3_mod"
			 href="/docs/models/html/index.html"
			 >Models</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDev')" 
		      onmouseout="mclosetime()"
			>Develop &#x25BC;</span>
		    <div id="mDev"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_api"
			 href="/docs/doxygen/html/index.html"
			 >API</a><br/>
		      <a id="ns3_bugs"
		       href="http://www.nsnam.org/bugzilla/">Bugs</a>
	        </li>
	      </ul>
	    </div>
	  </td>
	  <td id="projectsection">
	    <span style="margin-right:10px">Models</span>
	  </td>
	</tr>
      </tbody>
    </table>
    <script  type="text/javascript">ns3_write_links()</script>
  </div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="fq-codel.html" title="FqCoDel queue disc"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="red.html" title="RED queue disc"
             accesskey="P">previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="traffic-control.html" accesskey="U">Traffic Control Layer</a><span class="navelem">&nbsp;</span></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="codel-queue-disc">
<h1>CoDel queue disc<a class="headerlink" href="#codel-queue-disc" title="Permalink to this headline">¶</a></h1>
<p>This chapter describes the CoDel (<a class="reference internal" href="#nic12" id="id1"><span>[Nic12]</span></a>, <a class="reference internal" href="#nic14" id="id2"><span>[Nic14]</span></a>) queue disc implementation
in <em>ns-3</em>.</p>
<p>Developed by Kathleen Nichols and Van Jacobson as a solution to the
bufferbloat <a class="reference internal" href="#buf14" id="id3"><span>[Buf14]</span></a> problem, CoDel (Controlled Delay Management) is a queuing
discipline that uses a packet’s sojourn time (time in queue) to make
decisions on packet drops.</p>
<p>Note that, starting from ns-3.25, CoDel is no longer a queue variant and
cannot be installed as a NetDevice queue. Instead, CoDel is a queue disc
and must be installed in the context of the traffic control (see the
examples mentioned below).</p>
<div class="section" id="model-description">
<h2>Model Description<a class="headerlink" href="#model-description" title="Permalink to this headline">¶</a></h2>
<p>The source code for the CoDel model is located in the directory <code class="docutils literal notranslate"><span class="pre">src/traffic-control/model</span></code>
and consists of 2 files <cite>codel-queue-disc.h</cite> and <cite>codel-queue-disc.cc</cite> defining a CoDelQueueDisc
class and a helper CoDelTimestampTag class. The code was ported to <em>ns-3</em> by
Andrew McGregor based on Linux kernel code implemented by Dave Täht and Eric Dumazet.</p>
<ul class="simple">
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">CoDelQueueDisc</span></code>: This class implements the main CoDel algorithm:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::DoEnqueue</span> <span class="pre">()</span></code>: This routine tags a packet with the current time before pushing it into the queue.  The timestamp tag is used by <code class="docutils literal notranslate"><span class="pre">CoDelQueue::DoDequeue()</span></code> to compute the packet’s sojourn time.  If the queue is full upon the packet arrival, this routine will drop the packet and record the number of drops due to queue overflow, which is stored in <cite>m_dropOverLimit</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::ShouldDrop</span> <span class="pre">()</span></code>: This routine is <code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::DoDequeue()</span></code>’s helper routine that determines whether a packet should be dropped or not based on its sojourn time.  If the sojourn time goes above <cite>m_target</cite> and remains above continuously for at least <cite>m_interval</cite>, the routine returns <code class="docutils literal notranslate"><span class="pre">true</span></code> indicating that it is OK to drop the packet. Otherwise, it returns <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::DoDequeue</span> <span class="pre">()</span></code>: This routine performs the actual packet drop based on <code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::ShouldDrop</span> <span class="pre">()</span></code>’s return value and schedules the next drop.</p></li>
</ul>
</li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">CoDelTimestampTag</span></code>: This class implements the timestamp tagging for a packet.  This tag is used to compute the packet’s sojourn time (the difference between the time the packet is dequeued and the time it is pushed into the queue).</p></li>
</ul>
<p>There are 2 branches to <code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::DoDequeue</span> <span class="pre">()</span></code>:</p>
<ol class="arabic">
<li><p>If the queue is currently in the dropping state, which means the sojourn time has remained above <cite>m_target</cite> for more than <cite>m_interval</cite>, the routine determines if it’s OK to leave the dropping state or it’s time for the next drop. When <code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::ShouldDrop</span> <span class="pre">()</span></code> returns <code class="docutils literal notranslate"><span class="pre">false</span></code>, the queue can move out of the dropping state (set <cite>m_dropping</cite> to <code class="docutils literal notranslate"><span class="pre">false</span></code>).  Otherwise, the queue continuously drops packets and updates the time for next drop (<cite>m_dropNext</cite>) until one of the following conditions is met:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>The queue is empty, upon which the queue leaves the dropping state and exits <code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::ShouldDrop</span> <span class="pre">()</span></code> routine;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::ShouldDrop</span> <span class="pre">()</span></code> returns <code class="docutils literal notranslate"><span class="pre">false</span></code> (meaning the sojourn time goes below <cite>m_target</cite>) upon which the queue leaves the dropping state;</p></li>
<li><p>It is not yet time for next drop (<cite>m_dropNext</cite> is less than current time) upon which the queue waits for the next packet dequeue to check the condition again.</p></li>
</ol>
</div></blockquote>
</li>
<li><p>If the queue is not in the dropping state, the routine enters the dropping state and drop the first packet if <code class="docutils literal notranslate"><span class="pre">CoDelQueueDisc::ShouldDrop</span> <span class="pre">()</span></code> returns <code class="docutils literal notranslate"><span class="pre">true</span></code> (meaning the sojourn time has gone above <cite>m_target</cite> for at least <cite>m_interval</cite> for the first time or it has gone above again after the queue leaves the dropping state).</p></li>
</ol>
<p>The CoDel queue disc does not require packet filters, does not admit
child queue discs and uses a single internal queue. If not provided by
the user, a DropTail queue operating in the same mode (packet or byte)
as the queue disc and having a size equal to the CoDel MaxSize attribute
is created. Otherwise, the capacity of the queue disc is determined by
the capacity of the internal queue provided by the user.</p>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<dl class="citation">
<dt class="label" id="nic12"><span class="brackets"><a class="fn-backref" href="#id1">Nic12</a></span></dt>
<dd><ol class="upperalpha simple" start="11">
<li><p>Nichols and V. Jacobson, Controlling Queue Delay, ACM Queue, Vol. 10 No. 5, May 2012.  Available online at <a class="reference external" href="http://queue.acm.org/detail.cfm?id=2209336">http://queue.acm.org/detail.cfm?id=2209336</a>.</p></li>
</ol>
</dd>
<dt class="label" id="nic14"><span class="brackets"><a class="fn-backref" href="#id2">Nic14</a></span></dt>
<dd><ol class="upperalpha simple" start="11">
<li><p>Nichols and V. Jacobson, Internet-Draft:  Controlled Delay Active Queue Management, March 2014.  Available online at <a class="reference external" href="http://tools.ietf.org/html/draft-nichols-tsvwg-codel-02">http://tools.ietf.org/html/draft-nichols-tsvwg-codel-02</a>.</p></li>
</ol>
</dd>
<dt class="label" id="buf14"><span class="brackets"><a class="fn-backref" href="#id3">Buf14</a></span></dt>
<dd><p>Bufferbloat.net.  Available online at <a class="reference external" href="http://www.bufferbloat.net/">http://www.bufferbloat.net/</a>.</p>
</dd>
</dl>
</div>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h3>
<p>The key attributes that the CoDelQueue class holds include the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MaxSize:</span></code> The maximum number of packets/bytes the queue can hold. The default value is 1500 * DEFAULT_CODEL_LIMIT, which is 1500 * 1000 bytes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MinBytes:</span></code> The CoDel algorithm minbytes parameter. The default value is 1500 bytes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Interval:</span></code> The sliding-minimum window. The default value is 100 ms.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Target:</span></code> The CoDel algorithm target queue delay. The default value is 5 ms.</p></li>
</ul>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>The first example is <cite>codel-vs-pfifo-basic-test.cc</cite> located in <code class="docutils literal notranslate"><span class="pre">src/traffic-control/examples</span></code>.  To run the file (the first invocation below shows the available
command-line options):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run <span class="s2">&quot;codel-vs-pfifo-basic-test --PrintHelp&quot;</span>
$ ./waf --run <span class="s2">&quot;codel-vs-pfifo-basic-test --queueType=CoDel --pcapFileName=codel.pcap --cwndTrFileName=cwndCodel.tr&quot;</span>
</pre></div>
</div>
<p>The expected output from the previous commands are two files: <cite>codel.pcap</cite> file and <cite>cwndCoDel.tr</cite> (ASCII trace) file The .pcap file can be analyzed using
wireshark or tcptrace:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tcptrace -l -r -n -W codel.pcap
</pre></div>
</div>
<p>The second example is <cite>codel-vs-pfifo-asymmetric.cc</cite> located in <code class="docutils literal notranslate"><span class="pre">src/traffic-control/examples</span></code>.  This example is intended to model a typical cable modem
deployment scenario.  To run the file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run <span class="s2">&quot;codel-vs-pfifo-asymmetric --PrintHelp&quot;</span>
$ ./waf --run codel-vs-pfifo-asymmetric
</pre></div>
</div>
<p>The expected output from the previous commands is six pcap files:</p>
<ul class="simple">
<li><p>codel-vs-pfifo-asymmetric-CoDel-server-lan.pcap</p></li>
<li><p>codel-vs-pfifo-asymmetric-CoDel-router-wan.pcap</p></li>
<li><p>codel-vs-pfifo-asymmetric-CoDel-router-lan.pcap</p></li>
<li><p>codel-vs-pfifo-asymmetric-CoDel-cmts-wan.pcap</p></li>
<li><p>codel-vs-pfifo-asymmetric-CoDel-cmts-lan.pcap</p></li>
<li><p>codel-vs-pfifo-asymmetric-CoDel-host-lan.pcap</p></li>
</ul>
<p>One attribute file:</p>
<ul class="simple">
<li><p>codel-vs-pfifo-asymmetric-CoDel.attr</p></li>
</ul>
<p>Five ASCII trace files:</p>
<ul class="simple">
<li><p>codel-vs-pfifo-asymmetric-CoDel-drop.tr</p></li>
<li><p>codel-vs-pfifo-asymmetric-CoDel-drop-state.tr</p></li>
<li><p>codel-vs-pfifo-asymmetric-CoDel-sojourn.tr</p></li>
<li><p>codel-vs-pfifo-asymmetric-CoDel-length.tr</p></li>
<li><p>codel-vs-pfifo-asymmetric-CoDel-cwnd.tr</p></li>
</ul>
</div>
</div>
<div class="section" id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h2>
<p>The CoDel model is tested using <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">CoDelQueueDiscTestSuite</span></code> class defined in <cite>src/traffic-control/test/codel-queue-test-suite.cc</cite>.  The suite includes 5 test cases:</p>
<ul class="simple">
<li><p>Test 1: The first test checks the enqueue/dequeue with no drops and makes sure that CoDel attributes can be set correctly.</p></li>
<li><p>Test 2: The second test checks the enqueue with drops due to queue overflow.</p></li>
<li><p>Test 3: The third test checks the NewtonStep() arithmetic against explicit port of Linux implementation</p></li>
<li><p>Test 4: The fourth test checks the ControlLaw() against explicit port of Linux implementation</p></li>
<li><p>Test 5: The fifth test checks the enqueue/dequeue with drops according to CoDel algorithm</p></li>
</ul>
<p>The test suite can be run using the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure --enable-examples --enable-tests
$ ./waf build
$ ./test.py -s codel-queue-disc
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;CoDelQueueDisc&quot;</span> ./waf --run <span class="s2">&quot;test-runner --suite=codel-queue-disc&quot;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">CoDel queue disc</a><ul>
<li><a class="reference internal" href="#model-description">Model Description</a><ul>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validation">Validation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="red.html"
                        title="previous chapter">RED queue disc</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="fq-codel.html"
                        title="next chapter">FqCoDel queue disc</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/codel.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="fq-codel.html" title="FqCoDel queue disc"
             >next</a> |</li>
        <li class="right" >
          <a href="red.html" title="RED queue disc"
             >previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="traffic-control.html" >Traffic Control Layer</a><span class="navelem">&nbsp;</span></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006-2019.
      Last updated on Apr 29, 2020 17:37.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.2.
    </div>
  </body>
</html>