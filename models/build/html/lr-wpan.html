
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>19. Low-Rate Wireless Personal Area Network (LR-WPAN) &#8212; Model Library</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/default.css?v=bb97339c" />
    <script src="_static/documentation_options.js?v=951d00fa"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="20. LTE Module" href="lte.html" />
    <link rel="prev" title="18. LoRaWAN Module" href="lorawan.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico"
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="html";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>


  </head><body>
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0" width="100%">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectlogo">
              <a id="ns3_home1"
                 href="http://www.nsnam.org/">
                 <img alt="ns-3 Logo" style="background-color: unset;"
                      src="_static/ns-3-inverted-notext-small.png"/>
              </a>
            </td>
            <td id="projecttext">
              <div id="projectbrief">A Discrete-Event Network Simulator</div>
              <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
            </td>

            <td id="ns3-menu">
              <div class="menu">
                <ul >
                  <li style="background-image:none">
                    <a id="ns3_home2"
                         href="http://www.nsnam.org/"
                         >&nbsp;&nbsp;Home</a>
                  </li>
                  <li><span
                        onmouseover="mopen('mTuts')"
                        onmouseout="mclosetime()"
                          >Tutorials &nbsp;&#x25BC;</span>
                      <div id="mTuts"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_tut"
                           href="/docs/tutorial/html/index.html"
                            >English</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDocs')"
                        onmouseout="mclosetime()"
                          >Documentation &nbsp;&#x25BC;</span>
                      <div id="mDocs"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_ins"
                           href="/docs/installation/html/index.html"
                           >Installation</a><br/>
                        <a id="ns3_man"
                           href="/docs/manual/html/index.html"
                           >Manual</a><br/>
                        <a id="ns3_mod"
                           href="/docs/models/html/index.html"
                           >Models</a><br/>
                        <a id="ns3_con"
                           href="/docs/contributing/html/index.html"
                           >Contributing</a><br/>
                        <a id="ns3_wiki"
                           href="http://www.nsnam.org/wiki"
                           >Wiki</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDev')"
                        onmouseout="mclosetime()"
                          >Development &nbsp;&#x25BC;</span>
                      <div id="mDev"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_api"
                           href="/docs/doxygen/html/index.html"
                           >API Docs</a><br/>
                        <a id="ns3_bugs"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/issues"
                           >Issue Tracker</a><br/>
                        <a id="ns3_merge"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/merge_requests"
                           >Merge Requests</a><br/>
                      </div>
                  </li>
                </ul>
              </div>
            </td>

            <td id="projectsection">
              <span style="margin-right:10px">Models</span>
            </td>
          </tr>
        </tbody>
      </table>
      <script  type="text/javascript">ns3_write_links()</script>
    </div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="lte.html" title="20. LTE Module"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="lorawan.html" title="18. LoRaWAN Module"
             accesskey="P">previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

        <li class="nav-item nav-item-this"><a href=""><span class="section-number">19. </span>Low-Rate Wireless Personal Area Network (LR-WPAN)</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>PageBreak</p>
<section id="low-rate-wireless-personal-area-network-lr-wpan">
<h1><span class="section-number">19. </span>Low-Rate Wireless Personal Area Network (LR-WPAN)<a class="headerlink" href="#low-rate-wireless-personal-area-network-lr-wpan" title="Link to this heading">¶</a></h1>
<p>This chapter describes the implementation of <em>ns-3</em> models for the
low-rate, wireless personal area network (LR-WPAN) as specified by
IEEE standard 802.15.4 (2003,2006,2011).</p>
<section id="model-description">
<h2><span class="section-number">19.1. </span>Model Description<a class="headerlink" href="#model-description" title="Link to this heading">¶</a></h2>
<section id="design">
<h3><span class="section-number">19.1.1. </span>Design<a class="headerlink" href="#design" title="Link to this heading">¶</a></h3>
<p>The model design closely follows the standard from an architectural standpoint.</p>
<figure class="align-default" id="id1">
<span id="fig-lr-wpan-arch"></span><img alt="_images/lr-wpan-arch.png" src="_images/lr-wpan-arch.png" />
<figcaption>
<p><span class="caption-text">Architecture and scope of lr-wpan models</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The grey areas in the figure (adapted from Fig 3. of IEEE Std. 802.15.4-2006)
show the scope of the model.</p>
<p>The Spectrum NetDevice from Nicola Baldo is the basis for the implementation.</p>
<p>The implementation also borrows some ideas from the ns-2 models developed by
Zheng and Lee.</p>
<section id="apis">
<h4><span class="section-number">19.1.1.1. </span>APIs<a class="headerlink" href="#apis" title="Link to this heading">¶</a></h4>
<p>The APIs closely follow the standard, adapted for <em>ns-3</em> naming conventions
and idioms.  The APIs are organized around the concept of service primitives
as shown in the following figure adapted from Figure 14 of
IEEE Std. 802.15.4-2006.</p>
<figure class="align-default" id="id2">
<span id="fig-lr-wpan-primitives"></span><img alt="_images/lr-wpan-primitives.png" src="_images/lr-wpan-primitives.png" />
<figcaption>
<p><span class="caption-text">Service primitives</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The APIs are organized around four conceptual services and service access
points (SAP):</p>
<ul class="simple">
<li><p>MAC data service (MCPS)</p></li>
<li><p>MAC management service  (MLME)</p></li>
<li><p>PHY data service (PD)</p></li>
<li><p>PHY management service (PLME)</p></li>
</ul>
<p>In general, primitives are standardized as follows (e.g. Sec 7.1.1.1.1
of IEEE 802.15.4-2006)::</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>MCPS-DATA.request<span class="o">(</span>
<span class="w">                  </span>SrcAddrMode,
<span class="w">                  </span>DstAddrMode,
<span class="w">                  </span>DstPANId,
<span class="w">                  </span>DstAddr,
<span class="w">                  </span>msduLength,
<span class="w">                  </span>msdu,
<span class="w">                  </span>msduHandle,
<span class="w">                  </span>TxOptions,
<span class="w">                  </span>SecurityLevel,
<span class="w">                  </span>KeyIdMode,
<span class="w">                  </span>KeySource,
<span class="w">                  </span>KeyIndex
<span class="w">                 </span><span class="o">)</span>
</pre></div>
</div>
<p>This maps to <em>ns-3</em> classes and methods such as::</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>struct<span class="w"> </span>McpsDataRequestParameters
<span class="o">{</span>
<span class="w">  </span>uint8_t<span class="w"> </span>m_srcAddrMode<span class="p">;</span>
<span class="w">  </span>uint8_t<span class="w"> </span>m_dstAddrMode<span class="p">;</span>
<span class="w">  </span>...
<span class="o">}</span><span class="p">;</span>

void
LrWpanMac::McpsDataRequest<span class="o">(</span>McpsDataRequestParameters<span class="w"> </span>params<span class="o">)</span>
<span class="o">{</span>
...
<span class="o">}</span>
</pre></div>
</div>
<p>The primitives currently supported by the <em>ns-3</em> model are:</p>
<section id="mac-primitives">
<h5><span class="section-number">19.1.1.1.1. </span>MAC Primitives<a class="headerlink" href="#mac-primitives" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>MCPS-DATA.Request</p></li>
<li><p>MCPS-DATA.Confirm</p></li>
<li><p>MCPS-DATA.Indication</p></li>
<li><p>MLME-START.Request</p></li>
<li><p>MLME-START.Confirm</p></li>
<li><p>MLME-SCAN.Request</p></li>
<li><p>MLME-SCAN.Confirm</p></li>
<li><p>MLME-BEACON-NOFIFY.Indication</p></li>
<li><p>MLME-ASSOCIATE.Request</p></li>
<li><p>MLME-ASSOCIATE.Confirm</p></li>
<li><p>MLME-ASSOCIATE.Response</p></li>
<li><p>MLME-ASSOCIATE.Indication</p></li>
<li><p>MLME-POLL.Confirm</p></li>
<li><p>MLME-COMM-STATUS.Indication</p></li>
<li><p>MLME-SYNC.Request</p></li>
<li><p>MLME-SYNC-LOSS.Indication</p></li>
</ul>
</section>
<section id="phy-primitives">
<h5><span class="section-number">19.1.1.1.2. </span>PHY Primitives<a class="headerlink" href="#phy-primitives" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><p>PLME-CCA.Request</p></li>
<li><p>PLME-CCA.Confirm</p></li>
<li><p>PD-DATA.Request</p></li>
<li><p>PD-DATA.Confirm</p></li>
<li><p>PD-DATA.Indication</p></li>
<li><p>PLME-SET-TRX-STATE.Request</p></li>
<li><p>PLME-SET-TRX-STATE.Confirm</p></li>
</ul>
<p>For more information on primitives, See IEEE 802.15.4-2011, Table 8.</p>
</section>
</section>
<section id="mac">
<h4><span class="section-number">19.1.1.2. </span>MAC<a class="headerlink" href="#mac" title="Link to this heading">¶</a></h4>
<p>The MAC at present implements both, the unslotted CSMA/CA (non-beacon mode) and
the slotted CSMA/CA (beacon-enabled mode). The beacon-enabled mode supports only
direct transmissions. Indirect transmissions and Guaranteed Time Slots (GTS) are
currently not supported.</p>
<p>The present implementation supports a single PAN coordinator, support for additional
coordinators is under consideration for future releases.</p>
<p>The implemented MAC is similar to Contiki’s NullMAC, i.e., a MAC without sleep
features. The radio is assumed to be always active (receiving or transmitting),
of completely shut down. Frame reception is not disabled while performing the
CCA.</p>
<p>The main API supported is the data transfer API
(McpsDataRequest/Indication/Confirm).  CSMA/CA according to Stc 802.15.4-2006,
section 7.5.1.4 is supported. Frame reception and rejection according to
Std 802.15.4-2006, section 7.5.6.2 is supported, including acknowledgements.
Only short addressing completely implemented. Various trace sources are
supported, and trace sources can be hooked to sinks.</p>
<p>The implemented ns-3 MAC supports scanning. Typically, a scanning request is preceded
by an association request but these can be used independently.
IEEE 802.15.4 supports 4 types of scanning:</p>
<ul class="simple">
<li><p><em>Energy Detection (ED) Scan:</em> In an energy scan, a device or a coordinator scan a set number of channels looking for traces of energy. The maximum energy registered during a given amount of time is stored. Energy scan is typically used to measure the quality of a channel at any given time. For this reason, coordinators often use this scan before initiating a PAN on a channel.</p></li>
<li><p><em>Active Scan:</em> A device sends <code class="docutils literal notranslate"><span class="pre">beacon</span> <span class="pre">request</span> <span class="pre">commands</span></code> on a set number of channels looking for a PAN coordinator. The receiving coordinator must be configured on non-beacon mode. Coordinators on beacon-mode ignore these requests. The coordinators who accept the request, respond with a beacon. After an active scan take place, during the association process devices extract the information in the PAN descriptors from the collected beacons and based on this information (e.g. channel, LQI level), choose a coordinator to associate with.</p></li>
<li><p><em>Passive Scan:</em> In a passive scan, no <code class="docutils literal notranslate"><span class="pre">beacon</span> <span class="pre">requests</span> <span class="pre">commands</span></code> are sent. Devices scan a set number of channels looking for beacons currently being transmitted (coordinators in beacon-mode). Like in the active scan, the information from beacons is stored in PAN descriptors and used by the device to choose a coordinator to associate with.</p></li>
<li><p><em>Orphan Scan:</em> Orphan scan is used typically by device as a result of repeated communication failure attempts with a coordinator. In other words, an orphan scan represents the intent of a device to relocate its coordinator. In some situations, it can be used by devices higher layers to not only rejoin a network but also join a network for the first time. In an orphan scan, a device send a <code class="docutils literal notranslate"><span class="pre">orphan</span> <span class="pre">notification</span> <span class="pre">command</span></code> to a given list of channels. If a coordinator receives this notification, it responds to the device with a <code class="docutils literal notranslate"><span class="pre">coordinator</span> <span class="pre">realignment</span> <span class="pre">command</span></code>.</p></li>
</ul>
<p>In active and passive scans, the link quality indicator (LQI) is the main parameter used to
determine the optimal coordinator. LQI values range from 0 to 255. Where 255 is the highest quality link value and 0 the lowest. Typically, a link lower than 127 is considered a link with poor quality.</p>
<p>In LR-WPAN, association is used to join or leave PANs. All devices in LR-WPAN must belong to a PAN to communicate. <em>ns-3</em> uses a classic association procedure described in the standard. The standard also covers a more effective association procedure known as fast association (See IEEE 802.15.4-2015, fastA) but this association is currently not supported by <em>ns-3</em>. Alternatively, <em>ns-3</em> can do a “quick and dirty” association using either <code class="docutils literal notranslate"><span class="pre">`LrWpanHelper::AssociateToPan`</span></code> or <code class="docutils literal notranslate"><span class="pre">`LrWpanHelper::AssociateToBeaconPan`</span></code>. These functions are used when a preset association can be done. For example, when the relationships between existing nodes and coordinators are known and can be set before the beginning of the simulation. In other situations, like in many networks in real deployments or in large networks, it is desirable that devices “associate themselves” with the best possible available coordinator candidates. This is a process known as bootstrap, and simulating this process makes it possible to demonstrate the kind of situations a node would face in which large networks to associate in real environment.</p>
<p>Bootstrap (a.k.a. network initialization) is possible with a combination of scan and association MAC primitives. Details on the general process for this network initialization is described in the standard. Bootstrap is a complex process that not only requires the scanning networks, but also the exchange of command frames and the use of a pending transaction list (indirect transmissions) in the coordinator to store command frames. The following summarizes the whole process:</p>
<figure class="align-default" id="fig-lr-wpan-assocsequence">
<img alt="_images/lr-wpan-assocSequence.png" src="_images/lr-wpan-assocSequence.png" />
</figure>
<p>Bootstrap as whole depends on procedures that also take place on higher layers of devices and coordinators. These procedures are briefly described in the standard but out of its scope (See IEE 802.15.4-2011 Section 5.1.3.1.). However, these procedures are necessary for a “complete bootstrap” process. In the examples in <em>ns-3</em>, these high layer procedures are only briefly implemented to demonstrate a complete example that shows the use of scan and association. A full high layer (e.g. such as those found in Zigbee and Thread protocol stacks) should complete these procedures more robustly.</p>
<section id="mac-queues">
<h5><span class="section-number">19.1.1.2.1. </span>MAC queues<a class="headerlink" href="#mac-queues" title="Link to this heading">¶</a></h5>
<p>By default, <code class="docutils literal notranslate"><span class="pre">Tx</span> <span class="pre">queue</span></code> and <code class="docutils literal notranslate"><span class="pre">Ind</span> <span class="pre">Tx</span> <span class="pre">queue</span></code> (the pending transaction list) are not limited but they can configure to drop packets after they
reach a limit of elements (transaction overflow). Additionally, the <code class="docutils literal notranslate"><span class="pre">Ind</span> <span class="pre">Tx</span> <span class="pre">queue</span></code> drop packets when the packet has been longer than
<code class="docutils literal notranslate"><span class="pre">macTransactionPersistenceTime</span></code> (transaction expiration). Expiration of packets in the Tx queue is not supported.
Finally, packets in the <code class="docutils literal notranslate"><span class="pre">Tx</span> <span class="pre">queue</span></code> may be dropped due to excessive transmission retries or channel access failure.</p>
</section>
</section>
<section id="phy">
<h4><span class="section-number">19.1.1.3. </span>PHY<a class="headerlink" href="#phy" title="Link to this heading">¶</a></h4>
<p>The physical layer components consist of a Phy model, an error rate model,
and a loss model. The PHY state transitions are roughly model after
ATMEL’s AT86RF233.</p>
<figure class="align-default" id="id3">
<span id="fig-lr-wpan-phy"></span><img alt="_images/lr-wpan-phy.png" src="_images/lr-wpan-phy.png" />
<figcaption>
<p><span class="caption-text">Ns-3 lr-wpan PHY basic operating mode state diagram</span><a class="headerlink" href="#id3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The error rate model presently models the error rate
for IEEE 802.15.4 2.4 GHz AWGN channel for OQPSK; the model description can
be found in IEEE Std 802.15.4-2006, section E.4.1.7.   The Phy model is
based on SpectrumPhy and it follows specification described in section 6
of IEEE Std 802.15.4-2006. It models PHY service specifications, PPDU
formats, PHY constants and PIB attributes. It currently only supports
the transmit power spectral density mask specified in 2.4 GHz per section
6.5.3.1. The noise power density assumes uniformly distributed thermal
noise across the frequency bands. The loss model can fully utilize all
existing simple (non-spectrum phy) loss models. The Phy model uses
the existing single spectrum channel model.
The physical layer is modeled on packet level, that is, no preamble/SFD
detection is done. Packet reception will be started with the first bit of the
preamble (which is not modeled), if the SNR is more than -5 dB, see IEEE
Std 802.15.4-2006, appendix E, Figure E.2. Reception of the packet will finish
after the packet was completely transmitted. Other packets arriving during
reception will add up to the interference/noise.</p>
<p>Rx sensitivity is defined as the weakest possible signal point at which a receiver can receive and decode a packet with a high success rate.
According to the standard (IEEE Std 802.15.4-2006, section 6.1.7), this
corresponds to the point where the packet error rate is under 1% for 20 bytes PSDU
reference packets (11 bytes MAC header + 7 bytes payload (MSDU) + FCS 2 bytes). Setting low Rx sensitivity values (increasing the radio hearing capabilities)
have the effect to receive more packets (and at a greater distance) but it raises the probability to have dropped packets at the
MAC layer or the probability of corrupted packets. By default, the receiver sensitivity is set to the maximum theoretical possible value of -106.58 dBm for the supported IEEE 802.15.4 O-QPSK 250kps.
This rx sensitivity is set for the “perfect radio” which only considers the floor noise, in essence, this do not include the noise factor (noise introduced by imperfections in the demodulator chip or external factors).
The receiver sensitivity can be changed to different values using <code class="docutils literal notranslate"><span class="pre">SetRxSensitivity</span></code> function in the PHY to simulate the hearing capabilities of different compliant radio transceivers (the standard minimum compliant Rx sensitivity is -85 dBm).:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">                                                           </span><span class="o">(</span>defined<span class="w"> </span>by<span class="w"> </span>the<span class="w"> </span>standard<span class="o">)</span>
NoiseFloor<span class="w">          </span>Max<span class="w"> </span>Sensitivity<span class="w">                          </span>Min<span class="w"> </span>Sensitivity
-106.987dBm<span class="w">          </span>-106.58dBm<span class="w">                                   </span>-85dBm
<span class="w"> </span><span class="p">|</span>-------------------------<span class="p">|</span>------------------------------------------<span class="p">|</span>
<span class="w">                       </span>Noise<span class="w"> </span><span class="nv">Factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">                           </span><span class="p">|</span><span class="w"> </span>&lt;---------------------------------------&gt;<span class="p">|</span>
<span class="w">                                 </span>Acceptable<span class="w"> </span>sensitivity<span class="w"> </span>range
</pre></div>
</div>
<p>The example <code class="docutils literal notranslate"><span class="pre">lr-wpan-per-plot.cc`</span> <span class="pre">shows</span> <span class="pre">that</span> <span class="pre">at</span> <span class="pre">given</span> <span class="pre">Rx</span> <span class="pre">sensitivity,</span> <span class="pre">packets</span> <span class="pre">are</span> <span class="pre">dropped</span> <span class="pre">regardless</span> <span class="pre">of</span> <span class="pre">their</span> <span class="pre">theoretical</span> <span class="pre">error</span> <span class="pre">probability.</span>
<span class="pre">This</span> <span class="pre">program</span> <span class="pre">outputs</span> <span class="pre">a</span> <span class="pre">file</span> <span class="pre">named</span> <span class="pre">``802.15.4-per-vs-rxSignal.plt</span></code>.
Loading this file into gnuplot yields a file <code class="docutils literal notranslate"><span class="pre">802.15.4-per-vs-rsSignal.eps</span></code>, which can
be converted to pdf or other formats. Packet payload size, Tx power and Rx sensitivity can be configured.
The point where the blue line crosses with the PER indicates the Rx sensitivity. The default output is shown below.</p>
<figure class="align-default" id="id4">
<span id="fig-802-15-4-per-sens"></span><img alt="_images/802-15-4-per-sens.png" src="_images/802-15-4-per-sens.png" />
<figcaption>
<p><span class="caption-text">Default output of the program <code class="docutils literal notranslate"><span class="pre">lr-wpan-per-plot.cc</span></code></span><a class="headerlink" href="#id4" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="netdevice">
<h4><span class="section-number">19.1.1.4. </span>NetDevice<a class="headerlink" href="#netdevice" title="Link to this heading">¶</a></h4>
<p>Although it is expected that other technology profiles (such as
6LoWPAN and ZigBee) will write their own NetDevice classes, a basic
LrWpanNetDevice is provided, which encapsulates the common operations
of creating a generic LrWpan device and hooking things together.</p>
<section id="mac-addresses">
<h5><span class="section-number">19.1.1.4.1. </span>MAC addresses<a class="headerlink" href="#mac-addresses" title="Link to this heading">¶</a></h5>
<p>Contrary to other technologies, a IEEE 802.15.4 has 2 different kind of addresses:</p>
<ul class="simple">
<li><p>Long addresses (64 bits)</p></li>
<li><p>Short addresses (16 bits)</p></li>
</ul>
<p>The 64-bit addresses are unique worldwide, and set by the device vendor (in a real device).
The 16-bit addresses are not guaranteed to be unique, and they are typically either assigned
during the devices deployment, or assigned dynamically during the device bootstrap.</p>
<p>The other relevant “address” to consider is the PanId (16 bits), which represents the PAN
the device is attached to.</p>
<p>Due to the limited number of available bytes in a packet, IEEE 802.15.4 tries to use short
addresses instead of long addresses, even though the two might be used at the same time.</p>
<p>For the sake of communicating with the upper layers, and in particular to generate auto-configured
IPv6 addresses, each NetDevice must identify itself with a MAC address. The MAC addresses are
also used during packet reception, so it is important to use them consistently.</p>
<p>Focusing on IPv6 Stateless address autoconfiguration (SLAAC), there are two relevant RFCs to
consider: RFC 4944 and RFC 6282, and the two differ on how to build the IPv6 address given
the NetDevice address.</p>
<p>RFC 4944 mandates that the IID part of the IPv6 address is calculated as <code class="docutils literal notranslate"><span class="pre">YYYY:00ff:fe00:XXXX</span></code>,
while RFC 6282 mandates that the IID part of the IPv6 address is calculated as <code class="docutils literal notranslate"><span class="pre">0000:00ff:fe00:XXXX</span></code>
where <code class="docutils literal notranslate"><span class="pre">XXXX</span></code> is the device short address, and <code class="docutils literal notranslate"><span class="pre">YYYY</span></code> is the PanId.
In both cases the U/L bit must be set to local, so in the RFC 4944 the PanId might have one bit flipped.</p>
<p>In order to facilitate interoperability, and to avoid unwanted module dependencies, the <em>ns-3</em>
implementation moves the IID calculation in the <code class="docutils literal notranslate"><span class="pre">LrWpanNetDevice::GetAddress</span> <span class="pre">()</span></code>, which will
return an <code class="docutils literal notranslate"><span class="pre">Address</span></code> formatted properly, i.e.:</p>
<ul class="simple">
<li><p>The Long address (a <code class="docutils literal notranslate"><span class="pre">Mac64Address</span></code>) if the Short address has not been set, or</p></li>
<li><p>A properly formatted 48-bit pseudo-address (a <code class="docutils literal notranslate"><span class="pre">Mac48Address</span></code>) if the short address has been set.</p></li>
</ul>
<p>The 48-bit pseudo-address is generated according to either RFC 4944 or RFC 6282 depending on the
configuration of an Attribute (<code class="docutils literal notranslate"><span class="pre">PseudoMacAddressMode</span></code>).</p>
<p>The default is to use RFC 6282 style addresses.</p>
<p>Note that, on reception, a packet might contain either a short or a long address. This is reflected
in the upper-layer notification callback, which can contain either the pseudo-address (48 bits) or
the long address (64 bit) of the sender.</p>
<p>Note also that RFC 4944 or RFC 6282 are the RFCs defining the IPv6 address compression formats
(HC1 and IPHC respectively). It is definitely not a good idea to either mix devices using different
pseudo-address format or compression types in the same network. This point is further discussed
in the <code class="docutils literal notranslate"><span class="pre">sixlowpan</span></code> module documentation.</p>
</section>
</section>
</section>
<section id="scope-and-limitations">
<h3><span class="section-number">19.1.2. </span>Scope and Limitations<a class="headerlink" href="#scope-and-limitations" title="Link to this heading">¶</a></h3>
<p>Future versions of this document will contain a PICS proforma similar to
Appendix D of IEEE 802.15.4-2006. The current emphasis is on direct transmissions
running on both, slotted and unslotted mode (CSMA/CA) of 802.15.4 operation for use in Zigbee.</p>
<ul class="simple">
<li><p>Indirect data transmissions are not supported but planned for a future update.</p></li>
<li><p>Devices are capable of associating with a single PAN coordinator. Interference is modeled as AWGN but this is currently not thoroughly tested.</p></li>
<li><p>The standard describes the support of multiple PHY band-modulations but currently, only 250kbps O-QPSK (channel page 0) is supported.</p></li>
<li><p>Active and passive MAC scans are able to obtain a LQI value from a beacon frame, however, the scan primitives assumes LQI is correctly implemented and does not check the validity of its value.</p></li>
<li><p>Configuration of the ED thresholds are currently not supported.</p></li>
<li><p>Coordinator realignment command is only supported in orphan scans.</p></li>
<li><p>Disassociation primitives are not supported.</p></li>
<li><p>Security is not supported.</p></li>
<li><p>Beacon enabled mode GTS are not supported.</p></li>
</ul>
</section>
<section id="references">
<h3><span class="section-number">19.1.3. </span>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Wireless Medium Access Control (MAC) and Physical Layer (PHY) Specifications for Low-Rate Wireless Personal Area Networks (WPANs), IEEE Computer Society, IEEE Std 802.15.4-2006, 8 September 2006.</p></li>
<li><p>IEEE Standard for Local and metropolitan area networks–Part 15.4: Low-Rate Wireless Personal Area Networks (LR-WPANs),” in IEEE Std 802.15.4-2011 (Revision of IEEE Std 802.15.4-2006) , vol., no., pp.1-314, 5 Sept. 2011, doi: 10.1109/IEEESTD.2011.6012487.</p></li>
<li><ol class="upperalpha simple" start="10">
<li><p>Zheng and Myung J. Lee, “A comprehensive performance study of IEEE 802.15.4,” Sensor Network Operations, IEEE Press, Wiley Interscience, Chapter 4, pp. 218-237, 2006.</p></li>
</ol>
</li>
<li><p>Alberto Gallegos Ramonet and Taku Noguchi. 2020. LR-WPAN: Beacon Enabled Direct Transmissions on Ns-3. In 2020 the 6th International Conference on Communication and Information Processing (ICCIP 2020). Association for Computing Machinery, New York, NY, USA, 115–122. <a class="reference external" href="https://doi.org/10.1145/3442555.3442574">https://doi.org/10.1145/3442555.3442574</a>.</p></li>
<li><p>Gallegos Ramonet, A.; Noguchi, T. Performance Analysis of IEEE 802.15.4 Bootstrap Process. Electronics 2022, 11, 4090. <a class="reference external" href="https://doi.org/10.3390/electronics11244090">https://doi.org/10.3390/electronics11244090</a>.</p></li>
</ul>
</section>
</section>
<section id="usage">
<h2><span class="section-number">19.2. </span>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<section id="enabling-lr-wpan">
<h3><span class="section-number">19.2.1. </span>Enabling lr-wpan<a class="headerlink" href="#enabling-lr-wpan" title="Link to this heading">¶</a></h3>
<p>Add <code class="docutils literal notranslate"><span class="pre">lr-wpan</span></code> to the list of modules built with <em>ns-3</em>.</p>
</section>
<section id="helper">
<h3><span class="section-number">19.2.2. </span>Helper<a class="headerlink" href="#helper" title="Link to this heading">¶</a></h3>
<p>The helper is patterned after other device helpers.  In particular,
tracing (ascii and pcap) is enabled similarly, and enabling of all
lr-wpan log components is performed similarly.  Use of the helper
is exemplified in <code class="docutils literal notranslate"><span class="pre">examples/lr-wpan-data.cc</span></code>.  For ascii tracing,
the transmit and receive traces are hooked at the Mac layer.</p>
<p>The default propagation loss model added to the channel, when this helper
is used, is the LogDistancePropagationLossModel with default parameters.</p>
</section>
<section id="examples">
<h3><span class="section-number">19.2.3. </span>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h3>
<p>The following examples have been written, which can be found in <code class="docutils literal notranslate"><span class="pre">src/lr-wpan/examples/</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-data.cc</span></code>:  A simple example showing end-to-end data transfer.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-error-distance-plot.cc</span></code>:  An example to plot variations of the packet success ratio as a function of distance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-per-plot.cc</span></code>: An example to plot the theoretical and experimental packet error rate (PER) as a function of receive signal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-error-model-plot.cc</span></code>:  An example to test the phy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-packet-print.cc</span></code>:  An example to print out the MAC header fields.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-phy-test.cc</span></code>:  An example to test the phy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-ed-scan.cc</span></code>:  Simple example showing the use of energy detection (ED) scan in the MAC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-active-scan.cc</span></code>:  A simple example showing the use of an active scan in the MAC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-mlme.cc</span></code>: Demonstrates the use of lr-wpan beacon mode. Nodes use a manual association (i.e. No bootstrap) in this example.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-bootstrap.cc</span></code>:  Demonstrates the use of scanning and association working together to initiate a PAN.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-orphan-scan.cc</span></code>: Demonstrates the use of an orphan scanning in a simple network joining procedure.</p></li>
</ul>
<p>In particular, the module enables a very simplified end-to-end data
transfer scenario, implemented in <code class="docutils literal notranslate"><span class="pre">lr-wpan-data.cc</span></code>.  The figure
shows a sequence of events that are triggered when the MAC receives
a DataRequest from the higher layer.  It invokes a Clear Channel
Assessment (CCA) from the PHY, and if successful, sends the frame
down to the PHY where it is transmitted over the channel and results
in a DataIndication on the peer node.</p>
<figure class="align-default" id="id5">
<span id="fig-lr-wpan-data"></span><img alt="_images/lr-wpan-data-example.png" src="_images/lr-wpan-data-example.png" />
<figcaption>
<p><span class="caption-text">Data example for simple LR-WPAN data transfer end-to-end</span><a class="headerlink" href="#id5" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The example <code class="docutils literal notranslate"><span class="pre">lr-wpan-error-distance-plot.cc</span></code> plots the packet success
ratio (PSR) as a function of distance, using the default LogDistance
propagation loss model and the 802.15.4 error model.  The channel (default 11),
packet size (default PSDU 20 bytes = 11 bytes MAC header + data payload), transmit power (default 0 dBm)
and Rx sensitivity (default -106.58 dBm) can be varied by command line arguments.
The program outputs a file named <code class="docutils literal notranslate"><span class="pre">802.15.4-psr-distance.plt</span></code>.
Loading this file into gnuplot yields a file <code class="docutils literal notranslate"><span class="pre">802.15.4-psr-distance.eps</span></code>, which can
be converted to pdf or other formats.  The following image shows the output
of multiple runs using different Rx sensitivity values. A higher Rx sensitivity (lower dBm) results
in a increased communication distance but also makes the radio susceptible to more interference from
surrounding devices.</p>
<figure class="align-default" id="id6">
<span id="fig-802-15-4-psr-distance"></span><img alt="_images/802-15-4-psr-distance.png" src="_images/802-15-4-psr-distance.png" />
<figcaption>
<p><span class="caption-text">Default output of the program <code class="docutils literal notranslate"><span class="pre">lr-wpan-error-distance-plot.cc</span></code></span><a class="headerlink" href="#id6" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="tests">
<h3><span class="section-number">19.2.4. </span>Tests<a class="headerlink" href="#tests" title="Link to this heading">¶</a></h3>
<p>The following tests have been written, which can be found in <code class="docutils literal notranslate"><span class="pre">src/lr-wpan/tests/</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-ack-test.cc</span></code>:  Check that acknowledgments are being used and issued in the correct order.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-collision-test.cc</span></code>:  Test correct reception of packets with interference and collisions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-error-model-test.cc</span></code>:  Check that the error model gives predictable values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-packet-test.cc</span></code>:  Test the 802.15.4 MAC header/trailer classes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-pd-plme-sap-test.cc</span></code>:  Test the PLME and PD SAP per IEEE 802.15.4</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-spectrum-value-helper-test.cc</span></code>:  Test that the conversion between power (expressed as a scalar quantity) and spectral power, and back again, falls within a 25% tolerance across the range of possible channels and input powers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-ifs-test.cc</span></code>:  Check that the Intraframe Spaces (IFS) are being used and issued in the correct order.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lr-wpan-slotted-csmaca-test.cc</span></code>:  Test the transmission and deferring of data packets in the Contention Access Period (CAP) for the slotted CSMA/CA (beacon-enabled mode).</p></li>
</ul>
</section>
</section>
<section id="validation">
<h2><span class="section-number">19.3. </span>Validation<a class="headerlink" href="#validation" title="Link to this heading">¶</a></h2>
<p>The model has not been validated against real hardware.  The error model
has been validated against the data in IEEE Std 802.15.4-2006,
section E.4.1.7 (Figure E.2). The MAC behavior (CSMA backoff) has been
validated by hand against expected behavior.  The below plot is an example
of the error model validation and can be reproduced by running
<code class="docutils literal notranslate"><span class="pre">lr-wpan-error-model-plot.cc</span></code>:</p>
<figure class="align-default" id="id7">
<span id="fig-802-15-4-ber"></span><img alt="_images/802-15-4-ber.png" src="_images/802-15-4-ber.png" />
<figcaption>
<p><span class="caption-text">Default output of the program <code class="docutils literal notranslate"><span class="pre">lr-wpan-error-model-plot.cc</span></code></span><a class="headerlink" href="#id7" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">19. Low-Rate Wireless Personal Area Network (LR-WPAN)</a><ul>
<li><a class="reference internal" href="#model-description">19.1. Model Description</a><ul>
<li><a class="reference internal" href="#design">19.1.1. Design</a><ul>
<li><a class="reference internal" href="#apis">19.1.1.1. APIs</a><ul>
<li><a class="reference internal" href="#mac-primitives">19.1.1.1.1. MAC Primitives</a></li>
<li><a class="reference internal" href="#phy-primitives">19.1.1.1.2. PHY Primitives</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mac">19.1.1.2. MAC</a><ul>
<li><a class="reference internal" href="#mac-queues">19.1.1.2.1. MAC queues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#phy">19.1.1.3. PHY</a></li>
<li><a class="reference internal" href="#netdevice">19.1.1.4. NetDevice</a><ul>
<li><a class="reference internal" href="#mac-addresses">19.1.1.4.1. MAC addresses</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#scope-and-limitations">19.1.2. Scope and Limitations</a></li>
<li><a class="reference internal" href="#references">19.1.3. References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">19.2. Usage</a><ul>
<li><a class="reference internal" href="#enabling-lr-wpan">19.2.1. Enabling lr-wpan</a></li>
<li><a class="reference internal" href="#helper">19.2.2. Helper</a></li>
<li><a class="reference internal" href="#examples">19.2.3. Examples</a></li>
<li><a class="reference internal" href="#tests">19.2.4. Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validation">19.3. Validation</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="lorawan.html"
                          title="previous chapter"><span class="section-number">18. </span>LoRaWAN Module</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="lte.html"
                          title="next chapter"><span class="section-number">20. </span>LTE Module</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/lr-wpan.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="lte.html" title="20. LTE Module"
             >next</a> |</li>
        <li class="right" >
          <a href="lorawan.html" title="18. LoRaWAN Module"
             >previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

        <li class="nav-item nav-item-this"><a href=""><span class="section-number">19. </span>Low-Rate Wireless Personal Area Network (LR-WPAN)</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2006-2019, ns-3 project.
      Last updated on Mar 20, 2024 11:48.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>