
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>24.4. Sockets APIs &#8212; Model Library</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/default.css?v=bb97339c" />
    <script src="_static/documentation_options.js?v=316584e3"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="24.5. Simple NetDevice" href="simple.html" />
    <link rel="prev" title="24.3. Node and NetDevices Overview" href="network-overview.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico"
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="html";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>


  </head><body>
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0" width="100%">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectlogo">
              <a id="ns3_home1"
                 href="http://www.nsnam.org/">
                 <img alt="ns-3 Logo" style="background-color: unset;"
                      src="_static/ns-3-inverted-notext-small.png"/>
              </a>
            </td>
            <td id="projecttext">
              <div id="projectbrief">A Discrete-Event Network Simulator</div>
              <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
            </td>

            <td id="ns3-menu">
              <div class="menu">
                <ul >
                  <li style="background-image:none">
                    <a id="ns3_home2"
                         href="http://www.nsnam.org/"
                         >&nbsp;&nbsp;Home</a>
                  </li>
                  <li><span
                        onmouseover="mopen('mTuts')"
                        onmouseout="mclosetime()"
                          >Tutorials &nbsp;&#x25BC;</span>
                      <div id="mTuts"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_tut"
                           href="/docs/tutorial/html/index.html"
                            >English</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDocs')"
                        onmouseout="mclosetime()"
                          >Documentation &nbsp;&#x25BC;</span>
                      <div id="mDocs"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_ins"
                           href="/docs/installation/html/index.html"
                           >Installation</a><br/>
                        <a id="ns3_man"
                           href="/docs/manual/html/index.html"
                           >Manual</a><br/>
                        <a id="ns3_mod"
                           href="/docs/models/html/index.html"
                           >Models</a><br/>
                        <a id="ns3_con"
                           href="/docs/contributing/html/index.html"
                           >Contributing</a><br/>
                        <a id="ns3_wiki"
                           href="http://www.nsnam.org/wiki"
                           >Wiki</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDev')"
                        onmouseout="mclosetime()"
                          >Development &nbsp;&#x25BC;</span>
                      <div id="mDev"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_api"
                           href="/docs/doxygen/html/index.html"
                           >API Docs</a><br/>
                        <a id="ns3_bugs"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/issues"
                           >Issue Tracker</a><br/>
                        <a id="ns3_merge"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/merge_requests"
                           >Merge Requests</a><br/>
                      </div>
                  </li>
                </ul>
              </div>
            </td>

            <td id="projectsection">
              <span style="margin-right:10px">Models</span>
            </td>
          </tr>
        </tbody>
      </table>
      <script  type="text/javascript">ns3_write_links()</script>
    </div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="simple.html" title="24.5. Simple NetDevice"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="network-overview.html" title="24.3. Node and NetDevices Overview"
             accesskey="P">previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="network.html" accesskey="U"><span class="section-number">24. </span>Network Module</a><span class="navelem">&nbsp;</span></li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">24.4. </span>Sockets APIs</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="sockets-apis">
<span id="id1"></span><h1><span class="section-number">24.4. </span>Sockets APIs<a class="headerlink" href="#sockets-apis" title="Link to this heading">¶</a></h1>
<p>The <a class="reference external" href="http://en.wikipedia.org/wiki/Berkeley_sockets">sockets API</a>
is a long-standing API used by user-space applications to access
network services in the kernel.  A <em>socket</em> is an abstraction, like
a Unix file handle, that allows applications to connect to other
Internet hosts and exchange reliable byte streams and unreliable
datagrams, among other services.</p>
<p><em>ns-3</em> provides two types of sockets APIs, and it is important to
understand the differences between them.  The first is a <em>native</em>
<em>ns-3</em> API, while the second uses the services of the native API to
provide a <a class="reference external" href="http://en.wikipedia.org/wiki/POSIX">POSIX-like</a>
API as part of an overall application process.  Both APIs strive
to be close to the typical sockets API that application writers
on Unix systems are accustomed to, but the POSIX variant is much
closer to a real system’s sockets API.</p>
<section id="ns-3-sockets-api">
<h2><span class="section-number">24.4.1. </span>ns-3 sockets API<a class="headerlink" href="#ns-3-sockets-api" title="Link to this heading">¶</a></h2>
<p>The native sockets API for ns-3 provides an interface to various
types of transport protocols (TCP, UDP) as well as to packet sockets
and, in the future, Netlink-like sockets.  However, users are cautioned
to understand that the semantics are <em>not</em> the exact same as
one finds in a real system (for an API which is very much aligned
to real systems, see the next section).</p>
<p><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Socket</span></code> is defined in <code class="docutils literal notranslate"><span class="pre">src/network/model/socket.h</span></code>.
Readers will note that many public member functions are aligned
with real sockets function calls, and all other things being equal,
we have tried to align with a Posix sockets API.  However, note that:</p>
<ul class="simple">
<li><p>ns-3 applications handle a smart pointer to a Socket object, not
a file descriptor;</p></li>
<li><p>there is no notion of synchronous API or a <em>blocking</em> API;
in fact, the model for interaction between application and socket is
one of asynchronous I/O, which is not typically found in real systems
(more on this below);</p></li>
<li><p>the C-style socket address structures are not used;</p></li>
<li><p>the API is not a complete sockets API, such as supporting
all socket options or all function variants;</p></li>
<li><p>many calls use <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Packet</span></code> class to transfer data
between application and socket.  This may seem peculiar to
pass <em>Packets</em> across a stream socket API, but think
of these packets as just fancy byte buffers at this level (more
on this also below).</p></li>
</ul>
<section id="basic-operation-and-calls">
<h3><span class="section-number">24.4.1.1. </span>Basic operation and calls<a class="headerlink" href="#basic-operation-and-calls" title="Link to this heading">¶</a></h3>
<figure class="align-default" id="id3">
<span id="sockets-overview"></span><img alt="_images/sockets-overview.png" src="_images/sockets-overview.png" />
<figcaption>
<p><span class="caption-text">Implementation overview of native sockets API</span><a class="headerlink" href="#id3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="creating-sockets">
<h3><span class="section-number">24.4.1.2. </span>Creating sockets<a class="headerlink" href="#creating-sockets" title="Link to this heading">¶</a></h3>
<p>An application that wants to use sockets must first create one.
On real systems using a C-based API, this is accomplished by calling <code class="xref c c-func docutils literal notranslate"><span class="pre">socket()</span></code></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="nf">socket</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">domain</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">protocol</span><span class="p">);</span>
</pre></div>
</div>
<p>which creates a socket in the system and returns an integer descriptor.</p>
<p>In ns-3, we have no equivalent of a system call at the lower layers,
so we adopt the following model.  There are certain <em>factory</em>
objects that can create sockets.  Each factory is capable of creating
one type of socket, and if sockets of a particular type are able to
be created on a given node, then a factory that can create such sockets
must be aggregated to the Node:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span><span class="w"> </span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Socket</span><span class="o">&gt;</span><span class="w"> </span><span class="n">CreateSocket</span><span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">TypeId</span><span class="w"> </span><span class="n">tid</span><span class="p">);</span>
</pre></div>
</div>
<p>Examples of TypeIds to pass to this method are <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::TcpSocketFactory</span></code>,
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::PacketSocketFactory</span></code>, and <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::UdpSocketFactory</span></code>.</p>
<p>This method returns a smart pointer to a Socket object.  Here is an
example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span><span class="w"> </span><span class="n">n0</span><span class="p">;</span>
<span class="c1">// Do some stuff to build up the Node&#39;s internet stack</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Socket</span><span class="o">&gt;</span><span class="w"> </span><span class="n">localSocket</span><span class="w"> </span><span class="o">=</span>
<span class="w">   </span><span class="n">Socket</span><span class="o">::</span><span class="n">CreateSocket</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span><span class="w"> </span><span class="n">TcpSocketFactory</span><span class="o">::</span><span class="n">GetTypeId</span><span class="p">());</span>
</pre></div>
</div>
<p>In some ns-3 code, sockets will not be explicitly created by user’s
main programs, if an ns-3 application does it.  For instance, for
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::OnOffApplication</span></code>, the function <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::OnOffApplication::StartApplication()</span></code>
performs the socket creation, and the application holds the socket
pointer.</p>
</section>
<section id="using-sockets">
<h3><span class="section-number">24.4.1.3. </span>Using sockets<a class="headerlink" href="#using-sockets" title="Link to this heading">¶</a></h3>
<p>Below is a typical sequence of socket calls for a TCP client in a
real implementation:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(</span><span class="n">PF_INET</span><span class="p">,</span><span class="w"> </span><span class="n">SOCK_STREAM</span><span class="p">,</span><span class="w"> </span><span class="n">IPPROTO_TCP</span><span class="p">);</span>
<span class="n">bind</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<span class="n">connect</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<span class="n">send</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<span class="n">recv</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<span class="n">close</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
</pre></div>
</div>
<p>There are analogs to all of these calls in ns-3, but we will focus on
two aspects here.  First, most usage of sockets in real systems
requires a way to manage I/O between the application and kernel.
These models include <em>blocking sockets</em>, <em>signal-based I/O</em>,
and <em>non-blocking sockets</em> with polling.  In ns-3, we make use
of the callback mechanisms to support a fourth mode, which is
analogous to POSIX <em>asynchronous I/O</em>.</p>
<p>In this model, on the sending side, if the <code class="xref c c-func docutils literal notranslate"><span class="pre">send()</span></code> call were to
fail because of insufficient buffers, the application suspends the
sending of more data until a function registered at the
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::SetSendCallback()</span></code> callback is invoked.
An application can also ask the socket how much space is available
by calling <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::GetTxAvailable()</span></code>.  A typical sequence
of events for sending data (ignoring connection setup) might be:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">SetSendCallback</span><span class="p">(</span><span class="n">MakeCallback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">HandleSendCallback</span><span class="p">));</span>
<span class="n">Send</span><span class="p">();</span>
<span class="n">Send</span><span class="p">();</span>
<span class="p">...</span>
<span class="c1">// Send fails because buffer is full</span>
<span class="c1">// Wait until HandleSendCallback is called</span>
<span class="c1">// HandleSendCallback is called by socket, since space now available</span>
<span class="n">Send</span><span class="p">();</span><span class="w"> </span><span class="c1">// Start sending again</span>
</pre></div>
</div>
<p>Similarly, on the receive side, the socket user does not block on
a call to <code class="docutils literal notranslate"><span class="pre">recv()</span></code>.  Instead, the application sets a callback
with <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::SetRecvCallback()</span></code> in which the socket will notify the
application when (and how much) there is data to be read, and
the application then calls <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::Recv()</span></code> to read the data until
no more can be read.</p>
</section>
</section>
<section id="packet-vs-buffer-variants">
<h2><span class="section-number">24.4.2. </span>Packet vs. buffer variants<a class="headerlink" href="#packet-vs-buffer-variants" title="Link to this heading">¶</a></h2>
<p>There are two basic variants of <code class="docutils literal notranslate"><span class="pre">Send()</span></code> and <code class="docutils literal notranslate"><span class="pre">Recv()</span></code> supported:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Send</span><span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Send</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>

<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Recv</span><span class="p">();</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">Recv</span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
</pre></div>
</div>
<p>The non-Packet variants are provided for legacy API reasons.  When calling
the raw buffer variant of <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::Send()</span></code>, the buffer is immediately
written into a Packet and the packet variant is invoked.</p>
<p>Users may find it semantically odd to pass a Packet to a stream socket
such as TCP.  However, do not let the name bother you; think of
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Packet</span></code> to be a fancy byte buffer.  There are a few reasons why
the Packet variants are more likely to be preferred in ns-3:</p>
<ul class="simple">
<li><p>Users can use the Tags facility of packets to, for example, encode
a flow ID or other helper data at the application layer.</p></li>
<li><p>Users can exploit the copy-on-write implementation to avoid
memory copies (on the receive side, the conversion back to a
<code class="docutils literal notranslate"><span class="pre">uint8_t*</span> <span class="pre">buf</span></code> may sometimes incur an additional copy).</p></li>
<li><p>Use of Packet is more aligned with the rest of the ns-3 API</p></li>
</ul>
</section>
<section id="sending-dummy-data">
<h2><span class="section-number">24.4.3. </span>Sending dummy data<a class="headerlink" href="#sending-dummy-data" title="Link to this heading">¶</a></h2>
<p>Sometimes, users want the simulator to just pretend that there is an
actual data payload in the packet (e.g. to calculate transmission delay)
but do not want to actually produce or consume the data.  This is
straightforward to support in ns-3; have applications call
<code class="docutils literal notranslate"><span class="pre">Create&lt;Packet&gt;</span> <span class="pre">(size);</span></code> instead of <code class="docutils literal notranslate"><span class="pre">Create&lt;Packet&gt;</span> <span class="pre">(buffer,</span> <span class="pre">size);</span></code>.
Similarly, passing in a zero to the pointer argument in the raw buffer
variants has the same effect.  Note that, if some subsequent code tries
to read the Packet data buffer, the fake buffer will be converted to
a real (zeroed) buffer on the spot, and the efficiency will be lost there.</p>
</section>
<section id="use-of-send-vs-sendto">
<span id="socket-options"></span><h2><span class="section-number">24.4.4. </span>Use of Send() vs. SendTo()<a class="headerlink" href="#use-of-send-vs-sendto" title="Link to this heading">¶</a></h2>
<p>There are two variants of methods used to send data to the socket:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Send</span><span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">flags</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="k">virtual</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">SendTo</span><span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span>
<span class="w">                    </span><span class="k">const</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="o">&amp;</span><span class="n">toAddress</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>The first method is used if the socket has already been connected
(<code class="docutils literal notranslate"><span class="pre">Socket::Connect()</span></code>) to a peer address.  In the case of stream-based
sockets like TCP, the connect call is required to bind the socket to
a peer address, and thereafter, <code class="docutils literal notranslate"><span class="pre">Send()</span></code> is typically used.  In the case of
datagram-based sockets like UDP, the socket is not required to
be connected to a peer address before sending, and the socket may be used to
send data to different destination addresses; in this case, the
<code class="docutils literal notranslate"><span class="pre">SendTo()</span></code> method is used to specify the destination address for
the datagram.</p>
</section>
<section id="id2">
<h2><span class="section-number">24.4.5. </span>Socket options<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<section id="tos-type-of-service">
<span id="type-of-service"></span><h3><span class="section-number">24.4.5.1. </span>ToS (Type of Service)<a class="headerlink" href="#tos-type-of-service" title="Link to this heading">¶</a></h3>
<p>The native sockets API for ns-3 provides two public methods
(of the Socket base class):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">SetIpTos</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">ipTos</span><span class="p">);</span>
<span class="kt">uint8_t</span><span class="w"> </span><span class="nf">GetIpTos</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p>to set and get, respectively, the type of service associated with the socket.
These methods are equivalent to using the IP_TOS option of BSD sockets.
Clearly, setting the type of service only applies to sockets using the IPv4 protocol.
However, users typically do not set the type of service associated with a socket
through <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::SetIpTos()</span></code> because sockets are normally created
by application helpers and users cannot get a pointer to the sockets.
Instead, users can create an address of type <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::InetSocketAddress</span></code>
with the desired type of service value and pass it to the application helpers:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">InetSocketAddress</span><span class="w"> </span><span class="nf">destAddress</span><span class="p">(</span><span class="n">ipv4Address</span><span class="p">,</span><span class="w"> </span><span class="n">udpPort</span><span class="p">);</span>
<span class="n">destAddress</span><span class="p">.</span><span class="n">SetTos</span><span class="p">(</span><span class="n">tos</span><span class="p">);</span>
<span class="n">OnOffHelper</span><span class="w"> </span><span class="n">onoff</span><span class="p">(</span><span class="s">&quot;ns3::UdpSocketFactory&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">destAddress</span><span class="p">);</span>
</pre></div>
</div>
<p>For this to work, the application must eventually call the
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::Connect()</span></code> method to connect to the provided
destAddress and the Connect method of the particular socket type must
support setting the type of service associated with a socket (by using
the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::SetIpTos()</span></code> method). Currently, the socket
types that support setting the type of service in such a way are
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::UdpSocketImpl</span></code> and <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::TcpSocketBase</span></code>.</p>
<p>The type of service associated with a socket is then used to determine the value
of the Type of Service field (renamed as Differentiated Services field by RFC
2474) of the IPv4 header of the packets sent through that socket, as detailed
in the next sections.</p>
<section id="setting-the-tos-with-udp-sockets">
<h4><span class="section-number">24.4.5.1.1. </span>Setting the ToS with UDP sockets<a class="headerlink" href="#setting-the-tos-with-udp-sockets" title="Link to this heading">¶</a></h4>
<p>For IPv4 packets, the ToS field is set according to the following rules:</p>
<ul class="simple">
<li><p>If the socket is connected, the ToS field is set to the ToS value associated
with the socket.</p></li>
<li><p>If the socket is not connected, the ToS field is set to the value specified
in the destination address (of type <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::InetSocketAddress</span></code>) passed
to <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::SendTo()</span></code>, and the ToS value associated with the
socket is ignored.</p></li>
</ul>
</section>
<section id="setting-the-tos-with-tcp-sockets">
<h4><span class="section-number">24.4.5.1.2. </span>Setting the ToS with TCP sockets<a class="headerlink" href="#setting-the-tos-with-tcp-sockets" title="Link to this heading">¶</a></h4>
<p>For IPv4 packets, the ToS field is set to the ToS value associated with the
socket.</p>
</section>
</section>
<section id="priority">
<h3><span class="section-number">24.4.5.2. </span>Priority<a class="headerlink" href="#priority" title="Link to this heading">¶</a></h3>
<p>The native sockets API for ns-3 provides two public methods
(of the Socket base class):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">SetPriority</span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">priority</span><span class="p">);</span>
<span class="kt">uint8_t</span><span class="w"> </span><span class="nf">GetPriority</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p>to set and get, respectively, the priority associated with the socket.
These methods are equivalent to using the SO_PRIORITY option of BSD sockets.
Only values in the range 0..6 can be set through the above method.</p>
<p>Note that setting the type of service associated with a socket (by calling
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::SetIpTos()</span></code>) also sets the priority for the socket
to the value that the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::IpTos2Priority()</span></code> function
returns when it is passed the type of service value. This function
is implemented after the Linux rt_tos2priority function, which takes
an 8-bit value as input and returns a value which is a function of bits 3-6
(where bit 0 is the most significant bit) of the input value:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Bits 3-6</p></th>
<th class="head"><p>Priority</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0 to 3</p></td>
<td><p>0 (Best Effort)</p></td>
</tr>
<tr class="row-odd"><td><p>4 to 7</p></td>
<td><p>2 (Bulk)</p></td>
</tr>
<tr class="row-even"><td><p>8 to 11</p></td>
<td><p>6 (Interactive)</p></td>
</tr>
<tr class="row-odd"><td><p>12 to 15</p></td>
<td><p>4 (Interactive Bulk)</p></td>
</tr>
</tbody>
</table>
<p>The rationale is that bits 3-6 of the Type of Service field were interpreted
as the TOS subfield by (the obsolete) RFC 1349. Readers can refer to the
doxygen documentation of <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::IpTos2Priority()</span></code>
for more information, including how DSCP values map onto priority values.</p>
<p>The priority set for a socket (as described above) is then used to determine
the priority of the packets sent through that socket, as detailed in the next
sections. Currently, the socket types that support setting the packet priority
are <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::UdpSocketImpl</span></code>, <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::TcpSocketBase</span></code> and
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::PacketSocket</span></code>. The packet priority is used, e.g., by queuing
disciplines such as the default PfifoFastQueueDisc to classify packets into
distinct queues.</p>
<section id="setting-the-priority-with-udp-sockets">
<h4><span class="section-number">24.4.5.2.1. </span>Setting the priority with UDP sockets<a class="headerlink" href="#setting-the-priority-with-udp-sockets" title="Link to this heading">¶</a></h4>
<p>If the packet is an IPv4 packet and the value to be inserted in the ToS field
is not null, then the packet is assigned a priority based on such ToS value
(according to the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::Socket::IpTos2Priority()</span></code> function). Otherwise,
the priority associated with the socket is assigned to the packet.</p>
</section>
<section id="setting-the-priority-with-tcp-sockets">
<h4><span class="section-number">24.4.5.2.2. </span>Setting the priority with TCP sockets<a class="headerlink" href="#setting-the-priority-with-tcp-sockets" title="Link to this heading">¶</a></h4>
<p>Every packet is assigned a priority equal to the priority associated with the
socket.</p>
</section>
<section id="setting-the-priority-with-packet-sockets">
<h4><span class="section-number">24.4.5.2.3. </span>Setting the priority with packet sockets<a class="headerlink" href="#setting-the-priority-with-packet-sockets" title="Link to this heading">¶</a></h4>
<p>Every packet is assigned a priority equal to the priority associated with the
socket.</p>
</section>
</section>
</section>
<section id="socket-errno">
<h2><span class="section-number">24.4.6. </span>Socket errno<a class="headerlink" href="#socket-errno" title="Link to this heading">¶</a></h2>
<p><em>to be completed</em></p>
</section>
<section id="example-programs">
<h2><span class="section-number">24.4.7. </span>Example programs<a class="headerlink" href="#example-programs" title="Link to this heading">¶</a></h2>
<p><em>to be completed</em></p>
</section>
<section id="posix-like-sockets-api">
<h2><span class="section-number">24.4.8. </span>POSIX-like sockets API<a class="headerlink" href="#posix-like-sockets-api" title="Link to this heading">¶</a></h2>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">24.4. Sockets APIs</a><ul>
<li><a class="reference internal" href="#ns-3-sockets-api">24.4.1. ns-3 sockets API</a><ul>
<li><a class="reference internal" href="#basic-operation-and-calls">24.4.1.1. Basic operation and calls</a></li>
<li><a class="reference internal" href="#creating-sockets">24.4.1.2. Creating sockets</a></li>
<li><a class="reference internal" href="#using-sockets">24.4.1.3. Using sockets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#packet-vs-buffer-variants">24.4.2. Packet vs. buffer variants</a></li>
<li><a class="reference internal" href="#sending-dummy-data">24.4.3. Sending dummy data</a></li>
<li><a class="reference internal" href="#use-of-send-vs-sendto">24.4.4. Use of Send() vs. SendTo()</a></li>
<li><a class="reference internal" href="#id2">24.4.5. Socket options</a><ul>
<li><a class="reference internal" href="#tos-type-of-service">24.4.5.1. ToS (Type of Service)</a><ul>
<li><a class="reference internal" href="#setting-the-tos-with-udp-sockets">24.4.5.1.1. Setting the ToS with UDP sockets</a></li>
<li><a class="reference internal" href="#setting-the-tos-with-tcp-sockets">24.4.5.1.2. Setting the ToS with TCP sockets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#priority">24.4.5.2. Priority</a><ul>
<li><a class="reference internal" href="#setting-the-priority-with-udp-sockets">24.4.5.2.1. Setting the priority with UDP sockets</a></li>
<li><a class="reference internal" href="#setting-the-priority-with-tcp-sockets">24.4.5.2.2. Setting the priority with TCP sockets</a></li>
<li><a class="reference internal" href="#setting-the-priority-with-packet-sockets">24.4.5.2.3. Setting the priority with packet sockets</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#socket-errno">24.4.6. Socket errno</a></li>
<li><a class="reference internal" href="#example-programs">24.4.7. Example programs</a></li>
<li><a class="reference internal" href="#posix-like-sockets-api">24.4.8. POSIX-like sockets API</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="network-overview.html"
                          title="previous chapter"><span class="section-number">24.3. </span>Node and NetDevices Overview</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="simple.html"
                          title="next chapter"><span class="section-number">24.5. </span>Simple NetDevice</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/sockets-api.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="simple.html" title="24.5. Simple NetDevice"
             >next</a> |</li>
        <li class="right" >
          <a href="network-overview.html" title="24.3. Node and NetDevices Overview"
             >previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="network.html" ><span class="section-number">24. </span>Network Module</a><span class="navelem">&nbsp;</span></li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">24.4. </span>Sockets APIs</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2006-2019.
      Last updated on Nov 10, 2023 15:56.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>