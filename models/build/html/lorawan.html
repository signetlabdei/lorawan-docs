

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>LoRaWAN Module &#8212; Model Library</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Low-Rate Wireless Personal Area Network (LR-WPAN)" href="lr-wpan.html" />
    <link rel="prev" title="Internet Applications Module Documentation" href="internet-apps.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico" 
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="html";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>
      

  </head><body>
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0" width="100%">
      <tbody>
	<tr style="height: 56px;">
	  <td id="projectlogo">
	    <a id="ns3_home1"
	       href="http://www.nsnam.org/">
	       <img alt="ns-3 Logo"
		    src="_static/ns-3-inverted-notext-small.png"/>
	    </a>
	  </td>
	  <td id="projecttext">
	    <div id="projectbrief">A Discrete-Event Network Simulator</div>
	      <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
	  </td>
	      
	  <td id="ns3-menu">
	    <div class="menu">
	      <ul >
	        <li><a id="ns3_home2"
		       href="http://www.nsnam.org/"
		       >&nbsp;&nbsp;Home</a>
	        </li>
	        <li><span
		      onmouseover="mopen('mTuts')" 
		      onmouseout="mclosetime()"
			>Tutorials &nbsp;&#x25BC;</span>
		    <div id="mTuts" 
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_tut"
			 href="/docs/tutorial/html/index.html"
			  >English</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDocs')" 
		      onmouseout="mclosetime()"
			>Docs &nbsp;&nbsp;&nbsp;&#x25BC;</span>
		    <div id="mDocs"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_wiki"
			 href="http://www.nsnam.org/wiki"
			 >Wiki</a><br/>
		      <a id="ns3_man"
			 href="/docs/manual/html/index.html"
			 >Manual</a><br/>
		      <a id="ns3_mod"
			 href="/docs/models/html/index.html"
			 >Models</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDev')" 
		      onmouseout="mclosetime()"
			>Develop &#x25BC;</span>
		    <div id="mDev"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_api"
			 href="/docs/doxygen/html/index.html"
			 >API</a><br/>
		      <a id="ns3_bugs"
		       href="http://www.nsnam.org/bugzilla/">Bugs</a>
	        </li>
	      </ul>
	    </div>
	  </td>
	  <td id="projectsection">
	    <span style="margin-right:10px">Models</span>
	  </td>
	</tr>
      </tbody>
    </table>
    <script  type="text/javascript">ns3_write_links()</script>
  </div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="lr-wpan.html" title="Low-Rate Wireless Personal Area Network (LR-WPAN)"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="internet-apps.html" title="Internet Applications Module Documentation"
             accesskey="P">previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="lorawan-module">
<h1>LoRaWAN Module<a class="headerlink" href="#lorawan-module" title="Permalink to this headline">¶</a></h1>
<p>This module contains a series of classes and examples aimed at modeling the
modulation and medium access technology of a LoRaWAN network. Thanks to a simple
underlying physical layer model and to the regulations imposed on traffic in the
unlicensed bands this technology operates on, this module can support
simulations featuring a large number of devices that access the wireless channel
infrequently.</p>
<p>The following parts of this documentation first outline how the technology works
and then describe how it was translated into a system of classes in order to
simulate a LoRaWAN system.</p>
<div class="section" id="technology">
<h2>Technology<a class="headerlink" href="#technology" title="Permalink to this headline">¶</a></h2>
<p>LoRaWAN is a Low Power Wide Area Network (LPWAN) technology built on the LoRa
modulation. This technology allows a large number of devices to communicate
wirelessly over long distances (in the order of 5-15 km, depending on the
propagation environment) at low data rates. The typical scenario in which this
technology is expected to be employed is that of an IoT network, where devices
need to communicate sparsely and only need short payloads to transmit
some information coming from, typically, a sensor.</p>
<div class="section" id="lora">
<h3>LoRa<a class="headerlink" href="#lora" title="Permalink to this headline">¶</a></h3>
<p>The basis of LoRaWAN is the proprietary Long Range (LoRa) modulation, owned by
Semtech. This modulation, based on Chirp Spread Spectrum (CSS), spreads a signal
over a certain band by leveraging a chirp signal that scans the available
bandwidth linearly.</p>
<p>One of the key parameters of the modulation is the Spreading Factor (SF): this
value, ranging from 7 to 12, expresses how much a packet is spread in time
(i.e., how long it takes for a chirp to complete a complete scan of the
available bandwidth). Transmissions using a low SF need a lower Time on Air
(ToA) (assuming the same bandwidth) than packets using SF values closer to 12.
The advantage of using higher SFs is in the increased sensitivity of the
receiver: as an example, a transmission using SF7 that cannot be detected by a
LoRa receiver may be correctly demodulated if performed using SF12. Another
key feature of the modulation is the quasi-orthogonality between transmissions
using different SF values: even if two packets overlap in time, a receiver may
still be able to demodulate one of the packets, assuming that they are using
different SF and that some restrictions on their reciprocal power are respected.</p>
<p>More details on how the modulation works can be found in
<a class="reference internal" href="#semtech2015modulation" id="id1"><span>[semtech2015modulation]</span></a> (an official document explaining the modulation) and in
<a class="reference internal" href="#knight2016reversing" id="id2"><span>[knight2016reversing]</span></a> (a reverse engineering of the modulation by Matt Knight).</p>
</div>
<div class="section" id="lorawan">
<h3>LoRaWAN<a class="headerlink" href="#lorawan" title="Permalink to this headline">¶</a></h3>
<p>The LoRa Alliance first defined the LoRaWAN standard in <a class="reference internal" href="#lorawanstandard" id="id3"><span>[lorawanstandard]</span></a>,
with the objective of creating a medium access scheme and a set of network
management policies that leverage the properties of the modulation to achieve
good network performance at a low price in the complexity of the devices.</p>
<p>The topology of a LoRaWAN network is represented in the figure
<a class="reference internal" href="#lorawan-topology"><span class="std std-ref">Topology of the LoRaWAN architecture.</span></a>, where dotted lines represent a LoRa wireless link while
solid lines are other kinds of high throughput, high reliability connections. It
can be seen that there are three kinds of devices in a LoRaWAN network: End
Devices (EDs), Gateways (GWs) and a Network Server (NS). End Devices are basic
network nodes: typically inexpensive, they are constrained by low computational
capabilities and are usually powered by a battery. Gateways are high-end, mains
powered devices that are tasked with collecting the data transmitted by End
Devices leveraging the LoRa modulation. After a packet is correctly received, it
is forwarded to the Network Server via a link with high reliability and speed.
The Network Server functions as a sink for data coming from all devices, and as
a controller of the network that can leverage some MAC commands to change
transmission settings in the End Devices.</p>
<p>End Devices of the most basic type are defined as Class A devices, and are
currently the only kind of device supported by this module. Class A devices
perform transmission in a totally asynchronous way, and open two receive windows
of fixed duration after each transmission to allow the Network Server to
transmit acknowledgments or MAC commands.</p>
<p>Another important characteristic of the standard is that it is defined to work
on unlicensed bands in various regions, which usually subject transmitters to
regulations on duty cycle. This fact will be explained in greater detail in the
MAC layer model section of this document.</p>
<div class="figure align-default" id="id8">
<span id="lorawan-topology"></span><img alt="figures/LoRaWANTopology.*" src="figures/LoRaWANTopology.*" />
<p class="caption"><span class="caption-text">Topology of the LoRaWAN architecture.</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="module-design">
<h2>Module design<a class="headerlink" href="#module-design" title="Permalink to this headline">¶</a></h2>
<p>This module comprises two main models: one for the LoRa PHY layer that needs to
represent LoRa chips and the behavior of LoRa transmissions, and one for the
LoRaWAN MAC layer, that needs to behave according to the official
specifications.</p>
<p>To represent these two models, the module features two generic <code class="docutils literal notranslate"><span class="pre">LoraPhy</span></code> and
<code class="docutils literal notranslate"><span class="pre">LorawanMac</span></code> base classes. These classes are then extended by classes that
model the peculiarities of the two wireless network devices: the End Device (ED)
and the Gateway (GW). So, the PHY layers can be modeled by use of
<code class="docutils literal notranslate"><span class="pre">EndDeviceLoraPhy</span></code> and <code class="docutils literal notranslate"><span class="pre">GatewayLoraPhy</span></code> classes, while objects of class
<code class="docutils literal notranslate"><span class="pre">EndDeviceLorawanMac</span></code>, <code class="docutils literal notranslate"><span class="pre">ClassAEndDeviceLorawanMac</span></code>, and <code class="docutils literal notranslate"><span class="pre">GatewayLorawanMac</span></code>
are used to represent the MAC layer. A <code class="docutils literal notranslate"><span class="pre">NetworkServer</span></code> application can also be
installed on a node that will then administer the wireless network through the
GW’s forwarding application, <code class="docutils literal notranslate"><span class="pre">Forwarder</span></code>, which leverages the gateway’s LoRa
communication capabilities to forward to End Devices the Network Server’s
packets.</p>
<div class="section" id="phy-layer-model">
<h3>PHY layer model<a class="headerlink" href="#phy-layer-model" title="Permalink to this headline">¶</a></h3>
<p>The model for the PHY layer needs to take into account the two key factors of
LoRa, sensitivity and orthogonality, to decide whether a transmission is
received correctly or not. Besides, it also needs to be aware of how the chips
implementing the modulation work, and of their architecture.</p>
<div class="section" id="link-model">
<h4>Link model<a class="headerlink" href="#link-model" title="Permalink to this headline">¶</a></h4>
<p>The link model takes into account three main components to determine the
performance of a LoRa transmission:</p>
<ul class="simple">
<li><p>Data about device sensitivity taken from device datasheets;</p></li>
<li><p>A model to account for the interference between different LoRa transmissions;</p></li>
<li><p>A series of assumptions regarding this interference model.</p></li>
</ul>
<p>In this section, we will describe each portion of the model with a particular
focus on its implementation in the code.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">LoraChannel</span></code> class is used to interconnect the LoRa PHY layers of all
devices wishing to communicate using this technology. The class holds a list of
connected PHY layers, and notifies them about incoming transmissions, following
the same paradigm of other <code class="docutils literal notranslate"><span class="pre">Channel</span></code> classes in <em>ns-3</em>.</p>
<p>PHY layers that are connected to the channel expose a public <code class="docutils literal notranslate"><span class="pre">StartReceive</span></code>
method that allows the channel to start reception at a certain PHY. At this
point, these PHY classes rely on a <code class="docutils literal notranslate"><span class="pre">LoraInterferenceHelper</span></code> object to keep
track of all incoming packets, both as potentially desirable packets and as
interference. Once the channel notifies the PHY layer of the incoming packet,
the PHY informs its <code class="docutils literal notranslate"><span class="pre">LoraInterferenceHelper</span></code> right away of the incoming
transmission. After this, if a PHY fills certain prerequisites, it can lock on
the incoming packet for reception. In order to do so:</p>
<ol class="arabic simple">
<li><p>The receiver must be idle (in STANDBY state) when the <code class="docutils literal notranslate"><span class="pre">StartReceive</span></code>
function is called;</p></li>
<li><p>The packet receive power must be above a sensitivity threshold;</p></li>
<li><p>The receiver must be listening on the correct frequency;</p></li>
<li><p>The receiver must be listening for the correct SF.</p></li>
</ol>
<p>The sensitivity threshold that is currently implemented can be seen below
(values in dBm):</p>
<div class="math">
<p><img src="_images/math/32916788b8291d81c99b3aa76502bbabadf4490a.png" alt="\begin{matrix}
\scriptstyle{\rm SF7} &amp; \scriptstyle{\rm SF8} &amp; \scriptstyle{\rm SF9} &amp; \scriptstyle{\rm SF10} &amp; \scriptstyle{\rm SF11} &amp; \scriptstyle{\rm SF12}\\
-124 &amp; -127 &amp; -130 &amp; -133 &amp; -135 &amp; -137 \\
\end{matrix}"/></p>
</div><p>After the PHY layer locks on the incoming packet, it schedules an <code class="docutils literal notranslate"><span class="pre">EndReceive</span></code>
function call after the packet duration. The reception power is considered to be
constant throughout the packet reception process. When reception ends,
<code class="docutils literal notranslate"><span class="pre">EndReceive</span></code> calls the <code class="docutils literal notranslate"><span class="pre">IsDestroyedByInterference</span></code> method of the PHY’s
instance of <code class="docutils literal notranslate"><span class="pre">LoraInterferenceHelper</span></code> to determine whether the packet is lost
due to interference.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">IsDestroyedByInterference</span></code> function compares the desired packet’s
reception power with the interference energy of packets that overlap with it on
a SF basis, and compares the obtained SIR value against the isolation matrix
that was tabulated in <a class="reference internal" href="#goursaud2015dedicated" id="id4"><span>[goursaud2015dedicated]</span></a> and reproduced below. For
example, if the desired packet is using SF7, and it is (even partially)
overlapped to two packets using SF10, the desired signal’s energy (computed as
the product of reception power and signal duration) is compared to the summed
energy of the two interferers (computed as the product of the interferer’s power
at the receiver and overlap time). The ratio between the desired and the
interference energy from each spreading factor (considered separately) is then
compared to the table below, in which rows identify the desired signal’s SF,
while columns represent the interfering SF that is currently being considered.
If the SIR is above the tabulated threshold, the packet is received correctly
and forwarded to the MAC layer.</p>
<div class="math">
<p><img src="_images/math/c9a59ca0e1e5f7e0eb210b4798155419ffe71cb9.png" alt="\begin{matrix}
 &amp; \scriptstyle{\rm SF7 } &amp; \scriptstyle{\rm SF8 }&amp; \scriptstyle{\rm SF9 }&amp; \scriptstyle{\rm SF10} &amp; \scriptstyle{\rm SF11} &amp; \scriptstyle{\rm SF12}\\
\scriptstyle{\rm SF7 }&amp; 6    &amp;-16    &amp;-18    &amp;-19    &amp;-19    &amp;-20\\
\scriptstyle{\rm SF8 }&amp; -24  &amp;6      &amp;-20    &amp;-22    &amp;-22    &amp;-22\\
\scriptstyle{\rm SF9 }&amp; -27  &amp;-27    &amp;6      &amp;-23    &amp;-25    &amp;-25\\
\scriptstyle{\rm SF10} &amp; -30 &amp;-30    &amp;-30    &amp;6      &amp;-26    &amp;-28\\
\scriptstyle{\rm SF11} &amp; -33 &amp;-33    &amp;-33    &amp;-33    &amp;6      &amp;-29\\
\scriptstyle{\rm SF12} &amp; -36 &amp;-36    &amp;-36    &amp;-36    &amp;-36    &amp;6\\
\end{matrix}"/></p>
</div><p>A full description of the link layer model can also be found in
<a class="reference internal" href="#magrin2017performance" id="id5"><span>[magrin2017performance]</span></a> and in <a class="reference internal" href="#magrin2017thesis" id="id6"><span>[magrin2017thesis]</span></a>.</p>
</div>
<div class="section" id="gateway-model">
<h4>Gateway model<a class="headerlink" href="#gateway-model" title="Permalink to this headline">¶</a></h4>
<p>The chip installed on LoRa GWs needs special attention because of its
architecture: since it is characterized by the presence of 8 parallel <em>receive
paths</em>, it can receive multiple packets in parallel <a class="reference internal" href="#sx1301" id="id7"><span>[sx1301]</span></a>. This
behavior is represented in the simulator through a <code class="docutils literal notranslate"><span class="pre">ReceptionPath</span></code> object that
behaves as an <code class="docutils literal notranslate"><span class="pre">EndDeviceLoraPhy</span></code>, locking into incoming packets and comparing
them to others to determine correct reception by using the gateway’s
<code class="docutils literal notranslate"><span class="pre">LoraInterferenceHelper</span></code> instance. A <code class="docutils literal notranslate"><span class="pre">GatewayLoraPhy</span></code>, then, is essentially
a manager of this collection of <code class="docutils literal notranslate"><span class="pre">ReceptionPath</span></code> objects. Upon arrival of a
packet, the gateway picks a free reception path (if there are any), marks it as
occupied and locks it into the incoming packet. Once the scheduled
<code class="docutils literal notranslate"><span class="pre">EndReceive</span></code> method is executed, the gateway’s <code class="docutils literal notranslate"><span class="pre">LoraInterferenceHelper</span></code>
(which contains information used by all <code class="docutils literal notranslate"><span class="pre">ReceptionPaths</span></code>) is queried, and it
is decided whether the packet is correctly received or not.</p>
<p>Some further assumptions on the collaboration behavior of these reception paths
were made to establish a consistent model despite the SX1301 gateway chip
datasheet not going into full detail on how the chip administers the available
reception paths:</p>
<ul class="simple">
<li><p>Receive paths can be configured to listen for incoming packets on any
frequency;</p></li>
<li><p>Receive paths can be allocated freely on the available frequencies;</p></li>
<li><p>Receive paths don’t need to be pre-configured to listen for a certain
spreading factor (thus, point 4 of the prerequisites stated above for End
Devices doesn’t apply);</p></li>
<li><p>If a packet is incoming and multiple receive paths are listening for the same
channel, only one locks into the incoming packet;</p></li>
<li><p>If all reception paths listening on a channel are locked into an incoming
packet and another packet arrives, the new packet is immediately marked as
lost.</p></li>
</ul>
</div>
</div>
<div class="section" id="mac-layer-model">
<h3>MAC layer model<a class="headerlink" href="#mac-layer-model" title="Permalink to this headline">¶</a></h3>
<p>The MAC models contained in this module aim at implementing the LoRaWAN
standard. To facilitate this task, a series of side classes were created to
handle headers, MAC commands, logical channels and duty cycle computations.
Furthermore, a simplified version of a Network Server (NS) is also provided in
the form of an application that can be installed on a <em>ns-3</em> <code class="docutils literal notranslate"><span class="pre">Node</span></code> and
connected to the GWs via a <code class="docutils literal notranslate"><span class="pre">PointToPoint</span></code> link to also simulate a backbone
channel.</p>
<div class="section" id="headers-mac-commands-and-addressing-system">
<h4>Headers, MAC commands and addressing system<a class="headerlink" href="#headers-mac-commands-and-addressing-system" title="Permalink to this headline">¶</a></h4>
<p>The packet structure defined by the LoRaWAN standard is implemented through two
classes that extend the <code class="docutils literal notranslate"><span class="pre">Header</span></code> class: <code class="docutils literal notranslate"><span class="pre">LorawanMacHeader</span></code> and
<code class="docutils literal notranslate"><span class="pre">LoraFrameHeader</span></code>. In particular, <code class="docutils literal notranslate"><span class="pre">LoraFrameHeader</span></code> can include MAC commands
by leveraging the <code class="docutils literal notranslate"><span class="pre">MacCommand</span></code> and <code class="docutils literal notranslate"><span class="pre">LoraDeviceAddress</span></code> classes, that are
used to make serialization, deserialization and interpretation of MAC commands
and the LoRaWAN address system easier.</p>
<p>MAC commands are implemented by extending the <code class="docutils literal notranslate"><span class="pre">MacCommand</span></code> class. Each child
class is used to define a set of command variables, methods to serialize and
deserialize the commands inside a <code class="docutils literal notranslate"><span class="pre">LoraFrameHeader</span></code>, and callbacks to the MAC
layer to perform actions. This structure can facilitate the implementation and
testing of custom MAC commands, as allowed by the specification.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">LoraDeviceAddress</span></code> class is used to represent the address of a LoRaWAN
ED, and to handle serialization and deserialization.</p>
</div>
<div class="section" id="logical-channels-and-duty-cycle">
<h4>Logical channels and duty cycle<a class="headerlink" href="#logical-channels-and-duty-cycle" title="Permalink to this headline">¶</a></h4>
<p>Since LoRaWAN operates in unlicensed bands that are subject to restrictions on
duty cycle, a series of objects were created to keep track of available
transmission time and limit transmission at the MAC layer in case the layers
above aren’t aware of these limitations. A <code class="docutils literal notranslate"><span class="pre">LogicalLoraChannelHelper</span></code> is
assigned to each <code class="docutils literal notranslate"><span class="pre">LorawanMac</span></code> instance, and is tasked with keeping track of all
available logical channels (which can be added and modified with MAC commands,
and are represented by the <code class="docutils literal notranslate"><span class="pre">LogicalLoraChannel</span></code> class) and is aware of the
sub-band they are in (through instances of the <code class="docutils literal notranslate"><span class="pre">SubBand</span></code> class).</p>
<p>Additionally, in order to enforce duty cycle limitations, this object also
registers all transmissions that are performed on each channel, and can be
queried by the <code class="docutils literal notranslate"><span class="pre">LorawanMac</span></code> instance to know the next time in which transmission
will be possible according to the regulation. If a transmission of duration
<img class="math" src="_images/math/a648c6f443fd90cf72197076a615956506aa19c8.png" alt="t_{\rm air}"/> is performed by the device on a channel where the duty cycle
expressed in fractional form is <img class="math" src="_images/math/ec31009297265e6724a791aa785acf3346731ecd.png" alt="\rm dc"/>, the time the device needs to
stay off is computed according to the following formula:</p>
<div class="math">
<p><img src="_images/math/95ccaa7303a4220a0079a6e7275a68d66e1e6fe3.png" alt="t_{\rm off} = \frac{t_{\rm air}}{\rm dc} - t_{\rm air}"/></p>
</div><p>This time is kept track of on a sub band basis, so that if two channels are
under the same regulation, a transmission on one of them will also block the
other one.</p>
</div>
</div>
<div class="section" id="the-network-server">
<h3>The Network Server<a class="headerlink" href="#the-network-server" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">NetworkServer</span></code> is an application which is running on a node that is
connected to the simulation GWs. The GWs forward incoming LoRa packets to the
NS, and expect to be given packets to transmit in the downlink to EDs by the NS.
In order to keep track of all players in the network, the NS keeps two lists of
<code class="docutils literal notranslate"><span class="pre">DeviceStatus</span></code> and <code class="docutils literal notranslate"><span class="pre">GatewayStatus</span></code> objects, which represent the current
status of each ED and GW in the network, respectively. These objects are used to
keep track of downlink packets that will need to be sent during the ED’s receive
windows, and they also hold pointers to the Mac layer instances of each GW. This
is done in order to be able to perform queries on the gateway’s current duty
cycle limitations and always forward downlink packets to gateways that will be
able to transmit the packet in the LoRa network. The current iteration of the
Network Server only sends downlink packets to devices that require an
acknowledgment, ignoring the contents of the packet and of MAC commands it may
contain. Transmission is performed on the first receive window whenever
possible, and the second receive window is used only when no more resources are
available to leverage the first chance to respond to the device. More complex
and realistic NS behaviors are definitely possible, however they also come at a
complexity cost that is non-negligible.</p>
</div>
</div>
<div class="section" id="scope-and-limitations">
<h2>Scope and Limitations<a class="headerlink" href="#scope-and-limitations" title="Permalink to this headline">¶</a></h2>
<p>Since this is still a first version of the module, a few caveats are listed
below.</p>
<div class="section" id="inter-protocol-interference">
<h3>Inter-protocol interference<a class="headerlink" href="#inter-protocol-interference" title="Permalink to this headline">¶</a></h3>
<p>Since the <code class="docutils literal notranslate"><span class="pre">LoraChannel</span></code> class can only be connected to LoRa PHY layers, the
model is currently unable to account for interference by other technologies.</p>
<p>It’s expected that it will become possible, in the future, to handle
inter-protocol interference by leveraging the <code class="docutils literal notranslate"><span class="pre">SpectrumChannel</span></code> class, once
more accurate models of how interference affects LoRa signals become available.</p>
</div>
<div class="section" id="inter-channel-interference">
<h3>Inter-channel interference<a class="headerlink" href="#inter-channel-interference" title="Permalink to this headline">¶</a></h3>
<p>Interference between partially overlapping channels is not checked for.
Furthermore, there currently is no model to account for interference between
signals using different bandwidths.</p>
</div>
<div class="section" id="network-server">
<h3>Network Server<a class="headerlink" href="#network-server" title="Permalink to this headline">¶</a></h3>
<p>The current implementation of the Network Server tries to provide a general
structure to handle EDs and GWs in a network, but still lacks some possibly
complex code to simulate advanced features like different Adaptive Data Rate
(ADR) algorithms, responding to the ED’s MAC commands and supporting join
procedures. Other limitations of the Network Server is that it doesn’t employ a
protocol to communicate with the Gateways (since no official ones exist), and
that it informs the gateway in real time about downlink messages it needs to
send (in other words, no “booking” of the gateway resource is done in advance,
and downlink packets take priority over incoming packets at the gateway).</p>
<p>As of now, the Network Server implementation should be considered as an
experimental feature, prone to yet undiscovered bugs.</p>
</div>
<div class="section" id="device-classes">
<h3>Device Classes<a class="headerlink" href="#device-classes" title="Permalink to this headline">¶</a></h3>
<p>Currently, only Class A End Devices are supported.</p>
</div>
<div class="section" id="regional-parameters">
<h3>Regional parameters<a class="headerlink" href="#regional-parameters" title="Permalink to this headline">¶</a></h3>
<p>Since LoRaWAN parameters like default channel lineup and MAC command
interpretations vary based on the operational region of the network,
<code class="docutils literal notranslate"><span class="pre">LorawanMacHelper</span></code> includes methods to specify the region. While the current
implementation is predisposed to support different configurations of the network
based on the region it’s meant to be operating in, currently only the EU region
using the 868 MHz sub band is supported.</p>
</div>
<div class="section" id="mac-layer-details">
<h3>MAC layer details<a class="headerlink" href="#mac-layer-details" title="Permalink to this headline">¶</a></h3>
<p>Some details that are not crucial for the evaluation of the system performance
of a network still need to be implemented. These include:</p>
<ul class="simple">
<li><p>Frame counters, both at the End Devices and at the Network Server’s
DeviceStatus</p></li>
<li><p>Proper setting of ADR flags (no ADR mechanism is implemented still)</p></li>
<li><p>Join procedure management (both at the NS and at the EDs)</p></li>
</ul>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>A typical usage of the model follows some typical <em>ns-3</em> paradigms, like the
usage of helpers to configure a complex network. This section illustrates the
setup of a LoRaWAN network using the module and some other side classes that
weren’t described in the previous sections because they are mainly used to
configure the network.</p>
<div class="section" id="helpers">
<h3>Helpers<a class="headerlink" href="#helpers" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">lorawan</span></code> module features helpers to configure the PHY and MAC layers on a
large number of devices. The two layers are split in two different classes,
<code class="docutils literal notranslate"><span class="pre">LorawanMacHelper</span></code> and <code class="docutils literal notranslate"><span class="pre">LoraPhyHelper</span></code>, which can be leveraged by a
<code class="docutils literal notranslate"><span class="pre">LoraHelper</span></code> object to fully configure a LoRa device (both for EDs and for
GWs). Since the helpers are general purpose (i.e., they can be used both for ED
and GW configuration), it is necessary to specify the device type via the
<code class="docutils literal notranslate"><span class="pre">SetDeviceType</span></code> method before the <code class="docutils literal notranslate"><span class="pre">Install</span></code> method can be called.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">LorawanMacHelper</span></code> also exposes a method to set up the Spreading Factors used
by the devices participating in the network automatically, based on the channel
conditions and on the placement of devices and gateways. This procedure is
contained in the static method <code class="docutils literal notranslate"><span class="pre">SetSpreadingFactorsUp</span></code>, and works by trying to
minimize the time-on-air of packets, thus assigning the lowest possible
spreading factor such that reception by at least one gateway is still possible.
It should be noted that this is an heuristic, and that it doesn’t guarantee that
the SF distribution is optimal for the best possible operation of the network.
In fact, finding such a distribution based on the network scenario is still an
open challenge.</p>
</div>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h3>
<p>Currently, the following attributes are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Interval</span></code> and <code class="docutils literal notranslate"><span class="pre">PacketSize</span></code> in <code class="docutils literal notranslate"><span class="pre">PeriodicSender</span></code> determine the interval
between packet sends of the application, and the size of the packets that are
generated by the application.</p></li>
</ul>
</div>
<div class="section" id="trace-sources">
<h3>Trace Sources<a class="headerlink" href="#trace-sources" title="Permalink to this headline">¶</a></h3>
<p>Various trace sources can be used to keep track of events throughout the
simulation, mainly regarding the lifetime of a packet. At the PHY layer, the
following trace sources are exposed:</p>
<ul class="simple">
<li><p>In <code class="docutils literal notranslate"><span class="pre">LoraPhy</span></code> (both <code class="docutils literal notranslate"><span class="pre">EndDeviceLoraPhy</span></code> and <code class="docutils literal notranslate"><span class="pre">GatewayLoraPhy</span></code>):</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">StartSending</span></code>, fired when a PHY layer begins transmitting a packet;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PhyRxBegin</span></code>, fired when a PHY layer becomes locked on a packet;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PhyRxEnd</span></code>, fired when a PHY’s reception of a packet ends;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ReceivedPacket</span></code>, fired when a packet is correctly received;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LostPacketBecauseInterference</span></code>, fired when a packet is lost because of
interference from other transmissions;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LostPacketBecauseUnderSensitivity</span></code>, fired when a PHY cannot lock on a
packet because it’s being received with a power below the device sensitivity;</p></li>
</ul>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">EndDeviceLoraPhy</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LoraPacketBecauseWrongFrequency</span></code> is fired when an incoming packet is
using a frequency that is different from that on which the PHY is listening;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LoraPacketBecauseWrongSpreadingFactor</span></code> is fired when an incoming packet
is using a SF that is different from that for which the PHY is listening;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EndDeviceState</span></code> is used to keep track of the state of the device’s PHY
layer.</p></li>
</ul>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">GatewayLoraPhy</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">LostPacketBecauseNoMoreReceivers</span></code> is fired when a packet is lost because
no more receive paths are available to lock onto the incoming packet;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OccupiedReceptionPaths</span></code> is used to keep track of the number of occupied
reception paths out of the 8 that are available at the gateway;</p></li>
</ul>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">LorawanMac</span></code> (both <code class="docutils literal notranslate"><span class="pre">EndDeviceLorawanMac</span></code> and <code class="docutils literal notranslate"><span class="pre">GatewayLorawanMac</span></code>):</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CannotSendBecauseDutyCycle</span></code> is used to keep track of the number of when a
packet coming from the application layer cannot be sent on any of the
available channels because of duty cycle limitations;</p></li>
</ul>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">EndDeviceLorawanMac</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">DataRate</span></code> keeps track of the data rate that is employed by the device;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LastKnownLinkMargin</span></code> keeps track of the last link margin of this device’s
uplink transmissions; This information is gathered through the <code class="docutils literal notranslate"><span class="pre">LinkCheck</span></code>
MAC commands;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LastKnownGatewayCount</span></code> keeps track of the last known number of gateways
that this device is able to reach; This information is gathered through the
<code class="docutils literal notranslate"><span class="pre">LinkCheck</span></code> MAC commands;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AggregatedDutyCycle</span></code> keeps track of the currently set aggregated duty
cycle limitations;</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PacketSent</span></code> in <code class="docutils literal notranslate"><span class="pre">LoraChannel</span></code> is fired when a packet is sent on the channel;</p></li>
</ul>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="simple-lorawan-network-example">
<h3>simple-lorawan-network-example<a class="headerlink" href="#simple-lorawan-network-example" title="Permalink to this headline">¶</a></h3>
<p>This example is used to showcase how wireless communication between a device and
a gateway happens: one LoRa ED is configured to send a packet, and a GW receives
it. When logging is enabled, the various steps that are needed to send a packet
from the APP layer of an ED to the MAC layer of a GW can be observed.</p>
</div>
<div class="section" id="network-server-example">
<h3>network-server-example<a class="headerlink" href="#network-server-example" title="Permalink to this headline">¶</a></h3>
<p>This example builds on the <code class="docutils literal notranslate"><span class="pre">simple-lorawan-network-example</span></code> to add a Network
Server and multiple EDs and GWs to the scenario. This example works as a
showcase for how communication between the End Devices and the Network Server
happens.</p>
</div>
<div class="section" id="complete-lorawan-network-example">
<h3>complete-lorawan-network-example<a class="headerlink" href="#complete-lorawan-network-example" title="Permalink to this headline">¶</a></h3>
<p>This example shows how to configure a whole LoRaWAN network using the <em>ns-3</em>
<code class="docutils literal notranslate"><span class="pre">lorawan</span></code> module. A big network featuring several thousand devices and tens of
gateways is built, and each device is equipped with a <code class="docutils literal notranslate"><span class="pre">PeriodicSender</span></code>
application that periodically sends a packet to the NetworkServer through the
Gateways. The example keeps track of the sent and received packets, and computes
some statistics at the end of the simulation. No Network Server is used in this
simulation, since performance metrics are collected through the GW trace sources
and packets don’t require an acknowledgment.</p>
</div>
</div>
<div class="section" id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h2>
<p>Tests are contained in the <code class="docutils literal notranslate"><span class="pre">lorawan-test-suite.cc</span></code> file. The tests currently
cover the following classes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LoraInterferenceHelper</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LoraDeviceAddress</span></code> and <code class="docutils literal notranslate"><span class="pre">LoraDeviceAddressHelper</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LoraFrameHeader</span></code> and <code class="docutils literal notranslate"><span class="pre">LorawanMacHeader</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ReceivePath</span></code> and <code class="docutils literal notranslate"><span class="pre">GatewayLoraPhy</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LogicalLoraChannel</span></code> and <code class="docutils literal notranslate"><span class="pre">LogicalLoraChannelHelper</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LoraPhy</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EndDeviceLoraPhy</span></code> and <code class="docutils literal notranslate"><span class="pre">LoraChannel</span></code></p></li>
</ul>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<dl class="citation">
<dt class="label" id="magrin2017performance"><span class="brackets"><a class="fn-backref" href="#id5">magrin2017performance</a></span></dt>
<dd><p>D. Magrin, M. Centenaro and L. Vangelista,
<em>Performance Evaluation of LoRa Networks in a Smart
City Scenario</em>, in Proc. of the IEEE International
Conference on Communications, May 2017.</p>
</dd>
<dt class="label" id="magrin2017thesis"><span class="brackets"><a class="fn-backref" href="#id6">magrin2017thesis</a></span></dt>
<dd><p>D. Magrin, <em>Network level performances of a LoRa system</em>,
December 2016. Available:
<a class="reference external" href="http://tesi.cab.unipd.it/53740/">http://tesi.cab.unipd.it/53740/</a></p>
</dd>
<dt class="label" id="sx1301"><span class="brackets"><a class="fn-backref" href="#id7">sx1301</a></span></dt>
<dd><p>Semtech, SX1301 Datasheet.</p>
</dd>
<dt class="label" id="goursaud2015dedicated"><span class="brackets"><a class="fn-backref" href="#id4">goursaud2015dedicated</a></span></dt>
<dd><p>C. Goursaud, J. M. Gorce, <em>Dedicated networks for
IoT: PHY/MAC state of the art and challenges</em>, EAI
endorsed transactions on Internet of Things, 2015.</p>
</dd>
<dt class="label" id="semtech2015modulation"><span class="brackets"><a class="fn-backref" href="#id1">semtech2015modulation</a></span></dt>
<dd><p>Semtech Corporation, <em>AN1200.22 LoRa Modulation
Basics</em>, May 2015, Online. Available:
<a class="reference external" href="http://www.semtech.com/images/datasheet/an1200.22.pdf">http://www.semtech.com/images/datasheet/an1200.22.pdf</a></p>
</dd>
<dt class="label" id="knight2016reversing"><span class="brackets"><a class="fn-backref" href="#id2">knight2016reversing</a></span></dt>
<dd><p>M. Knight, <em>Reversing LoRa</em>, Online. Available:
<a class="reference external" href="https://github.com/matt-knight/research">https://github.com/matt-knight/research</a></p>
</dd>
<dt class="label" id="lorawanstandard"><span class="brackets"><a class="fn-backref" href="#id3">lorawanstandard</a></span></dt>
<dd><p>N. Sornin, M. Luis, T. Eirich, T. Kramp, and O. Hersent,
<em>LoRaWAN Specifications</em>, LoRa Alliance, Tech. Rep., 2015.</p>
</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">LoRaWAN Module</a><ul>
<li><a class="reference internal" href="#technology">Technology</a><ul>
<li><a class="reference internal" href="#lora">LoRa</a></li>
<li><a class="reference internal" href="#lorawan">LoRaWAN</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-design">Module design</a><ul>
<li><a class="reference internal" href="#phy-layer-model">PHY layer model</a><ul>
<li><a class="reference internal" href="#link-model">Link model</a></li>
<li><a class="reference internal" href="#gateway-model">Gateway model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mac-layer-model">MAC layer model</a><ul>
<li><a class="reference internal" href="#headers-mac-commands-and-addressing-system">Headers, MAC commands and addressing system</a></li>
<li><a class="reference internal" href="#logical-channels-and-duty-cycle">Logical channels and duty cycle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-network-server">The Network Server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scope-and-limitations">Scope and Limitations</a><ul>
<li><a class="reference internal" href="#inter-protocol-interference">Inter-protocol interference</a></li>
<li><a class="reference internal" href="#inter-channel-interference">Inter-channel interference</a></li>
<li><a class="reference internal" href="#network-server">Network Server</a></li>
<li><a class="reference internal" href="#device-classes">Device Classes</a></li>
<li><a class="reference internal" href="#regional-parameters">Regional parameters</a></li>
<li><a class="reference internal" href="#mac-layer-details">MAC layer details</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#helpers">Helpers</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#trace-sources">Trace Sources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#examples">Examples</a><ul>
<li><a class="reference internal" href="#simple-lorawan-network-example">simple-lorawan-network-example</a></li>
<li><a class="reference internal" href="#network-server-example">network-server-example</a></li>
<li><a class="reference internal" href="#complete-lorawan-network-example">complete-lorawan-network-example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tests">Tests</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="internet-apps.html"
                        title="previous chapter">Internet Applications Module Documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="lr-wpan.html"
                        title="next chapter">Low-Rate Wireless Personal Area Network (LR-WPAN)</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/lorawan.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="lr-wpan.html" title="Low-Rate Wireless Personal Area Network (LR-WPAN)"
             >next</a> |</li>
        <li class="right" >
          <a href="internet-apps.html" title="Internet Applications Module Documentation"
             >previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006-2019.
      Last updated on Apr 29, 2020 18:24.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.2.
    </div>
  </body>
</html>