

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Traffic Control Layer &#8212; Model Library</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Queue disciplines" href="queue-discs.html" />
    <link rel="prev" title="Traffic Control Layer" href="traffic-control.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico" 
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="html";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>
      

  </head><body>
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0" width="100%">
      <tbody>
	<tr style="height: 56px;">
	  <td id="projectlogo">
	    <a id="ns3_home1"
	       href="http://www.nsnam.org/">
	       <img alt="ns-3 Logo"
		    src="_static/ns-3-inverted-notext-small.png"/>
	    </a>
	  </td>
	  <td id="projecttext">
	    <div id="projectbrief">A Discrete-Event Network Simulator</div>
	      <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
	  </td>
	      
	  <td id="ns3-menu">
	    <div class="menu">
	      <ul >
	        <li><a id="ns3_home2"
		       href="http://www.nsnam.org/"
		       >&nbsp;&nbsp;Home</a>
	        </li>
	        <li><span
		      onmouseover="mopen('mTuts')" 
		      onmouseout="mclosetime()"
			>Tutorials &nbsp;&#x25BC;</span>
		    <div id="mTuts" 
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_tut"
			 href="/docs/tutorial/html/index.html"
			  >English</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDocs')" 
		      onmouseout="mclosetime()"
			>Docs &nbsp;&nbsp;&nbsp;&#x25BC;</span>
		    <div id="mDocs"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_wiki"
			 href="http://www.nsnam.org/wiki"
			 >Wiki</a><br/>
		      <a id="ns3_man"
			 href="/docs/manual/html/index.html"
			 >Manual</a><br/>
		      <a id="ns3_mod"
			 href="/docs/models/html/index.html"
			 >Models</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDev')" 
		      onmouseout="mclosetime()"
			>Develop &#x25BC;</span>
		    <div id="mDev"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_api"
			 href="/docs/doxygen/html/index.html"
			 >API</a><br/>
		      <a id="ns3_bugs"
		       href="http://www.nsnam.org/bugzilla/">Bugs</a>
	        </li>
	      </ul>
	    </div>
	  </td>
	  <td id="projectsection">
	    <span style="margin-right:10px">Models</span>
	  </td>
	</tr>
      </tbody>
    </table>
    <script  type="text/javascript">ns3_write_links()</script>
  </div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="queue-discs.html" title="Queue disciplines"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="traffic-control.html" title="Traffic Control Layer"
             accesskey="P">previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="traffic-control.html" accesskey="U">Traffic Control Layer</a><span class="navelem">&nbsp;</span></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="traffic-control-layer">
<h1>Traffic Control Layer<a class="headerlink" href="#traffic-control-layer" title="Permalink to this headline">¶</a></h1>
<p>The Traffic Control layer aims at introducing an equivalent of the Linux Traffic
Control infrastructure into ns-3. The Traffic Control layer sits in between
the NetDevices (L2) and any network protocol (e.g. IP). It is in charge of processing
packets and performing actions on them: scheduling, dropping, marking, policing, etc.</p>
<div class="section" id="introducing-the-traffic-control-layer">
<h2>Introducing the Traffic Control Layer<a class="headerlink" href="#introducing-the-traffic-control-layer" title="Permalink to this headline">¶</a></h2>
<p>The Traffic Control layer intercepts both outgoing packets flowing downwards from
the network layer to the network device and incoming packets flowing in the opposite
direction. Currently, only outgoing packets are processed by the Traffic Control layer.
In particular, outgoing packets are enqueued in a queuing discipline, which can perform
multiple actions on them.</p>
<p>In the following, more details are given about how the Traffic Control layer intercepts
outgoing and incoming packets and, more in general, about how the packets traverse the
network stack.</p>
<div class="section" id="transmitting-packets">
<h3>Transmitting packets<a class="headerlink" href="#transmitting-packets" title="Permalink to this headline">¶</a></h3>
<p>The IPv{4,6} interfaces uses the aggregated object TrafficControlLayer to send
down packets, instead of calling NetDevice::Send() directly. After the analysis
and the process of the packet, when the backpressure mechanism allows it,
TrafficControlLayer will call the Send() method on the right NetDevice.</p>
</div>
<div class="section" id="receiving-packets">
<h3>Receiving packets<a class="headerlink" href="#receiving-packets" title="Permalink to this headline">¶</a></h3>
<p>The callback chain that (in the past) involved IPv{4,6}L3Protocol and NetDevices,
through ReceiveCallback, is extended to involve TrafficControlLayer. When an
IPv{4,6}Interface is added in the IPv{4,6}L3Protocol, the callback chain is
configured to have the following packet exchange:</p>
<p>NetDevice –&gt; Node –&gt; TrafficControlLayer –&gt; IPv{4,6}L3Protocol</p>
</div>
</div>
<div class="section" id="brief-description-of-old-node-device-protocol-interactions">
<h2>Brief description of old node/device/protocol interactions<a class="headerlink" href="#brief-description-of-old-node-device-protocol-interactions" title="Permalink to this headline">¶</a></h2>
<p>The main question that we would like to answer in the following paragraphs is:
how a ns-3 node can send/receive packets?</p>
<p>If we analyze any example out there, the ability of the node to receive/transmit
packets derives from the interaction of two helper:</p>
<ul class="simple">
<li><p>L2 Helper (something derived from NetDevice)</p></li>
<li><p>L3 Helper (usually from Internet module)</p></li>
</ul>
<div class="section" id="l2-helper-main-operations">
<h3>L2 Helper main operations<a class="headerlink" href="#l2-helper-main-operations" title="Permalink to this headline">¶</a></h3>
<p>Any good L2 Helper will do the following operations:</p>
<ul class="simple">
<li><p>Create n netdevices (n&gt;1)</p></li>
<li><p>Attach a channel between these devices</p></li>
<li><p>Call Node::AddDevice ()</p></li>
</ul>
<p>Obviously the last point is the most important.</p>
<p>Node::AddDevice (network/model/node.cc:128) assigns an interface index to the
device, calls NetDevice::SetNode, sets the receive callback of the device to
Node::NonPromiscReceiveFromDevice. Then, it schedules NetDevice::Initialize() method at
Seconds(0.0), then notify the registered DeviceAdditionListener handlers (not used BY ANYONE).</p>
<p>Node::NonPromiscReceiveFromDevice calls Node::ReceiveFromDevice.</p>
<p>Node::ReceiveFromDevice iterates through ProtocolHandlers, which are callbacks
which accept as signature:</p>
<p>ProtocolHandler (Ptr&lt;NetDevice&gt;, Ptr&lt;const Packet&gt;, protocol, from_addr, to_addr, packetType).</p>
<p>If device, protocol number and promiscuous flag corresponds, the handler is
invoked.</p>
<p>Who is responsible to set ProtocolHandler ? We will analyze that in the next
section.</p>
</div>
<div class="section" id="l3-helper">
<h3>L3 Helper<a class="headerlink" href="#l3-helper" title="Permalink to this headline">¶</a></h3>
<p>We have only internet which provides network protocol (IP). That module splits
the operations between two helpers: InternetStackHelper and Ipv{4,6}AddressHelper.</p>
<p>InternetStackHelper::Install (internet/helper/internet-stack-helper.cc:423)
creates and aggregates protocols {ArpL3,Ipv4L3,Icmpv4}Protocol. It creates the
routing protocol, and if Ipv6 is enabled it adds {Ipv6L3,Icmpv6L4}Protocol. In
any case, it instantiates and aggregates an UdpL4Protocol object, along with a
PacketSocketFactory.
Ultimately, it creates the required objects and aggregates them to the node.</p>
<p>Let’s assume an Ipv4 environment (things are the same for Ipv6).</p>
<p>Ipv4AddressHelper::Assign (src/internet/helper/ipv4-address-helper.cc:131)
registers the handlers. The process is a bit long. The method is called with
a list of NetDevice. For each of them, the node and Ipv4L3Protocol pointers are
retrieved; if an Ipv4Interface is already registered for the device, on that the
address is set. Otherwise, the method Ipv4L3Protocol::AddInterface is called,
before adding the address.</p>
</div>
<div class="section" id="ip-interfaces">
<h3>IP interfaces<a class="headerlink" href="#ip-interfaces" title="Permalink to this headline">¶</a></h3>
<p>In Ipv4L3Protocol::AddInterface (src/internet/model/ipv4-l3-protocol.cc:300)
two protocol handlers are installed: one that react to ipv4 protocol number,
and one that react to arp protocol number (Ipv4L3Protocol::Receive and
ArpL3Protocol::Receive, respectively). The interface is then created,
initialized, and returned.</p>
<p>Ipv4L3Protocol::Receive (src/internet/model/ipv4-l3-protocol.cc:472) iterates
through the interface. Once it finds the Ipv4Interface which has the same device
as the one passed as argument, invokes the rxTrace callback. If the interface is
down, the packet is dropped. Then, it removes the header and trim any residual
frame padding. If checksum is not OK, it drops the packet. Otherwise, forward
the packet to the raw sockets (not used). Then, it ask the routing protocol what
is the destiny of that packet. The choices are: Ipv4L3Protocol::{IpForward,
IpMulticastForward,LocalDeliver,RouteInputError}.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Traffic Control Layer</a><ul>
<li><a class="reference internal" href="#introducing-the-traffic-control-layer">Introducing the Traffic Control Layer</a><ul>
<li><a class="reference internal" href="#transmitting-packets">Transmitting packets</a></li>
<li><a class="reference internal" href="#receiving-packets">Receiving packets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#brief-description-of-old-node-device-protocol-interactions">Brief description of old node/device/protocol interactions</a><ul>
<li><a class="reference internal" href="#l2-helper-main-operations">L2 Helper main operations</a></li>
<li><a class="reference internal" href="#l3-helper">L3 Helper</a></li>
<li><a class="reference internal" href="#ip-interfaces">IP interfaces</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="traffic-control.html"
                        title="previous chapter">Traffic Control Layer</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="queue-discs.html"
                        title="next chapter">Queue disciplines</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/traffic-control-layer.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="queue-discs.html" title="Queue disciplines"
             >next</a> |</li>
        <li class="right" >
          <a href="traffic-control.html" title="Traffic Control Layer"
             >previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="traffic-control.html" >Traffic Control Layer</a><span class="navelem">&nbsp;</span></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006-2019.
      Last updated on Apr 29, 2020 17:37.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.2.
    </div>
  </body>
</html>