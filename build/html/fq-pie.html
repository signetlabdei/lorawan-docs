
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>33.13. FQ-PIE queue disc &#8212; Model Library</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/default.css?v=bb97339c" />
    <script src="_static/documentation_options.js?v=951d00fa"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="33.14. Mq queue disc" href="mq.html" />
    <link rel="prev" title="33.12. PIE queue disc" href="pie.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico"
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="html";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>


  </head><body>
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0" width="100%">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectlogo">
              <a id="ns3_home1"
                 href="http://www.nsnam.org/">
                 <img alt="ns-3 Logo" style="background-color: unset;"
                      src="_static/ns-3-inverted-notext-small.png"/>
              </a>
            </td>
            <td id="projecttext">
              <div id="projectbrief">A Discrete-Event Network Simulator</div>
              <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
            </td>

            <td id="ns3-menu">
              <div class="menu">
                <ul >
                  <li style="background-image:none">
                    <a id="ns3_home2"
                         href="http://www.nsnam.org/"
                         >&nbsp;&nbsp;Home</a>
                  </li>
                  <li><span
                        onmouseover="mopen('mTuts')"
                        onmouseout="mclosetime()"
                          >Tutorials &nbsp;&#x25BC;</span>
                      <div id="mTuts"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_tut"
                           href="/docs/tutorial/html/index.html"
                            >English</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDocs')"
                        onmouseout="mclosetime()"
                          >Documentation &nbsp;&#x25BC;</span>
                      <div id="mDocs"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_ins"
                           href="/docs/installation/html/index.html"
                           >Installation</a><br/>
                        <a id="ns3_man"
                           href="/docs/manual/html/index.html"
                           >Manual</a><br/>
                        <a id="ns3_mod"
                           href="/docs/models/html/index.html"
                           >Models</a><br/>
                        <a id="ns3_con"
                           href="/docs/contributing/html/index.html"
                           >Contributing</a><br/>
                        <a id="ns3_wiki"
                           href="http://www.nsnam.org/wiki"
                           >Wiki</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDev')"
                        onmouseout="mclosetime()"
                          >Development &nbsp;&#x25BC;</span>
                      <div id="mDev"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_api"
                           href="/docs/doxygen/html/index.html"
                           >API Docs</a><br/>
                        <a id="ns3_bugs"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/issues"
                           >Issue Tracker</a><br/>
                        <a id="ns3_merge"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/merge_requests"
                           >Merge Requests</a><br/>
                      </div>
                  </li>
                </ul>
              </div>
            </td>

            <td id="projectsection">
              <span style="margin-right:10px">Models</span>
            </td>
          </tr>
        </tbody>
      </table>
      <script  type="text/javascript">ns3_write_links()</script>
    </div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="mq.html" title="33.14. Mq queue disc"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pie.html" title="33.12. PIE queue disc"
             accesskey="P">previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="traffic-control.html" accesskey="U"><span class="section-number">33. </span>Traffic Control Layer</a><span class="navelem">&nbsp;</span></li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">33.13. </span>FQ-PIE queue disc</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="fq-pie-queue-disc">
<h1><span class="section-number">33.13. </span>FQ-PIE queue disc<a class="headerlink" href="#fq-pie-queue-disc" title="Link to this heading">¶</a></h1>
<p>This chapter describes the FQ-PIE (<a class="reference internal" href="#ram19" id="id1"><span>[Ram19]</span></a>) queue disc implementation in <em>ns-3</em>.</p>
<p>The FQ-PIE queue disc combines the Proportional Integral Controller Enhanced
(PIE) AQM algorithm with the FlowQueue scheduler that is part of FQ-CoDel
(also available in <em>ns-3</em>). FQ-PIE was introduced to Linux kernel version 5.6.</p>
<section id="model-description">
<h2><span class="section-number">33.13.1. </span>Model Description<a class="headerlink" href="#model-description" title="Link to this heading">¶</a></h2>
<p>The source code for the <code class="docutils literal notranslate"><span class="pre">FqPieQueueDisc</span></code> is located in the directory
<code class="docutils literal notranslate"><span class="pre">src/traffic-control/model</span></code> and consists of 2 files <cite>fq-pie-queue-disc.h</cite>
and <cite>fq-pie-queue-disc.cc</cite> defining a FqPieQueueDisc class and a helper
FqPieFlow class. The code was ported to <em>ns-3</em> based on Linux kernel code
implemented by Mohit P. Tahiliani.</p>
<p>This model calculates drop probability independently in each flow queue.
One difficulty, as pointed out by <a class="reference internal" href="#cablelabs14" id="id2"><span>[CableLabs14]</span></a>, is that PIE calculates
drop probability based on the departure rate of a (flow) queue, which may
be more highly variable than the aggregate queue.  An alternative, which
CableLabs has called SFQ-PIE, is to calculate an overall drop probability
for the entire queue structure, and then scale this drop probability based
on the ratio of the queue depth of each flow queue compared with the depth
of the current largest queue.  This ns-3 model does not implement the
SFQ-PIE variant described by CableLabs.</p>
<section id="references">
<h3><span class="section-number">33.13.1.1. </span>References<a class="headerlink" href="#references" title="Link to this heading">¶</a></h3>
<div role="list" class="citation-list">
<div class="citation" id="ram19" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">Ram19</a><span class="fn-bracket">]</span></span>
<ol class="upperalpha simple" start="7">
<li><p>Ramakrishnan, M. Bhasi, V. Saicharan, L. Monis, S. D. Patil and M. P. Tahiliani, “FQ-PIE Queue Discipline in the Linux Kernel: Design, Implementation and Challenges,” 2019 IEEE 44th LCN Symposium on Emerging Topics in Networking (LCN Symposium), Osnabrueck, Germany, 2019, pp. 117-124,</p></li>
</ol>
</div>
<div class="citation" id="cablelabs14" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">CableLabs14</a><span class="fn-bracket">]</span></span>
<ol class="upperalpha simple" start="7">
<li><p>White, Active Queue Management in DOCSIS 3.X Cable Modems, CableLabs white paper, May 2014.</p></li>
</ol>
</div>
</div>
</section>
<section id="attributes">
<h3><span class="section-number">33.13.1.2. </span>Attributes<a class="headerlink" href="#attributes" title="Link to this heading">¶</a></h3>
<p>The key attributes that the FqPieQueue class holds include the following.
First, there are PIE-specific attributes that are copied into the individual
PIE flow queues:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UseEcn:</span></code> Whether to use ECN marking</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MarkEcnThreshold:</span></code> ECN marking threshold (RFC 8033 suggests 0.1 (i.e., 10%) default).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UseL4s:</span></code> Whether to use L4S (only mark ECT1 packets at CE threshold)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MeanPktSize:</span></code> Constant used to roughly convert bytes to packets</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">A:</span></code> Alpha value in PIE algorithm drop probability calculation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">B:</span></code> Beta value in PIE algorithm drop probability calculation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Tupdate:</span></code> Time period to calculate drop probability</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Supdate:</span></code> Start time of the update timer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DequeueThreshold:</span></code> Minimum queue size in bytes before dequeue rate is measured</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QueueDelayReference:</span></code> AQM latency target</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MaxBurstAllowance:</span></code> AQM max burst allowance before random drop</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UseDequeueRateEstimator:</span></code> Enable/Disable usage of Dequeue Rate Estimator</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UseCapDropAdjustment:</span></code> Enable/Disable Cap Drop Adjustment feature mentioned in RFC 8033</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UseDerandomization:</span></code> Enable/Disable Derandomization feature mentioned in RFC 8033</p></li>
</ul>
<p>Second, there are QueueDisc level, or FQ-specific attributes::
* <code class="docutils literal notranslate"><span class="pre">MaxSize:</span></code> Maximum number of packets in the queue disc
* <code class="docutils literal notranslate"><span class="pre">Flows:</span></code> Maximum number of flow queues
* <code class="docutils literal notranslate"><span class="pre">DropBatchSize:</span></code> Maximum number of packets dropped from the fat flow
* <code class="docutils literal notranslate"><span class="pre">Perturbation:</span></code> Salt value used as hash input when classifying flows
* <code class="docutils literal notranslate"><span class="pre">EnableSetAssociativeHash:</span></code> Enable or disable set associative hash
* <code class="docutils literal notranslate"><span class="pre">SetWays:</span></code> Size of a set of queues in set associative hash</p>
</section>
<section id="examples">
<h3><span class="section-number">33.13.1.3. </span>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h3>
<p>A typical usage pattern is to create a traffic control helper and to configure
the type and attributes of queue disc and filters from the helper. For example, FqPIE
can be configured as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TrafficControlHelper</span><span class="w"> </span><span class="n">tch</span><span class="p">;</span>
<span class="n">tch</span><span class="p">.</span><span class="n">SetRootQueueDisc</span><span class="p">(</span><span class="s">&quot;ns3::FqPieQueueDisc&quot;</span><span class="p">,</span>
<span class="w">                     </span><span class="s">&quot;DropBatchSize&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UintegerValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                     </span><span class="s">&quot;Perturbation&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UintegerValue</span><span class="p">(</span><span class="mi">256</span><span class="p">));</span>
<span class="n">QueueDiscContainer</span><span class="w"> </span><span class="n">qdiscs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tch</span><span class="p">.</span><span class="n">Install</span><span class="p">(</span><span class="n">devices</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="validation">
<h2><span class="section-number">33.13.2. </span>Validation<a class="headerlink" href="#validation" title="Link to this heading">¶</a></h2>
<p>The FqPie model is tested using <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">FqPieQueueDiscTestSuite</span></code> class defined in <cite>src/test/ns3tc/fq-pie-queue-test-suite.cc</cite>.</p>
<p>The tests are similar to the ones for FqCoDel queue disc mentioned in first section of this document.
The test suite can be run using the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./ns3<span class="w"> </span>configure<span class="w"> </span>--enable-examples<span class="w"> </span>--enable-tests
$<span class="w"> </span>./ns3<span class="w"> </span>build
$<span class="w"> </span>./test.py<span class="w"> </span>-s<span class="w"> </span>fq-pie-queue-disc
</pre></div>
</div>
<p>or:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;FqPieQueueDisc&quot;</span><span class="w"> </span>./ns3<span class="w"> </span>run<span class="w"> </span><span class="s2">&quot;test-runner --suite=fq-pie-queue-disc&quot;</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">33.13. FQ-PIE queue disc</a><ul>
<li><a class="reference internal" href="#model-description">33.13.1. Model Description</a><ul>
<li><a class="reference internal" href="#references">33.13.1.1. References</a></li>
<li><a class="reference internal" href="#attributes">33.13.1.2. Attributes</a></li>
<li><a class="reference internal" href="#examples">33.13.1.3. Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validation">33.13.2. Validation</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="pie.html"
                          title="previous chapter"><span class="section-number">33.12. </span>PIE queue disc</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="mq.html"
                          title="next chapter"><span class="section-number">33.14. </span>Mq queue disc</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/fq-pie.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="mq.html" title="33.14. Mq queue disc"
             >next</a> |</li>
        <li class="right" >
          <a href="pie.html" title="33.12. PIE queue disc"
             >previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Models</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="traffic-control.html" ><span class="section-number">33. </span>Traffic Control Layer</a><span class="navelem">&nbsp;</span></li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">33.13. </span>FQ-PIE queue disc</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2006-2019, ns-3 project.
      Last updated on Apr 19, 2024 16:32.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>