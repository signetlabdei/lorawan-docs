

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Manual</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico" 
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="singlehtml";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>
      

  </head><body>
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0" width="100%">
      <tbody>
	<tr style="height: 56px;">
	  <td id="projectlogo">
	    <a id="ns3_home1"
	       href="http://www.nsnam.org/">
	       <img alt="ns-3 Logo"
		    src="_static/ns-3-inverted-notext-small.png"/>
	    </a>
	  </td>
	  <td id="projecttext">
	    <div id="projectbrief">A Discrete-Event Network Simulator</div>
	      <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
	  </td>
	      
	  <td id="ns3-menu">
	    <div class="menu">
	      <ul >
	        <li><a id="ns3_home2"
		       href="http://www.nsnam.org/"
		       >&nbsp;&nbsp;Home</a>
	        </li>
	        <li><span
		      onmouseover="mopen('mTuts')" 
		      onmouseout="mclosetime()"
			>Tutorials &nbsp;&#x25BC;</span>
		    <div id="mTuts" 
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_tut"
			 href="/docs/tutorial/html/index.html"
			  >English</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDocs')" 
		      onmouseout="mclosetime()"
			>Docs &nbsp;&nbsp;&nbsp;&#x25BC;</span>
		    <div id="mDocs"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_wiki"
			 href="http://www.nsnam.org/wiki"
			 >Wiki</a><br/>
		      <a id="ns3_man"
			 href="/docs/manual/html/index.html"
			 >Manual</a><br/>
		      <a id="ns3_mod"
			 href="/docs/models/html/index.html"
			 >Models</a><br/>
	        </li>
	        <li><span
		      onmouseover="mopen('mDev')" 
		      onmouseout="mclosetime()"
			>Develop &#x25BC;</span>
		    <div id="mDev"
		        onmouseover="mcancelclosetime()" 
		        onmouseout="mclosetime()">
		      <a id="ns3_api"
			 href="/docs/doxygen/html/index.html"
			 >API</a><br/>
		      <a id="ns3_bugs"
		       href="http://www.nsnam.org/bugzilla/">Bugs</a>
	        </li>
	      </ul>
	    </div>
	  </td>
	  <td id="projectsection">
	    <span style="margin-right:10px">Manual</span>
	  </td>
	</tr>
      </tbody>
    </table>
    <script  type="text/javascript">ns3_write_links()</script>
  </div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="#">Manual</a><span class="navelem">&nbsp;</span></li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ns-3-manual">
<h1>ns-3 Manual<a class="headerlink" href="#ns-3-manual" title="Permalink to this headline">¶</a></h1>
<p>This is the <em>ns-3 Manual</em>. Primary documentation for the ns-3 project is
available in five forms:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.nsnam.org/doxygen/index.html">ns-3 Doxygen</a>: Documentation of the public APIs of the simulator</p></li>
<li><p>Tutorial, Manual <em>(this document)</em>, and Model Library for the <a class="reference external" href="https://www.nsnam.org/documentation/latest/">latest release</a> and <a class="reference external" href="https://www.nsnam.org/documentation/development-tree/">development tree</a></p></li>
<li><p><a class="reference external" href="https://www.nsnam.org/wiki">ns-3 wiki</a></p></li>
</ul>
<p>This document is written in <a class="reference external" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> for <a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a> and is maintained in the
<code class="docutils literal notranslate"><span class="pre">doc/manual</span></code> directory of ns-3’s source code.</p>
<div class="toctree-wrapper compound">
<span id="document-organization"></span><div class="section" id="organization">
<h2>Organization<a class="headerlink" href="#organization" title="Permalink to this headline">¶</a></h2>
<p>This chapter describes the overall <em>ns-3</em> software organization and the
corresponding organization of this manual.</p>
<p><em>ns-3</em> is a discrete-event network simulator in which the simulation core
and models are implemented in C++. <em>ns-3</em> is built as a library which may be
statically or dynamically linked to a C++ main program that defines the
simulation topology and starts the simulator. <em>ns-3</em> also exports nearly all
of its API to Python, allowing Python programs to import an “ns3” module in
much the same way as the <em>ns-3</em> library is linked by executables in C++.</p>
<div class="figure align-default" id="id1">
<span id="software-organization"></span><img alt="_images/software-organization.png" src="_images/software-organization.png" />
<p class="caption"><span class="caption-text">Software organization of <em>ns-3</em></span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>The source code for <em>ns-3</em> is mostly organized in the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory and
can be described by the diagram in <a class="reference internal" href="#software-organization"><span class="std std-ref">Software organization of ns-3</span></a>. We will
work our way from the bottom up; in general, modules only have dependencies
on modules beneath them in the figure.</p>
<p>We first describe the core of the simulator; those components that are
common across all protocol, hardware, and environmental models.
The simulation core is implemented in <code class="docutils literal notranslate"><span class="pre">src/core</span></code>. Packets are
fundamental objects in a network simulator
and are implemented in <code class="docutils literal notranslate"><span class="pre">src/network</span></code>. These two simulation modules by
themselves are intended to comprise a generic simulation core that can be
used by different kinds of networks, not just Internet-based networks.  The
above modules of <em>ns-3</em> are independent of specific network and device
models, which are covered in subsequent parts of this manual.</p>
<p>In addition to the above <em>ns-3</em> core, we introduce, also in the initial
portion of the manual, two other modules that supplement the core C++-based
API.  <em>ns-3</em> programs may access
all of the API directly or may make use of a so-called <em>helper API</em> that
provides convenient wrappers or encapsulation of low-level API calls. The
fact that <em>ns-3</em> programs can be written to two APIs (or a combination
thereof) is a fundamental aspect of the simulator.
We also describe how Python is supported in <em>ns-3</em> before moving onto
specific models of relevance to network simulation.</p>
<p>The remainder of the manual is focused on documenting the models and
supporting capabilities.  The next part focuses on two fundamental objects in
<em>ns-3</em>:  the <code class="docutils literal notranslate"><span class="pre">Node</span></code> and <code class="docutils literal notranslate"><span class="pre">NetDevice</span></code>. Two special NetDevice types are
designed to support network emulation use cases, and emulation is described
next.  The following chapter is devoted to Internet-related models,
including the
sockets API used by Internet applications. The next chapter covers
applications, and the following chapter describes additional support for
simulation, such as animators and statistics.</p>
<p>The project maintains a separate manual devoted to testing and validation
of <em>ns-3</em> code (see the <a class="reference external" href="http://www.nsnam.org/tutorials.html">ns-3 Testing and Validation manual</a>).</p>
</div>
<span id="document-working-with-git"></span><div class="section" id="working-with-git-as-a-user">
<span id="working-with-git"></span><h2>Working with git as a user<a class="headerlink" href="#working-with-git-as-a-user" title="Permalink to this headline">¶</a></h2>
<p>The ns-3 project used Mercurial in the past as its source code control system, but it has moved to Git in December 2018. Git is a VCS like Mercurial, Subversion or CVS, and it is used to maintain many open-source (and closed-source) projects. While git and mercurial have a lot of common properties, if you are new to git you should read first an introduction to it. The most up-to-date guide is the Git Book, at <a class="reference external" href="https://git-scm.com/book/en/v2/Getting-Started-Git-Basics">https://git-scm.com/book/en/v2/Getting-Started-Git-Basics</a>.</p>
<p>The ns-3 project is officially hosted on GitLab.com at <a class="reference external" href="https://gitlab.com/nsnam/">https://gitlab.com/nsnam/</a>.  For convenience and historical reasons, ns-3-dev mirrors are currently posted on Bitbucket.com and GitHub.com, and kept in sync with the official repository periodically via cron jobs.  We recommend that users who have been working from one of these mirrors repoint their remotes so that they pull origin or upstream from GitLab.com (see below explanation about how to configure remotes).</p>
<p>This section of the manual provides common tips for both users and maintainers. Since the first part is shared, in this manual section we will start with a personal repository and then explain what to do in some typical cases. ns-3 users often combine ns-3-dev with other repositories (pybindgen, netanim, apps from the app store).  This manual chapter does not cover this use case; it only focuses on the single ns-3-dev repository.  See other project documentation such as the ns-3 tutorial for descriptions on bundled releases distributed as source archives, or on the bake build tool for managing multiple repositories.  The guidelines listed below also largely pertain to the user who is using (and cloning) bake from the GitLab.com repository.</p>
<div class="section" id="ns-3-s-git-workflow-in-a-nutshell">
<h3>ns-3’s Git workflow in a nutshell<a class="headerlink" href="#ns-3-s-git-workflow-in-a-nutshell" title="Permalink to this headline">¶</a></h3>
<p>Experienced git users will not necessarily need instruction on how to set up personal repositories (below).  However, they should be aware of the project’s workflow:</p>
<ul class="simple">
<li><p>The main repository’s <code class="docutils literal notranslate"><span class="pre">master</span></code> branch is the main development branch.  The project maintains only this one branch and strives to maintain a mostly linear history on it.</p></li>
<li><p>Releases are made by creating a branch from the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch and tagging the branch with the release number when ready, and then merging the release branch back to the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch.  Releases can be identified by a git tag, and a modified <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> file in the branch.  However, the modified <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> file is not merged back to <code class="docutils literal notranslate"><span class="pre">master</span></code>.</p>
<ul>
<li><p>If a hotfix release must be made to update a past release, a new hotfix support branch will be created by branching from the tip of the last relevant release.  Changesets from <code class="docutils literal notranslate"><span class="pre">master</span></code> branch (such as bug fixes) may be cherry-picked to the hotfix branch.  The hotfix release is tagged with the hotfix version number, and merged back to the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch.</p></li>
</ul>
</li>
<li><p>Merges to the ns-3 <code class="docutils literal notranslate"><span class="pre">master</span></code> branch are fast forwarded when possible, and commits can be squashed as appropriate, to maintain a clean linear history.  Merge commits can be avoided in simple cases.</p>
<ul>
<li><p>More complicated merges might not be able to be fast forwarded, with the result that there will be a merge commit upon the merge.</p></li>
</ul>
</li>
<li><p>Maintainers can commit obvious non-critical fixes (documentation improvements, typos etc.) directly into the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch.  Users who are not maintainers can create GitLab.com Merge Requests for small items such as these, for maintainers to review.</p></li>
<li><p>Maintainers can directly commit bug fixes to their maintained modules without review/approval by other maintainers, although a review phase is recommended for non-trivial fixes.  Larger commits that touch multiple modules should be reviewed and approved by the set of affected maintainers.</p></li>
<li><p>When proposing code (new features, bug fixes, etc.) for a module maintained by someone else, the typical workflow will be to fork the <code class="docutils literal notranslate"><span class="pre">nsnam/ns-3-dev.git</span></code> repository, create a local feature branch on your fork, and use GitLab.com to generate a Merge Request towards <code class="docutils literal notranslate"><span class="pre">nsnam/ns-3-dev.git</span></code> when ready.  The Merge Request will then be reviewed, and in response to changes requested or comments from maintainers, authors are are asked to modify their feature branch and rebase to the tip of <code class="docutils literal notranslate"><span class="pre">ns-3-dev.git</span></code> as needed.</p></li>
</ul>
</div>
<div class="section" id="setup-of-a-personal-repository">
<h3>Setup of a personal repository<a class="headerlink" href="#setup-of-a-personal-repository" title="Permalink to this headline">¶</a></h3>
<p>We will provide two ways, one anonymous (but will impede the creation of merge requests) and the other, preferred, that include forking the repository through the GitLab.com web interface.</p>
<div class="section" id="directly-cloning-ns-3-dev">
<h4>Directly cloning ns-3-dev<a class="headerlink" href="#directly-cloning-ns-3-dev" title="Permalink to this headline">¶</a></h4>
<p>If you go to the official ns-3-dev page, hosted at <a class="reference external" href="https://gitlab.com/nsnam/ns-3-dev">https://gitlab.com/nsnam/ns-3-dev</a>, you can find a button that says <code class="docutils literal notranslate"><span class="pre">Clone</span></code>. If you are not logged in, then you will see only the option of cloning the repository through HTTPS, with this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://gitlab.com/nsnam/ns-3-dev.git
</pre></div>
</div>
<p>If this command exits successfully, you will have a newly created <cite>ns-3-dev</cite> directory with all the source code.</p>
</div>
<div class="section" id="forking-ns-3-dev-on-gitlab-com">
<h4>Forking ns-3-dev on GitLab.com<a class="headerlink" href="#forking-ns-3-dev-on-gitlab-com" title="Permalink to this headline">¶</a></h4>
<p>Assume that you are the user <em>john</em> on GitLab.com and that you want to create a new repository that is synced with nsnam/ns-3-dev.</p>
<ol class="arabic simple">
<li><p>Log into GitLab.com</p></li>
<li><p>Navigate to <a class="reference external" href="https://gitlab.com/nsnam/ns-3-dev">https://gitlab.com/nsnam/ns-3-dev</a></p></li>
<li><p>In the top-right corner of the page, click <code class="docutils literal notranslate"><span class="pre">Fork</span></code>.</p></li>
</ol>
<p>Note that you may only do this once; if you try to fork again, Gitlab will take you to the page of the original fork. So, if you are planning to maintain two or more separate forks (for example, one for your private work, another for maintenance, etc.), you are doing a mistake. Instead, you should add these forks as a remote of your existing directory (see below for adding remotes). Usually, it is a good thing to add the maintainer’s repository as remotes, because it can happen that “bleeding edge” features will appear there before landing in ns-3-dev.</p>
<p>For more information on forking with Gilab, there is plenty of visual documentation (<a class="reference external" href="https://docs.gitlab.com/ee/gitlab-basics/fork-project.html">https://docs.gitlab.com/ee/gitlab-basics/fork-project.html</a>). To work with your forked repository, you have two ways: one is a clean clone while the other is meant to re-use an existing ns-3 git repository.</p>
<div class="section" id="clone-your-forked-repository-on-your-machine">
<h5>Clone your forked repository on your machine<a class="headerlink" href="#clone-your-forked-repository-on-your-machine" title="Permalink to this headline">¶</a></h5>
<p>Git is a distributed versioning system. This means that <em>nobody</em> will touch your personal repository, until you do something. Please note that every gitlab user has, at least, two repositories: the first is represented by the repository hosted on gitlab servers, which will be called in the following <code class="docutils literal notranslate"><span class="pre">origin</span></code>. Then, you have your clone on your machine. This means that you could have many clones, on different machines, which points to <code class="docutils literal notranslate"><span class="pre">origin</span></code>.</p>
<p>To clone the newly created fork to your system, go to the homepage of your fork (that should be in the form <cite>https://gitlab.com/your-user-name/ns-3-dev</cite>) and click the <cite>Clone</cite> button. Then, go to your computer’s terminal, and issue the command (please refer to <a class="reference external" href="https://docs.gitlab.com/ee/gitlab-basics/command-line-commands.html#clone-your-project">https://docs.gitlab.com/ee/gitlab-basics/command-line-commands.html#clone-your-project</a> for more documentation):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://gitlab.com/your-user-name/ns-3-dev
$ <span class="nb">cd</span> ns-3-dev
</pre></div>
</div>
<p>In this example we used the HTTPS address because in some place the git + ssh address is blocked by firewalls. If you are not under this constraint, it is recommended to use the git + ssh address to avoid the username/password typing at each request.</p>
</div>
<div class="section" id="naming-conventions">
<h5>Naming conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a></h5>
<p>Git is able to fetch and push changes to several repositories, each of them is called <code class="docutils literal notranslate"><span class="pre">remote</span></code>. With time, you probably will have many remotes, each one with many branches. To avoid confusion, it is recommended to give meaningful names to the remotes; in the following, we will use <code class="docutils literal notranslate"><span class="pre">origin</span></code> to indicate the ns-3-dev repository in your personal namespace (your forked version, server-side) and <code class="docutils literal notranslate"><span class="pre">nsnam</span></code> to indicate the ns-3-dev repository in the nsnam namespace, server-side.</p>
</div>
</div>
</div>
<div class="section" id="add-the-official-ns-3-repository-as-remote-upstream">
<h3>Add the official ns-3 repository as remote upstream<a class="headerlink" href="#add-the-official-ns-3-repository-as-remote-upstream" title="Permalink to this headline">¶</a></h3>
<p>You could have already used git in the past, and therefore already having a ns-3 git repository somewhere. Or, instead, you could have it cloned for the first time in the step above. In both cases, when you fork/clone a repository, your history is no more bound to the repository itself. At this point, it is your duty to sync your fork with the original repository. The first remote repository we have encountered is <code class="docutils literal notranslate"><span class="pre">origin</span></code>; we must add the official ns-3 repo as another remote repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git remote add nsnam https://gitlab.com/nsnam/ns-3-dev
</pre></div>
</div>
<p>With the command above, we added a remote repository, named nsnam, which links to the official ns-3 repo. To show your remote repositories:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git remote show
</pre></div>
</div>
<p>To see to what <code class="docutils literal notranslate"><span class="pre">origin</span></code> is linking to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git remote show origin
</pre></div>
</div>
<p>Many options are available; please refer to the git manual for more.</p>
</div>
<div class="section" id="add-your-forked-repository-as-remote">
<h3>Add your forked repository as remote<a class="headerlink" href="#add-your-forked-repository-as-remote" title="Permalink to this headline">¶</a></h3>
<p>If you were a user of the old github mirror, you probably have an existing git repository installed somewhere. In your case, it is not necessary to clone your fork and to port all your work in the new directory; you can add the fork as new remote:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git remote rename origin old-origin
$ git remote add origin https://gitlab.com/your-user-name/ns-3-dev
</pre></div>
</div>
<p>After these two commands, you will have a remote, named origin, that points
to your forked repository on gitlab.</p>
</div>
<div class="section" id="keep-in-sync-your-repository-with-latest-ns-3-dev-updates">
<h3>Keep in sync your repository with latest ns-3-dev updates<a class="headerlink" href="#keep-in-sync-your-repository-with-latest-ns-3-dev-updates" title="Permalink to this headline">¶</a></h3>
<p>We assume, from now to the end of this document, that you will not make commits on top of the master branch. It should be kept clean from <em>any</em> personal modifications: all the works must be done in branches. Therefore, to move the current HEAD of the master branch to the latest commit in ns-3-dev, you should do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout master
$ git fetch nsnam
$ git pull nsnam master
</pre></div>
</div>
<p>If you tried a pull which resulted in a conflict and you would like to start over, you can recover with git reset (but this never happens if you do not commit over master).</p>
</div>
<div class="section" id="start-a-new-branch-to-do-some-work">
<h3>Start a new branch to do some work<a class="headerlink" href="#start-a-new-branch-to-do-some-work" title="Permalink to this headline">¶</a></h3>
<p>Look at the available branches:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git branch -a
</pre></div>
</div>
<p>you should see something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>* master
  remotes/origin/master
  remotes/nsnam/master
</pre></div>
</div>
<p>The branch master is your local master branch; remotes/origin/master point at the master branch on your repository located in the Gitlab server, while remotes/nsnam/master points to the official master branch.</p>
<p>Before entering in details on how to create a new branch, we have to explain why it is recommended to do it. First of all, if you put all your work in a separate branch, you can easily see the diff between ns-3 mainline and your feature branch (with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span> <span class="pre">master</span></code>). Also, you can integrate more easily the upstream advancements in your work, and when you wish, you can create a <em>conflict-free</em> merge request, that will ease the maintainer’s job in reviewing your work.</p>
<p>To create a new branch, starting from master, the command is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout master
$ git checkout -b <span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
</pre></div>
</div>
<p>To switch between branches, remove the -b option. You should now see:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git branch -a
 * master
  <span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
  remotes/origin/master
  remotes/nsnam/master
</pre></div>
</div>
</div>
<div class="section" id="edit-and-commit-the-modifications">
<h3>Edit and commit the modifications<a class="headerlink" href="#edit-and-commit-the-modifications" title="Permalink to this headline">¶</a></h3>
<p>After you edit some file, you should commit the difference. As a policy, git users love small and incremental patches. So, commit early, and commit often: you could rewrite your history later.</p>
<p>Suppose we edited <code class="docutils literal notranslate"><span class="pre">src/internet/model/tcp-socket-base.cc</span></code>. With git status, we can see the repository status:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git status
   On branch tcp-next
   Your branch is up-to-date with <span class="s1">&#39;mirror/tcp-next&#39;</span>.
   Changes not staged <span class="k">for</span> commit:
     modified:   src/internet/model/tcp-socket-base.cc
</pre></div>
</div>
<p>and we can see the edits with git diff:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ git diff

nat@miyamoto ~/Work/ns-3-dev-git (tcp-next)$ git diff
diff --git i/src/internet/model/tcp-socket-base.cc w/src/internet/model/tcp-socket-base.cc
index 1bf0f69..e2298b0 100644
--- i/src/internet/model/tcp-socket-base.cc
+++ w/src/internet/model/tcp-socket-base.cc
@@ -1439,6 +1439,10 @@ TcpSocketBase::ReceivedAck (Ptr&lt;Packet&gt; packet, const TcpHeader&amp; tcpHeader)
       // There is a DupAck
       ++m_dupAckCount;

+      // I&#39;m introducing a subtle bug!
+
+      m_tcb-&gt;m_cWnd = m_tcb-&gt;m_ssThresh;
+
       if (m_tcb-&gt;m_congState == TcpSocketState::CA_OPEN)
         {
           // From Open we go Disorder
</pre></div>
</div>
<p>To create a commit, select the file you want to add to the commit with git add:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git add src/internet/model/tcp-socket-base.cc
</pre></div>
</div>
<p>and then commit the result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git commit -m <span class="s2">&quot;My new TCP broken&quot;</span>
</pre></div>
</div>
<p>Of course, it would be better to have some rules for the commit message: they will be reported in the next subsection.</p>
<div class="section" id="commit-message-guidelines">
<h4>Commit message guidelines<a class="headerlink" href="#commit-message-guidelines" title="Permalink to this headline">¶</a></h4>
<p>The commit title should not go over the 80 char limit. It should be prefixed by the name of the module you are working on, and if it fixes a bug, it should reference it in the commit title. For instance, a good commit title would be:</p>
<blockquote>
<div><p>tcp: My new TCP broken</p>
</div></blockquote>
<p>Another example is:</p>
<blockquote>
<div><p>tcp: (fixes #2322) Corrected the uint32_t wraparound during recovery</p>
</div></blockquote>
<p>In the body message, try to explain what the problem was, and how you resolved that. If it is a new feature, try to describe it at a very high level, and highlight any modifications that changed the behaviour or the interface towards the users or other modules.</p>
</div>
<div class="section" id="commit-log">
<h4>Commit log<a class="headerlink" href="#commit-log" title="Permalink to this headline">¶</a></h4>
<p>You can see the history of the commits with git log. To show a particular commit, copy the sha-id and use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">show</span> <span class="pre">&lt;sha-id&gt;</span></code>. The ID is unique, so it can be referenced in emails or in issues. The next step is useful if you plan to contribute back your changes, but also to keep your feature branch updated with the latest changes from ns-3-dev.</p>
</div>
</div>
<div class="section" id="rebase-your-branch-on-top-of-master">
<h3>Rebase your branch on top of master<a class="headerlink" href="#rebase-your-branch-on-top-of-master" title="Permalink to this headline">¶</a></h3>
<p>Meanwhile you were busy with your branch, the upstream master could have changed. To rebase your work with the now new master, first of all sync your master branch (pulling the nsnam/master branch into your local master branch) as explained before; then</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout <span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
$ git rebase master
</pre></div>
</div>
<p>The last command will rewind your work, update the HEAD of your branch to the actual master, and then re-apply all your work. If some of your work conflicts with the actual master, you will be asked to fix these conflicts if automatic merge fails.</p>
</div>
<div class="section" id="pushing-your-changes-to-origin">
<h3>Pushing your changes to origin<a class="headerlink" href="#pushing-your-changes-to-origin" title="Permalink to this headline">¶</a></h3>
<p>After you have done some work on a branch, if you would like to share it with others, there is nothing better than pushing your work to your origin repository, on Gitlab servers.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout <span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
$ git push origin <span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> command can be used every time you need to push something from your computer to a remote repository, except when you propose changes to the main ns-3-dev repository: your changes must pass a review stage.</p>
<p>Please note that for older git version, the push command looks like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git push -u origin <span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="submit-work-for-review">
<h3>Submit work for review<a class="headerlink" href="#submit-work-for-review" title="Permalink to this headline">¶</a></h3>
<p>After you push your branch to origin, you can follow the instructions here <a class="reference external" href="https://docs.gitlab.com/ee/gitlab-basics/add-merge-request.html">https://docs.gitlab.com/ee/gitlab-basics/add-merge-request.html</a> to create a merge request. Please remember to add, as reviewer, at least one maintainer. To get the information on who is maintaining what, please refer to the <a class="reference external" href="https://www.nsnam.org/develop/maintainers/">nsnam website</a>.</p>
</div>
<div class="section" id="porting-patches-from-mercurial-repositories-to-git">
<h3>Porting patches from mercurial repositories to git<a class="headerlink" href="#porting-patches-from-mercurial-repositories-to-git" title="Permalink to this headline">¶</a></h3>
<p><em>Placeholder section; please improve it.</em></p>
</div>
</div>
<div class="section" id="working-with-git-as-a-maintainer">
<h2>Working with git as a maintainer<a class="headerlink" href="#working-with-git-as-a-maintainer" title="Permalink to this headline">¶</a></h2>
<p>As a maintainer, you are a person who has write access to the main nsnam repository. You could push your own work (without passing from code review) or push someone else’s work. Let’s investigate the two cases.</p>
<div class="section" id="pushing-your-own-work">
<h3>Pushing your own work<a class="headerlink" href="#pushing-your-own-work" title="Permalink to this headline">¶</a></h3>
<p>Since you have been added to the Developer list on Gitlab (if not, please open an issue) you can use the git + ssh address when adding nsnam as remote. Once you have done that, you can do your modifications to a local branch, then update the master to point to the latest changes of the nsnam repo, and then:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout master
$ git pull nsnam master
$ git merge <span class="o">[</span>your_branch_name<span class="o">]</span>
$ git push nsnam master
</pre></div>
</div>
<p>Please note that if you want to keep track of your branch, you can use as command <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">merge</span> <span class="pre">--no-ff</span> <span class="pre">[your_branch_name]</span></code>. It is always recommended to rebase your branch before merging, to have a clean history. That is not a requirement, though: git perfectly handles a master with parallel merged branches.</p>
</div>
<div class="section" id="review-and-merge-someone-else-s-work">
<h3>Review and merge someone else’s work<a class="headerlink" href="#review-and-merge-someone-else-s-work" title="Permalink to this headline">¶</a></h3>
<p>Gitlab.com has a plenty of documentation on how to handle merge requests. Please take a look here: <a class="reference external" href="https://docs.gitlab.com/ee/user/project/merge_requests/index.html">https://docs.gitlab.com/ee/user/project/merge_requests/index.html</a>.</p>
<p>If you are committing a patch from someone else, and it is not coming through a Merge Request process, you can use the –author=’’ argument to ‘git commit’ to assign authorship to another email address (such as we have done in the past with the Mercurial -u option).</p>
</div>
<div class="section" id="making-a-release">
<h3>Making a release<a class="headerlink" href="#making-a-release" title="Permalink to this headline">¶</a></h3>
<p>As stated above, the project has adopted a workflow to aim for a mostly
linear history on a single <code class="docutils literal notranslate"><span class="pre">master</span></code> branch.  Releases are branches from
this <code class="docutils literal notranslate"><span class="pre">master</span></code> branch but the branches themselves are not long-lived;
the release branches are merged back to <code class="docutils literal notranslate"><span class="pre">master</span></code> in a special way.  However,
the release branches can be checked out by using the git tag facility;
a named release such as ‘ns-3.30’ can be checked out on a branch by specifying
the release name ‘ns-3.30’ (or ‘ns-3.30.1’ etc.).</p>
<p>To facilitate this, let’s look at a toy repository and the git commands
involved.  This repository is initialized with a few files (<code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>,
<code class="docutils literal notranslate"><span class="pre">c</span></code>, and <code class="docutils literal notranslate"><span class="pre">README.md</span></code>) and a <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> file.  <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> is always
kept on the string <code class="docutils literal notranslate"><span class="pre">3-dev</span></code> in the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch, but is changed to
the release number in the release branches.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ls
a  b  c  README.md  VERSION
</pre></div>
</div>
<p>The git log command can be appended with some arguments to display the
branch history:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git log --graph --decorate --oneline --all
* d3e953b <span class="o">(</span>HEAD -&gt; master<span class="o">)</span> Add VERSION file
* 62b05c5 Add three files a, b, and c
* 3e124c8 <span class="o">(</span>origin/master, origin/HEAD<span class="o">)</span> Initial commit

$ cat VERSION
<span class="m">3</span>-dev

$ git branch -a
* master
  remotes/origin/HEAD -&gt; origin/master
  remotes/origin/master
</pre></div>
</div>
<p>Now, let’s create a notional ns-3.1 release.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout -b <span class="s1">&#39;ns-3.1-release&#39;</span>
Switched to a new branch <span class="s1">&#39;ns-3.1-release&#39;</span>
</pre></div>
</div>
<p>We change the VERSION field from ‘3-dev’ to ‘3.1’:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sed -i <span class="s1">&#39;s/3-dev/3.1/g&#39;</span> VERSION
$ cat VERSION
<span class="m">3</span>.1
$ git commit -m<span class="s2">&quot;Update VERSION to 3.1&quot;</span> VERSION
</pre></div>
</div>
<p>Let’s release this.  Add a git annotated tag as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git tag -a <span class="s1">&#39;ns-3.1&#39;</span> -m<span class="s2">&quot;ns-3.1 release&quot;</span>
</pre></div>
</div>
<p>Now, let’s merge back to <code class="docutils literal notranslate"><span class="pre">master</span></code>.  However, we want to avoid touching
the <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> file on <code class="docutils literal notranslate"><span class="pre">master</span></code>; we want all other changes and tags
but this one.  We can accomplish this with a special merge as follows.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout master
$ git merge --no-commit --no-ff ns-3.1-release
Automatic merge went well<span class="p">;</span> stopped before committing as requested
</pre></div>
</div>
<p>Now, we want to reset VERSION to the previous string, which existed before
we branched.  We can use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">reset</span></code> on this file and then finish the merge.
Recall its commit hash of <code class="docutils literal notranslate"><span class="pre">d3e953b</span></code> from above</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git reset d3e953b VERSION
Unstaged changes after reset:
M     VERSION
$ sed -i <span class="s1">&#39;s/3.1/3-dev/g&#39;</span> VERSION
$ cat VERSION
<span class="m">3</span>-dev
</pre></div>
</div>
<p>Finally, commit the branch and delete our local release branch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git commit -m<span class="s2">&quot;Merge ns-3.1-release branch&quot;</span>
$ git branch -d ns-3.1-release
</pre></div>
</div>
<p>The git history now looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git log --graph --decorate --oneline --all
*   80de6c5 <span class="o">(</span>HEAD -&gt; master<span class="o">)</span> Merge ns-3.1-release branch
<span class="p">|</span><span class="se">\</span>
<span class="p">|</span> * 5718d61 <span class="o">(</span>tag: ns-3.1, ns-3.1-release<span class="o">)</span> Update VERSION to <span class="m">3</span>.1
<span class="p">|</span>/
* d3e953b Add VERSION file
* 62b05c5 Add three files a, b, and c
* 3e124c8 <span class="o">(</span>origin/master, origin/HEAD<span class="o">)</span> Initial commit
$ git tag
ns-3.1
</pre></div>
</div>
<p>This may now be pushed to <code class="docutils literal notranslate"><span class="pre">nsnam/ns-3-dev.git</span></code> and development can continue.</p>
<p><strong>Note:</strong>  When pushing to the remote, don’t forget to push the tags:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git push --follow-tags
</pre></div>
</div>
<p>Future users who want to check out the ns-3.1 release will do something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout -b my-local-ns-3.1 ns-3.1
Switched to a new branch <span class="s1">&#39;my-local-ns-3.1&#39;</span>
</pre></div>
</div>
<p><strong>Note:</strong>  It is a good idea to avoid naming the new branch the same as the tag
name; in this case, ‘ns-3.1’.</p>
<p>Let’s assume now that master evolves with new features and bugfixes.  They
are committed to <code class="docutils literal notranslate"><span class="pre">master</span></code> on <code class="docutils literal notranslate"><span class="pre">nsnam/ns-3-dev.git</span></code> as usual:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout master
... <span class="o">(</span>some changes<span class="o">)</span>
$ git commit -m<span class="s2">&quot;make some changes&quot;</span> -a
$ <span class="nb">echo</span> <span class="s1">&#39;d&#39;</span> &gt;&gt; d
$ git add d
$ git commit -m<span class="s2">&quot;Add new feature&quot;</span> d
... <span class="o">(</span>some more changes<span class="o">)</span>
$ git commit -m<span class="s2">&quot;some more changes&quot;</span> -a
... <span class="o">(</span>now fix a really important bug<span class="o">)</span>
$ <span class="nb">echo</span> <span class="s1">&#39;abc&#39;</span> &gt;&gt; a
$ git commit -m<span class="s2">&quot;Fix missing abc bug on file a&quot;</span> a
</pre></div>
</div>
<p>Now the tree looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git log --graph --decorate --oneline --all
* ee37d41 <span class="o">(</span>HEAD -&gt; master<span class="o">)</span> Fix missing abc bug on file a
* 9a3432a some more changes
* ba28d6d Add new feature
* e50015a make some changes
*   80de6c5 Merge ns-3.1-release branch
<span class="p">|</span><span class="se">\</span>
<span class="p">|</span> * 5718d61 <span class="o">(</span>tag: ns-3.1<span class="o">)</span> Update VERSION to <span class="m">3</span>.1
<span class="p">|</span>/
* d3e953b Add VERSION file
* 62b05c5 Add three files a, b, and c
* 3e124c8 <span class="o">(</span>origin/master, origin/HEAD<span class="o">)</span> Initial commit
</pre></div>
</div>
<p>Let’s assume that the changeset <code class="docutils literal notranslate"><span class="pre">ee37d41</span></code> is considered important to fix in
the ns-3.1 release, but we don’t want the other changes introduced since then.
The solution will be to create a new branch for a hotfix release, and follow
similar steps.  The branch for the hotfix should come from commit <code class="docutils literal notranslate"><span class="pre">5718d61</span></code>,
and should cherry-pick commit <code class="docutils literal notranslate"><span class="pre">ee37d41</span></code> (which may require merge if it
doesn’t apply cleanly), and then the hotfix branch can be tagged and merged
as was done before.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout -b ns-3.1.1-release ns-3.1
$ git cherry-pick ee37d41
... <span class="o">(</span>resolve any conflicts<span class="o">)</span>
$ git add a
$ git commit
$ sed -i <span class="s1">&#39;s/3.1/3.1.1/g&#39;</span> VERSION
$ cat VERSION
<span class="m">3</span>.1.1
$ git commit -m<span class="s2">&quot;Update VERSION to 3.1.1&quot;</span> VERSION
$ git tag -a <span class="s1">&#39;ns-3.1.1&#39;</span> -m<span class="s2">&quot;ns-3.1.1 release&quot;</span>
</pre></div>
</div>
<p>Now the merge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git checkout master
$ git merge --no-commit --no-ff ns-3.1.1-release
</pre></div>
</div>
<p>This time we see:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Auto-merging a
CONFLICT <span class="o">(</span>content<span class="o">)</span>: Merge conflict in a
Auto-merging VERSION
CONFLICT <span class="o">(</span>content<span class="o">)</span>: Merge conflict in VERSION
Automatic merge failed<span class="p">;</span> fix conflicts and <span class="k">then</span> commit the result.
</pre></div>
</div>
<p>And we can then do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git reset ee37d41 a
$ git reset ee37d41 VERSION
</pre></div>
</div>
<p>Which leaves us with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Unstaged changes after reset:
M     VERSION
M     a
</pre></div>
</div>
<p>We can next hand-edit these files to restore them to original state, so that:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git status
On branch master
Your branch is ahead of <span class="s1">&#39;origin/master&#39;</span> by <span class="m">8</span> commits.
  <span class="o">(</span>use <span class="s2">&quot;git push&quot;</span> to publish your <span class="nb">local</span> commits<span class="o">)</span>

All conflicts fixed but you are still merging.
  <span class="o">(</span>use <span class="s2">&quot;git commit&quot;</span> to conclude merge<span class="o">)</span>

$ git commit
$ git branch -d ns-3.1.1-release
</pre></div>
</div>
<p>The new log should show:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git log --graph --decorate --oneline --all
*   815ce6e <span class="o">(</span>HEAD -&gt; master<span class="o">)</span> Merge branch <span class="s1">&#39;ns-3.1.1-release&#39;</span>
<span class="p">|</span><span class="se">\</span>
<span class="p">|</span> * 12a29ca <span class="o">(</span>tag: ns-3.1.1, ns-3.1.1-release<span class="o">)</span> Update VERSION to <span class="m">3</span>.1.1
<span class="p">|</span> * 21ebdbf Fix missing abc bug on file a
* <span class="p">|</span> ee37d41 Fix missing abc bug on file a
* <span class="p">|</span> 9a3432a some more changes
* <span class="p">|</span> ba28d6d Add new feature
* <span class="p">|</span> e50015a make some changes
* <span class="p">|</span>   80de6c5 Merge ns-3.1-release branch
<span class="p">|</span><span class="se">\ \</span>
<span class="p">|</span> <span class="p">|</span>/
<span class="p">|</span> * 5718d61 <span class="o">(</span>tag: ns-3.1<span class="o">)</span> Update VERSION to <span class="m">3</span>.1
<span class="p">|</span>/
* d3e953b Add VERSION file
* 62b05c5 Add three files a, b, and c
* 3e124c8 <span class="o">(</span>origin/master, origin/HEAD<span class="o">)</span> Initial commit
</pre></div>
</div>
<p>And we can continue to commit on top of master going forward.  The two
tags are:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git tag
ns-3.1
ns-3.1.1
</pre></div>
</div>
</div>
</div>
<span id="document-random-variables"></span><div class="section" id="random-variables">
<h2>Random Variables<a class="headerlink" href="#random-variables" title="Permalink to this headline">¶</a></h2>
<p><em>ns-3</em> contains a built-in pseudo-random number generator (PRNG). It is important
for serious users of the simulator to understand the functionality,
configuration, and usage of this PRNG, and to decide whether it is sufficient
for his or her research use.</p>
<div class="section" id="quick-overview">
<h3>Quick Overview<a class="headerlink" href="#quick-overview" title="Permalink to this headline">¶</a></h3>
<p><em>ns-3</em> random numbers are provided via instances of
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::RandomVariableStream</span></code>.</p>
<ul class="simple">
<li><p>by default, <em>ns-3</em> simulations use a fixed seed; if there is any randomness in
the simulation, each run of the program will yield identical results unless
the seed and/or run number is changed.</p></li>
<li><p>in <em>ns-3.3</em> and earlier, <em>ns-3</em> simulations used a random seed by default; this
marks a change in policy starting with <em>ns-3.4</em>.</p></li>
<li><p>in <em>ns-3.14</em> and earlier, <em>ns-3</em> simulations used a different wrapper class
called <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::RandomVariable</span></code>.  As of <em>ns-3.15</em>, this class has been
replaced by <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::RandomVariableStream</span></code>; the underlying pseudo-random
number generator has not changed.</p></li>
<li><p>to obtain randomness across multiple simulation runs, you must either set the
seed differently or set the run number differently.  To set a seed, call
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::RngSeedManager::SetSeed()</span></code> at the beginning of the program; to set
a run number with the same seed, call <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ns3::RngSeedManager::SetRun()</span></code> at
the beginning of the program; see <a class="reference internal" href="#seeding-and-independent-replications"><span class="std std-ref">Creating random variables</span></a>.</p></li>
<li><p>each RandomVariableStream used in <em>ns-3</em> has a virtual random number generator
associated with it; all random variables use either a fixed or random seed
based on the use of the global seed (previous bullet);</p></li>
<li><p>if you intend to perform multiple runs of the same scenario, with different
random numbers, please be sure to read the section on how to perform
independent replications: <a class="reference internal" href="#seeding-and-independent-replications"><span class="std std-ref">Creating random variables</span></a>.</p></li>
</ul>
<p>Read further for more explanation about the random number facility for <em>ns-3</em>.</p>
</div>
<div class="section" id="background">
<h3>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h3>
<p>Simulations use a lot of random numbers; one study
found that most network simulations spend as much as 50%
of the CPU generating random numbers.  Simulation users need
to be concerned with the quality of the (pseudo) random numbers and
the independence between different streams of random numbers.</p>
<p>Users need to be concerned with a few issues, such as:</p>
<ul class="simple">
<li><p>the seeding of the random number generator and whether a
simulation outcome is deterministic or not,</p></li>
<li><p>how to acquire different streams of random numbers that are
independent from one another, and</p></li>
<li><p>how long it takes for streams to cycle</p></li>
</ul>
<p>We will introduce a few terms here:  a RNG provides a long sequence
of (pseudo) random numbers.
The length of this sequence is called the <em>cycle length</em>
or <em>period</em>, after which the RNG will repeat itself.
This sequence can
be  partitioned into disjoint <em>streams</em>.  A stream of a
RNG is a contiguous subset or block of the RNG sequence.
For instance, if the
RNG period is of length N, and two streams are provided from this
RNG, then
the first stream might use the first N/2 values and the second
stream might produce the second N/2 values.  An important property
here is that the two streams are uncorrelated.  Likewise, each
stream can be partitioned disjointedly to a number of
uncorrelated <em>substreams</em>.  The underlying RNG hopefully
produces a pseudo-random sequence of numbers with a very long
cycle length, and partitions this into streams and substreams in an
efficient manner.</p>
<p><em>ns-3</em> uses the same underlying random number generator as does <em>ns-2</em>:  the
MRG32k3a generator from Pierre L’Ecuyer.  A detailed description can be found in
<a class="reference external" href="http://www.iro.umontreal.ca/~lecuyer/myftp/papers/streams00.pdf">http://www.iro.umontreal.ca/~lecuyer/myftp/papers/streams00.pdf</a>.  The MRG32k3a
generator provides <img class="math" src="_images/math/7bc755977774155c946c69cdcc441af1158e91a7.png" alt="1.8x10^{19}"/> independent streams of random numbers,
each of which consists of <img class="math" src="_images/math/31dc40610b46af3bcbd9eb68b6b5ec5350027bff.png" alt="2.3x10^{15}"/> substreams. Each substream has a
period (<em>i.e.</em>, the number of random numbers before overlap) of
<img class="math" src="_images/math/b221b0c74b72bae4e861a699b85b5964c8f01732.png" alt="7.6x10^{22}"/>. The period of the entire generator is <img class="math" src="_images/math/abeb4f688127a64818f66a29f6a61500bf02197d.png" alt="3.1x10^{57}"/>.</p>
<p>Class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::RandomVariableStream</span></code> is the public interface to this
underlying random number generator.  When users create new random variables
(such as <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::UniformRandomVariable</span></code>,
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::ExponentialRandomVariable</span></code>, etc.), they create an object that uses
one of the distinct, independent streams of the random number generator.
Therefore, each object of type <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::RandomVariableStream</span></code> has,
conceptually, its own “virtual” RNG.  Furthermore, each
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::RandomVariableStream</span></code> can be configured to use one of the set of
substreams drawn from the main stream.</p>
<p>An alternate implementation would be to allow each RandomVariable to have its
own (differently seeded) RNG.  However, we cannot guarantee as strongly that the
different sequences would be uncorrelated in such a case; hence, we prefer to
use a single RNG and streams and substreams from it.</p>
</div>
<div class="section" id="creating-random-variables">
<span id="seeding-and-independent-replications"></span><h3>Creating random variables<a class="headerlink" href="#creating-random-variables" title="Permalink to this headline">¶</a></h3>
<p><em>ns-3</em> supports a number of random variable objects from the base class
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">RandomVariableStream</span></code>.  These objects derive from
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Object</span></code> and are handled by smart pointers.</p>
<p>The correct way to create these objects is to use the templated
<cite>CreateObject&lt;&gt;</cite> method, such as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">UniformRandomVariable</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">UniformRandomVariable</span><span class="o">&gt;</span> <span class="p">();</span>
</pre></div>
</div>
<p>then you can access values by calling methods on the object such as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">myRandomNo</span> <span class="o">=</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">GetInteger</span> <span class="p">();</span>
</pre></div>
</div>
<p>If you try to instead do something like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">myRandomNo</span> <span class="o">=</span> <span class="n">UniformRandomVariable</span><span class="p">().</span><span class="n">GetInteger</span> <span class="p">();</span>
</pre></div>
</div>
<p>your program will encounter a segmentation fault, because the implementation
relies on some attribute construction that occurs only when <cite>CreateObject</cite>
is called.</p>
<p>Much of the rest of this chapter now discusses the properties of the
stream of pseudo-random numbers generated from such objects, and how to
control the seeding of such objects.</p>
</div>
<div class="section" id="id1">
<h3>Seeding and independent replications<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><em>ns-3</em> simulations can be configured to produce deterministic or random results.
If the <em>ns-3</em> simulation is configured to use a fixed, deterministic seed with
the same run number, it should give the same output each time it is run.</p>
<p>By default, <em>ns-3</em> simulations use a fixed seed and run number.  These values
are stored in two <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::GlobalValue</span></code> instances: <code class="docutils literal notranslate"><span class="pre">g_rngSeed</span></code> and
<code class="docutils literal notranslate"><span class="pre">g_rngRun</span></code>.</p>
<p>A typical use case is to run a simulation as a sequence of independent trials,
so as to compute statistics on a large number of independent runs.  The user can
either change the global seed and rerun the simulation, or can advance the
substream state of the RNG, which is referred to as incrementing the run number.</p>
<p>A class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::RngSeedManager</span></code> provides an API to control the seeding and
run number behavior.  This seeding and substream state setting must be called
before any random variables are created; e.g:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">RngSeedManager</span><span class="o">::</span><span class="n">SetSeed</span> <span class="p">(</span><span class="mi">3</span><span class="p">);</span>  <span class="c1">// Changes seed from default of 1 to 3</span>
<span class="n">RngSeedManager</span><span class="o">::</span><span class="n">SetRun</span> <span class="p">(</span><span class="mi">7</span><span class="p">);</span>   <span class="c1">// Changes run number from default of 1 to 7</span>
<span class="c1">// Now, create random variables</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">UniformRandomVariable</span><span class="o">&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">UniformRandomVariable</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ExponentialRandomVariable</span><span class="o">&gt;</span> <span class="n">y</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">ExponentialRandomVarlable</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="p">...</span>
</pre></div>
</div>
<p>Which is better, setting a new seed or advancing the substream state?  There is
no guarantee that the streams produced by two random seeds will not overlap.
The only way to guarantee that two streams do not overlap is to use the
substream capability provided by the RNG implementation.  <em>Therefore, use the
substream capability to produce multiple independent runs of the same
simulation.</em> In other words, the more statistically rigorous way to configure
multiple independent replications is to use a fixed seed and to advance the run
number.  This implementation allows for a maximum of <img class="math" src="_images/math/31dc40610b46af3bcbd9eb68b6b5ec5350027bff.png" alt="2.3x10^{15}"/>
independent replications using the substreams.</p>
<p>For ease of use, it is not necessary to control the seed and run number from
within the program; the user can set the <code class="docutils literal notranslate"><span class="pre">NS_GLOBAL_VALUE</span></code> environment
variable as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_GLOBAL_VALUE</span><span class="o">=</span><span class="s2">&quot;RngRun=3&quot;</span> ./waf --run program-name
</pre></div>
</div>
<p>Another way to control this is by passing a command-line argument; since this is
an <em>ns-3</em> GlobalValue instance, it is equivalently done such as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --command-template<span class="o">=</span><span class="s2">&quot;%s --RngRun=3&quot;</span> --run program-name
</pre></div>
</div>
<p>or, if you are running programs directly outside of waf:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./build/optimized/scratch/program-name --RngRun<span class="o">=</span><span class="m">3</span>
</pre></div>
</div>
<p>The above command-line variants make it easy to run lots of different
runs from a shell script by just passing a different RngRun index.</p>
</div>
<div class="section" id="class-randomvariablestream">
<h3>Class RandomVariableStream<a class="headerlink" href="#class-randomvariablestream" title="Permalink to this headline">¶</a></h3>
<p>All random variables should derive from class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">RandomVariable</span></code>. This
base class provides a few methods for globally configuring the behavior
of the random number generator. Derived classes provide API for drawing random
variates from the particular distribution being supported.</p>
<p>Each RandomVariableStream created in the simulation is given a generator that is a
new RNGStream from the underlying PRNG. Used in this manner, the L’Ecuyer
implementation allows for a maximum of <img class="math" src="_images/math/ce00b567c62f520f9a3fec854af6e8ca530afbfd.png" alt="1.8x10^19"/> random variables.  Each
random variable in a single replication can produce up to <img class="math" src="_images/math/e91e442e51f610bd366686d760b40020dd85ee33.png" alt="7.6x10^22"/>
random numbers before overlapping.</p>
</div>
<div class="section" id="base-class-public-api">
<h3>Base class public API<a class="headerlink" href="#base-class-public-api" title="Permalink to this headline">¶</a></h3>
<p>Below are excerpted a few public methods of class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">RandomVariableStream</span></code>
that access the next value in the substream.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * \brief Returns a random double from the underlying distribution</span>
<span class="cm"> * \return A floating point random value</span>
<span class="cm"> */</span>
<span class="kt">double</span> <span class="nf">GetValue</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * \brief Returns a random integer from the underlying distribution</span>
<span class="cm"> * \return  Integer cast of ::GetValue()</span>
<span class="cm"> */</span>
<span class="kt">uint32_t</span> <span class="nf">GetInteger</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p>We have already described the seeding configuration above. Different
RandomVariable subclasses may have additional API.</p>
</div>
<div class="section" id="types-of-randomvariables">
<h3>Types of RandomVariables<a class="headerlink" href="#types-of-randomvariables" title="Permalink to this headline">¶</a></h3>
<p>The following types of random variables are provided, and are documented in the
<em>ns-3</em> Doxygen or by reading <code class="docutils literal notranslate"><span class="pre">src/core/model/random-variable-stream.h</span></code>.  Users
can also create their own custom random variables by deriving from class
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">RandomVariableStream</span></code>.</p>
<ul class="simple">
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">UniformRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConstantRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">SequentialRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ExponentialRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ParetoRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">WeibullRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">NormalRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">LogNormalRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">GammaRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ErlangRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TriangularRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ZipfRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ZetaRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">DeterministicRandomVariable</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">EmpiricalRandomVariable</span></code></p></li>
</ul>
</div>
<div class="section" id="semantics-of-randomvariablestream-objects">
<h3>Semantics of RandomVariableStream objects<a class="headerlink" href="#semantics-of-randomvariablestream-objects" title="Permalink to this headline">¶</a></h3>
<p>RandomVariableStream objects derive from <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Object</span></code> and are
handled by smart pointers.</p>
<p>RandomVariableStream instances can also be used in <em>ns-3</em> attributes, which means
that values can be set for them through the <em>ns-3</em> attribute system.
An example is in the propagation models for WifiNetDevice:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TypeId</span>
<span class="n">RandomPropagationDelayModel</span><span class="o">::</span><span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;ns3::RandomPropagationDelayModel&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">SetParent</span><span class="o">&lt;</span><span class="n">PropagationDelayModel</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">SetGroupName</span> <span class="p">(</span><span class="s">&quot;Propagation&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">AddConstructor</span><span class="o">&lt;</span><span class="n">RandomPropagationDelayModel</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;Variable&quot;</span><span class="p">,</span>
                   <span class="s">&quot;The random variable which generates random delays (s).&quot;</span><span class="p">,</span>
                   <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;ns3::UniformRandomVariable&quot;</span><span class="p">),</span>
                   <span class="n">MakePointerAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">RandomPropagationDelayModel</span><span class="o">::</span><span class="n">m_variable</span><span class="p">),</span>
                   <span class="n">MakePointerChecker</span><span class="o">&lt;</span><span class="n">RandomVariableStream</span><span class="o">&gt;</span> <span class="p">())</span>
    <span class="p">;</span>
  <span class="k">return</span> <span class="n">tid</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, the <em>ns-3</em> user can change the default random variable for this
delay model (which is a UniformRandomVariable ranging from 0 to 1) through
the attribute system.</p>
</div>
<div class="section" id="using-other-prng">
<h3>Using other PRNG<a class="headerlink" href="#using-other-prng" title="Permalink to this headline">¶</a></h3>
<p>There is presently no support for substituting a different underlying
random number generator (e.g., the GNU Scientific Library or the Akaroa
package).  Patches are welcome.</p>
</div>
<div class="section" id="setting-the-stream-number">
<h3>Setting the stream number<a class="headerlink" href="#setting-the-stream-number" title="Permalink to this headline">¶</a></h3>
<p>The underlying MRG32k3a generator provides 2^64 independent streams.
In ns-3, these are assigned sequentially starting from the first stream as
new RandomVariableStream instances make their first call to GetValue().</p>
<p>As a result of how these RandomVariableStream objects are assigned to
underlying streams, the assignment is sensitive to perturbations of
the simulation configuration.  The consequence is that if any aspect of the
simulation configuration is changed, the mapping of RandomVariables to
streams may (or may not) change.</p>
<p>As a concrete example, a user running a comparative study between routing
protocols may find that the act of changing one routing protocol for another
will notice that the underlying mobility pattern also changed.</p>
<p>Starting with ns-3.15, some control has been provided to users to allow
users to optionally fix the assignment of selected RandomVariableStream
objects to underlying streams.  This is the <code class="docutils literal notranslate"><span class="pre">Stream</span></code> attribute, part
of the base class RandomVariableStream.</p>
<p>By partitioning the existing sequence of streams from before:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;--------------------------------------------------------------------------&gt;
stream 0                                                   stream (2^64 - 1)
</pre></div>
</div>
<p>into two equal-sized sets:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;--------------------------------------------------------------------------&gt;
^                                    ^^                                    ^
|                                    ||                                    |
stream 0            stream (2^63 - 1)  stream 2^63         stream (2^64 - 1)
&lt;- automatically assigned -----------&gt;&lt;- assigned by user -----------------&gt;
</pre></div>
</div>
<p>The first 2^63 streams continue to be automatically assigned, while
the last 2^63 are given stream indices starting with zero up to
2^63-1.</p>
<p>The assignment of streams to a fixed stream number is optional; instances
of RandomVariableStream that do not have a stream value assigned will
be assigned the next one from the pool of automatic streams.</p>
<p>To fix a RandomVariableStream to a particular underlying stream, assign
its <code class="docutils literal notranslate"><span class="pre">Stream</span></code> attribute to a non-negative integer (the default value
of -1 means that a value will be automatically allocated).</p>
</div>
<div class="section" id="publishing-your-results">
<h3>Publishing your results<a class="headerlink" href="#publishing-your-results" title="Permalink to this headline">¶</a></h3>
<p>When you publish simulation results, a key piece of configuration
information that you should always state is how you used the
random number generator.</p>
<ul class="simple">
<li><p>what seeds you used,</p></li>
<li><p>what RNG you used if not the default,</p></li>
<li><p>how were independent runs performed,</p></li>
<li><p>for large simulations, how did you check that you did not cycle.</p></li>
</ul>
<p>It is incumbent on the researcher publishing results to include enough
information to allow others to reproduce his or her results. It is also
incumbent on the researcher to convince oneself that the random numbers used
were statistically valid, and to state in the paper why such confidence is
assumed.</p>
</div>
<div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<p>Let’s review what things you should do when creating a simulation.</p>
<ul class="simple">
<li><p>Decide whether you are running with a fixed seed or random seed; a fixed seed
is the default,</p></li>
<li><p>Decide how you are going to manage independent replications, if applicable,</p></li>
<li><p>Convince yourself that you are not drawing more random values than the cycle
length, if you are running a very long simulation, and</p></li>
<li><p>When you publish, follow the guidelines above about documenting your use of
the random number generator.</p></li>
</ul>
</div>
</div>
<span id="document-hash-functions"></span><div class="section" id="hash-functions">
<h2>Hash Functions<a class="headerlink" href="#hash-functions" title="Permalink to this headline">¶</a></h2>
<p><em>ns-3</em> provides a generic interface to general purpose hash functions.
In the simplest usage, the hash function returns the 32-bit or 64-bit
hash of a data buffer or string.  The default underlying hash function
is <a class="reference external" href="http://code.google.com/p/smhasher/wiki/MurmurHash3">murmur3</a>, chosen because it has good hash function properties and
offers a 64-bit version.  The venerable <a class="reference external" href="http://isthe.com/chongo/tech/comp/fnv/">FNV1a</a> hash is also available.</p>
<p>There is a straight-forward mechanism to
add (or provide at run time) alternative hash function implementations.</p>
<div class="section" id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">¶</a></h3>
<p>The simplest way to get a hash value of a data buffer or string is just:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ns3/hash.h&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">ns3</span><span class="p">;</span>

<span class="kt">char</span> <span class="o">*</span> <span class="n">buffer</span> <span class="o">=</span> <span class="p">...</span>
<span class="kt">size_t</span> <span class="n">buffer_size</span> <span class="o">=</span> <span class="p">...</span>

<span class="kt">uint32_t</span>  <span class="n">buffer_hash</span> <span class="o">=</span> <span class="n">Hash32</span> <span class="p">(</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s</span><span class="p">;</span>
<span class="kt">uint32_t</span>  <span class="n">string_hash</span> <span class="o">=</span> <span class="n">Hash32</span> <span class="p">(</span><span class="n">s</span><span class="p">);</span>
</pre></div>
</div>
<p>Equivalent functions are defined for 64-bit hash values.</p>
</div>
<div class="section" id="incremental-hashing">
<h3>Incremental Hashing<a class="headerlink" href="#incremental-hashing" title="Permalink to this headline">¶</a></h3>
<p>In some situations it’s useful to compute the hash of multiple buffers,
as if they had been joined together.  (For example, you might want
the hash of a packet stream, but not want to assemble a single buffer
with the combined contents of all the packets.)</p>
<p>This is almost as straight-forward as the first example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ns3/hash.h&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">ns3</span><span class="p">;</span>

<span class="kt">char</span> <span class="o">*</span> <span class="n">buffer</span><span class="p">;</span>
<span class="kt">size_t</span> <span class="n">buffer_size</span><span class="p">;</span>

<span class="n">Hasher</span> <span class="n">hasher</span><span class="p">;</span>  <span class="c1">// Use default hash function</span>

<span class="k">for</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">every</span> <span class="n">buffer</span><span class="o">&gt;</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">buffer</span> <span class="o">=</span> <span class="n">get_next_buffer</span> <span class="p">();</span>
      <span class="n">hasher</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">);</span>
  <span class="p">}</span>
<span class="kt">uint32_t</span> <span class="n">combined_hash</span> <span class="o">=</span> <span class="n">hasher</span><span class="p">.</span><span class="n">GetHash32</span> <span class="p">();</span>
</pre></div>
</div>
<p>By default <code class="docutils literal notranslate"><span class="pre">Hasher</span></code> preserves internal state to enable incremental
hashing.  If you want to reuse a <code class="docutils literal notranslate"><span class="pre">Hasher</span></code> object (for example
because it’s configured with a non-default hash function), but don’t
want to add to the previously computed hash, you need to <code class="docutils literal notranslate"><span class="pre">clear()</span></code>
first:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">hasher</span><span class="p">.</span><span class="n">clear</span> <span class="p">().</span><span class="n">GetHash32</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">);</span>
</pre></div>
</div>
<p>This reinitializes the internal state before hashing the buffer.</p>
</div>
<div class="section" id="using-an-alternative-hash-function">
<h3>Using an Alternative Hash Function<a class="headerlink" href="#using-an-alternative-hash-function" title="Permalink to this headline">¶</a></h3>
<p>The default hash function is <a class="reference external" href="http://code.google.com/p/smhasher/wiki/MurmurHash3">murmur3</a>.  <a class="reference external" href="http://isthe.com/chongo/tech/comp/fnv/">FNV1a</a> is also available.  To specify
the hash function explicitly, use this constructor:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Hasher</span> <span class="n">hasher</span> <span class="o">=</span> <span class="n">Hasher</span> <span class="p">(</span> <span class="n">Create</span><span class="o">&lt;</span><span class="n">Hash</span><span class="o">::</span><span class="n">Function</span><span class="o">::</span><span class="n">Fnv1a</span><span class="o">&gt;</span> <span class="p">()</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-new-hash-function-implementations">
<h3>Adding New Hash Function Implementations<a class="headerlink" href="#adding-new-hash-function-implementations" title="Permalink to this headline">¶</a></h3>
<p>To add the hash function <code class="docutils literal notranslate"><span class="pre">foo</span></code>, follow the <code class="docutils literal notranslate"><span class="pre">hash-murmur3.h</span></code>/<code class="docutils literal notranslate"><span class="pre">.cc</span></code> pattern:</p>
<blockquote>
<div><ul class="simple">
<li><p>Create a class declaration (<code class="docutils literal notranslate"><span class="pre">.h</span></code>) and definition (<code class="docutils literal notranslate"><span class="pre">.cc</span></code>) inheriting
from <code class="docutils literal notranslate"><span class="pre">Hash::Implementation</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include</span></code> the declaration in <code class="docutils literal notranslate"><span class="pre">hash.h</span></code> (at the point where
<code class="docutils literal notranslate"><span class="pre">hash-murmur3.h</span></code> is included.</p></li>
<li><p>In your own code, instantiate a <code class="docutils literal notranslate"><span class="pre">Hasher</span></code> object via the constructor
<code class="docutils literal notranslate"><span class="pre">Hasher</span> <span class="pre">(Ptr&lt;Hash::Function::Foo&gt;</span> <span class="pre">())</span></code></p></li>
</ul>
</div></blockquote>
<p>If your hash function is a single function, e.g. <code class="docutils literal notranslate"><span class="pre">hashf</span></code>, you don’t
even need to create a new class derived from HashImplementation:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Hasher</span> <span class="n">hasher</span> <span class="o">=</span>
  <span class="n">Hasher</span> <span class="p">(</span> <span class="n">Create</span><span class="o">&lt;</span><span class="n">Hash</span><span class="o">::</span><span class="n">Function</span><span class="o">::</span><span class="n">Hash32</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">hashf</span><span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>For this to compile, your <code class="docutils literal notranslate"><span class="pre">hashf</span></code> has to match one of the function pointer
signatures:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="nf">uint32_t</span> <span class="p">(</span><span class="o">*</span><span class="n">Hash32Function_ptr</span><span class="p">)</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span><span class="p">);</span>
<span class="k">typedef</span> <span class="nf">uint64_t</span> <span class="p">(</span><span class="o">*</span><span class="n">Hash64Function_ptr</span><span class="p">)</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="sources-for-hash-functions">
<h3>Sources for Hash Functions<a class="headerlink" href="#sources-for-hash-functions" title="Permalink to this headline">¶</a></h3>
<p>Sources for other hash function implementations include:</p>
<blockquote>
<div><ul class="simple">
<li><p>Peter Kankowski: <a class="reference external" href="http://www.strchr.com">http://www.strchr.com</a></p></li>
<li><p>Arash Partow:    <a class="reference external" href="http://www.partow.net/programming/hashfunctions/index.html">http://www.partow.net/programming/hashfunctions/index.html</a></p></li>
<li><p>SMHasher:        <a class="reference external" href="http://code.google.com/p/smhasher/">http://code.google.com/p/smhasher/</a></p></li>
<li><p>Sanmayce:        <a class="reference external" href="http://www.sanmayce.com/Fastest_Hash/index.html">http://www.sanmayce.com/Fastest_Hash/index.html</a></p></li>
</ul>
</div></blockquote>
</div>
</div>
<span id="document-events"></span><div class="section" id="events-and-simulator">
<h2>Events and Simulator<a class="headerlink" href="#events-and-simulator" title="Permalink to this headline">¶</a></h2>
<p><em>ns-3</em> is a discrete-event network simulator.  Conceptually, the simulator
keeps track of a number of events that are scheduled to execute at a
specified simulation time.  The job of the simulator is to execute the
events in sequential time order.  Once the completion of an event occurs,
the simulator will move to the next event (or will exit if there are no
more events in the event queue).  If, for example, an event scheduled
for simulation time “100 seconds” is executed, and the next event is not
scheduled until “200 seconds”, the simulator will immediately jump from
100 seconds to 200 seconds (of simulation time) to execute the next event.
This is what is meant by “discrete-event” simulator.</p>
<p>To make this all happen, the simulator needs a few things:</p>
<ol class="arabic simple">
<li><p>a simulator object that can access an event queue where events are
stored and that can manage the execution of events</p></li>
<li><p>a scheduler responsible for inserting and removing events from the queue</p></li>
<li><p>a way to represent simulation time</p></li>
<li><p>the events themselves</p></li>
</ol>
<p>This chapter of the manual describes these fundamental objects
(simulator, scheduler, time, event) and how they are used.</p>
<div class="section" id="event">
<h3>Event<a class="headerlink" href="#event" title="Permalink to this headline">¶</a></h3>
<p><em>To be completed</em></p>
</div>
<div class="section" id="simulator">
<h3>Simulator<a class="headerlink" href="#simulator" title="Permalink to this headline">¶</a></h3>
<p>The Simulator class is the public entry point to access event scheduling
facilities. Once a couple of events have been scheduled to start the
simulation, the user can start to execute them by entering the simulator
main loop (call <code class="docutils literal notranslate"><span class="pre">Simulator::Run</span></code>). Once the main loop starts running, it
will sequentially execute all scheduled events in order from oldest to
most recent until there are either no more events left in the event
queue or Simulator::Stop has been called.</p>
<p>To schedule events for execution by the simulator main loop, the
Simulator class provides the Simulator::Schedule* family of functions.</p>
<ol class="arabic simple">
<li><p>Handling event handlers with different signatures</p></li>
</ol>
<p>These functions are declared and implemented as C++ templates to handle
automatically the wide variety of C++ event handler signatures used in
the wild. For example, to schedule an event to execute 10 seconds in the
future, and invoke a C++ method or function with specific arguments, you
might write this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">handler</span> <span class="p">(</span><span class="kt">int</span> <span class="n">arg0</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg1</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;handler called with argument arg0=&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">arg0</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; and</span>
     <span class="n">arg1</span><span class="o">=</span><span class="s">&quot; &lt;&lt; arg1 &lt;&lt; std::endl;</span>
<span class="p">}</span>

<span class="n">Simulator</span><span class="o">::</span><span class="n">Schedule</span><span class="p">(</span><span class="n">Seconds</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">handler</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
<p>Which will output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>handler called with argument arg0=10 and arg1=5
</pre></div>
</div>
<p>Of course, these C++ templates can also handle transparently member
methods on C++ objects:</p>
<p><em>To be completed:  member method example</em></p>
<p>Notes:</p>
<ul class="simple">
<li><p>the ns-3 Schedule methods recognize automatically functions and
methods only if they take less than 5 arguments. If you need them to
support more arguments, please, file a bug report.</p></li>
<li><p>Readers familiar with the term ‘fully-bound functors’ will recognize
the Simulator::Schedule methods as a way to automatically construct such
objects.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Common scheduling operations</p></li>
</ol>
<p>The Simulator API was designed to make it really simple to schedule most
events. It provides three variants to do so (ordered from most commonly
used to least commonly used):</p>
<ul class="simple">
<li><p>Schedule methods which allow you to schedule an event in the future
by providing the delay between the current simulation time and the
expiration date of the target event.</p></li>
<li><p>ScheduleNow methods which allow you to schedule an event for the
current simulation time: they will execute _after_ the current event is
finished executing but _before_ the simulation time is changed for the
next event.</p></li>
<li><p>ScheduleDestroy methods which allow you to hook in the shutdown
process of the Simulator to cleanup simulation resources: every
‘destroy’ event is executed when the user calls the Simulator::Destroy
method.</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>Maintaining the simulation context</p></li>
</ol>
<p>There are two basic ways to schedule events, with and without <em>context</em>.
What does this mean?</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Simulator</span><span class="o">::</span><span class="n">Schedule</span> <span class="p">(</span><span class="n">Time</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">time</span><span class="p">,</span> <span class="n">MEM</span> <span class="n">mem_ptr</span><span class="p">,</span> <span class="n">OBJ</span> <span class="n">obj</span><span class="p">);</span>
</pre></div>
</div>
<p>vs.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Simulator</span><span class="o">::</span><span class="n">ScheduleWithContext</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">context</span><span class="p">,</span> <span class="n">Time</span> <span class="k">const</span> <span class="o">&amp;</span><span class="n">time</span><span class="p">,</span> <span class="n">MEM</span> <span class="n">mem_ptr</span><span class="p">,</span> <span class="n">OBJ</span> <span class="n">obj</span><span class="p">);</span>
</pre></div>
</div>
<p>Readers who invest time and effort in developing or using a non-trivial
simulation model will know the value of the ns-3 logging framework to
debug simple and complex simulations alike. One of the important
features that is provided by this logging framework is the automatic
display of the network node id associated with the ‘currently’ running
event.</p>
<p>The node id of the currently executing network node is in fact tracked
by the Simulator class. It can be accessed with the
Simulator::GetContext method which returns the ‘context’ (a 32-bit
integer) associated and stored in the currently-executing event. In some
rare cases, when an event is not associated with a specific network
node, its ‘context’ is set to 0xffffffff.</p>
<p>To associate a context to each event, the Schedule, and ScheduleNow
methods automatically reuse the context of the currently-executing event
as the context of the event scheduled for execution later.</p>
<p>In some cases, most notably when simulating the transmission of a packet
from a node to another, this behavior is undesirable since the expected
context of the reception event is that of the receiving node, not the
sending node. To avoid this problem, the Simulator class provides a
specific schedule method: ScheduleWithContext which allows one to
provide explicitly the node id of the receiving node associated with
the receive event.</p>
<p><em>XXX: code example</em></p>
<p>In some very rare cases, developers might need to modify or understand
how the context (node id) of the first event is set to that of its
associated node. This is accomplished by the NodeList class: whenever a
new node is created, the NodeList class uses ScheduleWithContext to
schedule a ‘initialize’ event for this node. The ‘initialize’ event thus executes
with a context set to that of the node id and can use the normal variety
of Schedule methods. It invokes the Node::Initialize method which propagates
the ‘initialize’ event by calling the DoInitialize method for each object
associated with the node. The DoInitialize method overridden in some of these
objects (most notably in the Application base class) will schedule some
events (most notably Application::StartApplication) which will in turn
scheduling traffic generation events which will in turn schedule
network-level events.</p>
<p>Notes:</p>
<ul class="simple">
<li><p>Users need to be careful to propagate DoInitialize methods across objects
by calling Initialize explicitly on their member objects</p></li>
<li><p>The context id associated with each ScheduleWithContext method has
other uses beyond logging: it is used by an experimental branch of ns-3
to perform parallel simulation on multicore systems using
multithreading.</p></li>
</ul>
<p>The Simulator::* functions do not know what the context is: they
merely make sure that whatever context you specify with
ScheduleWithContext is available when the corresponding event executes
with ::GetContext.</p>
<p>It is up to the models implemented on top of Simulator::* to interpret
the context value. In ns-3, the network models interpret the context
as the node id of the node which generated an event. This is why it is
important to call ScheduleWithContext in ns3::Channel subclasses
because we are generating an event from node i to node j and we want
to make sure that the event which will run on node j has the right
context.</p>
</div>
<div class="section" id="time">
<h3>Time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h3>
<p><em>To be completed</em></p>
</div>
<div class="section" id="scheduler">
<h3>Scheduler<a class="headerlink" href="#scheduler" title="Permalink to this headline">¶</a></h3>
<p><em>To be completed</em></p>
</div>
</div>
<span id="document-callbacks"></span><div class="section" id="callbacks">
<h2>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h2>
<p>Some new users to <em>ns-3</em> are unfamiliar with an extensively used programming
idiom used throughout the code: the <em>ns-3 callback</em>. This chapter provides some
motivation on the callback, guidance on how to use it, and details on its
implementation.</p>
<div class="section" id="callbacks-motivation">
<h3>Callbacks Motivation<a class="headerlink" href="#callbacks-motivation" title="Permalink to this headline">¶</a></h3>
<p>Consider that you have two simulation models A and B, and you wish to have them
pass information between them during the simulation. One way that you can do
that is that you can make A and B each explicitly knowledgeable about the other,
so that they can invoke methods on each other:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">ReceiveInput</span> <span class="p">(</span> <span class="c1">// parameters );</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="p">(</span><span class="n">in</span> <span class="n">another</span> <span class="n">source</span> <span class="nl">file</span><span class="p">:)</span>

<span class="k">class</span> <span class="nc">B</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">DoSomething</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
  <span class="p">...</span>

<span class="k">private</span><span class="o">:</span>
  <span class="n">A</span><span class="o">*</span> <span class="n">a_instance</span><span class="p">;</span> <span class="c1">// pointer to an A</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">B</span><span class="o">::</span><span class="n">DoSomething</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Tell a_instance that something happened</span>
  <span class="n">a_instance</span><span class="o">-&gt;</span><span class="n">ReceiveInput</span> <span class="p">(</span> <span class="c1">// parameters);</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This certainly works, but it has the drawback that it introduces a dependency on
A and B to know about the other at compile time (this makes it harder to have
independent compilation units in the simulator) and is not generalized; if in a
later usage scenario, B needs to talk to a completely different C object, the
source code for B needs to be changed to add a <code class="docutils literal notranslate"><span class="pre">c_instance</span></code> and so forth. It
is easy to see that this is a brute force mechanism of communication that can
lead to programming cruft in the models.</p>
<p>This is not to say that objects should not know about one another if there is a
hard dependency between them, but that often the model can be made more flexible
if its interactions are less constrained at compile time.</p>
<p>This is not an abstract problem for network simulation research, but rather it
has been a source of problems in previous simulators, when researchers want to
extend or modify the system to do different things (as they are apt to do in
research). Consider, for example, a user who wants to add an IPsec security
protocol sublayer between TCP and IP:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">------------</span>                   <span class="o">-----------</span>
<span class="o">|</span>   <span class="n">TCP</span>    <span class="o">|</span>                   <span class="o">|</span>  <span class="n">TCP</span>    <span class="o">|</span>
<span class="o">------------</span>                   <span class="o">-----------</span>
     <span class="o">|</span>           <span class="n">becomes</span> <span class="o">-&gt;</span>        <span class="o">|</span>
<span class="o">-----------</span>                    <span class="o">-----------</span>
<span class="o">|</span>   <span class="n">IP</span>    <span class="o">|</span>                    <span class="o">|</span> <span class="n">IPsec</span>   <span class="o">|</span>
<span class="o">-----------</span>                    <span class="o">-----------</span>
                                   <span class="o">|</span>
                               <span class="o">-----------</span>
                               <span class="o">|</span>   <span class="n">IP</span>    <span class="o">|</span>
                               <span class="o">-----------</span>
</pre></div>
</div>
<p>If the simulator has made assumptions, and hard coded into the code, that IP
always talks to a transport protocol above, the user may be forced to hack the
system to get the desired interconnections. This is clearly not an optimal way
to design a generic simulator.</p>
</div>
<div class="section" id="callbacks-background">
<h3>Callbacks Background<a class="headerlink" href="#callbacks-background" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Readers familiar with programming callbacks may skip this tutorial
section.</p>
</div>
<p>The basic mechanism that allows one to address the problem above is known as a
<em>callback</em>. The ultimate goal is to allow one piece of code to call a function
(or method in C++) without any specific inter-module dependency.</p>
<p>This ultimately means you need some kind of indirection – you treat the address
of the called function as a variable.  This variable is called a
pointer-to-function variable. The relationship between function and
pointer-to-function pointer is really no different that that of object and
pointer-to-object.</p>
<p>In C the canonical example of a pointer-to-function is a
pointer-to-function-returning-integer (PFI). For a PFI taking one int parameter,
this could be declared like,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">pfi</span><span class="p">)(</span><span class="kt">int</span> <span class="n">arg</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>What you get from this is a variable named simply <code class="docutils literal notranslate"><span class="pre">pfi</span></code> that is initialized to
the value 0. If you want to initialize this pointer to something meaningful, you
have to have a function with a matching signature. In this case:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">MyFunction</span> <span class="p">(</span><span class="kt">int</span> <span class="n">arg</span><span class="p">)</span> <span class="p">{}</span>
</pre></div>
</div>
<p>If you have this target, you can initialize the variable to point to your
function like:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">pfi</span> <span class="o">=</span> <span class="n">MyFunction</span><span class="p">;</span>
</pre></div>
</div>
<p>You can then call MyFunction indirectly using the more suggestive form of the
call:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">pfi</span><span class="p">)</span> <span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
</pre></div>
</div>
<p>This is suggestive since it looks like you are dereferencing the function
pointer just like you would dereference any pointer. Typically, however, people
take advantage of the fact that the compiler knows what is going on and will
just use a shorter form:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pfi</span> <span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
</pre></div>
</div>
<p>Notice that the function pointer obeys value semantics, so you can pass it
around like any other value. Typically, when you use an asynchronous interface
you will pass some entity like this to a function which will perform an action
and <em>call back</em> to let you know it completed. It calls back by following the
indirection and executing the provided function.</p>
<p>In C++ you have the added complexity of objects. The analogy with the PFI above
means you have a pointer to a member function returning an int (PMI) instead of
the pointer to function returning an int (PFI).</p>
<p>The declaration of the variable providing the indirection looks only slightly
different:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="p">(</span><span class="n">MyClass</span><span class="o">::*</span><span class="n">pmi</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span> <span class="n">arg</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>This declares a variable named <code class="docutils literal notranslate"><span class="pre">pmi</span></code> just as the previous example declared a
variable named <code class="docutils literal notranslate"><span class="pre">pfi</span></code>. Since the will be to call a method of an instance of a
particular class, one must declare that method in a class:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">MyMethod</span> <span class="p">(</span><span class="kt">int</span> <span class="n">arg</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Given this class declaration, one would then initialize that variable like
this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">pmi</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyMethod</span><span class="p">;</span>
</pre></div>
</div>
<p>This assigns the address of the code implementing the method to the variable,
completing the indirection. In order to call a method, the code needs a <code class="docutils literal notranslate"><span class="pre">this</span></code>
pointer. This, in turn, means there must be an object of MyClass to refer to. A
simplistic example of this is just calling a method indirectly (think virtual
function):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="p">(</span><span class="n">MyClass</span><span class="o">::*</span><span class="n">pmi</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span> <span class="n">arg</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// Declare a PMI</span>
<span class="n">pmi</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">MyClass</span><span class="o">::</span><span class="n">MyMethod</span><span class="p">;</span>           <span class="c1">// Point at the implementation code</span>

<span class="n">MyClass</span> <span class="n">myClass</span><span class="p">;</span>                    <span class="c1">// Need an instance of the class</span>
<span class="p">(</span><span class="n">myClass</span><span class="p">.</span><span class="o">*</span><span class="n">pmi</span><span class="p">)</span> <span class="p">(</span><span class="mi">1234</span><span class="p">);</span>              <span class="c1">// Call the method with an object ptr</span>
</pre></div>
</div>
<p>Just like in the C example, you can use this in an asynchronous call to another
module which will <em>call back</em> using a method and an object pointer. The
straightforward extension one might consider is to pass a pointer to the object
and the PMI variable. The module would just do:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">*</span><span class="n">objectPtr</span><span class="p">.</span><span class="o">*</span><span class="n">pmi</span><span class="p">)</span> <span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
</pre></div>
</div>
<p>to execute the callback on the desired object.</p>
<p>One might ask at this time, <em>what’s the point</em>? The called module will have to
understand the concrete type of the calling object in order to properly make the
callback. Why not just accept this, pass the correctly typed object pointer and
do <code class="docutils literal notranslate"><span class="pre">object-&gt;Method(1234)</span></code> in the code instead of the callback?  This is
precisely the problem described above. What is needed is a way to decouple the
calling function from the called class completely. This requirement led to the
development of the <em>Functor</em>.</p>
<p>A functor is the outgrowth of something invented in the 1960s called a closure.
It is basically just a packaged-up function call, possibly with some state.</p>
<p>A functor has two parts, a specific part and a generic part, related through
inheritance. The calling code (the code that executes the callback) will execute
a generic overloaded <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">()</span></code> of a generic functor to cause the callback
to be called. The called code (the code that wants to be called back) will have
to provide a specialized implementation of the <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">()</span></code> that performs the
class-specific work that caused the close-coupling problem above.</p>
<p>With the specific functor and its overloaded <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">()</span></code> created, the called
code then gives the specialized code to the module that will execute the
callback (the calling code).</p>
<p>The calling code will take a generic functor as a parameter, so an implicit cast
is done in the function call to convert the specific functor to a generic
functor.  This means that the calling module just needs to understand the
generic functor type. It is decoupled from the calling code completely.</p>
<p>The information one needs to make a specific functor is the object pointer and
the pointer-to-method address.</p>
<p>The essence of what needs to happen is that the system declares a generic part
of the functor:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Functor</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="n">T</span> <span class="n">arg</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The caller defines a specific part of the functor that really is just there to
implement the specific <code class="docutils literal notranslate"><span class="pre">operator()</span></code> method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ARG</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">SpecificFunctor</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Functor</span><span class="o">&lt;</span><span class="n">ARG</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">SpecificFunctor</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="p">(</span><span class="n">T</span><span class="o">::*</span><span class="n">_pmi</span><span class="p">)(</span><span class="n">ARG</span> <span class="n">arg</span><span class="p">))</span>
  <span class="p">{</span>
    <span class="n">m_p</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
    <span class="n">m_pmi</span> <span class="o">=</span> <span class="n">_pmi</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">virtual</span> <span class="kt">int</span> <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="n">ARG</span> <span class="n">arg</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="p">(</span><span class="o">*</span><span class="n">m_p</span><span class="p">.</span><span class="o">*</span><span class="n">m_pmi</span><span class="p">)(</span><span class="n">arg</span><span class="p">);</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="p">(</span><span class="n">T</span><span class="o">::*</span><span class="n">m_pmi</span><span class="p">)(</span><span class="n">ARG</span> <span class="n">arg</span><span class="p">);</span>
  <span class="n">T</span><span class="o">*</span> <span class="n">m_p</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Here is an example of the usage:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="n">A</span> <span class="p">(</span><span class="kt">int</span> <span class="n">a0</span><span class="p">)</span> <span class="o">:</span> <span class="n">a</span> <span class="p">(</span><span class="n">a0</span><span class="p">)</span> <span class="p">{}</span>
<span class="kt">int</span> <span class="n">Hello</span> <span class="p">(</span><span class="kt">int</span> <span class="n">b0</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Hello from A, a = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; b0 = &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b0</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">A</span> <span class="n">a</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="n">SpecificFunctor</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">sf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">A</span><span class="o">::</span><span class="n">Hello</span><span class="p">);</span>
  <span class="n">sf</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The previous code is not real ns-3 code.  It is simplistic example
code used only to illustrate the concepts involved and to help you understand
the system more.  Do not expect to find this code anywhere in the ns-3 tree.</p>
</div>
<p>Notice that there are two variables defined in the class above.  The m_p
variable is the object pointer and m_pmi is the variable containing the
address of the function to execute.</p>
<p>Notice that when <code class="docutils literal notranslate"><span class="pre">operator()</span></code> is called, it in turn calls the method provided
with the object pointer using the C++ PMI syntax.</p>
<p>To use this, one could then declare some model code that takes a generic functor
as a parameter:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">LibraryFunction</span> <span class="p">(</span><span class="n">Functor</span> <span class="n">functor</span><span class="p">);</span>
</pre></div>
</div>
<p>The code that will talk to the model would build a specific functor and pass it to <code class="docutils literal notranslate"><span class="pre">LibraryFunction</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MyClass</span> <span class="n">myClass</span><span class="p">;</span>
<span class="n">SpecificFunctor</span><span class="o">&lt;</span><span class="n">MyClass</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">functor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">myclass</span><span class="p">,</span> <span class="n">MyClass</span><span class="o">::</span><span class="n">MyMethod</span><span class="p">);</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">LibraryFunction</span></code> is done, it executes the callback using the
<code class="docutils literal notranslate"><span class="pre">operator()</span></code> on the generic functor it was passed, and in this particular
case, provides the integer argument:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">LibraryFunction</span> <span class="p">(</span><span class="n">Functor</span> <span class="n">functor</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// Execute the library function</span>
  <span class="n">functor</span><span class="p">(</span><span class="mi">1234</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">LibraryFunction</span></code> is completely decoupled from the specific
type of the client.  The connection is made through the Functor polymorphism.</p>
<p>The Callback API in <em>ns-3</em> implements object-oriented callbacks using
the functor mechanism.  This callback API, being based on C++ templates, is
type-safe; that is, it performs static type checks to enforce proper signature
compatibility between callers and callees.  It is therefore more type-safe to
use than traditional function pointers, but the syntax may look imposing at
first.  This section is designed to walk you through the Callback system so
that you can be comfortable using it in <em>ns-3</em>.</p>
</div>
<div class="section" id="using-the-callback-api">
<h3>Using the Callback API<a class="headerlink" href="#using-the-callback-api" title="Permalink to this headline">¶</a></h3>
<p>The Callback API is fairly minimal, providing only two services:</p>
<p>1. callback type declaration: a way to declare a type of callback
with a given signature, and,</p>
<p>2. callback instantiation: a way to instantiate a
template-generated forwarding callback which can forward any calls
to another C++ class member method or C++ function.</p>
<p>This is best observed via walking through an example, based on
<code class="docutils literal notranslate"><span class="pre">samples/main-callback.cc</span></code>.</p>
<div class="section" id="using-the-callback-api-with-static-functions">
<h4>Using the Callback API with static functions<a class="headerlink" href="#using-the-callback-api-with-static-functions" title="Permalink to this headline">¶</a></h4>
<p>Consider a function:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">double</span>
<span class="nf">CbOne</span> <span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;invoke cbOne a=&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;, b=&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Consider also the following main program snippet:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="c1">// return type: double</span>
  <span class="c1">// first arg type: double</span>
  <span class="c1">// second arg type: double</span>
  <span class="n">Callback</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="n">one</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is an example of a C-style callback – one which does not include or need
a <code class="docutils literal notranslate"><span class="pre">this</span></code> pointer.  The function template <code class="docutils literal notranslate"><span class="pre">Callback</span></code> is essentially the
declaration of the variable containing the pointer-to-function.  In the example
above, we explicitly showed a pointer to a function that returned an integer and
took a single integer as a parameter,  The <code class="docutils literal notranslate"><span class="pre">Callback</span></code> template function is
a generic version of that – it is used to declare the type of a callback.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Readers unfamiliar with C++ templates may consult <a class="reference external" href="http://www.cplusplus.com/doc/tutorial/templates/">http://www.cplusplus.com/doc/tutorial/templates/</a>.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Callback</span></code> template requires one mandatory argument (the return type
of the function to be assigned to this callback) and up to five optional
arguments, which each specify the type of the arguments (if your particular
callback function has more than five arguments, then this can be handled
by extending the callback implementation).</p>
<p>So in the above example, we have a declared a callback named “one” that will
eventually hold a function pointer.  The signature of the function that it will
hold must return double and must support two double arguments.  If one tries
to pass a function whose signature does not match the declared callback,
a compilation error will occur.  Also, if one tries to assign to a callback
an incompatible one, compilation will succeed but a run-time
NS_FATAL_ERROR will be raised.  The sample program
<code class="docutils literal notranslate"><span class="pre">src/core/examples/main-callback.cc</span></code> demonstrates both of these error cases
at the end of the <code class="docutils literal notranslate"><span class="pre">main()</span></code> program.</p>
<p>Now, we need to tie together this callback instance and the actual target function
(CbOne).  Notice above that CbOne has the same function signature types as the
callback– this is important.  We can pass in any such properly-typed function
to this callback.  Let’s look at this more closely:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span>   <span class="kt">double</span> <span class="nf">CbOne</span> <span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">,</span> <span class="kt">double</span> <span class="n">b</span><span class="p">)</span> <span class="p">{}</span>
           <span class="o">^</span>             <span class="o">^</span>         <span class="o">^</span>
           <span class="o">|</span>             <span class="o">|</span>         <span class="o">|</span>
           <span class="o">|</span>             <span class="o">|</span>         <span class="o">|</span>
<span class="n">Callback</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span>       <span class="kt">double</span><span class="p">,</span>   <span class="kt">double</span><span class="o">&gt;</span> <span class="n">one</span><span class="p">;</span>
</pre></div>
</div>
<p>You can only bind a function to a callback if they have the matching signature.
The first template argument is the return type, and the additional template
arguments are the types of the arguments of the function signature.</p>
<p>Now, let’s bind our callback “one” to the function that matches its signature:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// build callback instance which points to cbOne function</span>
<span class="n">one</span> <span class="o">=</span> <span class="n">MakeCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">CbOne</span><span class="p">);</span>
</pre></div>
</div>
<p>This call to <code class="docutils literal notranslate"><span class="pre">MakeCallback</span></code> is, in essence, creating one of the specialized
functors mentioned above.  The variable declared using the <code class="docutils literal notranslate"><span class="pre">Callback</span></code>
template function is going to be playing the part of the generic functor.  The
assignment <code class="docutils literal notranslate"><span class="pre">one</span> <span class="pre">=</span> <span class="pre">MakeCallback</span> <span class="pre">(&amp;CbOne)</span></code> is the cast that converts the
specialized functor known to the callee to a generic functor known to the caller.</p>
<p>Then, later in the program, if the callback is needed, it can be used as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NS_ASSERT</span> <span class="p">(</span><span class="o">!</span><span class="n">one</span><span class="p">.</span><span class="n">IsNull</span> <span class="p">());</span>

<span class="c1">// invoke cbOne function through callback instance</span>
<span class="kt">double</span> <span class="n">retOne</span><span class="p">;</span>
<span class="n">retOne</span> <span class="o">=</span> <span class="n">one</span> <span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">);</span>
</pre></div>
</div>
<p>The check for <code class="docutils literal notranslate"><span class="pre">IsNull()</span></code> ensures that the callback is not null – that there
is a function to call behind this callback.  Then, <code class="docutils literal notranslate"><span class="pre">one()</span></code> executes the
generic <code class="docutils literal notranslate"><span class="pre">operator()</span></code> which is really overloaded with a specific implementation
of <code class="docutils literal notranslate"><span class="pre">operator()</span></code> and returns the same result as if <code class="docutils literal notranslate"><span class="pre">CbOne()</span></code> had been
called directly.</p>
</div>
<div class="section" id="using-the-callback-api-with-member-functions">
<h4>Using the Callback API with member functions<a class="headerlink" href="#using-the-callback-api-with-member-functions" title="Permalink to this headline">¶</a></h4>
<p>Generally, you will not be calling static functions but instead public member
functions of an object.  In this case, an extra argument is needed to the
MakeCallback function, to tell the system on which object the function should be
invoked.  Consider this example, also from main-callback.cc:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCb</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">CbTwo</span> <span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;invoke cbTwo a=&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="p">...</span>
  <span class="c1">// return type: int</span>
  <span class="c1">// first arg type: double</span>
  <span class="n">Callback</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="n">two</span><span class="p">;</span>
  <span class="n">MyCb</span> <span class="n">cb</span><span class="p">;</span>
  <span class="c1">// build callback instance which points to MyCb::cbTwo</span>
  <span class="n">two</span> <span class="o">=</span> <span class="n">MakeCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">MyCb</span><span class="o">::</span><span class="n">CbTwo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cb</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we pass an additional object pointer to the <code class="docutils literal notranslate"><span class="pre">MakeCallback&lt;&gt;</span></code> function.
Recall from the background section above that <code class="docutils literal notranslate"><span class="pre">Operator()</span></code> will use the pointer to
member syntax when it executes on an object:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span> <span class="kt">int</span> <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="n">ARG</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">(</span><span class="o">*</span><span class="n">m_p</span><span class="p">.</span><span class="o">*</span><span class="n">m_pmi</span><span class="p">)(</span><span class="n">arg</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And so we needed to provide the two variables (<code class="docutils literal notranslate"><span class="pre">m_p</span></code> and <code class="docutils literal notranslate"><span class="pre">m_pmi</span></code>) when
we made the specific functor.  The line:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">two</span> <span class="o">=</span> <span class="n">MakeCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">MyCb</span><span class="o">::</span><span class="n">CbTwo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cb</span><span class="p">);</span>
</pre></div>
</div>
<p>does precisely that.  In this case, when <code class="docutils literal notranslate"><span class="pre">two</span> <span class="pre">()</span></code> is invoked:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">two</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
</pre></div>
</div>
<p>will result in a call to the <code class="docutils literal notranslate"><span class="pre">CbTwo</span></code> member function (method) on the object
pointed to by <code class="docutils literal notranslate"><span class="pre">&amp;cb</span></code>.</p>
</div>
<div class="section" id="building-null-callbacks">
<h4>Building Null Callbacks<a class="headerlink" href="#building-null-callbacks" title="Permalink to this headline">¶</a></h4>
<p>It is possible for callbacks to be null; hence it may be wise to
check before using them.  There is a special construct for a null
callback, which is preferable to simply passing “0” as an argument;
it is the <code class="docutils literal notranslate"><span class="pre">MakeNullCallback&lt;&gt;</span></code> construct:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">two</span> <span class="o">=</span> <span class="n">MakeNullCallback</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">double</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">NS_ASSERT</span> <span class="p">(</span><span class="n">two</span><span class="p">.</span><span class="n">IsNull</span> <span class="p">());</span>
</pre></div>
</div>
<p>Invoking a null callback is just like invoking a null function pointer: it will
crash at runtime.</p>
</div>
</div>
<div class="section" id="bound-callbacks">
<h3>Bound Callbacks<a class="headerlink" href="#bound-callbacks" title="Permalink to this headline">¶</a></h3>
<p>A very useful extension to the functor concept is that of a Bound Callback.
Previously it was mentioned that closures were originally function calls
packaged up for later execution.  Notice that in all of the Callback
descriptions above, there is no way to package up any parameters for use
later – when the <code class="docutils literal notranslate"><span class="pre">Callback</span></code> is called via <code class="docutils literal notranslate"><span class="pre">operator()</span></code>.  All of
the parameters are provided by the calling function.</p>
<p>What if it is desired to allow the client function (the one that provides the
callback) to provide some of the parameters?  <a class="reference external" href="http://erdani.com/book/main.html">Alexandrescu</a> calls the process of
allowing a client to specify one of the parameters <em>“binding”</em>.  One of the
parameters of <code class="docutils literal notranslate"><span class="pre">operator()</span></code> has been bound (fixed) by the client.</p>
<p>Some of our pcap tracing code provides a nice example of this.  There is a
function that needs to be called whenever a packet is received.  This function
calls an object that actually writes the packet to disk in the pcap file
format.  The signature of one of these functions will be:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="nf">DefaultSink</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">PcapFileWrapper</span><span class="o">&gt;</span> <span class="n">file</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Packet</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">);</span>
</pre></div>
</div>
<p>The static keyword means this is a static function which does not need a
<code class="docutils literal notranslate"><span class="pre">this</span></code> pointer, so it will be using C-style callbacks.  We don’t want the
calling code to have to know about anything but the Packet.  What we want in
the calling code is just a call that looks like:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_promiscSnifferTrace</span> <span class="p">(</span><span class="n">m_currentPkt</span><span class="p">);</span>
</pre></div>
</div>
<p>What we want to do is to <em>bind</em> the <code class="docutils literal notranslate"><span class="pre">Ptr&lt;PcapFileWriter&gt;</span> <span class="pre">file</span></code> to the
specific callback implementation when it is created and arrange for the
<code class="docutils literal notranslate"><span class="pre">operator()</span></code> of the Callback to provide that parameter for free.</p>
<p>We provide the <code class="docutils literal notranslate"><span class="pre">MakeBoundCallback</span></code> template function for that purpose.  It
takes the same parameters as the <code class="docutils literal notranslate"><span class="pre">MakeCallback</span></code> template function but also
takes the parameters to be bound.  In the case of the example above:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MakeBoundCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">DefaultSink</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>
</pre></div>
</div>
<p>will create a specific callback implementation that knows to add in the extra
bound arguments.  Conceptually, it extends the specific functor described above
with one or more bound arguments:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ARG</span><span class="p">,</span> <span class="k">typename</span> <span class="n">BOUND_ARG</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">SpecificFunctor</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Functor</span>
 <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
    <span class="n">SpecificFunctor</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="p">(</span><span class="n">T</span><span class="o">::*</span><span class="n">_pmi</span><span class="p">)(</span><span class="n">ARG</span> <span class="n">arg</span><span class="p">),</span> <span class="n">BOUND_ARG</span> <span class="n">boundArg</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">m_p</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
      <span class="n">m_pmi</span> <span class="o">=</span> <span class="n">pmi</span><span class="p">;</span>
      <span class="n">m_boundArg</span> <span class="o">=</span> <span class="n">boundArg</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">virtual</span> <span class="kt">int</span> <span class="k">operator</span><span class="p">()</span> <span class="p">(</span><span class="n">ARG</span> <span class="n">arg</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="p">(</span><span class="o">*</span><span class="n">m_p</span><span class="p">.</span><span class="o">*</span><span class="n">m_pmi</span><span class="p">)(</span><span class="n">m_boundArg</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
    <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
    <span class="kt">void</span> <span class="p">(</span><span class="n">T</span><span class="o">::*</span><span class="n">m_pmi</span><span class="p">)(</span><span class="n">ARG</span> <span class="n">arg</span><span class="p">);</span>
    <span class="n">T</span><span class="o">*</span> <span class="n">m_p</span><span class="p">;</span>
    <span class="n">BOUND_ARG</span> <span class="n">m_boundArg</span><span class="p">;</span>
 <span class="p">};</span>
</pre></div>
</div>
<p>You can see that when the specific functor is created, the bound argument is saved
in the functor / callback object itself.  When the <code class="docutils literal notranslate"><span class="pre">operator()</span></code> is invoked with
the single parameter, as in:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_promiscSnifferTrace</span> <span class="p">(</span><span class="n">m_currentPkt</span><span class="p">);</span>
</pre></div>
</div>
<p>the implementation of <code class="docutils literal notranslate"><span class="pre">operator()</span></code> adds the bound parameter into the actual
function call:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">*</span><span class="n">m_p</span><span class="p">.</span><span class="o">*</span><span class="n">m_pmi</span><span class="p">)(</span><span class="n">m_boundArg</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
</pre></div>
</div>
<p>It’s possible to bind two or three arguments as well.  Say we have a function with
signature:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="nf">NotifyEvent</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">MyEventType</span> <span class="n">e</span><span class="p">);</span>
</pre></div>
</div>
<p>One can create bound callback binding first two arguments like:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MakeBoundCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">NotifyEvent</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">);</span>
</pre></div>
</div>
<p>assuming <cite>a1</cite> and <cite>b1</cite> are objects of type <cite>A</cite> and <cite>B</cite> respectively.  Similarly for
three arguments one would have function with a signature:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span> <span class="nf">NotifyEvent</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="n">b</span><span class="p">,</span> <span class="n">MyEventType</span> <span class="n">e</span><span class="p">);</span>
</pre></div>
</div>
<p>Binding three arguments in done with:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MakeBoundCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">NotifyEvent</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">c1</span><span class="p">);</span>
</pre></div>
</div>
<p>again assuming <cite>a1</cite>, <cite>b1</cite> and <cite>c1</cite> are objects of type <cite>A</cite>, <cite>B</cite> and <cite>C</cite> respectively.</p>
<p>This kind of binding can be used for exchanging information between objects in
simulation; specifically, bound callbacks can be used as traced callbacks, which will
be described in the next section.</p>
</div>
<div class="section" id="traced-callbacks">
<h3>Traced Callbacks<a class="headerlink" href="#traced-callbacks" title="Permalink to this headline">¶</a></h3>
<p><em>Placeholder subsection</em></p>
</div>
<div class="section" id="callback-locations-in-ns-3">
<h3>Callback locations in ns-3<a class="headerlink" href="#callback-locations-in-ns-3" title="Permalink to this headline">¶</a></h3>
<p>Where are callbacks frequently used in <em>ns-3</em>?  Here are some of the
more visible ones to typical users:</p>
<ul class="simple">
<li><p>Socket API</p></li>
<li><p>Layer-2/Layer-3 API</p></li>
<li><p>Tracing subsystem</p></li>
<li><p>API between IP and routing subsystems</p></li>
</ul>
</div>
<div class="section" id="implementation-details">
<h3>Implementation details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h3>
<p>The code snippets above are simplistic and only designed to illustrate the mechanism
itself.  The actual Callback code is quite complicated and very template-intense and
a deep understanding of the code is not required.  If interested, expert users may
find the following useful.</p>
<p>The code was originally written based on the techniques described in
<a class="reference external" href="http://www.codeproject.com/cpp/TTLFunction.asp">http://www.codeproject.com/cpp/TTLFunction.asp</a>.
It was subsequently rewritten to follow the architecture outlined in
<a class="reference external" href="http://www.moderncppdesign.com/book/main.html">Modern C++ Design, Generic Programming and Design Patterns Applied, Alexandrescu, chapter 5, Generalized Functors</a>.</p>
<p>This code uses:</p>
<ul class="simple">
<li><p>default template parameters to saves users from having to
specify empty parameters when the number of parameters
is smaller than the maximum supported number</p></li>
<li><p>the pimpl idiom: the Callback class is passed around by
value and delegates the crux of the work to its pimpl pointer.</p></li>
<li><p>two pimpl implementations which derive from CallbackImpl
FunctorCallbackImpl can be used with any functor-type
while MemPtrCallbackImpl can be used with pointers to
member functions.</p></li>
<li><p>a reference list implementation to implement the Callback’s
value semantics.</p></li>
</ul>
<p>This code most notably departs from the Alexandrescu implementation in that it
does not use type lists to specify and pass around the types of the callback
arguments. Of course, it also does not use copy-destruction semantics and
relies on a reference list rather than autoPtr to hold the pointer.</p>
</div>
</div>
<span id="document-object-model"></span><div class="section" id="object-model">
<span id="id1"></span><h2>Object model<a class="headerlink" href="#object-model" title="Permalink to this headline">¶</a></h2>
<p><em>ns-3</em> is fundamentally a C++ object system. Objects can be declared and
instantiated as usual, per C++ rules. <em>ns-3</em> also adds some features to
traditional C++ objects, as described below, to provide greater functionality
and features. This manual chapter is intended to introduce the reader to the
<em>ns-3</em> object model.</p>
<p>This section describes the C++ class design for <em>ns-3</em> objects. In brief,
several design patterns in use include classic object-oriented design
(polymorphic interfaces and implementations), separation of interface and
implementation, the non-virtual public interface design pattern, an object
aggregation facility, and reference counting for memory management. Those
familiar with component models such as COM or Bonobo will recognize elements of
the design in the <em>ns-3</em> object aggregation model, although the <em>ns-3</em> design is
not strictly in accordance with either.</p>
<div class="section" id="object-oriented-behavior">
<h3>Object-oriented behavior<a class="headerlink" href="#object-oriented-behavior" title="Permalink to this headline">¶</a></h3>
<p>C++ objects, in general, provide common object-oriented capabilities
(abstraction, encapsulation, inheritance, and polymorphism) that are part
of classic object-oriented design. <em>ns-3</em> objects make use of these
properties; for instance:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Address</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Address</span> <span class="p">();</span>
  <span class="n">Address</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="n">type</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">len</span><span class="p">);</span>
  <span class="n">Address</span> <span class="p">(</span><span class="k">const</span> <span class="n">Address</span> <span class="o">&amp;</span> <span class="n">address</span><span class="p">);</span>
  <span class="n">Address</span> <span class="o">&amp;</span><span class="k">operator</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="n">Address</span> <span class="o">&amp;</span><span class="n">address</span><span class="p">);</span>
  <span class="p">...</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">uint8_t</span> <span class="n">m_type</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">m_len</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="object-base-classes">
<h3>Object base classes<a class="headerlink" href="#object-base-classes" title="Permalink to this headline">¶</a></h3>
<p>There are three special base classes used in <em>ns-3</em>. Classes that inherit
from these base classes can instantiate objects with special properties.
These base classes are:</p>
<ul class="simple">
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectBase</span></code></p></li>
<li><p>class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">SimpleRefCount</span></code></p></li>
</ul>
<p>It is not required that <em>ns-3</em> objects inherit from these class, but
those that do get special properties. Classes deriving from
class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> get the following properties.</p>
<ul class="simple">
<li><p>the <em>ns-3</em> type and attribute system (see <a class="reference internal" href="index.html#attributes"><span class="std std-ref">Configuration and Attributes</span></a>)</p></li>
<li><p>an object aggregation system</p></li>
<li><p>a smart-pointer reference counting system (class Ptr)</p></li>
</ul>
<p>Classes that derive from class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectBase</span></code> get the first two
properties above, but do not get smart pointers. Classes that derive from class
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">SimpleRefCount</span></code>: get only the smart-pointer reference counting
system.</p>
<p>In practice, class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> is the variant of the three above that
the <em>ns-3</em> developer will most commonly encounter.</p>
</div>
<div class="section" id="memory-management-and-class-ptr">
<span id="id2"></span><h3>Memory management and class Ptr<a class="headerlink" href="#memory-management-and-class-ptr" title="Permalink to this headline">¶</a></h3>
<p>Memory management in a C++ program is a complex process, and is often done
incorrectly or inconsistently. We have settled on a reference counting design
described as follows.</p>
<p>All objects using reference counting maintain an internal reference count to
determine when an object can safely delete itself. Each time that a pointer is
obtained to an interface, the object’s reference count is incremented by calling
<code class="docutils literal notranslate"><span class="pre">Ref()</span></code>. It is the obligation of the user of the pointer to explicitly
<code class="docutils literal notranslate"><span class="pre">Unref()</span></code> the pointer when done. When the reference count falls to zero, the
object is deleted.</p>
<ul class="simple">
<li><p>When the client code obtains a pointer from the object itself through object
creation, or via GetObject, it does not have to increment the reference count.</p></li>
<li><p>When client code obtains a pointer from another source (e.g., copying a
pointer) it must call <code class="docutils literal notranslate"><span class="pre">Ref()</span></code> to increment the reference count.</p></li>
<li><p>All users of the object pointer must call <code class="docutils literal notranslate"><span class="pre">Unref()</span></code> to release the
reference.</p></li>
</ul>
<p>The burden for calling <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Unref()</span></code> is somewhat relieved by the use of
the reference counting smart pointer class described below.</p>
<p>Users using a low-level API who wish to explicitly allocate
non-reference-counted objects on the heap, using operator new, are responsible
for deleting such objects.</p>
<div class="section" id="reference-counting-smart-pointer-ptr">
<h4>Reference counting smart pointer (Ptr)<a class="headerlink" href="#reference-counting-smart-pointer-ptr" title="Permalink to this headline">¶</a></h4>
<p>Calling <code class="docutils literal notranslate"><span class="pre">Ref()</span></code> and <code class="docutils literal notranslate"><span class="pre">Unref()</span></code> all the time would be cumbersome, so <em>ns-3</em>
provides a smart pointer class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Ptr</span></code> similar to
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Boost::intrusive_ptr</span></code>. This smart-pointer class assumes that the
underlying type provides a pair of <code class="docutils literal notranslate"><span class="pre">Ref</span></code> and <code class="docutils literal notranslate"><span class="pre">Unref</span></code> methods that are
expected to increment and decrement the internal refcount of the object
instance.</p>
<p>This implementation allows you to manipulate the smart pointer as if it was a
normal pointer: you can compare it with zero, compare it against other pointers,
assign zero to it, etc.</p>
<p>It is possible to extract the raw pointer from this smart pointer with the
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetPointer()</span></code> and <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">PeekPointer()</span></code> methods.</p>
<p>If you want to store a newed object into a smart pointer, we recommend you to
use the CreateObject template functions to create the object and store it in a
smart pointer to avoid memory leaks. These functions are really small
convenience functions and their goal is just to save you a small bit of typing.</p>
</div>
</div>
<div class="section" id="createobject-and-create">
<h3>CreateObject and Create<a class="headerlink" href="#createobject-and-create" title="Permalink to this headline">¶</a></h3>
<p>Objects in C++ may be statically, dynamically, or automatically created.  This
holds true for <em>ns-3</em> also, but some objects in the system have some additional
frameworks available. Specifically, reference counted objects are usually
allocated using a templated Create or CreateObject method, as follows.</p>
<p>For objects deriving from class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">WifiNetDevice</span><span class="o">&gt;</span> <span class="n">device</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">WifiNetDevice</span><span class="o">&gt;</span> <span class="p">();</span>
</pre></div>
</div>
<p>Please do not create such objects using <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code>; create them using
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateObject()</span></code> instead.</p>
<p>For objects deriving from class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">SimpleRefCount</span></code>, or other objects
that support usage of the smart pointer class, a templated helper function is
available and recommended to be used:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Create</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="p">();</span>
</pre></div>
</div>
<p>This is simply a wrapper around operator new that correctly handles the
reference counting system.</p>
<p>In summary, use <code class="docutils literal notranslate"><span class="pre">Create&lt;B&gt;</span></code> if B is not an object but just uses reference
counting (e.g. <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Packet</span></code>), and use <code class="docutils literal notranslate"><span class="pre">CreateObject&lt;B&gt;</span></code> if B derives
from <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Object</span></code>.</p>
</div>
<div class="section" id="aggregation">
<h3>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">¶</a></h3>
<p>The <em>ns-3</em> object aggregation system is motivated in strong part by a recognition
that a common use case for <em>ns-2</em> has been the use of inheritance and
polymorphism to extend protocol models. For instance, specialized versions of
TCP such as RenoTcpAgent derive from (and override functions from) class
TcpAgent.</p>
<p>However, two problems that have arisen in the <em>ns-2</em> model are downcasts and
“weak base class.” Downcasting refers to the procedure of using a base class
pointer to an object and querying it at run time to find out type information,
used to explicitly cast the pointer to a subclass pointer so that the subclass
API can be used. Weak base class refers to the problems that arise when a class
cannot be effectively reused (derived from) because it lacks necessary
functionality, leading the developer to have to modify the base class and
causing proliferation of base class API calls, some of which may not be
semantically correct for all subclasses.</p>
<p><em>ns-3</em> is using a version of the query interface design pattern to avoid these
problems. This design is based on elements of the <a class="reference external" href="http://en.wikipedia.org/wiki/Component_Object_Model">Component Object Model</a> and <a class="reference external" href="http://en.wikipedia.org/wiki/Bonobo_(component_model)">GNOME Bonobo</a> although full
binary-level compatibility of replaceable components is not supported and we
have tried to simplify the syntax and impact on model developers.</p>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<div class="section" id="aggregation-example">
<h4>Aggregation example<a class="headerlink" href="#aggregation-example" title="Permalink to this headline">¶</a></h4>
<p><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Node</span></code> is a good example of the use of aggregation in <em>ns-3</em>.  Note
that there are not derived classes of Nodes in <em>ns-3</em> such as class
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">InternetNode</span></code>.  Instead, components (protocols) are aggregated to a
node. Let’s look at how some Ipv4 protocols are added to a node.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span>
<span class="nf">AddIpv4Stack</span><span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">node</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4L3Protocol</span><span class="o">&gt;</span> <span class="n">ipv4</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Ipv4L3Protocol</span><span class="o">&gt;</span> <span class="p">();</span>
  <span class="n">ipv4</span><span class="o">-&gt;</span><span class="n">SetNode</span> <span class="p">(</span><span class="n">node</span><span class="p">);</span>
  <span class="n">node</span><span class="o">-&gt;</span><span class="n">AggregateObject</span> <span class="p">(</span><span class="n">ipv4</span><span class="p">);</span>
  <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4Impl</span><span class="o">&gt;</span> <span class="n">ipv4Impl</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Ipv4Impl</span><span class="o">&gt;</span> <span class="p">();</span>
  <span class="n">ipv4Impl</span><span class="o">-&gt;</span><span class="n">SetIpv4</span> <span class="p">(</span><span class="n">ipv4</span><span class="p">);</span>
  <span class="n">node</span><span class="o">-&gt;</span><span class="n">AggregateObject</span> <span class="p">(</span><span class="n">ipv4Impl</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the Ipv4 protocols are created using <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateObject()</span></code>.
Then, they are aggregated to the node. In this manner, the Node base class does
not need to be edited to allow users with a base class Node pointer to access
the Ipv4 interface; users may ask the node for a pointer to its Ipv4 interface
at runtime. How the user asks the node is described in the next subsection.</p>
<p>Note that it is a programming error to aggregate more than one object of the
same type to an <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Object</span></code>. So, for instance, aggregation is not
an option for storing all of the active sockets of a node.</p>
</div>
<div class="section" id="getobject-example">
<h4>GetObject example<a class="headerlink" href="#getobject-example" title="Permalink to this headline">¶</a></h4>
<p>GetObject is a type-safe way to achieve a safe downcasting and to allow
interfaces to be found on an object.</p>
<p>Consider a node pointer <code class="docutils literal notranslate"><span class="pre">m_node</span></code> that points to a Node object that has an
implementation of IPv4 previously aggregated to it. The client code wishes to
configure a default route. To do so, it must access an object within the node
that has an interface to the IP forwarding configuration. It performs the
following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span> <span class="o">=</span> <span class="n">m_node</span><span class="o">-&gt;</span><span class="n">GetObject</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="p">();</span>
</pre></div>
</div>
<p>If the node in fact does not have an Ipv4 object aggregated to it, then the
method will return null. Therefore, it is good practice to check the return
value from such a function call. If successful, the user can now use the Ptr to
the Ipv4 object that was previously aggregated to the node.</p>
<p>Another example of how one might use aggregation is to add optional models to
objects. For instance, an existing Node object may have an “Energy Model” object
aggregated to it at run time (without modifying and recompiling the node class).
An existing model (such as a wireless net device) can then later “GetObject” for
the energy model and act appropriately if the interface has been either built in
to the underlying Node object or aggregated to it at run time.  However, other
nodes need not know anything about energy models.</p>
<p>We hope that this mode of programming will require much less need for developers
to modify the base classes.</p>
</div>
</div>
<div class="section" id="object-factories">
<h3>Object factories<a class="headerlink" href="#object-factories" title="Permalink to this headline">¶</a></h3>
<p>A common use case is to create lots of similarly configured objects. One can
repeatedly call <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateObject()</span></code> but there is also a factory design
pattern in use in the <em>ns-3</em> system. It is heavily used in the “helper” API.</p>
<p>Class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectFactory</span></code> can be used to instantiate objects and to
configure the attributes on those objects:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">SetTypeId</span> <span class="p">(</span><span class="n">TypeId</span> <span class="n">tid</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">Set</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">AttributeValue</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Create</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
</pre></div>
</div>
<p>The first method allows one to use the <em>ns-3</em> TypeId system to specify the type
of objects created. The second allows one to set attributes on the objects to be
created, and the third allows one to create the objects themselves.</p>
<p>For example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ObjectFactory</span> <span class="n">factory</span><span class="p">;</span>
<span class="c1">// Make this factory create objects of type FriisPropagationLossModel</span>
<span class="n">factory</span><span class="p">.</span><span class="n">SetTypeId</span> <span class="p">(</span><span class="s">&quot;ns3::FriisPropagationLossModel&quot;</span><span class="p">)</span>
<span class="c1">// Make this factory object change a default value of an attribute, for</span>
<span class="c1">// subsequently created objects</span>
<span class="n">factory</span><span class="p">.</span><span class="n">Set</span> <span class="p">(</span><span class="s">&quot;SystemLoss&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">));</span>
<span class="c1">// Create one such object</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">object</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="n">Create</span> <span class="p">();</span>
<span class="n">factory</span><span class="p">.</span><span class="n">Set</span> <span class="p">(</span><span class="s">&quot;SystemLoss&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">));</span>
<span class="c1">// Create another object with a different SystemLoss</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">object</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="n">Create</span> <span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="downcasting">
<h3>Downcasting<a class="headerlink" href="#downcasting" title="Permalink to this headline">¶</a></h3>
<p>A question that has arisen several times is, “If I have a base class pointer
(Ptr) to an object and I want the derived class pointer, should I downcast (via
C++ dynamic cast) to get the derived pointer, or should I use the object
aggregation system to <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetObject&lt;&gt;</span> <span class="pre">()</span></code> to find a Ptr to the interface
to the subclass API?”</p>
<p>The answer to this is that in many situations, both techniques will work.
<em>ns-3</em> provides a templated function for making the syntax of Object
dynamic casting much more user friendly:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T2</span><span class="o">&gt;</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">&gt;</span>
<span class="n">DynamicCast</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">T2</span><span class="o">&gt;</span> <span class="k">const</span><span class="o">&amp;</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">&gt;</span> <span class="p">(</span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">T1</span> <span class="o">*&gt;</span> <span class="p">(</span><span class="n">PeekPointer</span> <span class="p">(</span><span class="n">p</span><span class="p">)));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>DynamicCast works when the programmer has a base type pointer and is testing
against a subclass pointer. GetObject works when looking for different objects
aggregated, but also works with subclasses, in the same way as DynamicCast. If
unsure, the programmer should use GetObject, as it works in all cases. If the
programmer knows the class hierarchy of the object under consideration, it is
more direct to just use DynamicCast.</p>
</div>
</div>
<span id="document-attributes"></span><div class="section" id="configuration-and-attributes">
<span id="attributes"></span><h2>Configuration and Attributes<a class="headerlink" href="#configuration-and-attributes" title="Permalink to this headline">¶</a></h2>
<p>In <em>ns-3</em> simulations, there are two main aspects to configuration:</p>
<ul class="simple">
<li><p>The simulation topology and how objects are connected.</p></li>
<li><p>The values used by the models instantiated in the topology.</p></li>
</ul>
<p>This chapter focuses on the second item above: how the many values in use in
<em>ns-3</em> are organized, documented, and modifiable by <em>ns-3</em> users. The <em>ns-3</em>
attribute system is also the underpinning of how traces and statistics are
gathered in the simulator.</p>
<p>In the course of this chapter we will discuss the various ways to set or
modify the values used by <em>ns-3</em> model objects.  In increasing order of
specificity, these are:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Scope</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Default Attribute values set when
Attributes are defined in
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetTypeId</span> <span class="pre">()</span></code>.</p></td>
<td><p>Affect all instances of the class.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">CommandLine</span></code></div>
<div class="line"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Config::SetDefault()</span></code></div>
<div class="line"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigStore</span></code></div>
</div>
</td>
<td><p>Affect all future instances.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectFactory</span></code></p></td>
<td><p>Affects all instances created with
the factory.</p></td>
</tr>
<tr class="row-odd"><td><p>Helper methods with (string/
AttributeValue) parameter pairs</p></td>
<td><p>Affects all instances created by
the helper.</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MyClass::SetX</span> <span class="pre">()</span></code></div>
<div class="line"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Object::SetAttribute</span> <span class="pre">()</span></code></div>
<div class="line"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Config::Set()</span></code></div>
</div>
</td>
<td><p>Alters this particular instance.
Generally this is the only form
which can be scheduled to alter
an instance once the simulation
is running.</p></td>
</tr>
</tbody>
</table>
<p>By “specificity” we mean that methods in later rows in the table
override the values set by, and typically affect fewer instances than,
earlier methods.</p>
<p>Before delving into details of the attribute value system, it will help to
review some basic properties of class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code>.</p>
<div class="section" id="object-overview">
<h3>Object Overview<a class="headerlink" href="#object-overview" title="Permalink to this headline">¶</a></h3>
<p><em>ns-3</em> is fundamentally a C++ object-based system. By this we mean that new C++
classes (types) can be declared, defined, and subclassed as usual.</p>
<p>Many <em>ns-3</em> objects inherit from the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> base class.  These
objects have some additional properties that we exploit for organizing the
system and improving the memory management of our objects:</p>
<ul class="simple">
<li><p>“Metadata” system that links the class name to a lot of meta-information
about the object, including:</p>
<ul>
<li><p>The base class of the subclass,</p></li>
<li><p>The set of accessible constructors in the subclass,</p></li>
<li><p>The set of “attributes” of the subclass,</p></li>
<li><p>Whether each attribute can be set, or is read-only,</p></li>
<li><p>The allowed range of values for each attribute.</p></li>
</ul>
</li>
<li><p>Reference counting smart pointer implementation, for memory management.</p></li>
</ul>
<p><em>ns-3</em> objects that use the attribute system derive from either
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> or <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectBase</span></code>. Most <em>ns-3</em> objects we
will discuss derive from <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code>, but a few that are outside
the smart pointer memory management framework derive from
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectBase</span></code>.</p>
<p>Let’s review a couple of properties of these objects.</p>
<div class="section" id="smart-pointers">
<h4>Smart Pointers<a class="headerlink" href="#smart-pointers" title="Permalink to this headline">¶</a></h4>
<p>As introduced in the <em>ns-3</em> tutorial, <em>ns-3</em> objects are memory managed by a
<a class="reference external" href="http://en.wikipedia.org/wiki/Smart_pointer">reference counting smart pointer implementation</a>, class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Ptr</span></code>.</p>
<p>Smart pointers are used extensively in the <em>ns-3</em> APIs, to avoid passing
references to heap-allocated objects that may cause memory leaks.
For most basic usage (syntax), treat a smart pointer like a regular pointer:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">WifiNetDevice</span><span class="o">&gt;</span> <span class="n">nd</span> <span class="o">=</span> <span class="p">...;</span>
<span class="n">nd</span><span class="o">-&gt;</span><span class="n">CallSomeFunction</span> <span class="p">();</span>
<span class="c1">// etc.</span>
</pre></div>
</div>
<p>So how do you get a smart pointer to an object, as in the first line
of this example?</p>
<div class="section" id="createobject">
<h5>CreateObject<a class="headerlink" href="#createobject" title="Permalink to this headline">¶</a></h5>
<p>As we discussed above in <a class="reference internal" href="index.html#memory-management-and-class-ptr"><span class="std std-ref">Memory management and class Ptr</span></a>, at the
lowest-level API, objects of type <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> are not instantiated
using <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code> as usual but instead by a templated function called
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateObject</span> <span class="pre">()</span></code>.</p>
<p>A typical way to create such an object is as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">WifiNetDevice</span><span class="o">&gt;</span> <span class="n">nd</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">WifiNetDevice</span><span class="o">&gt;</span> <span class="p">();</span>
</pre></div>
</div>
<p>You can think of this as being functionally equivalent to:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">WifiNetDevice</span><span class="o">*</span> <span class="n">nd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WifiNetDevice</span> <span class="p">();</span>
</pre></div>
</div>
<p>Objects that derive from <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> must be allocated on the heap
using <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateObject</span> <span class="pre">()</span></code>. Those deriving from <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectBase</span></code>,
such as <em>ns-3</em> helper functions and packet headers and trailers,
can be allocated on the stack.</p>
<p>In some scripts, you may not see a lot of <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateObject</span> <span class="pre">()</span></code> calls
in the code; this is because there are some helper objects in effect
that are doing the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateObject</span> <span class="pre">()</span></code> calls for you.</p>
</div>
</div>
<div class="section" id="typeid">
<h4>TypeId<a class="headerlink" href="#typeid" title="Permalink to this headline">¶</a></h4>
<p><em>ns-3</em> classes that derive from class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> can include
a metadata class called <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TypeId</span></code> that records meta-information
about the class, for use in the object aggregation and component manager
systems:</p>
<ul class="simple">
<li><p>A unique string identifying the class.</p></li>
<li><p>The base class of the subclass, within the metadata system.</p></li>
<li><p>The set of accessible constructors in the subclass.</p></li>
<li><p>A list of publicly accessible properties (“attributes”) of the class.</p></li>
</ul>
</div>
<div class="section" id="object-summary">
<h4>Object Summary<a class="headerlink" href="#object-summary" title="Permalink to this headline">¶</a></h4>
<p>Putting all of these concepts together, let’s look at a specific
example: class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Node</span></code>.</p>
<p>The public header file <code class="docutils literal notranslate"><span class="pre">node.h</span></code> has a declaration that includes
a static <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetTypeId</span> <span class="pre">()</span></code> function call:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Object</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
  <span class="p">...</span>
</pre></div>
</div>
<p>This is defined in the <code class="docutils literal notranslate"><span class="pre">node.cc</span></code> file as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TypeId</span>
<span class="n">Node</span><span class="o">::</span><span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;ns3::Node&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">SetParent</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">SetGroupName</span> <span class="p">(</span><span class="s">&quot;Network&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">AddConstructor</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;DeviceList&quot;</span><span class="p">,</span>
                   <span class="s">&quot;The list of devices associated to this Node.&quot;</span><span class="p">,</span>
                   <span class="n">ObjectVectorValue</span> <span class="p">(),</span>
                   <span class="n">MakeObjectVectorAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">Node</span><span class="o">::</span><span class="n">m_devices</span><span class="p">),</span>
                   <span class="n">MakeObjectVectorChecker</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="p">())</span>
    <span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;ApplicationList&quot;</span><span class="p">,</span>
                   <span class="s">&quot;The list of applications associated to this Node.&quot;</span><span class="p">,</span>
                   <span class="n">ObjectVectorValue</span> <span class="p">(),</span>
                   <span class="n">MakeObjectVectorAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">Node</span><span class="o">::</span><span class="n">m_applications</span><span class="p">),</span>
                   <span class="n">MakeObjectVectorChecker</span><span class="o">&lt;</span><span class="n">Application</span><span class="o">&gt;</span> <span class="p">())</span>
    <span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;Id&quot;</span><span class="p">,</span>
                   <span class="s">&quot;The id (unique integer) of this Node.&quot;</span><span class="p">,</span>
                   <span class="n">TypeId</span><span class="o">::</span><span class="n">ATTR_GET</span><span class="p">,</span> <span class="c1">// allow only getting it.</span>
                   <span class="n">UintegerValue</span> <span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                   <span class="n">MakeUintegerAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">Node</span><span class="o">::</span><span class="n">m_id</span><span class="p">),</span>
                   <span class="n">MakeUintegerChecker</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span> <span class="p">())</span>
    <span class="p">;</span>
  <span class="k">return</span> <span class="n">tid</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Consider the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TypeId</span></code> of the <em>ns-3</em> <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> class
as an extended form of run time type information (RTTI). The C++ language
includes a simple kind of RTTI in order to support <code class="docutils literal notranslate"><span class="pre">dynamic_cast</span></code> and
<code class="docutils literal notranslate"><span class="pre">typeid</span></code> operators.</p>
<p>The <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">SetParent&lt;Object&gt;</span> <span class="pre">()</span></code> call in the definition above is used in
conjunction with our object aggregation mechanisms to allow safe up- and
down-casting in inheritance trees during <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetObject</span> <span class="pre">()</span></code>.
It also enables subclasses to inherit the Attributes of their parent class.</p>
<p>The <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">AddConstructor&lt;Node&gt;</span> <span class="pre">()</span></code> call is used in conjunction
with our abstract object factory mechanisms to allow us to construct
C++ objects without forcing a user to know the concrete class of
the object she is building.</p>
<p>The three calls to <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">AddAttribute</span> <span class="pre">()</span></code> associate a given string
with a strongly typed value in the class. Notice that you must provide
a help string which may be displayed, for example, <em>via</em> command line
processors. Each <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Attribute</span></code> is associated with mechanisms
for accessing the underlying member variable in the object (for example,
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">MakeUintegerAccessor</span> <span class="pre">()</span></code> tells the generic <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Attribute</span></code>
code how to get to the node ID above). There are also “Checker” methods which
are used to validate values against range limitations, such as maximum
and minimum allowed values.</p>
<p>When users want to create Nodes, they will usually call some form of
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateObject</span> <span class="pre">()</span></code>,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">n</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="p">();</span>
</pre></div>
</div>
<p>or more abstractly, using an object factory, you can create a
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Node</span></code> object without even knowing the concrete C++ type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ObjectFactory</span> <span class="n">factory</span><span class="p">;</span>
<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">typeId</span> <span class="o">=</span> <span class="s">&quot;ns3::Node&#39;&#39;;</span>
<span class="n">factory</span><span class="p">.</span><span class="n">SetTypeId</span> <span class="p">(</span><span class="n">typeId</span><span class="p">);</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">node</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="n">Create</span> <span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="p">();</span>
</pre></div>
</div>
<p>Both of these methods result in fully initialized attributes being available
in the resulting <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> instances.</p>
<p>We next discuss how attributes (values associated with member variables or
functions of the class) are plumbed into the above <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TypeId</span></code>.</p>
</div>
</div>
<div class="section" id="id1">
<h3>Attributes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The goal of the attribute system is to organize the access of
internal member objects of a simulation. This goal arises because,
typically in simulation, users will cut and paste/modify existing
simulation scripts, or will use higher-level simulation constructs,
but often will be interested in studying or tracing particular
internal variables.  For instance, use cases such as:</p>
<ul class="simple">
<li><p><em>“I want to trace the packets on the wireless interface only on the first
access point.”</em></p></li>
<li><p><em>“I want to trace the value of the TCP congestion window (every time it
changes) on a particular TCP socket.”</em></p></li>
<li><p><em>“I want a dump of all values that were used in my simulation.”</em></p></li>
</ul>
<p>Similarly, users may want fine-grained access to internal variables in the
simulation, or may want to broadly change the initial value used for a
particular parameter in all subsequently created objects. Finally, users may
wish to know what variables are settable and retrievable in a simulation
configuration. This is not just for direct simulation interaction on the command
line; consider also a (future) graphical user interface that would like to be
able to provide a feature whereby a user might right-click on an node on the
canvas and see a hierarchical, organized list of parameters that are settable on
the node and its constituent member objects, and help text and default values
for each parameter.</p>
<div class="section" id="defining-attributes">
<h4>Defining Attributes<a class="headerlink" href="#defining-attributes" title="Permalink to this headline">¶</a></h4>
<p>We provide a way for users to access values deep in the system, without having
to plumb accessors (pointers) through the system and walk pointer chains to get
to them. Consider a class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">QueueBase</span></code> that has a member variable
<code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">m_maxSize</span></code> controlling the depth of the queue.</p>
<p>If we look at the declaration of <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">QueueBase</span></code>, we see
the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">QueueBase</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Object</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
  <span class="p">...</span>

<span class="k">private</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="n">QueueSize</span> <span class="n">m_maxSize</span><span class="p">;</span>                <span class="c1">//!&lt; max queue size</span>
  <span class="p">...</span>
<span class="p">};</span>
</pre></div>
</div>
<p><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">QueueSize</span></code> is a special type in <em>ns-3</em> that allows size
to be represented in different units:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">QueueSizeUnit</span>
<span class="p">{</span>
  <span class="n">PACKETS</span><span class="p">,</span>     <span class="cm">/**&lt; Use number of packets for queue size */</span>
  <span class="n">BYTES</span><span class="p">,</span>       <span class="cm">/**&lt; Use number of bytes for queue size */</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">QueueSize</span>
<span class="p">{</span>
  <span class="p">...</span>
<span class="k">private</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="n">QueueSizeUnit</span> <span class="n">m_unit</span><span class="p">;</span> <span class="c1">//!&lt; unit</span>
  <span class="kt">uint32_t</span> <span class="n">m_value</span><span class="p">;</span>     <span class="c1">//!&lt; queue size [bytes or packets]</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Finally, the class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">DropTailQueue</span></code> inherits from this base
class and provides the semantics that packets that are submitted to
a full queue will be dropped from the back of the queue (“drop tail”).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * \ingroup queue</span>
<span class="cm"> *</span>
<span class="cm"> * \brief A FIFO packet queue that drops tail-end packets on overflow</span>
<span class="cm"> */</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Item</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">DropTailQueue</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Queue</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Let’s consider things that a user may want to do with the value of
<code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">m_maxSize</span></code>:</p>
<ul class="simple">
<li><p>Set a default value for the system, such that whenever a new
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">DropTailQueue</span></code> is created, this member is initialized
to that default.</p></li>
<li><p>Set or get the value on an already instantiated queue.</p></li>
</ul>
<p>The above things typically require providing <code class="docutils literal notranslate"><span class="pre">Set</span> <span class="pre">()</span></code> and <code class="docutils literal notranslate"><span class="pre">Get</span> <span class="pre">()</span></code>
functions, and some type of global default value.</p>
<p>In the <em>ns-3</em> attribute system, these value definitions and accessor function
registrations are moved into the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TypeId</span></code> class; <em>e.g</em>.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NS_OBJECT_ENSURE_REGISTERED</span> <span class="p">(</span><span class="n">QueueBase</span><span class="p">);</span>

<span class="n">TypeId</span>
<span class="n">QueueBase</span><span class="o">::</span><span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;ns3::DropTailQueue&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">SetParent</span><span class="o">&lt;</span><span class="n">Queue</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">SetGroupName</span> <span class="p">(</span><span class="s">&quot;Network&quot;</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;MaxSize&quot;</span><span class="p">,</span>
                   <span class="s">&quot;The max queue size&quot;</span><span class="p">,</span>
                   <span class="n">QueueSizeValue</span> <span class="p">(</span><span class="n">QueueSize</span> <span class="p">(</span><span class="s">&quot;100p&quot;</span><span class="p">)),</span>
                   <span class="n">MakeQueueSizeAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">QueueBase</span><span class="o">::</span><span class="n">SetMaxSize</span><span class="p">,</span>
                                          <span class="o">&amp;</span><span class="n">QueueBase</span><span class="o">::</span><span class="n">GetMaxSize</span><span class="p">),</span>
                   <span class="n">MakeQueueSizeChecker</span> <span class="p">())</span>
    <span class="p">...</span>
    <span class="p">;</span>

  <span class="k">return</span> <span class="n">tid</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">AddAttribute</span> <span class="pre">()</span></code> method is performing a number of things for the
<code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">m_maxSize</span></code> value:</p>
<ul class="simple">
<li><p>Binding the (usually private) member variable <code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">m_maxSize</span></code>
to a public string <code class="docutils literal notranslate"><span class="pre">&quot;MaxSize&quot;</span></code>.</p></li>
<li><p>Providing a default value (0 packets).</p></li>
<li><p>Providing some help text defining the meaning of the value.</p></li>
<li><p>Providing a “Checker” (not used in this example) that can be used to set
bounds on the allowable range of values.</p></li>
</ul>
<p>The key point is that now the value of this variable and its default value are
accessible in the attribute namespace, which is based on strings such as
<code class="docutils literal notranslate"><span class="pre">&quot;MaxSize&quot;</span></code> and <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TypeId</span></code> name strings. In the next section,
we will provide an example script that shows how users may manipulate
these values.</p>
<p>Note that initialization of the attribute relies on the macro
<code class="docutils literal notranslate"><span class="pre">NS_OBJECT_ENSURE_REGISTERED</span> <span class="pre">(QueueBase)</span></code> being called; if you leave this
out of your new class implementation, your attributes will not be initialized
correctly.</p>
<p>While we have described how to create attributes, we still haven’t described how
to access and manage these values. For instance, there is no <code class="docutils literal notranslate"><span class="pre">globals.h</span></code>
header file where these are stored; attributes are stored with their classes.
Questions that naturally arise are how do users easily learn about all of the
attributes of their models, and how does a user access these attributes, or
document their values as part of the record of their simulation?</p>
<p>Detailed documentation of the actual attributes defined for a type,
and a global list of all defined attributes, are available in
the API documentation.  For the rest of this document we are going
to demonstrate the various ways of getting and setting attribute values.</p>
</div>
<div class="section" id="setting-default-values">
<h4>Setting Default Values<a class="headerlink" href="#setting-default-values" title="Permalink to this headline">¶</a></h4>
<div class="section" id="config-setdefault-and-commandline">
<h5>Config::SetDefault and CommandLine<a class="headerlink" href="#config-setdefault-and-commandline" title="Permalink to this headline">¶</a></h5>
<p>Let’s look at how a user script might access a specific attribute value.
We’re going to use the
<code class="docutils literal notranslate"><span class="pre">src/point-to-point/examples/main-attribute-value.cc</span></code>
script for illustration, with some details stripped out.  The <code class="docutils literal notranslate"><span class="pre">main</span></code>
function begins:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// This is a basic example of how to use the attribute system to</span>
<span class="c1">// set and get a value in the underlying system; namely, the maximum</span>
<span class="c1">// size of the FIFO queue in the PointToPointNetDevice</span>
<span class="c1">//</span>

<span class="kt">int</span>
<span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>

  <span class="c1">// Queues in ns-3 are objects that hold items (other objects) in</span>
  <span class="c1">// a queue structure.  The C++ implementation uses templates to</span>
  <span class="c1">// allow queues to hold various types of items, but the most</span>
  <span class="c1">// common is a pointer to a packet (Ptr&lt;Packet&gt;).</span>
  <span class="c1">//</span>
  <span class="c1">// The maximum queue size can either be enforced in bytes (&#39;b&#39;) or</span>
  <span class="c1">// packets (&#39;p&#39;).  A special type called the ns3::QueueSize can</span>
  <span class="c1">// hold queue size values in either unit (bytes or packets).  The</span>
  <span class="c1">// queue base class ns3::QueueBase has a MaxSize attribute that can</span>
  <span class="c1">// be set to a QueueSize.</span>

  <span class="c1">// By default, the MaxSize attribute has a value of 100 packets (&#39;100p&#39;)</span>
  <span class="c1">// (this default can be observed in the function QueueBase::GetTypeId)</span>
  <span class="c1">//</span>
  <span class="c1">// Here, we set it to 80 packets.  We could use one of two value types:</span>
  <span class="c1">// a string-based value or a QueueSizeValue value</span>
  <span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::QueueBase::MaxSize&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;80p&quot;</span><span class="p">));</span>
  <span class="c1">// The below function call is redundant</span>
  <span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::QueueBase::MaxSize&quot;</span><span class="p">,</span> <span class="n">QueueSizeValue</span> <span class="p">(</span><span class="n">QueueSize</span> <span class="p">(</span><span class="n">QueueSizeUnit</span><span class="o">::</span><span class="n">PACKETS</span><span class="p">,</span> <span class="mi">80</span><span class="p">)));</span>
</pre></div>
</div>
<p>The main thing to notice in the above are the two equivalent calls to
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Config::SetDefault</span> <span class="pre">()</span></code>.  This is how we set the default value
for all subsequently instantiated <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">DropTailQueue</span></code>s.  We illustrate
that two types of <code class="docutils literal notranslate"><span class="pre">Value</span></code> classes, a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">StringValue</span></code> and
a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">QueueSizeValue</span></code> class, can be used to assign the value
to the attribute named by “ns3::QueueBase::MaxSize”.</p>
<p>It is also possible to manipulate Attributes using the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">CommandLine</span></code>;
we saw some examples early in the <em>ns-3</em> Tutorial.  In particular, it is
straightforward to add a shorthand argument name, such as <code class="docutils literal notranslate"><span class="pre">--maxSize</span></code>,
for an Attribute that is particular relevant for your model, in this case
<code class="docutils literal notranslate"><span class="pre">&quot;ns3::QueueBase::MaxSize&quot;</span></code>.  This has the additional feature that
the help string for the Attribute will be printed as part of the usage
message for the script.  For more information see
the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">CommandLine</span></code> API documentation.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Allow the user to override any of the defaults and the above</span>
<span class="c1">// SetDefaults() at run-time, via command-line arguments</span>
<span class="c1">// For example, via &quot;--ns3::QueueBase::MaxSize=80p&quot;</span>
<span class="n">CommandLine</span> <span class="n">cmd</span><span class="p">;</span>
<span class="c1">// This provides yet another way to set the value from the command line:</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">AddValue</span> <span class="p">(</span><span class="s">&quot;maxSize&quot;</span><span class="p">,</span> <span class="s">&quot;ns3::QueueBase::MaxSize&quot;</span><span class="p">);</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">Parse</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
</pre></div>
</div>
<p>Now, we will create a few objects using the low-level API.  Our
newly created queues will not have <code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">m_maxSize</span></code> initialized to
0 packets, as defined in the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">QueueBase::GetTypeId</span> <span class="pre">()</span></code>
function, but to 80 packets, because of what we did above with
default values.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">n0</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="p">();</span>

<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">PointToPointNetDevice</span><span class="o">&gt;</span> <span class="n">net0</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">PointToPointNetDevice</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">n0</span><span class="o">-&gt;</span><span class="n">AddDevice</span> <span class="p">(</span><span class="n">net0</span><span class="p">);</span>

<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Queue</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">q</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">DropTailQueue</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">();</span>
<span class="n">net0</span><span class="o">-&gt;</span><span class="n">AddQueue</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</pre></div>
</div>
<p>At this point, we have created a single <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Node</span></code> (<code class="docutils literal notranslate"><span class="pre">n0</span></code>)
and a single <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">PointToPointNetDevice</span></code> (<code class="docutils literal notranslate"><span class="pre">net0</span></code>),
and added a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">DropTailQueue</span></code> (<code class="docutils literal notranslate"><span class="pre">q</span></code>) to <code class="docutils literal notranslate"><span class="pre">net0</span></code>.</p>
</div>
<div class="section" id="constructors-helpers-and-objectfactory">
<h5>Constructors, Helpers and ObjectFactory<a class="headerlink" href="#constructors-helpers-and-objectfactory" title="Permalink to this headline">¶</a></h5>
<p>Arbitrary combinations of attributes can be set and fetched from
the helper and low-level APIs; either from the constructors themselves:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">GridPositionAllocator</span><span class="o">&gt;</span> <span class="n">p</span> <span class="o">=</span>
  <span class="n">CreateObjectWithAttributes</span><span class="o">&lt;</span><span class="n">GridPositionAllocator</span><span class="o">&gt;</span>
    <span class="p">(</span><span class="s">&quot;MinX&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">),</span>
     <span class="s">&quot;MinY&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">),</span>
     <span class="s">&quot;DeltaX&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="mf">5.0</span><span class="p">),</span>
     <span class="s">&quot;DeltaY&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="mf">20.0</span><span class="p">),</span>
     <span class="s">&quot;GridWidth&quot;</span><span class="p">,</span> <span class="n">UintegerValue</span> <span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="s">&quot;LayoutType&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;RowFirst&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>or from the higher-level helper APIs, such as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">mobility</span><span class="p">.</span><span class="n">SetPositionAllocator</span>
    <span class="p">(</span><span class="s">&quot;ns3::GridPositionAllocator&quot;</span><span class="p">,</span>
     <span class="s">&quot;MinX&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">),</span>
     <span class="s">&quot;MinY&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">),</span>
     <span class="s">&quot;DeltaX&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="mf">5.0</span><span class="p">),</span>
     <span class="s">&quot;DeltaY&quot;</span><span class="p">,</span> <span class="n">DoubleValue</span> <span class="p">(</span><span class="mf">20.0</span><span class="p">),</span>
     <span class="s">&quot;GridWidth&quot;</span><span class="p">,</span> <span class="n">UintegerValue</span> <span class="p">(</span><span class="mi">20</span><span class="p">),</span>
     <span class="s">&quot;LayoutType&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;RowFirst&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>We don’t illustrate it here, but you can also configure an
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectFactory</span></code> with new values for specific attributes.
Instances created by the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectFactory</span></code> will have those
attributes set during construction.  This is very similar to using
one of the helper APIs for the class.</p>
<p>To review, there are several ways to set values for attributes for
class instances <em>to be created in the future:</em></p>
<ul class="simple">
<li><p><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Config::SetDefault</span> <span class="pre">()</span></code></p></li>
<li><p><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CommandLine::AddValue</span> <span class="pre">()</span></code></p></li>
<li><p><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CreateObjectWithAttributes&lt;&gt;</span> <span class="pre">()</span></code></p></li>
<li><p>Various helper APIs</p></li>
</ul>
<p>But what if you’ve already created an instance, and you want
to change the value of the attribute?  In this example, how can we
manipulate the <code class="xref cpp cpp-member docutils literal notranslate"><span class="pre">m_maxSize</span></code> value of the already instantiated
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">DropTailQueue</span></code>?  Here are various ways to do that.</p>
</div>
</div>
<div class="section" id="changing-values">
<h4>Changing Values<a class="headerlink" href="#changing-values" title="Permalink to this headline">¶</a></h4>
<div class="section" id="smartpointer">
<h5>SmartPointer<a class="headerlink" href="#smartpointer" title="Permalink to this headline">¶</a></h5>
<p>Assume that a smart pointer (<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Ptr</span></code>) to a relevant network device
is in hand; in the current example, it is the <code class="docutils literal notranslate"><span class="pre">net0</span></code> pointer.</p>
<p>One way to change the value is to access a pointer to the underlying queue and
modify its attribute.</p>
<p>First, we observe that we can get a pointer to the (base class)
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Queue</span></code> <em>via</em> the
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">PointToPointNetDevice</span></code> attributes, where it is called
<code class="docutils literal notranslate"><span class="pre">&quot;TxQueue&quot;</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">PointerValue</span> <span class="n">ptr</span><span class="p">;</span>
<span class="n">net0</span><span class="o">-&gt;</span><span class="n">GetAttribute</span> <span class="p">(</span><span class="s">&quot;TxQueue&quot;</span><span class="p">,</span> <span class="n">ptr</span><span class="p">);</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Queue</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">txQueue</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">Queue</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">();</span>
</pre></div>
</div>
<p>Using the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetObject</span> <span class="pre">()</span></code> function, we can perform a safe downcast
to a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">DropTailQueue</span></code>.  The <cite>NS_ASSERT</cite> checks that the pointer is
valid.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DropTailQueue</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">dtq</span> <span class="o">=</span> <span class="n">txQueue</span><span class="o">-&gt;</span><span class="n">GetObject</span> <span class="o">&lt;</span><span class="n">DropTailQueue</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="p">();</span>
<span class="n">NS_ASSERT</span> <span class="p">(</span><span class="n">dtq</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>Next, we can get the value of an attribute on this queue.  We have introduced
wrapper <code class="docutils literal notranslate"><span class="pre">Value</span></code> classes for the underlying data types, similar
to Java wrappers around these types, since the attribute system stores values
serialized to strings, and not disparate types.  Here, the attribute value
is assigned to a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">QueueSizeValue</span></code>, and the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Get</span> <span class="pre">()</span></code>
method on this value produces the (unwrapped) <code class="docutils literal notranslate"><span class="pre">QueueSize</span></code>.  That is,
the variable <cite>limit</cite> is written into by the GetAttribute method.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">QueueSizeValue</span> <span class="n">limit</span><span class="p">;</span>
<span class="n">dtq</span><span class="o">-&gt;</span><span class="n">GetAttribute</span> <span class="p">(</span><span class="s">&quot;MaxSize&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">);</span>
<span class="n">NS_LOG_INFO</span> <span class="p">(</span><span class="s">&quot;1.  dtq limit: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">limit</span><span class="p">.</span><span class="n">Get</span> <span class="p">());</span>
</pre></div>
</div>
<p>Note that the above downcast is not really needed; we could have gotten
the attribute value directly from <code class="docutils literal notranslate"><span class="pre">txQueue</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">txQueue</span><span class="o">-&gt;</span><span class="n">GetAttribute</span> <span class="p">(</span><span class="s">&quot;MaxSize&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">);</span>
<span class="n">NS_LOG_INFO</span> <span class="p">(</span><span class="s">&quot;2.  txQueue limit: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">limit</span><span class="p">.</span><span class="n">Get</span> <span class="p">());</span>
</pre></div>
</div>
<p>Now, let’s set it to another value (60 packets).  Let’s also make
use of the StringValue shorthand notation to set the size by
passing in a string (the string must be a positive integer suffixed
by either the <cite>p</cite> or <cite>b</cite> character).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">txQueue</span><span class="o">-&gt;</span><span class="n">SetAttribute</span> <span class="p">(</span><span class="s">&quot;MaxSize&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;60p&quot;</span><span class="p">));</span>
<span class="n">txQueue</span><span class="o">-&gt;</span><span class="n">GetAttribute</span> <span class="p">(</span><span class="s">&quot;MaxSize&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">);</span>
<span class="n">NS_LOG_INFO</span> <span class="p">(</span><span class="s">&quot;3.  txQueue limit changed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">limit</span><span class="p">.</span><span class="n">Get</span> <span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="config-namespace-path">
<h5>Config Namespace Path<a class="headerlink" href="#config-namespace-path" title="Permalink to this headline">¶</a></h5>
<p>An alternative way to get at the attribute is to use the configuration
namespace.  Here, this attribute resides on a known path in this namespace; this
approach is useful if one doesn’t have access to the underlying pointers and
would like to configure a specific attribute with a single statement.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Config</span><span class="o">::</span><span class="n">Set</span> <span class="p">(</span><span class="s">&quot;/NodeList/0/DeviceList/0/TxQueue/MaxSize&quot;</span><span class="p">,</span>
             <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;25p&quot;</span><span class="p">));</span>
<span class="n">txQueue</span><span class="o">-&gt;</span><span class="n">GetAttribute</span> <span class="p">(</span><span class="s">&quot;MaxSize&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">);</span>
<span class="n">NS_LOG_INFO</span> <span class="p">(</span><span class="s">&quot;4.  txQueue limit changed through namespace: &quot;</span>
             <span class="o">&lt;&lt;</span> <span class="n">limit</span><span class="p">.</span><span class="n">Get</span> <span class="p">());</span>
</pre></div>
</div>
<p>The configuration path often has the form of
<code class="docutils literal notranslate"><span class="pre">&quot;.../&lt;container</span> <span class="pre">name&gt;/&lt;index&gt;/.../&lt;attribute&gt;/&lt;attribute&gt;&quot;</span></code>
to refer to a specific instance by index of an object in the container.
In this case the first container is the list of all <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Node</span></code>s;
the second container is the list of all <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">NetDevice</span></code>s on
the chosen <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Node</span></code>.  Finally, the configuration path usually
ends with a succession of member attributes, in this case the <code class="docutils literal notranslate"><span class="pre">&quot;MaxSize&quot;</span></code>
attribute of the <code class="docutils literal notranslate"><span class="pre">&quot;TxQueue&quot;</span></code> of the chosen <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">NetDevice</span></code>.</p>
<p>We could have also used wildcards to set this value for all nodes and all net
devices (which in this simple example has the same effect as the previous
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Config::Set</span> <span class="pre">()</span></code>):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Config</span><span class="o">::</span><span class="n">Set</span> <span class="p">(</span><span class="s">&quot;/NodeList/*/DeviceList/*/TxQueue/MaxSize&quot;</span><span class="p">,</span>
             <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;15p&quot;</span><span class="p">));</span>
<span class="n">txQueue</span><span class="o">-&gt;</span><span class="n">GetAttribute</span> <span class="p">(</span><span class="s">&quot;MaxSize&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="p">);</span>
<span class="n">NS_LOG_INFO</span> <span class="p">(</span><span class="s">&quot;5.  txQueue limit changed through wildcarded namespace: &quot;</span>
             <span class="o">&lt;&lt;</span> <span class="n">limit</span><span class="p">.</span><span class="n">Get</span> <span class="p">());</span>
</pre></div>
</div>
<p>If you run this program from the command line, you should see the following
output corresponding to the steps we took above:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run main-attribute-value
<span class="m">1</span>.  dtq limit: 80p
<span class="m">2</span>.  txQueue limit: 80p
<span class="m">3</span>.  txQueue limit changed: 60p
<span class="m">4</span>.  txQueue limit changed through namespace: 25p
<span class="m">5</span>.  txQueue limit changed through wildcarded namespace: 15p
</pre></div>
</div>
</div>
<div class="section" id="object-name-service">
<h5>Object Name Service<a class="headerlink" href="#object-name-service" title="Permalink to this headline">¶</a></h5>
<p>Another way to get at the attribute is to use the object name service facility.
The object name service allows us to add items to the configuration
namespace under the <code class="docutils literal notranslate"><span class="pre">&quot;/Names/&quot;</span></code> path with a user-defined name string.
This approach is useful if one doesn’t have access to the underlying
pointers and it is difficult to determine the required concrete configuration
namespace path.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;server&quot;</span><span class="p">,</span> <span class="n">n0</span><span class="p">);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;server/eth0&quot;</span><span class="p">,</span> <span class="n">net0</span><span class="p">);</span>

<span class="p">...</span>

<span class="n">Config</span><span class="o">::</span><span class="n">Set</span> <span class="p">(</span><span class="s">&quot;/Names/server/eth0/TxQueue/MaxPackets&quot;</span><span class="p">,</span> <span class="n">UintegerValue</span> <span class="p">(</span><span class="mi">25</span><span class="p">));</span>
</pre></div>
</div>
<p>Here we’ve added the path elements <code class="docutils literal notranslate"><span class="pre">&quot;server&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;eth0&quot;</span></code> under
the <code class="docutils literal notranslate"><span class="pre">&quot;/Names/&quot;</span></code> namespace, then used the resulting configuration path
to set the attribute.</p>
<p>See <a class="reference internal" href="index.html#object-names"><span class="std std-ref">Object names</span></a> for a fuller treatment of the <em>ns-3</em> configuration namespace.</p>
</div>
</div>
</div>
<div class="section" id="implementation-details">
<h3>Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h3>
<div class="section" id="value-classes">
<h4>Value Classes<a class="headerlink" href="#value-classes" title="Permalink to this headline">¶</a></h4>
<p>Readers will note the <code class="docutils literal notranslate"><span class="pre">TypeValue</span></code> classes which are subclasses of the
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AttributeValue</span></code> base class. These can be thought of as
intermediate classes which are used to convert from raw types to the
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AttributeValue</span></code>s that are used by the attribute system.
Recall that this database is holding objects of many types serialized
to strings. Conversions to this type can either be done using
an intermediate class (such as <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">IntegerValue</span></code>,
or <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">DoubleValue</span></code> for floating point numbers)
or <em>via</em> strings. Direct implicit conversion of types to
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AttributeValue</span></code> is not really practical.
So in the above, users have a choice of using strings or values:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">-&gt;</span><span class="n">Set</span> <span class="p">(</span><span class="s">&quot;cwnd&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">));</span> <span class="c1">// string-based setter</span>
<span class="n">p</span><span class="o">-&gt;</span><span class="n">Set</span> <span class="p">(</span><span class="s">&quot;cwnd&quot;</span><span class="p">,</span> <span class="n">IntegerValue</span> <span class="p">(</span><span class="mi">100</span><span class="p">));</span> <span class="c1">// integer-based setter</span>
</pre></div>
</div>
<p>The system provides some macros that help users declare and define
new AttributeValue subclasses for new types that they want to introduce into
the attribute system:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ATTRIBUTE_HELPER_HEADER</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ATTRIBUTE_HELPER_CPP</span></code></p></li>
</ul>
<p>See the API documentation for these constructs for more information.</p>
</div>
<div class="section" id="initialization-order">
<h4>Initialization Order<a class="headerlink" href="#initialization-order" title="Permalink to this headline">¶</a></h4>
<p>Attributes in the system must not depend on the state of any other Attribute in
this system. This is because an ordering of Attribute initialization is not
specified, nor enforced, by the system. A specific example of this can be seen
in automated configuration programs such as <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigStore</span></code>.
Although a given model may arrange it so that Attributes are initialized in a
particular order, another automatic configurator may decide independently to
change Attributes in, for example, alphabetic order.</p>
<p>Because of this non-specific ordering, no Attribute in the system may have any
dependence on any other Attribute. As a corollary, Attribute setters must never
fail due to the state of another Attribute. No Attribute setter may change (set)
any other Attribute value as a result of changing its value.</p>
<p>This is a very strong restriction and there are cases where Attributes must set
consistently to allow correct operation. To this end we do allow for consistency
checking <em>when the attribute is used</em> (<em>cf</em>. <code class="docutils literal notranslate"><span class="pre">NS_ASSERT_MSG</span></code>
or <code class="docutils literal notranslate"><span class="pre">NS_ABORT_MSG</span></code>).</p>
<p>In general, the attribute code to assign values to the underlying class member
variables is executed after an object is constructed. But what if you need the
values assigned before the constructor body executes, because you need them in
the logic of the constructor? There is a way to do this, used for example in the
class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigStore</span></code>: call <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ObjectBase::ConstructSelf</span> <span class="pre">()</span></code> as
follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ConfigStore</span><span class="o">::</span><span class="n">ConfigStore</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="n">ObjectBase</span><span class="o">::</span><span class="n">ConstructSelf</span> <span class="p">(</span><span class="n">AttributeConstructionList</span> <span class="p">());</span>
  <span class="c1">// continue on with constructor.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Beware that the object and all its derived classes must also implement
a <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetInstanceTypeId</span> <span class="pre">()</span></code> method. Otherwise
the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">ObjectBase::ConstructSelf</span> <span class="pre">()</span></code> will not be able to read
the attributes.</p>
</div>
<div class="section" id="adding-attributes">
<h4>Adding Attributes<a class="headerlink" href="#adding-attributes" title="Permalink to this headline">¶</a></h4>
<p>The <em>ns-3</em> system will place a number of internal values under the attribute
system, but undoubtedly users will want to extend this to pick up ones we have
missed, or to add their own classes to the system.</p>
<p>There are three typical use cases:</p>
<ul class="simple">
<li><p>Making an existing class data member accessible as an Attribute,
when it isn’t already.</p></li>
<li><p>Making a new class able to expose some data members as Attributes
by giving it a TypeId.</p></li>
<li><p>Creating an <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">AttributeValue</span></code> subclass for a new class
so that it can be accessed as an Attribute.</p></li>
</ul>
<div class="section" id="existing-member-variable">
<h5>Existing Member Variable<a class="headerlink" href="#existing-member-variable" title="Permalink to this headline">¶</a></h5>
<p>Consider this variable in <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TcpSocket</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32_t</span> <span class="n">m_cWnd</span><span class="p">;</span>   <span class="c1">// Congestion window</span>
</pre></div>
</div>
<p>Suppose that someone working with TCP wanted to get or set the value of that
variable using the metadata system. If it were not already provided by <em>ns-3</em>,
the user could declare the following addition in the runtime metadata system (to
the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetTypeId()</span></code> definition for <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TcpSocket</span></code>):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;Congestion window&quot;</span><span class="p">,</span>
               <span class="s">&quot;Tcp congestion window (bytes)&quot;</span><span class="p">,</span>
               <span class="n">UintegerValue</span> <span class="p">(</span><span class="mi">1</span><span class="p">),</span>
               <span class="n">MakeUintegerAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">TcpSocket</span><span class="o">::</span><span class="n">m_cWnd</span><span class="p">),</span>
               <span class="n">MakeUintegerChecker</span><span class="o">&lt;</span><span class="kt">uint16_t</span><span class="o">&gt;</span> <span class="p">())</span>
</pre></div>
</div>
<p>Now, the user with a pointer to a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TcpSocket</span></code> instance
can perform operations such as
setting and getting the value, without having to add these functions explicitly.
Furthermore, access controls can be applied, such as allowing the parameter to
be read and not written, or bounds checking on the permissible values can be
applied.</p>
</div>
<div class="section" id="new-class-typeid">
<h5>New Class TypeId<a class="headerlink" href="#new-class-typeid" title="Permalink to this headline">¶</a></h5>
<p>Here, we discuss the impact on a user who wants to add a new class to <em>ns-3</em>.
What additional things must be done to enable it to hold attributes?</p>
<p>Let’s assume our new class, called <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::MyMobility</span></code>,
is a type of mobility model.  First, the class should inherit from
its parent class, <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::MobilityModel</span></code>.
In the <code class="docutils literal notranslate"><span class="pre">my-mobility.h</span></code> header file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">ns3</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">MyMobility</span> <span class="o">:</span> <span class="k">public</span> <span class="n">MobilityModel</span>
<span class="p">{</span>
</pre></div>
</div>
<p>This requires we declare the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">GetTypeId</span> <span class="pre">()</span></code> function.
This is a one-line public function declaration:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span><span class="o">:</span>
  <span class="cm">/**</span>
<span class="cm">   *  Register this type.</span>
<span class="cm">   *  \return The object TypeId.</span>
<span class="cm">   */</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>We’ve already introduced what a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TypeId</span></code> definition will look like
in the <code class="docutils literal notranslate"><span class="pre">my-mobility.cc</span></code> implementation file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NS_OBJECT_ENSURE_REGISTERED</span> <span class="p">(</span><span class="n">MyMobility</span><span class="p">);</span>

<span class="n">TypeId</span>
<span class="n">MyMobility</span><span class="o">::</span><span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;ns3::MyMobility&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">SetParent</span><span class="o">&lt;</span><span class="n">MobilityModel</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">SetGroupName</span> <span class="p">(</span><span class="s">&quot;Mobility&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">AddConstructor</span><span class="o">&lt;</span><span class="n">MyMobility</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;Bounds&quot;</span><span class="p">,</span>
                   <span class="s">&quot;Bounds of the area to cruise.&quot;</span><span class="p">,</span>
                   <span class="n">RectangleValue</span> <span class="p">(</span><span class="n">Rectangle</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)),</span>
                   <span class="n">MakeRectangleAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">MyMobility</span><span class="o">::</span><span class="n">m_bounds</span><span class="p">),</span>
                   <span class="n">MakeRectangleChecker</span> <span class="p">())</span>
    <span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;Time&quot;</span><span class="p">,</span>
                   <span class="s">&quot;Change current direction and speed after moving for this delay.&quot;</span><span class="p">,</span>
                   <span class="n">TimeValue</span> <span class="p">(</span><span class="n">Seconds</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">)),</span>
                   <span class="n">MakeTimeAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">MyMobility</span><span class="o">::</span><span class="n">m_modeTime</span><span class="p">),</span>
                   <span class="n">MakeTimeChecker</span> <span class="p">())</span>
    <span class="c1">// etc (more parameters).</span>
    <span class="p">;</span>
  <span class="k">return</span> <span class="n">tid</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If we don’t want to subclass from an existing class, in the header file
we just inherit from <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Object</span></code>, and in the object file
we set the parent class to <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Object</span></code> with
<code class="docutils literal notranslate"><span class="pre">.SetParent&lt;Object&gt;</span> <span class="pre">()</span></code>.</p>
<p>Typical mistakes here involve:</p>
<ul class="simple">
<li><p>Not calling <code class="docutils literal notranslate"><span class="pre">NS_OBJECT_ENSURE_REGISTERED</span> <span class="pre">()</span></code></p></li>
<li><p>Not calling the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">SetParent</span> <span class="pre">()</span></code> method,
or calling it with the wrong type.</p></li>
<li><p>Not calling the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">AddConstructor</span> <span class="pre">()</span></code> method,
or calling it with the wrong type.</p></li>
<li><p>Introducing a typographical error in the name of the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TypeId</span></code>
in its constructor.</p></li>
<li><p>Not using the fully-qualified C++ typename of the enclosing C++ class as the
name of the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">TypeId</span></code>.  Note that <code class="docutils literal notranslate"><span class="pre">&quot;ns3::&quot;</span></code> is required.</p></li>
</ul>
<p>None of these mistakes can be detected by the <em>ns-3</em> codebase, so users
are advised to check carefully multiple times that they got these right.</p>
</div>
<div class="section" id="new-attributevalue-type">
<h5>New AttributeValue Type<a class="headerlink" href="#new-attributevalue-type" title="Permalink to this headline">¶</a></h5>
<p>From the perspective of the user who writes a new class in the system and wants
it to be accessible as an attribute, there is mainly the matter of writing the
conversions to/from strings and attribute values.  Most of this can be
copy/pasted with macro-ized code.  For instance, consider a class declaration
for <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Rectangle</span></code> in the <code class="docutils literal notranslate"><span class="pre">src/mobility/model</span></code> directory:</p>
<div class="section" id="header-file">
<h6>Header File<a class="headerlink" href="#header-file" title="Permalink to this headline">¶</a></h6>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * \brief a 2d rectangle</span>
<span class="cm"> */</span>
<span class="k">class</span> <span class="nc">Rectangle</span>
<span class="p">{</span>
  <span class="p">...</span>

  <span class="kt">double</span> <span class="n">xMin</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">xMax</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">yMin</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">yMax</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>One macro call and two operators, must be added below the class declaration in
order to turn a Rectangle into a value usable by the <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> system:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Rectangle</span> <span class="o">&amp;</span><span class="n">rectangle</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">istream</span> <span class="o">&amp;</span><span class="k">operator</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Rectangle</span> <span class="o">&amp;</span><span class="n">rectangle</span><span class="p">);</span>

<span class="n">ATTRIBUTE_HELPER_HEADER</span> <span class="p">(</span><span class="n">Rectangle</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="implementation-file">
<h6>Implementation File<a class="headerlink" href="#implementation-file" title="Permalink to this headline">¶</a></h6>
<p>In the class definition (<code class="docutils literal notranslate"><span class="pre">.cc</span></code> file), the code looks like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">ATTRIBUTE_HELPER_CPP</span> <span class="p">(</span><span class="n">Rectangle</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span>
<span class="k">operator</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Rectangle</span> <span class="o">&amp;</span><span class="n">rectangle</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">rectangle</span><span class="p">.</span><span class="n">xMin</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">rectangle</span><span class="p">.</span><span class="n">xMax</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;|&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">rectangle</span><span class="p">.</span><span class="n">yMin</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;|&quot;</span>
     <span class="o">&lt;&lt;</span> <span class="n">rectangle</span><span class="p">.</span><span class="n">yMax</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">std</span><span class="o">::</span><span class="n">istream</span> <span class="o">&amp;</span>
<span class="k">operator</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Rectangle</span> <span class="o">&amp;</span><span class="n">rectangle</span><span class="p">)</span>
 <span class="p">{</span>
  <span class="kt">char</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">;</span>
  <span class="n">is</span> <span class="o">&gt;&gt;</span> <span class="n">rectangle</span><span class="p">.</span><span class="n">xMin</span> <span class="o">&gt;&gt;</span> <span class="n">c1</span> <span class="o">&gt;&gt;</span> <span class="n">rectangle</span><span class="p">.</span><span class="n">xMax</span> <span class="o">&gt;&gt;</span> <span class="n">c2</span> <span class="o">&gt;&gt;</span> <span class="n">rectangle</span><span class="p">.</span><span class="n">yMin</span> <span class="o">&gt;&gt;</span> <span class="n">c3</span>
     <span class="o">&gt;&gt;</span> <span class="n">rectangle</span><span class="p">.</span><span class="n">yMax</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">c1</span> <span class="o">!=</span> <span class="sc">&#39;|&#39;</span> <span class="o">||</span>
      <span class="n">c2</span> <span class="o">!=</span> <span class="sc">&#39;|&#39;</span> <span class="o">||</span>
      <span class="n">c3</span> <span class="o">!=</span> <span class="sc">&#39;|&#39;</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">is</span><span class="p">.</span><span class="n">setstate</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ios_base</span><span class="o">::</span><span class="n">failbit</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">is</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These stream operators simply convert from a string representation of the
Rectangle (<code class="docutils literal notranslate"><span class="pre">&quot;xMin|xMax|yMin|yMax&quot;</span></code>) to the underlying Rectangle.  The modeler
must specify these operators and the string syntactical representation of an
instance of the new class.</p>
</div>
</div>
</div>
</div>
<div class="section" id="configstore">
<h3>ConfigStore<a class="headerlink" href="#configstore" title="Permalink to this headline">¶</a></h3>
<p>Values for <em>ns-3</em> attributes can be stored in an ASCII or XML text file
and loaded into a future simulation run.  This feature is known as the
<em>ns-3</em> ConfigStore.  The <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigStore</span></code> is a specialized database for attribute values and default values.</p>
<p>Although it is a separately maintained module in the
<code class="docutils literal notranslate"><span class="pre">src/config-store/</span></code> directory, we document it here because of its
sole dependency on <em>ns-3</em> core module and attributes.</p>
<p>We can explore this system by using an example from
<code class="docutils literal notranslate"><span class="pre">src/config-store/examples/config-store-save.cc</span></code>.</p>
<p>First, all users of the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigStore</span></code> must include
the following statement:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ns3/config-store-module.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>Next, this program adds a sample object <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigExample</span></code>
to show how the system is extended:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ConfigExample</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Object</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;ns3::A&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="n">SetParent</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="p">()</span>
      <span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;TestInt16&quot;</span><span class="p">,</span> <span class="s">&quot;help text&quot;</span><span class="p">,</span>
                     <span class="n">IntegerValue</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span>
                     <span class="n">MakeIntegerAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">A</span><span class="o">::</span><span class="n">m_int16</span><span class="p">),</span>
                     <span class="n">MakeIntegerChecker</span><span class="o">&lt;</span><span class="kt">int16_t</span><span class="o">&gt;</span> <span class="p">())</span>
      <span class="p">;</span>
      <span class="k">return</span> <span class="n">tid</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="kt">int16_t</span> <span class="n">m_int16</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">NS_OBJECT_ENSURE_REGISTERED</span> <span class="p">(</span><span class="n">ConfigExample</span><span class="p">);</span>
</pre></div>
</div>
<p>Next, we use the Config subsystem to override the defaults in a couple of
ways:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigExample::TestInt16&quot;</span><span class="p">,</span> <span class="n">IntegerValue</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">));</span>

<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ConfigExample</span><span class="o">&gt;</span> <span class="n">a_obj</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">ConfigExample</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">NS_ABORT_MSG_UNLESS</span> <span class="p">(</span><span class="n">a_obj</span><span class="o">-&gt;</span><span class="n">m_int16</span> <span class="o">==</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
                     <span class="s">&quot;Cannot set ConfigExample&#39;s integer attribute via Config::SetDefault&quot;</span><span class="p">);</span>

<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ConfigExample</span><span class="o">&gt;</span> <span class="n">a2_obj</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">ConfigExample</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">a2_obj</span><span class="o">-&gt;</span><span class="n">SetAttribute</span> <span class="p">(</span><span class="s">&quot;TestInt16&quot;</span><span class="p">,</span> <span class="n">IntegerValue</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">));</span>
<span class="n">IntegerValue</span> <span class="n">iv</span><span class="p">;</span>
<span class="n">a2_obj</span><span class="o">-&gt;</span><span class="n">GetAttribute</span> <span class="p">(</span><span class="s">&quot;TestInt16&quot;</span><span class="p">,</span> <span class="n">iv</span><span class="p">);</span>
<span class="n">NS_ABORT_MSG_UNLESS</span> <span class="p">(</span><span class="n">iv</span><span class="p">.</span><span class="n">Get</span> <span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span>
                     <span class="s">&quot;Cannot set ConfigExample&#39;s integer attribute via SetAttribute&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The next statement is necessary to make sure that (one of) the objects
created is rooted in the configuration namespace as an object instance.
This normally happens when you aggregate objects to a <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Node</span></code>
or <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Channel</span></code> instance,
but here, since we are working at the core level, we need to create a
new root namespace object:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Config</span><span class="o">::</span><span class="n">RegisterRootNamespaceObject</span> <span class="p">(</span><span class="n">a2_obj</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="writing">
<h4>Writing<a class="headerlink" href="#writing" title="Permalink to this headline">¶</a></h4>
<p>Next, we want to output the configuration store.  The examples show how
to do it in two formats, XML and raw text.  In practice, one should perform
this step just before calling <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Simulator::Run</span> <span class="pre">()</span></code> to save the
final configuration just before running the simulation.</p>
<p>There are three Attributes that govern the behavior of the ConfigStore:
<code class="docutils literal notranslate"><span class="pre">&quot;Mode&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;Filename&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;FileFormat&quot;</span></code>.  The Mode (default <code class="docutils literal notranslate"><span class="pre">&quot;None&quot;</span></code>)
configures whether <em>ns-3</em> should load configuration from a previously saved file
(specify <code class="docutils literal notranslate"><span class="pre">&quot;Mode=Load&quot;</span></code>) or save it to a file (specify <code class="docutils literal notranslate"><span class="pre">&quot;Mode=Save&quot;</span></code>).
The Filename (default <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>) is where the ConfigStore should read or write
its data.  The FileFormat (default <code class="docutils literal notranslate"><span class="pre">&quot;RawText&quot;</span></code>) governs whether
the ConfigStore format is plain text or Xml (<code class="docutils literal notranslate"><span class="pre">&quot;FileFormat=Xml&quot;</span></code>)</p>
<p>The example shows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Filename&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;output-attributes.xml&quot;</span><span class="p">));</span>
<span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::FileFormat&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;Xml&quot;</span><span class="p">));</span>
<span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Mode&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;Save&quot;</span><span class="p">));</span>
<span class="n">ConfigStore</span> <span class="n">outputConfig</span><span class="p">;</span>
<span class="n">outputConfig</span><span class="p">.</span><span class="n">ConfigureDefaults</span> <span class="p">();</span>
<span class="n">outputConfig</span><span class="p">.</span><span class="n">ConfigureAttributes</span> <span class="p">();</span>

<span class="c1">// Output config store to txt format</span>
<span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Filename&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;output-attributes.txt&quot;</span><span class="p">));</span>
<span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::FileFormat&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;RawText&quot;</span><span class="p">));</span>
<span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Mode&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;Save&quot;</span><span class="p">));</span>
<span class="n">ConfigStore</span> <span class="n">outputConfig2</span><span class="p">;</span>
<span class="n">outputConfig2</span><span class="p">.</span><span class="n">ConfigureDefaults</span> <span class="p">();</span>
<span class="n">outputConfig2</span><span class="p">.</span><span class="n">ConfigureAttributes</span> <span class="p">();</span>

<span class="n">Simulator</span><span class="o">::</span><span class="n">Run</span> <span class="p">();</span>

<span class="n">Simulator</span><span class="o">::</span><span class="n">Destroy</span> <span class="p">();</span>
</pre></div>
</div>
<p>Note the placement of these statements just prior to the
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">Simulator::Run</span> <span class="pre">()</span></code> statement.  This output logs all of the
values in place just prior to starting the simulation (<em>i.e</em>. after
all of the configuration has taken place).</p>
<p>After running, you can open the <code class="docutils literal notranslate"><span class="pre">output-attributes.txt</span></code> file and see:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>...
default ns3::ErrorModel::IsEnabled &quot;true&quot;
default ns3::RateErrorModel::ErrorUnit &quot;ERROR_UNIT_BYTE&quot;
default ns3::RateErrorModel::ErrorRate &quot;0&quot;
default ns3::RateErrorModel::RanVar &quot;ns3::UniformRandomVariable[Min=0.0|Max=1.0]&quot;
default ns3::BurstErrorModel::ErrorRate &quot;0&quot;
default ns3::BurstErrorModel::BurstStart &quot;ns3::UniformRandomVariable[Min=0.0|Max=1.0]&quot;
default ns3::BurstErrorModel::BurstSize &quot;ns3::UniformRandomVariable[Min=1|Max=4]&quot;
default ns3::PacketSocket::RcvBufSize &quot;131072&quot;
default ns3::PcapFileWrapper::CaptureSize &quot;65535&quot;
default ns3::PcapFileWrapper::NanosecMode &quot;false&quot;
default ns3::SimpleNetDevice::PointToPointMode &quot;false&quot;
default ns3::SimpleNetDevice::TxQueue &quot;ns3::DropTailQueue&lt;Packet&gt;&quot;
default ns3::SimpleNetDevice::DataRate &quot;0bps&quot;
default ns3::PacketSocketClient::MaxPackets &quot;100&quot;
default ns3::PacketSocketClient::Interval &quot;+1000000000.0ns&quot;
default ns3::PacketSocketClient::PacketSize &quot;1024&quot;
default ns3::PacketSocketClient::Priority &quot;0&quot;
default ns3::ConfigStore::Mode &quot;Save&quot;
default ns3::ConfigStore::Filename &quot;output-attributes.txt&quot;
default ns3::ConfigStore::FileFormat &quot;RawText&quot;
default ns3::ConfigExample::TestInt16 &quot;-5&quot;
global SimulatorImplementationType &quot;ns3::DefaultSimulatorImpl&quot;
global SchedulerType &quot;ns3::MapScheduler&quot;
global RngSeed &quot;1&quot;
global RngRun &quot;1&quot;
global ChecksumEnabled &quot;false&quot;
value /$ns3::ConfigExample/TestInt16 &quot;-3&quot;
</pre></div>
</div>
<p>In the above, several of the default values for attributes for the core
and network modules are shown.  Then, all the values for the <em>ns-3</em> global values
are recorded.  Finally, the value of the instance of <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigExample</span></code>
that was rooted in the configuration namespace is shown.  In a real
<em>ns-3</em> program, many more models, attributes, and defaults would be shown.</p>
<p>An XML version also exists in <code class="docutils literal notranslate"><span class="pre">output-attributes.xml</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;ns3&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::ErrorModel::IsEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::RateErrorModel::ErrorUnit&quot;</span> <span class="na">value=</span><span class="s">&quot;ERROR_UNIT_BYTE&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::RateErrorModel::ErrorRate&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::RateErrorModel::RanVar&quot;</span> <span class="na">value=</span><span class="s">&quot;ns3::UniformRandomVariable[Min=0.0|Max=1.0]&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::BurstErrorModel::ErrorRate&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::BurstErrorModel::BurstStart&quot;</span> <span class="na">value=</span><span class="s">&quot;ns3::UniformRandomVariable[Min=0.0|Max=1.0]&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::BurstErrorModel::BurstSize&quot;</span> <span class="na">value=</span><span class="s">&quot;ns3::UniformRandomVariable[Min=1|Max=4]&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::PacketSocket::RcvBufSize&quot;</span> <span class="na">value=</span><span class="s">&quot;131072&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::PcapFileWrapper::CaptureSize&quot;</span> <span class="na">value=</span><span class="s">&quot;65535&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::PcapFileWrapper::NanosecMode&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::SimpleNetDevice::PointToPointMode&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::SimpleNetDevice::TxQueue&quot;</span> <span class="na">value=</span><span class="s">&quot;ns3::DropTailQueue&amp;lt;Packet&amp;gt;&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::SimpleNetDevice::DataRate&quot;</span> <span class="na">value=</span><span class="s">&quot;0bps&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::PacketSocketClient::MaxPackets&quot;</span> <span class="na">value=</span><span class="s">&quot;100&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::PacketSocketClient::Interval&quot;</span> <span class="na">value=</span><span class="s">&quot;+1000000000.0ns&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::PacketSocketClient::PacketSize&quot;</span> <span class="na">value=</span><span class="s">&quot;1024&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::PacketSocketClient::Priority&quot;</span> <span class="na">value=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::ConfigStore::Mode&quot;</span> <span class="na">value=</span><span class="s">&quot;Save&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::ConfigStore::Filename&quot;</span> <span class="na">value=</span><span class="s">&quot;output-attributes.xml&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::ConfigStore::FileFormat&quot;</span> <span class="na">value=</span><span class="s">&quot;Xml&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;default</span> <span class="na">name=</span><span class="s">&quot;ns3::ConfigExample::TestInt16&quot;</span> <span class="na">value=</span><span class="s">&quot;-5&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;global</span> <span class="na">name=</span><span class="s">&quot;SimulatorImplementationType&quot;</span> <span class="na">value=</span><span class="s">&quot;ns3::DefaultSimulatorImpl&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;global</span> <span class="na">name=</span><span class="s">&quot;SchedulerType&quot;</span> <span class="na">value=</span><span class="s">&quot;ns3::MapScheduler&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;global</span> <span class="na">name=</span><span class="s">&quot;RngSeed&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;global</span> <span class="na">name=</span><span class="s">&quot;RngRun&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;global</span> <span class="na">name=</span><span class="s">&quot;ChecksumEnabled&quot;</span> <span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;value</span> <span class="na">path=</span><span class="s">&quot;/$ns3::ConfigExample/TestInt16&quot;</span> <span class="na">value=</span><span class="s">&quot;-3&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ns3&gt;</span>
</pre></div>
</div>
<p>This file can be archived with your simulation script and output data.</p>
</div>
<div class="section" id="reading">
<h4>Reading<a class="headerlink" href="#reading" title="Permalink to this headline">¶</a></h4>
<p>Next, we discuss configuring simulations <em>via</em> a stored input
configuration file.  There are a couple of key differences
compared to writing the final simulation configuration.  First, we
need to place statements such as these at the beginning of the program,
before simulation configuration statements are written (so the values
are registered before being used in object construction).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Filename&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;input-defaults.xml&quot;</span><span class="p">));</span>
<span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Mode&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;Load&quot;</span><span class="p">));</span>
<span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::FileFormat&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;Xml&quot;</span><span class="p">));</span>
<span class="n">ConfigStore</span> <span class="n">inputConfig</span><span class="p">;</span>
<span class="n">inputConfig</span><span class="p">.</span><span class="n">ConfigureDefaults</span> <span class="p">();</span>
</pre></div>
</div>
<p>Next, note that loading of input configuration data is limited to Attribute
default (<em>i.e</em>. not instance) values, and global values.  Attribute instance
values are not supported because at this stage of the simulation, before
any objects are constructed, there are no such object instances around.
(Note, future enhancements to the config store may change this behavior).</p>
<p>Second, while the output of <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigStore</span></code> state
will list everything in the database, the input file need only contain
the specific values to be overridden.  So, one way to use this class
for input file configuration is to generate an initial configuration
using the output (<code class="docutils literal notranslate"><span class="pre">&quot;Save&quot;</span></code>) <code class="docutils literal notranslate"><span class="pre">&quot;Mode&quot;</span></code> described above, extract from
that configuration file only the elements one wishes to change,
and move these minimal elements to a new configuration file
which can then safely be edited and loaded in a subsequent simulation run.</p>
<p>When the <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigStore</span></code> object is instantiated, its attributes
<code class="docutils literal notranslate"><span class="pre">&quot;Filename&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;Mode&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;FileFormat&quot;</span></code> must be set,
either <em>via</em> command-line or <em>via</em> program statements.</p>
</div>
<div class="section" id="reading-writing-example">
<h4>Reading/Writing Example<a class="headerlink" href="#reading-writing-example" title="Permalink to this headline">¶</a></h4>
<p>As a more complicated example, let’s assume that we want to read in a
configuration of defaults from an input file named <code class="docutils literal notranslate"><span class="pre">input-defaults.xml</span></code>, and
write out the resulting attributes to a separate file called
<code class="docutils literal notranslate"><span class="pre">output-attributes.xml</span></code>.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ns3/config-store-module.h&quot;</span><span class="cp"></span>
<span class="p">...</span>
<span class="kt">int</span> <span class="n">main</span> <span class="p">(...)</span>
<span class="p">{</span>

  <span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Filename&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;input-defaults.xml&quot;</span><span class="p">));</span>
  <span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Mode&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;Load&quot;</span><span class="p">));</span>
  <span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::FileFormat&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;Xml&quot;</span><span class="p">));</span>
  <span class="n">ConfigStore</span> <span class="n">inputConfig</span><span class="p">;</span>
  <span class="n">inputConfig</span><span class="p">.</span><span class="n">ConfigureDefaults</span> <span class="p">();</span>

  <span class="c1">//</span>
  <span class="c1">// Allow the user to override any of the defaults and the above Bind () at</span>
  <span class="c1">// run-time, viacommand-line arguments</span>
  <span class="c1">//</span>
  <span class="n">CommandLine</span> <span class="n">cmd</span><span class="p">;</span>
  <span class="n">cmd</span><span class="p">.</span><span class="n">Parse</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>

  <span class="c1">// setup topology</span>
  <span class="p">...</span>

  <span class="c1">// Invoke just before entering Simulator::Run ()</span>
  <span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Filename&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;output-attributes.xml&quot;</span><span class="p">));</span>
  <span class="n">Config</span><span class="o">::</span><span class="n">SetDefault</span> <span class="p">(</span><span class="s">&quot;ns3::ConfigStore::Mode&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;Save&quot;</span><span class="p">));</span>
  <span class="n">ConfigStore</span> <span class="n">outputConfig</span><span class="p">;</span>
  <span class="n">outputConfig</span><span class="p">.</span><span class="n">ConfigureAttributes</span> <span class="p">();</span>
  <span class="n">Simulator</span><span class="o">::</span><span class="n">Run</span> <span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="configstore-gui">
<h4>ConfigStore GUI<a class="headerlink" href="#configstore-gui" title="Permalink to this headline">¶</a></h4>
<p>There is a GTK-based front end for the ConfigStore.  This allows users to use a
GUI to access and change variables.  Screenshots of this feature are available
in the <a class="reference external" href="http://www.nsnam.org/docs/ns-3-overview.pdf">|ns3| Overview</a>
presentation.</p>
<p>To use this feature, one must install <code class="docutils literal notranslate"><span class="pre">libgtk</span></code> and <code class="docutils literal notranslate"><span class="pre">libgtk-dev</span></code>; an example
Ubuntu installation command is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install libgtk2.0-0 libgtk2.0-dev
</pre></div>
</div>
<p>To check whether it is configured or not, check the output of the step:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure --enable-examples --enable-tests

---- Summary of optional NS-3 features:
Python Bindings               : enabled
Python API Scanning Support   : enabled
NS-3 Click Integration        : enabled
GtkConfigStore                : not enabled <span class="o">(</span>library <span class="s1">&#39;gtk+-2.0 &gt;= 2.12&#39;</span> not found<span class="o">)</span>
</pre></div>
</div>
<p>In the above example, it was not enabled, so it cannot be used until a suitable
version is installed and:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure --enable-examples --enable-tests
$ ./waf
</pre></div>
</div>
<p>is rerun.</p>
<p>Usage is almost the same as the non-GTK-based version, but there
are no <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ConfigStore</span></code> attributes involved:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Invoke just before entering Simulator::Run ()</span>
<span class="n">GtkConfigStore</span> <span class="n">config</span><span class="p">;</span>
<span class="n">config</span><span class="p">.</span><span class="n">ConfigureDefaults</span> <span class="p">();</span>
<span class="n">config</span><span class="p">.</span><span class="n">ConfigureAttributes</span> <span class="p">();</span>
</pre></div>
</div>
<p>Now, when you run the script, a GUI should pop up, allowing you to open menus of
attributes on different nodes/objects, and then launch the simulation execution
when you are done.</p>
</div>
</div>
</div>
<span id="document-object-names"></span><div class="section" id="object-names">
<span id="id1"></span><h2>Object names<a class="headerlink" href="#object-names" title="Permalink to this headline">¶</a></h2>
<p><em>Placeholder chapter</em></p>
</div>
<span id="document-logging"></span><div class="section" id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>The <em>ns-3</em> logging facility can be used to monitor or debug the progress
of simulation programs.  Logging output can be enabled by program statements
in your <code class="docutils literal notranslate"><span class="pre">main()</span></code> program or by the use of the <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> environment variable.</p>
<p>Logging statements are not compiled into optimized builds of <em>ns-3</em>.  To use
logging, one must build the (default) debug build of <em>ns-3</em>.</p>
<p>The project makes no guarantee about whether logging output will remain
the same over time.  Users are cautioned against building simulation output
frameworks on top of logging code, as the output and the way the output
is enabled may change over time.</p>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p><em>ns-3</em> logging statements are typically used to log various program
execution events, such as the occurrence of simulation events or the
use of a particular function.</p>
<p>For example, this code snippet is from <code class="docutils literal notranslate"><span class="pre">Ipv4L3Protocol::IsDestinationAddress()</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="n">iaddr</span><span class="p">.</span><span class="n">GetBroadcast</span> <span class="p">())</span>
  <span class="p">{</span>
    <span class="n">NS_LOG_LOGIC</span> <span class="p">(</span><span class="s">&quot;For me (interface broadcast address)&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
   <span class="p">}</span>
</pre></div>
</div>
<p>If logging has been enabled for the <code class="docutils literal notranslate"><span class="pre">Ipv4L3Protocol</span></code> component at a severity
of <code class="docutils literal notranslate"><span class="pre">LOGIC</span></code> or above (see below about log severity), the statement
will be printed out; otherwise, it will be suppressed.</p>
<div class="section" id="enabling-output">
<h4>Enabling Output<a class="headerlink" href="#enabling-output" title="Permalink to this headline">¶</a></h4>
<p>There are two ways that users typically control log output.  The
first is by setting the <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> environment variable; e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;*&quot;</span> ./waf --run first
</pre></div>
</div>
<p>will run the <code class="docutils literal notranslate"><span class="pre">first</span></code> tutorial program with all logging output.  (The
specifics of the <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> format will be discussed below.)</p>
<p>This can be made more granular by selecting individual components:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;Ipv4L3Protocol&quot;</span> ./waf --run first
</pre></div>
</div>
<p>The output can be further tailored with prefix options.</p>
<p>The second way to enable logging is to use explicit statements in your
program, such as in the <code class="docutils literal notranslate"><span class="pre">first</span></code> tutorial program:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">LogComponentEnable</span> <span class="p">(</span><span class="s">&quot;UdpEchoClientApplication&quot;</span><span class="p">,</span> <span class="n">LOG_LEVEL_INFO</span><span class="p">);</span>
  <span class="n">LogComponentEnable</span> <span class="p">(</span><span class="s">&quot;UdpEchoServerApplication&quot;</span><span class="p">,</span> <span class="n">LOG_LEVEL_INFO</span><span class="p">);</span>
  <span class="p">...</span>
</pre></div>
</div>
<p>(The meaning of <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_INFO</span></code>, and other possible values,
will be discussed below.)</p>
</div>
<div class="section" id="ns-log-syntax">
<h4><code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> Syntax<a class="headerlink" href="#ns-log-syntax" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> environment variable contains a list of log components
and options.  Log components are separated by `:’ characters:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;&lt;log-component&gt;:&lt;log-component&gt;...&quot;</span>
</pre></div>
</div>
<p>Options for each log component are given as flags after
each log component:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;&lt;log-component&gt;=&lt;option&gt;|&lt;option&gt;...:&lt;log-component&gt;...&quot;</span>
</pre></div>
</div>
<p>Options control the severity and level for that component,
and whether optional information should be included, such as the
simulation time, simulation node, function name, and the symbolic severity.</p>
</div>
<div class="section" id="log-components">
<h4>Log Components<a class="headerlink" href="#log-components" title="Permalink to this headline">¶</a></h4>
<p>Generally a log component refers to a single source code <code class="docutils literal notranslate"><span class="pre">.cc</span></code> file,
and encompasses the entire file.</p>
<p>Some helpers have special methods to enable the logging of all components
in a module, spanning different compilation units, but logically grouped
together, such as the <em>ns-3</em> wifi code:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">WifiHelper</span> <span class="n">wifiHelper</span><span class="p">;</span>
<span class="n">wifiHelper</span><span class="p">.</span><span class="n">EnableLogComponents</span> <span class="p">();</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> log component wildcard `*’ will enable all components.</p>
<p>To see what log components are defined, any of these will work:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;print-list&quot;</span> ./waf --run ...

$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span>  <span class="c1"># a token not matching any log-component</span>
</pre></div>
</div>
<p>The first form will print the name and enabled flags for all log components
which are linked in; try it with <code class="docutils literal notranslate"><span class="pre">scratch-simulator</span></code>.
The second form prints all registered log components,
then exit with an error.</p>
</div>
<div class="section" id="severity-and-level-options">
<h4>Severity and Level Options<a class="headerlink" href="#severity-and-level-options" title="Permalink to this headline">¶</a></h4>
<p>Individual messages belong to a single “severity class,” set by the macro
creating the message.  In the example above,
<code class="docutils literal notranslate"><span class="pre">NS_LOG_LOGIC(..)</span></code> creates the message in the <code class="docutils literal notranslate"><span class="pre">LOG_LOGIC</span></code> severity class.</p>
<p>The following severity classes are defined as <code class="docutils literal notranslate"><span class="pre">enum</span></code> constants:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Severity Class</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_NONE</span></code></p></td>
<td><p>The default, no logging</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_ERROR</span></code></p></td>
<td><p>Serious error messages only</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_WARN</span></code></p></td>
<td><p>Warning messages</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_DEBUG</span></code></p></td>
<td><p>For use in debugging</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_INFO</span></code></p></td>
<td><p>Informational</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_FUNCTION</span></code></p></td>
<td><p>Function tracing</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_LOGIC</span></code></p></td>
<td><p>Control flow tracing within functions</p></td>
</tr>
</tbody>
</table>
<p>Typically one wants to see messages at a given severity class <em>and higher</em>.
This is done by defining inclusive logging “levels”:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Level</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_ERROR</span></code></p></td>
<td><p>Only <code class="docutils literal notranslate"><span class="pre">LOG_ERROR</span></code> severity class messages.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_WARN</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LOG_WARN</span></code> and above.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_DEBUG</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LOG_DEBUG</span></code> and above.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_INFO</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LOG_INFO</span></code> and above.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_FUNCTION</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LOG_FUNCTION</span></code> and above.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_LOGIC</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">LOG_LOGIC</span></code> and above.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_ALL</span></code></p></td>
<td><p>All severity classes.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_ALL</span></code></p></td>
<td><p>Synonym for <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_ALL</span></code></p></td>
</tr>
</tbody>
</table>
<p>The severity class and level options can be given in the <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code>
environment variable by these tokens:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Class</p></th>
<th class="head"><p>Level</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">error</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">level_error</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">warn</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">level_warn</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">debug</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">level_debug</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">info</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">level_info</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">function</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">level_function</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">logic</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">level_logic</span></code></p></td>
</tr>
<tr class="row-even"><td></td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">level_all</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">all</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">*</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Using a severity class token enables log messages at that severity only.
For example, <code class="docutils literal notranslate"><span class="pre">NS_LOG=&quot;*=warn&quot;</span></code> won’t output messages with severity <code class="docutils literal notranslate"><span class="pre">error</span></code>.
<code class="docutils literal notranslate"><span class="pre">NS_LOG=&quot;*=level_debug&quot;</span></code> will output messages at severity levels
<code class="docutils literal notranslate"><span class="pre">debug</span></code> and above.</p>
<p>Severity classes and levels can be combined with the `|’ operator:
<code class="docutils literal notranslate"><span class="pre">NS_LOG=&quot;*=level_warn|logic&quot;</span></code> will output messages at severity levels
<code class="docutils literal notranslate"><span class="pre">error</span></code>, <code class="docutils literal notranslate"><span class="pre">warn</span></code> and <code class="docutils literal notranslate"><span class="pre">logic</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> severity level wildcard `*’ and <code class="docutils literal notranslate"><span class="pre">all</span></code>
are synonyms for <code class="docutils literal notranslate"><span class="pre">level_all</span></code>.</p>
<p>For log components merely mentioned in <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;&lt;log-component&gt;:...&quot;</span>
</pre></div>
</div>
<p>the default severity is <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_ALL</span></code>.</p>
</div>
<div class="section" id="prefix-options">
<h4>Prefix Options<a class="headerlink" href="#prefix-options" title="Permalink to this headline">¶</a></h4>
<p>A number of prefixes can help identify
where and when a message originated, and at what severity.</p>
<p>The available prefix options (as <code class="docutils literal notranslate"><span class="pre">enum</span></code> constants) are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Prefix Symbol</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_PREFIX_FUNC</span></code></p></td>
<td><p>Prefix the name of the calling function.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_PREFIX_TIME</span></code></p></td>
<td><p>Prefix the simulation time.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_PREFIX_NODE</span></code></p></td>
<td><p>Prefix the node id.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_PREFIX_LEVEL</span></code></p></td>
<td><p>Prefix the severity level.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_PREFIX_ALL</span></code></p></td>
<td><p>Enable all prefixes.</p></td>
</tr>
</tbody>
</table>
<p>The prefix options are described briefly below.</p>
<p>The options can be given in the <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code>
environment variable by these tokens:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 64%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Token</p></th>
<th class="head"><p>Alternate</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">prefix_func</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">func</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">prefix_time</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">time</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">prefix_node</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">node</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">prefix_level</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">level</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">prefix_all</span></code></p></td>
<td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">all</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">*</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>For log components merely mentioned in <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;&lt;log-component&gt;:...&quot;</span>
</pre></div>
</div>
<p>the default prefix options are <code class="docutils literal notranslate"><span class="pre">LOG_PREFIX_ALL</span></code>.</p>
<div class="section" id="severity-prefix">
<h5>Severity Prefix<a class="headerlink" href="#severity-prefix" title="Permalink to this headline">¶</a></h5>
<p>The severity class of a message can be included with the options
<code class="docutils literal notranslate"><span class="pre">prefix_level</span></code> or <code class="docutils literal notranslate"><span class="pre">level</span></code>.  For example, this value of <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code>
enables logging for all log components (`*’) and all severity
classes (<code class="docutils literal notranslate"><span class="pre">=all</span></code>), and prefixes the message with the severity
class (<code class="docutils literal notranslate"><span class="pre">|prefix_level</span></code>).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;*=all|prefix_level&quot;</span> ./waf --run scratch-simulator
Scratch Simulator
<span class="o">[</span>ERROR<span class="o">]</span> error message
<span class="o">[</span>WARN<span class="o">]</span> warn message
<span class="o">[</span>DEBUG<span class="o">]</span> debug message
<span class="o">[</span>INFO<span class="o">]</span> info message
<span class="o">[</span>FUNCT<span class="o">]</span> <span class="k">function</span> message
<span class="o">[</span>LOGIC<span class="o">]</span> logic message
</pre></div>
</div>
</div>
<div class="section" id="time-prefix">
<h5>Time Prefix<a class="headerlink" href="#time-prefix" title="Permalink to this headline">¶</a></h5>
<p>The simulation time can be included with the options
<code class="docutils literal notranslate"><span class="pre">prefix_time</span></code> or <code class="docutils literal notranslate"><span class="pre">time</span></code>.  This prints the simulation time in seconds.</p>
</div>
<div class="section" id="node-prefix">
<h5>Node Prefix<a class="headerlink" href="#node-prefix" title="Permalink to this headline">¶</a></h5>
<p>The simulation node id can be included with the options
<code class="docutils literal notranslate"><span class="pre">prefix_node</span></code> or <code class="docutils literal notranslate"><span class="pre">node</span></code>.</p>
</div>
<div class="section" id="function-prefix">
<h5>Function Prefix<a class="headerlink" href="#function-prefix" title="Permalink to this headline">¶</a></h5>
<p>The name of the calling function can be included with the options
<code class="docutils literal notranslate"><span class="pre">prefix_func</span></code> or <code class="docutils literal notranslate"><span class="pre">func</span></code>.</p>
</div>
<div class="section" id="ns-log-wildcards">
<h5><code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> Wildcards<a class="headerlink" href="#ns-log-wildcards" title="Permalink to this headline">¶</a></h5>
<p>The log component wildcard `*’ will enable all components.  To
enable all components at a specific severity level
use <code class="docutils literal notranslate"><span class="pre">*=&lt;severity&gt;</span></code>.</p>
<p>The severity level option wildcard `*’ is a synonym for <code class="docutils literal notranslate"><span class="pre">all</span></code>.
This must occur before any `|’ characters separating options.
To enable all severity classes, use <code class="docutils literal notranslate"><span class="pre">&lt;log-component&gt;=*</span></code>,
or <code class="docutils literal notranslate"><span class="pre">&lt;log-component&gt;=*|&lt;options&gt;</span></code>.</p>
<p>The option wildcard `*’ or token <code class="docutils literal notranslate"><span class="pre">all</span></code> enables all prefix options,
but must occur <em>after</em> a `|’ character.  To enable a specific
severity class or level, and all prefixes, use
<code class="docutils literal notranslate"><span class="pre">&lt;log-component&gt;=&lt;severity&gt;|*</span></code>.</p>
<p>The combined option wildcard <code class="docutils literal notranslate"><span class="pre">**</span></code> enables all severities and all prefixes;
for example, <code class="docutils literal notranslate"><span class="pre">&lt;log-component&gt;=**</span></code>.</p>
<p>The uber-wildcard <code class="docutils literal notranslate"><span class="pre">***</span></code> enables all severities and all prefixes
for all log components.  These are all equivalent:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;***&quot;</span> ...      $ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;*=all|*&quot;</span> ...        $ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;*=*|all&quot;</span> ...
$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;*=**&quot;</span> ...     $ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;*=level_all|*&quot;</span> ...  $ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;*=*|prefix_all&quot;</span> ...
$ <span class="nv">NS_LOG</span><span class="o">=</span><span class="s2">&quot;*=*|*&quot;</span> ...
</pre></div>
</div>
<p>Be advised:  even the trivial <code class="docutils literal notranslate"><span class="pre">scratch-simulator</span></code> produces over
46K lines of output with <code class="docutils literal notranslate"><span class="pre">NS_LOG=&quot;***&quot;</span></code>!</p>
</div>
</div>
</div>
<div class="section" id="how-to-add-logging-to-your-code">
<h3>How to add logging to your code<a class="headerlink" href="#how-to-add-logging-to-your-code" title="Permalink to this headline">¶</a></h3>
<p>Adding logging to your code is very simple:</p>
<ol class="arabic simple">
<li><p>Invoke the <code class="docutils literal notranslate"><span class="pre">NS_LOG_COMPONENT_DEFINE</span> <span class="pre">(...);</span></code> macro
inside of <code class="docutils literal notranslate"><span class="pre">namespace</span> <span class="pre">ns3</span></code>.</p></li>
</ol>
<blockquote>
<div><p>Create a unique string identifier (usually based on the name of the file
and/or class defined within the file) and register it with a macro call
such as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">ns3</span> <span class="p">{</span>

<span class="n">NS_LOG_COMPONENT_DEFINE</span> <span class="p">(</span><span class="s">&quot;Ipv4L3Protocol&quot;</span><span class="p">);</span>
<span class="p">...</span>
</pre></div>
</div>
<p>This registers <code class="docutils literal notranslate"><span class="pre">Ipv4L3Protocol</span></code> as a log component.</p>
<p>(The macro was carefully written to permit inclusion either within or
outside of namespace <code class="docutils literal notranslate"><span class="pre">ns3</span></code>, and usage will vary across the codebase, but
the original intent was to register this <em>outside</em> of namespace <code class="docutils literal notranslate"><span class="pre">ns3</span></code>
at file global scope.)</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Add logging statements (macro calls) to your functions and function bodies.</p></li>
</ol>
<p>In case you want to add logging statements to the methods of your template class
(which are defined in an header file):</p>
<ol class="arabic simple">
<li><p>Invoke the <code class="docutils literal notranslate"><span class="pre">NS_LOG_TEMPLATE_DECLARE;</span></code> macro in the private section of
your class declaration. For instance:</p></li>
</ol>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Item</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Queue</span> <span class="o">:</span> <span class="k">public</span> <span class="n">QueueBase</span>
<span class="p">{</span>
<span class="p">...</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">m_packets</span><span class="p">;</span>          <span class="c1">//!&lt; the items in the queue</span>
  <span class="n">NS_LOG_TEMPLATE_DECLARE</span><span class="p">;</span>                  <span class="c1">//!&lt; the log component</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This requires you to perform these steps for all the subclasses of your class.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Invoke the <code class="docutils literal notranslate"><span class="pre">NS_LOG_TEMPLATE_DEFINE</span> <span class="pre">(...);</span></code> macro in the constructor of
your class by providing the name of a log component registered by calling
the <code class="docutils literal notranslate"><span class="pre">NS_LOG_COMPONENT_DEFINE</span> <span class="pre">(...);</span></code> macro in some module. For instance:</p></li>
</ol>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Item</span><span class="o">&gt;</span>
<span class="n">Queue</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;::</span><span class="n">Queue</span> <span class="p">()</span>
  <span class="o">:</span> <span class="n">NS_LOG_TEMPLATE_DEFINE</span> <span class="p">(</span><span class="s">&quot;Queue&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Add logging statements (macro calls) to the methods of your class.</p></li>
</ol>
<p>In case you want to add logging statements to a static member template
(which is defined in an header file):</p>
<ol class="arabic simple">
<li><p>Invoke the <code class="docutils literal notranslate"><span class="pre">NS_LOG_STATIC_TEMPLATE_DEFINE</span> <span class="pre">(...);</span></code> macro in your static
method by providing the name of a log component registered by calling
the <code class="docutils literal notranslate"><span class="pre">NS_LOG_COMPONENT_DEFINE</span> <span class="pre">(...);</span></code> macro in some module. For instance:</p></li>
</ol>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Item</span><span class="o">&gt;</span>
<span class="kt">void</span>
<span class="n">NetDeviceQueue</span><span class="o">::</span><span class="n">PacketEnqueued</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Queue</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">queue</span><span class="p">,</span>
                                <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDeviceQueueInterface</span><span class="o">&gt;</span> <span class="n">ndqi</span><span class="p">,</span>
                                <span class="kt">uint8_t</span> <span class="n">txq</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Item</span><span class="o">&gt;</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>

  <span class="n">NS_LOG_STATIC_TEMPLATE_DEFINE</span> <span class="p">(</span><span class="s">&quot;NetDeviceQueueInterface&quot;</span><span class="p">);</span>
<span class="p">...</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Add logging statements (macro calls) to your static method.</p></li>
</ol>
</div>
<div class="section" id="controlling-timestamp-precision">
<h3>Controlling timestamp precision<a class="headerlink" href="#controlling-timestamp-precision" title="Permalink to this headline">¶</a></h3>
<p>Timestamps are printed out in units of seconds.  When used with the default
<em>ns-3</em> time resolution of nanoseconds, the default timestamp precision is 9
digits, with fixed format, to allow for 9 digits to be consistently printed
to the right of the decimal point.  Example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="mf">0.000123456</span><span class="n">s</span> <span class="nl">RandomVariableStream</span><span class="p">:</span><span class="n">SetAntithetic</span><span class="p">(</span><span class="mh">0x805040</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>When the <em>ns-3</em> simulation uses higher time resolution such as picoseconds
or femtoseconds, the precision is expanded accordingly; e.g. for picosecond:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="mf">0.000123456789</span><span class="n">s</span> <span class="nl">RandomVariableStream</span><span class="p">:</span><span class="n">SetAntithetic</span><span class="p">(</span><span class="mh">0x805040</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>When the <em>ns-3</em> simulation uses a time resolution lower than microseconds,
the default C++ precision is used.</p>
<p>An example program at <code class="docutils literal notranslate"><span class="pre">src\core\examples\sample-log-time-format.cc</span></code>
demonstrates how to change the timestamp formatting.</p>
<p>The maximum useful precision is 20 decimal digits, since Time is signed 64
bits.</p>
<div class="section" id="logging-macros">
<h4>Logging Macros<a class="headerlink" href="#logging-macros" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>The logging macros and associated severity levels are</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Severity Class</p></th>
<th class="head"><p>Macro</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_NONE</span></code></p></td>
<td><p>(none needed)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_ERROR</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NS_LOG_ERROR</span> <span class="pre">(...);</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_WARN</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NS_LOG_WARN</span> <span class="pre">(...);</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_DEBUG</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NS_LOG_DEBUG</span> <span class="pre">(...);</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_INFO</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NS_LOG_INFO</span> <span class="pre">(...);</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_FUNCTION</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NS_LOG_FUNCTION</span> <span class="pre">(...);</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">LOG_LOGIC</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NS_LOG_LOGIC</span> <span class="pre">(...);</span></code></p></td>
</tr>
</tbody>
</table>
<p>The macros function as output streamers, so anything you can send to
<code class="docutils literal notranslate"><span class="pre">std::cout</span></code>, joined by <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operators, is allowed:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">MyClass</span><span class="o">::</span><span class="n">Check</span> <span class="p">(</span><span class="kt">int</span> <span class="n">value</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NS_LOG_FUNCTION</span> <span class="p">(</span><span class="k">this</span> <span class="o">&lt;&lt;</span> <span class="n">arg</span> <span class="o">&lt;&lt;</span> <span class="n">item</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">arg</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">NS_LOG_ERROR</span> <span class="p">(</span><span class="s">&quot;encountered bad value &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">&lt;&lt;</span>
                    <span class="s">&quot; while checking &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">NS_LOG_FUNCTION</span></code> automatically inserts a `<code class="docutils literal notranslate"><span class="pre">,</span></code>’
(comma-space) separator between each of its arguments.
This simplifies logging of function arguments;
just concatenate them with <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> as in the example above.</p>
</div></blockquote>
</div>
<div class="section" id="unconditional-logging">
<h4>Unconditional Logging<a class="headerlink" href="#unconditional-logging" title="Permalink to this headline">¶</a></h4>
<p>As a convenience, the <code class="docutils literal notranslate"><span class="pre">NS_LOG_UNCOND</span> <span class="pre">(...);</span></code> macro will always log its
arguments, even if the associated log-component is not enabled at any
severity.  This macro does not use any of the prefix options.  Note that
logging is only enabled in debug builds; this macro won’t produce
output in optimized builds.</p>
</div>
<div class="section" id="guidelines">
<h4>Guidelines<a class="headerlink" href="#guidelines" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Start every class method with <code class="docutils literal notranslate"><span class="pre">NS_LOG_FUNCTION</span> <span class="pre">(this</span> <span class="pre">&lt;&lt;</span> <span class="pre">args...);</span></code>
This enables easy function call tracing.</p>
<ul>
<li><p>Except:  don’t log operators or explicit copy constructors,
since these will cause infinite recursion and stack overflow.</p></li>
<li><p>For methods without arguments use the same form:
<code class="docutils literal notranslate"><span class="pre">NS_LOG_FUNCTION</span> <span class="pre">(this);</span></code></p></li>
<li><p>For static functions:</p>
<ul>
<li><p>With arguments use <code class="docutils literal notranslate"><span class="pre">NS_LOG_FUNCTION</span> <span class="pre">(...);</span></code> as normal.</p></li>
<li><p>Without arguments use <code class="docutils literal notranslate"><span class="pre">NS_LOG_FUNCTION_NOARGS</span> <span class="pre">();</span></code></p></li>
</ul>
</li>
</ul>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">NS_LOG_ERROR</span></code> for serious error conditions that probably
invalidate the simulation execution.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">NS_LOG_WARN</span></code> for unusual conditions that may be correctable.
Please give some hints as to the nature of the problem and how
it might be corrected.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NS_LOG_DEBUG</span></code> is usually used in an <em>ad hoc</em> way to understand
the execution of a model.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">NS_LOG_INFO</span></code> for additional information about the execution,
such as the size of a data structure when adding/removing from it.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">NS_LOG_LOGIC</span></code> to trace important logic branches within a function.</p></li>
<li><p>Test that your logging changes do not break the code.
Run some example programs with all log components turned on (e.g.
<code class="docutils literal notranslate"><span class="pre">NS_LOG=&quot;***&quot;</span></code>).</p></li>
<li><p>Use an explicit cast for any variable of type uint8_t or int8_t,
e.g., <code class="docutils literal notranslate"><span class="pre">NS_LOG_LOGIC</span> <span class="pre">(&quot;Variable</span> <span class="pre">i</span> <span class="pre">is</span> <span class="pre">&quot;</span> <span class="pre">&lt;&lt;</span> <span class="pre">static_cast&lt;int&gt;</span> <span class="pre">(i));</span></code>.
Without the cast, the integer is interpreted as a char, and the result
will be most likely not in line with the expectations.
This is a well documented C++ ‘feature’.</p></li>
</ul>
</div>
</div>
</div>
<span id="document-tracing"></span><div class="section" id="tracing">
<h2>Tracing<a class="headerlink" href="#tracing" title="Permalink to this headline">¶</a></h2>
<p>The tracing subsystem is one of the most important mechanisms to understand in
<em>ns-3</em>. In most cases, <em>ns-3</em> users will have a brilliant idea for some new and
improved networking feature. In order to verify that this idea works, the
researcher will make changes to an existing system and then run experiments to
see how the new feature behaves by gathering statistics that capture the
behavior of the feature.</p>
<p>In other words, the whole point of running a simulation is to generate output
for further study. In <em>ns-3</em>, the subsystem that enables a researcher to do this
is the tracing subsystem.</p>
<div class="section" id="tracing-motivation">
<h3>Tracing Motivation<a class="headerlink" href="#tracing-motivation" title="Permalink to this headline">¶</a></h3>
<p>There are many ways to get information out of a program. The most
straightforward way is to just directly print the information to the standard
output, as in,</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="p">...</span>
<span class="kt">int</span> <span class="n">main</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="p">...</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;The value of x is &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is workable in small environments, but as your simulations get more and
more complicated, you end up with more and more prints and the task of parsing
and performing computations on the output begins to get harder and harder.</p>
<p>Another thing to consider is that every time a new tidbit is needed, the
software core must be edited and another print introduced. There is no
standardized way to control all of this output, so the amount of output tends to
grow without bounds. Eventually, the bandwidth required for simply outputting
this information begins to limit the running time of the simulation. The output
files grow to enormous sizes and parsing them becomes a problem.</p>
<p><em>ns-3</em> provides a simple mechanism for logging and providing some control over
output via <em>Log Components</em>, but the level of control is not very fine grained
at all. The logging module is a relatively blunt instrument.</p>
<p>It is desirable to have a facility that allows one to reach into the core system
and only get the information required without having to change and recompile the
core system. Even better would be a system that notified the user when an item
of interest changed or an interesting event happened.</p>
<p>The <em>ns-3</em> tracing system is designed to work along those lines and is
well-integrated with the Attribute and Config substems allowing for relatively
simple use scenarios.</p>
</div>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The tracing subsystem relies heavily on the <em>ns-3</em> Callback and Attribute
mechanisms. You should read and understand the corresponding sections of the
manual before attempting to understand the tracing system.</p>
<p>The <em>ns-3</em> tracing system is built on the concepts of independent tracing sources
and tracing sinks; along with a uniform mechanism for connecting sources to
sinks.</p>
<p>Trace sources are entities that can signal events that happen in a simulation
and provide access to interesting underlying data. For example, a trace source
could indicate when a packet is received by a net device and provide access to
the packet contents for interested trace sinks. A trace source might also
indicate when an interesting state change happens in a model. For example, the
congestion window of a TCP model is a prime candidate for a trace source.</p>
<p>Trace sources are not useful by themselves; they must be connected to other
pieces of code that actually do something useful with the information provided
by the source.  The entities that consume trace information are called trace
sinks. Trace sources are generators of events and trace sinks are consumers.</p>
<p>This explicit division allows for large numbers of trace sources to be scattered
around the system in places which model authors believe might be useful. Unless
a user connects a trace sink to one of these sources, nothing is output. This
arrangement allows relatively unsophisticated users to attach new types of sinks
to existing tracing sources, without requiring editing and recompiling the core
or models of the simulator.</p>
<p>There can be zero or more consumers of trace events generated by a trace source.
One can think of a trace source as a kind of point-to-multipoint information
link.</p>
<p>The “transport protocol” for this conceptual point-to-multipoint link is an
<em>ns-3</em> <code class="docutils literal notranslate"><span class="pre">Callback</span></code>.</p>
<p>Recall from the Callback Section that callback facility is a way to allow two
modules in the system to communicate via function calls while at the same time
decoupling the calling function from the called class completely. This is the
same requirement as outlined above for the tracing system.</p>
<p>Basically, a trace source <em>is</em> a callback to which multiple functions may be
registered. When a trace sink expresses interest in receiving trace events, it
adds a callback to a list of callbacks held by the trace source. When an
interesting event happens, the trace source invokes its <code class="docutils literal notranslate"><span class="pre">operator()</span></code> providing
zero or more parameters. This tells the source to go through its list of
callbacks invoking each one in turn. In this way, the parameter(s) are
communicated to the trace sinks, which are just functions.</p>
<div class="section" id="the-simplest-example">
<h4>The Simplest Example<a class="headerlink" href="#the-simplest-example" title="Permalink to this headline">¶</a></h4>
<p>It will be useful to go walk a quick example just to reinforce what we’ve
said.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ns3/object.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;ns3/uinteger.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;ns3/traced-value.h&quot;&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;ns3/trace-source-accessor.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">ns3</span><span class="p">;</span>
</pre></div>
</div>
<p>The first thing to do is include the required files. As mentioned above, the
trace system makes heavy use of the Object and Attribute systems. The first two
includes bring in the declarations for those systems. The file,
<code class="docutils literal notranslate"><span class="pre">traced-value.h</span></code> brings in the required declarations for tracing data that
obeys value semantics.</p>
<p>In general, value semantics just means that you can pass the object around, not
an address. In order to use value semantics at all you have to have an object
with an associated copy constructor and assignment operator available. We extend
the requirements to talk about the set of operators that are pre-defined for
plain-old-data (POD) types. Operator=, operator++, operator–, operator+,
operator==, etc.</p>
<p>What this all means is that you will be able to trace changes to an object
made using those operators.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyObject</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Object</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;MyObject&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="n">SetParent</span> <span class="p">(</span><span class="n">Object</span><span class="o">::</span><span class="n">GetTypeId</span> <span class="p">())</span>
      <span class="p">.</span><span class="n">AddConstructor</span><span class="o">&lt;</span><span class="n">MyObject</span><span class="o">&gt;</span> <span class="p">()</span>
      <span class="p">.</span><span class="n">AddTraceSource</span> <span class="p">(</span><span class="s">&quot;MyInteger&quot;</span><span class="p">,</span>
                       <span class="s">&quot;An integer value to trace.&quot;</span><span class="p">,</span>
                       <span class="n">MakeTraceSourceAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">MyObject</span><span class="o">::</span><span class="n">m_myInt</span><span class="p">))</span>
      <span class="p">;</span>
    <span class="k">return</span> <span class="n">tid</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">MyObject</span> <span class="p">()</span> <span class="p">{}</span>
  <span class="n">TracedValue</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span> <span class="n">m_myInt</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Since the tracing system is integrated with Attributes, and Attributes work with
Objects, there must be an <em>ns-3</em> <code class="docutils literal notranslate"><span class="pre">Object</span></code> for the trace source to live in. The
two important lines of code are the <code class="docutils literal notranslate"><span class="pre">.AddTraceSource</span></code> and the <code class="docutils literal notranslate"><span class="pre">TracedValue</span></code>
declaration.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.AddTraceSource</span></code> provides the “hooks” used for connecting the trace
source to the outside world. The <code class="docutils literal notranslate"><span class="pre">TracedValue</span></code> declaration provides the
infrastructure that overloads the operators mentioned above and drives the
callback process.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">IntTrace</span> <span class="p">(</span><span class="n">Int</span> <span class="n">oldValue</span><span class="p">,</span> <span class="n">Int</span> <span class="n">newValue</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Traced &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">oldValue</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; to &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">newValue</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is the definition of the trace sink. It corresponds directly to a callback
function. This function will be called whenever one of the operators of the
<code class="docutils literal notranslate"><span class="pre">TracedValue</span></code> is executed.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>
<span class="nf">main</span> <span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">MyObject</span><span class="o">&gt;</span> <span class="n">myObject</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">MyObject</span><span class="o">&gt;</span> <span class="p">();</span>

  <span class="n">myObject</span><span class="o">-&gt;</span><span class="n">TraceConnectWithoutContext</span> <span class="p">(</span><span class="s">&quot;MyInteger&quot;</span><span class="p">,</span> <span class="n">MakeCallback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">IntTrace</span><span class="p">));</span>

  <span class="n">myObject</span><span class="o">-&gt;</span><span class="n">m_myInt</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this snippet, the first thing that needs to be done is to create the object
in which the trace source lives.</p>
<p>The next step, the <code class="docutils literal notranslate"><span class="pre">TraceConnectWithoutContext</span></code>, forms the connection between
the trace source and the trace sink. Notice the <code class="docutils literal notranslate"><span class="pre">MakeCallback</span></code> template
function. Recall from the Callback section that this creates the specialized
functor responsible for providing the overloaded <code class="docutils literal notranslate"><span class="pre">operator()</span></code> used to “fire”
the callback. The overloaded operators (++, –, etc.) will use this
<code class="docutils literal notranslate"><span class="pre">operator()</span></code> to actually invoke the callback. The
<code class="docutils literal notranslate"><span class="pre">TraceConnectWithoutContext</span></code>, takes a string parameter that provides the name
of the Attribute assigned to the trace source. Let’s ignore the bit about
context for now since it is not important yet.</p>
<p>Finally, the line,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">myObject</span><span class="o">-&gt;</span><span class="n">m_myInt</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span>
</pre></div>
</div>
<p>should be interpreted as an invocation of <code class="docutils literal notranslate"><span class="pre">operator=</span></code> on the member variable
<code class="docutils literal notranslate"><span class="pre">m_myInt</span></code> with the integer <img class="math" src="_images/math/b648f8658ef578b3c1312db5aea9b2e8d436c232.png" alt="1234"/> passed as a parameter. It turns out
that this operator is defined (by <code class="docutils literal notranslate"><span class="pre">TracedValue</span></code>) to execute a callback that
returns void and takes two integer values as parameters – an old value and a
new value for the integer in question. That is exactly the function signature
for the callback function we provided – <code class="docutils literal notranslate"><span class="pre">IntTrace</span></code>.</p>
<p>To summarize, a trace source is, in essence, a variable that holds a list of
callbacks. A trace sink is a function used as the target of a callback. The
Attribute and object type information systems are used to provide a way to
connect trace sources to trace sinks. The act of “hitting” a trace source is
executing an operator on the trace source which fires callbacks. This results in
the trace sink callbacks registering interest in the source being called with
the parameters provided by the source.</p>
</div>
<div class="section" id="using-the-config-subsystem-to-connect-to-trace-sources">
<h4>Using the Config Subsystem to Connect to Trace Sources<a class="headerlink" href="#using-the-config-subsystem-to-connect-to-trace-sources" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">TraceConnectWithoutContext</span></code> call shown above in the simple example is
actually very rarely used in the system. More typically, the <code class="docutils literal notranslate"><span class="pre">Config</span></code>
subsystem is used to allow selecting a trace source in the system using what is
called a <em>config path</em>.</p>
<p>For example, one might find something that looks like the following in the
system (taken from <code class="docutils literal notranslate"><span class="pre">examples/tcp-large-transfer.cc</span></code>):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">CwndTracer</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">oldval</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">newval</span><span class="p">)</span> <span class="p">{}</span>

<span class="p">...</span>

<span class="n">Config</span><span class="o">::</span><span class="n">ConnectWithoutContext</span> <span class="p">(</span>
  <span class="s">&quot;/NodeList/0/$ns3::TcpL4Protocol/SocketList/0/CongestionWindow&quot;</span><span class="p">,</span>
  <span class="n">MakeCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">CwndTracer</span><span class="p">));</span>
</pre></div>
</div>
<p>This should look very familiar. It is the same thing as the previous example,
except that a static member function of class <code class="docutils literal notranslate"><span class="pre">Config</span></code> is being called instead
of a method on <code class="docutils literal notranslate"><span class="pre">Object</span></code>; and instead of an <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> name, a path is being
provided.</p>
<p>The first thing to do is to read the path backward. The last segment of the path
must be an <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> of an <code class="docutils literal notranslate"><span class="pre">Object</span></code>. In fact, if you had a pointer to the
<code class="docutils literal notranslate"><span class="pre">Object</span></code> that has the “CongestionWindow” <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> handy (call it
<code class="docutils literal notranslate"><span class="pre">theObject</span></code>), you could write this just like the previous example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">CwndTracer</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="n">oldval</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">newval</span><span class="p">)</span> <span class="p">{}</span>

<span class="p">...</span>

<span class="n">theObject</span><span class="o">-&gt;</span><span class="n">TraceConnectWithoutContext</span> <span class="p">(</span><span class="s">&quot;CongestionWindow&quot;</span><span class="p">,</span> <span class="n">MakeCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">CwndTracer</span><span class="p">));</span>
</pre></div>
</div>
<p>It turns out that the code for <code class="docutils literal notranslate"><span class="pre">Config::ConnectWithoutContext</span></code> does exactly
that. This function takes a path that represents a chain of <code class="docutils literal notranslate"><span class="pre">Object</span></code> pointers
and follows them until it gets to the end of the path and interprets the last
segment as an <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> on the last object. Let’s walk through what
happens.</p>
<p>The leading “/” character in the path refers to a so-called namespace. One of the
predefined namespaces in the config system is “NodeList” which is a list of all of
the nodes in the simulation. Items in the list are referred to by indices into the
list, so “/NodeList/0” refers to the zeroth node in the list of nodes created by
the simulation. This node is actually a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Node&gt;</span></code> and so is a subclass of
an <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ns3::Object</span></code>.</p>
<p>As described in the <a class="reference internal" href="index.html#object-model"><span class="std std-ref">Object model</span></a> section, <em>ns-3</em> supports an object
aggregation model. The next path segment begins with the “$” character which
indicates a <code class="docutils literal notranslate"><span class="pre">GetObject</span></code> call should be made looking for the type that follows.
When a node is initialized by an <code class="docutils literal notranslate"><span class="pre">InternetStackHelper</span></code> a number of interfaces
are aggregated to the node. One of these is the TCP level four protocol. The
runtime type of this protocol object is <code class="docutils literal notranslate"><span class="pre">ns3::TcpL4Protocol''.</span> <span class="pre">When</span> <span class="pre">the</span>
<span class="pre">``GetObject</span></code> is executed, it returns a pointer to the object of this type.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TcpL4Protocol</span></code> class defines an Attribute called “SocketList” which is a
list of sockets.  Each socket is actually an <code class="docutils literal notranslate"><span class="pre">ns3::Object</span></code> with its own
<code class="docutils literal notranslate"><span class="pre">Attributes</span></code>.  The items in the list of sockets are referred to by index just
as in the NodeList, so “SocketList/0” refers to the zeroth socket in the list of
sockets on the zeroth node in the NodeList – the first node constructed in the
simulation.</p>
<p>This socket, the type of which turns out to be an <code class="docutils literal notranslate"><span class="pre">ns3::TcpSocketImpl</span></code> defines
an attribute called “CongestionWindow” which is a <code class="docutils literal notranslate"><span class="pre">TracedValue&lt;uint32_t&gt;</span></code>.
The <code class="docutils literal notranslate"><span class="pre">Config::ConnectWithoutContext</span></code> now does a,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">object</span><span class="o">-&gt;</span><span class="n">TraceConnectWithoutContext</span> <span class="p">(</span><span class="s">&quot;CongestionWindow&quot;</span><span class="p">,</span> <span class="n">MakeCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">CwndTracer</span><span class="p">));</span>
</pre></div>
</div>
<p>using the object pointer from “SocketList/0” which makes the connection between
the trace source defined in the socket to the callback – <code class="docutils literal notranslate"><span class="pre">CwndTracer</span></code>.</p>
<p>Now, whenever a change is made to the <code class="docutils literal notranslate"><span class="pre">TracedValue&lt;uint32_t&gt;</span></code> representing the
congestion window in the TCP socket, the registered callback will be executed
and the function <code class="docutils literal notranslate"><span class="pre">CwndTracer</span></code> will be called printing out the old and new
values of the TCP congestion window.</p>
</div>
</div>
<div class="section" id="using-the-tracing-api">
<h3>Using the Tracing API<a class="headerlink" href="#using-the-tracing-api" title="Permalink to this headline">¶</a></h3>
<p>There are three levels of interaction with the tracing system:</p>
<ul class="simple">
<li><p>Beginning user can easily control which objects are participating in tracing;</p></li>
<li><p>Intermediate users can extend the tracing system to modify the output format
generated or use existing trace sources in different ways, without modifying
the core of the simulator;</p></li>
<li><p>Advanced users can modify the simulator core to add new tracing sources and
sinks.</p></li>
</ul>
</div>
<div class="section" id="using-trace-helpers">
<h3>Using Trace Helpers<a class="headerlink" href="#using-trace-helpers" title="Permalink to this headline">¶</a></h3>
<p>The <em>ns-3</em> trace helpers provide a rich environment for configuring and selecting
different trace events and writing them to files. In previous sections,
primarily “Building Topologies,” we have seen several varieties of the trace
helper methods designed for use inside other (device) helpers.</p>
<p>Perhaps you will recall seeing some of these variations:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">pointToPoint</span><span class="p">.</span><span class="n">EnablePcapAll</span> <span class="p">(</span><span class="s">&quot;second&quot;</span><span class="p">);</span>
<span class="n">pointToPoint</span><span class="p">.</span><span class="n">EnablePcap</span> <span class="p">(</span><span class="s">&quot;second&quot;</span><span class="p">,</span> <span class="n">p2pNodes</span><span class="p">.</span><span class="n">Get</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetId</span> <span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">csma</span><span class="p">.</span><span class="n">EnablePcap</span> <span class="p">(</span><span class="s">&quot;third&quot;</span><span class="p">,</span> <span class="n">csmaDevices</span><span class="p">.</span><span class="n">Get</span> <span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nb">true</span><span class="p">);</span>
<span class="n">pointToPoint</span><span class="p">.</span><span class="n">EnableAsciiAll</span> <span class="p">(</span><span class="n">ascii</span><span class="p">.</span><span class="n">CreateFileStream</span> <span class="p">(</span><span class="s">&quot;myfirst.tr&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>What may not be obvious, though, is that there is a consistent model for all of
the trace-related methods found in the system. We will now take a little time
and take a look at the “big picture”.</p>
<p>There are currently two primary use cases of the tracing helpers in <em>ns-3</em>:
Device helpers and protocol helpers. Device helpers look at the problem of
specifying which traces should be enabled through a node, device pair.  For
example, you may want to specify that pcap tracing should be enabled on a
particular device on a specific node. This follows from the <em>ns-3</em> device
conceptual model, and also the conceptual models of the various device helpers.
Following naturally from this, the files created follow a
&lt;prefix&gt;-&lt;node&gt;-&lt;device&gt; naming convention.</p>
<p>Protocol helpers look at the problem of specifying which traces should be
enabled through a protocol and interface pair. This follows from the <em>ns-3</em>
protocol stack conceptual model, and also the conceptual models of internet
stack helpers. Naturally, the trace files should follow a
&lt;prefix&gt;-&lt;protocol&gt;-&lt;interface&gt; naming convention.</p>
<p>The trace helpers therefore fall naturally into a two-dimensional taxonomy.
There are subtleties that prevent all four classes from behaving identically,
but we do strive to make them all work as similarly as possible; and whenever
possible there are analogs for all methods in all classes.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 49%" />
<col style="width: 26%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>pcap</p></th>
<th class="head"><p>ascii</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Device Helper</p></td>
<td><p><img class="math" src="_images/math/eb43d5592546eaaff233c50b390d221dc5c75cd9.png" alt="\checkmark"/></p></td>
<td><p><img class="math" src="_images/math/eb43d5592546eaaff233c50b390d221dc5c75cd9.png" alt="\checkmark"/></p></td>
</tr>
<tr class="row-odd"><td><p>Protocol Helper</p></td>
<td><p><img class="math" src="_images/math/eb43d5592546eaaff233c50b390d221dc5c75cd9.png" alt="\checkmark"/></p></td>
<td><p><img class="math" src="_images/math/eb43d5592546eaaff233c50b390d221dc5c75cd9.png" alt="\checkmark"/></p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>We use an approach called a <code class="docutils literal notranslate"><span class="pre">mixin</span></code> to add tracing functionality to our helper
classes. A <code class="docutils literal notranslate"><span class="pre">mixin</span></code> is a class that provides functionality to that is
inherited by a subclass. Inheriting from a mixin is not considered a form of
specialization but is really a way to collect functionality.</p>
<p>Let’s take a quick look at all four of these cases and their respective
<code class="docutils literal notranslate"><span class="pre">mixins</span></code>.</p>
<div class="section" id="pcap-tracing-device-helpers">
<h4>Pcap Tracing Device Helpers<a class="headerlink" href="#pcap-tracing-device-helpers" title="Permalink to this headline">¶</a></h4>
<p>The goal of these helpers is to make it easy to add a consistent pcap trace
facility to an <em>ns-3</em> device. We want all of the various flavors of pcap tracing
to work the same across all devices, so the methods of these helpers are
inherited by device helpers. Take a look at <code class="docutils literal notranslate"><span class="pre">src/network/helper/trace-helper.h</span></code> if you
want to follow the discussion while looking at real code.</p>
<p>The class <code class="docutils literal notranslate"><span class="pre">PcapHelperForDevice</span></code> is a <code class="docutils literal notranslate"><span class="pre">mixin</span></code> provides the high level
functionality for using pcap tracing in an <em>ns-3</em> device. Every device must
implement a single virtual method inherited from this class.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">EnablePcapInternal</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">promiscuous</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>The signature of this method reflects the device-centric view of the situation
at this level. All of the public methods inherited from class
<code class="docutils literal notranslate"><span class="pre">PcapUserHelperForDevice</span></code> reduce to calling this single device-dependent
implementation method. For example, the lowest level pcap method,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">EnablePcap</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">explicitFilename</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
<p>will call the device implementation of <code class="docutils literal notranslate"><span class="pre">EnablePcapInternal</span></code> directly. All
other public pcap tracing methods build on this implementation to provide
additional user-level functionality. What this means to the user is that all
device helpers in the system will have all of the pcap trace methods available;
and these methods will all work in the same way across devices if the device
implements <code class="docutils literal notranslate"><span class="pre">EnablePcapInternal</span></code> correctly.</p>
<div class="section" id="pcap-tracing-device-helper-methods">
<h5>Pcap Tracing Device Helper Methods<a class="headerlink" href="#pcap-tracing-device-helper-methods" title="Permalink to this headline">¶</a></h5>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">EnablePcap</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">,</span>
                 <span class="kt">bool</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">explicitFilename</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcap</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ndName</span><span class="p">,</span>
                 <span class="kt">bool</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">explicitFilename</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcap</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">NetDeviceContainer</span> <span class="n">d</span><span class="p">,</span>
                 <span class="kt">bool</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcap</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">NodeContainer</span> <span class="n">n</span><span class="p">,</span>
                 <span class="kt">bool</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcap</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">deviceid</span><span class="p">,</span>
                 <span class="kt">bool</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcapAll</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
<p>In each of the methods shown above, there is a default parameter called
<code class="docutils literal notranslate"><span class="pre">promiscuous</span></code> that defaults to false. This parameter indicates that the trace
should not be gathered in promiscuous mode. If you do want your traces to
include all traffic seen by the device (and if the device supports a promiscuous
mode) simply add a true parameter to any of the calls above. For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcap</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">nd</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>will enable promiscuous mode captures on the <code class="docutils literal notranslate"><span class="pre">NetDevice</span></code> specified by <code class="docutils literal notranslate"><span class="pre">nd</span></code>.</p>
<p>The first two methods also include a default parameter called
<code class="docutils literal notranslate"><span class="pre">explicitFilename</span></code> that will be discussed below.</p>
<p>You are encouraged to peruse the Doxygen for class <code class="docutils literal notranslate"><span class="pre">PcapHelperForDevice</span></code> to
find the details of these methods; but to summarize …</p>
<p>You can enable pcap tracing on a particular node/net-device pair by providing a
<code class="docutils literal notranslate"><span class="pre">Ptr&lt;NetDevice&gt;</span></code> to an <code class="docutils literal notranslate"><span class="pre">EnablePcap</span></code> method. The <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Node&gt;</span></code> is implicit
since the net device must belong to exactly one <code class="docutils literal notranslate"><span class="pre">Node</span></code>. For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcap</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">nd</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable pcap tracing on a particular node/net-device pair by providing a
<code class="docutils literal notranslate"><span class="pre">std::string</span></code> representing an object name service string to an <code class="docutils literal notranslate"><span class="pre">EnablePcap</span></code>
method.  The <code class="docutils literal notranslate"><span class="pre">Ptr&lt;NetDevice&gt;</span></code> is looked up from the name string.  Again, the
<code class="docutils literal notranslate"><span class="pre">&lt;Node&gt;</span></code> is implicit since the named net device must belong to exactly one
<code class="docutils literal notranslate"><span class="pre">Node</span></code>.  For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;server&quot;</span> <span class="p">...);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;server/eth0&quot;</span> <span class="p">...);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcap</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="s">&quot;server/ath0&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable pcap tracing on a collection of node/net-device pairs by
providing a <code class="docutils literal notranslate"><span class="pre">NetDeviceContainer</span></code>. For each <code class="docutils literal notranslate"><span class="pre">NetDevice</span></code> in the container the
type is checked.  For each device of the proper type (the same type as is
managed by the device helper), tracing is enabled. Again, the <code class="docutils literal notranslate"><span class="pre">&lt;Node&gt;</span></code> is
implicit since the found net device must belong to exactly one <code class="docutils literal notranslate"><span class="pre">Node</span></code>. For
example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NetDeviceContainer</span> <span class="n">d</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcap</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable pcap tracing on a collection of node/net-device pairs by
providing a <code class="docutils literal notranslate"><span class="pre">NodeContainer</span></code>. For each <code class="docutils literal notranslate"><span class="pre">Node</span></code> in the <code class="docutils literal notranslate"><span class="pre">NodeContainer</span></code> its
attached <code class="docutils literal notranslate"><span class="pre">NetDevices</span></code> are iterated.  For each <code class="docutils literal notranslate"><span class="pre">NetDevice</span></code> attached to each
node in the container, the type of that device is checked.  For each device of
the proper type (the same type as is managed by the device helper), tracing is
enabled.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NodeContainer</span> <span class="n">n</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcap</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable pcap tracing on the basis of node ID and device ID as well as
with explicit <code class="docutils literal notranslate"><span class="pre">Ptr</span></code>. Each <code class="docutils literal notranslate"><span class="pre">Node</span></code> in the system has an integer node ID and
each device connected to a node has an integer device ID.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">helper</span><span class="p">.</span><span class="n">EnablePcap</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Finally, you can enable pcap tracing for all devices in the system, with the
same type as that managed by the device helper.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">helper</span><span class="p">.</span><span class="n">EnablePcapAll</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="pcap-tracing-device-helper-filename-selection">
<h5>Pcap Tracing Device Helper Filename Selection<a class="headerlink" href="#pcap-tracing-device-helper-filename-selection" title="Permalink to this headline">¶</a></h5>
<p>Implicit in the method descriptions above is the construction of a complete
filename by the implementation method. By convention, pcap traces in the <em>ns-3</em>
system are of the form <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;-&lt;node</span> <span class="pre">id&gt;-&lt;device</span> <span class="pre">id&gt;.pcap</span></code></p>
<p>As previously mentioned, every node in the system will have a system-assigned
node id; and every device will have an interface index (also called a device id)
relative to its node. By default, then, a pcap trace file created as a result
of enabling tracing on the first device of node 21 using the prefix “prefix”
would be <code class="docutils literal notranslate"><span class="pre">prefix-21-1.pcap</span></code>.</p>
<p>You can always use the <em>ns-3</em> object name service to make this more clear.  For
example, if you use the object name service to assign the name “server” to node
21, the resulting pcap trace file name will automatically become,
<code class="docutils literal notranslate"><span class="pre">prefix-server-1.pcap</span></code> and if you also assign the name “eth0” to the device,
your pcap file name will automatically pick this up and be called
<code class="docutils literal notranslate"><span class="pre">prefix-server-eth0.pcap</span></code>.</p>
<p>Finally, two of the methods shown above,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">EnablePcap</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">explicitFilename</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcap</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ndName</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">explicitFilename</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
</pre></div>
</div>
<p>have a default parameter called <code class="docutils literal notranslate"><span class="pre">explicitFilename</span></code>. When set to true, this
parameter disables the automatic filename completion mechanism and allows you to
create an explicit filename. This option is only available in the methods which
enable pcap tracing on a single device.</p>
<p>For example, in order to arrange for a device helper to create a single
promiscuous pcap capture file of a specific name (<code class="docutils literal notranslate"><span class="pre">my-pcap-file.pcap</span></code>) on a
given device, one could:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcap</span> <span class="p">(</span><span class="s">&quot;my-pcap-file.pcap&quot;</span><span class="p">,</span> <span class="n">nd</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
</pre></div>
</div>
<p>The first <code class="docutils literal notranslate"><span class="pre">true</span></code> parameter enables promiscuous mode traces and the second
tells the helper to interpret the <code class="docutils literal notranslate"><span class="pre">prefix</span></code> parameter as a complete filename.</p>
</div>
</div>
<div class="section" id="ascii-tracing-device-helpers">
<h4>Ascii Tracing Device Helpers<a class="headerlink" href="#ascii-tracing-device-helpers" title="Permalink to this headline">¶</a></h4>
<p>The behavior of the ASCII trace helper <code class="docutils literal notranslate"><span class="pre">mixin</span></code> is substantially similar to
the pcap version. Take a look at <code class="docutils literal notranslate"><span class="pre">src/network/helper/trace-helper.h</span></code> if you want to
follow the discussion while looking at real code.</p>
<p>The class <code class="docutils literal notranslate"><span class="pre">AsciiTraceHelperForDevice</span></code> adds the high level functionality for
using ASCII tracing to a device helper class. As in the pcap case, every device
must implement a single virtual method inherited from the ASCII trace
<code class="docutils literal notranslate"><span class="pre">mixin</span></code>.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">EnableAsciiInternal</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>The signature of this method reflects the device-centric view of the situation
at this level; and also the fact that the helper may be writing to a shared
output stream. All of the public ASCII-trace-related methods inherited from
class <code class="docutils literal notranslate"><span class="pre">AsciiTraceHelperForDevice</span></code> reduce to calling this single device-
dependent implementation method. For example, the lowest level ASCII trace
methods,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">);</span>
</pre></div>
</div>
<p>will call the device implementation of <code class="docutils literal notranslate"><span class="pre">EnableAsciiInternal</span></code> directly,
providing either a valid prefix or stream.  All other public ASCII tracing
methods will build on these low-level functions to provide additional user-level
functionality. What this means to the user is that all device helpers in the
system will have all of the ASCII trace methods available; and these methods
will all work in the same way across devices if the devices implement
<code class="docutils literal notranslate"><span class="pre">EnablAsciiInternal</span></code> correctly.</p>
<div class="section" id="ascii-tracing-device-helper-methods">
<h5>Ascii Tracing Device Helper Methods<a class="headerlink" href="#ascii-tracing-device-helper-methods" title="Permalink to this headline">¶</a></h5>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ndName</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ndName</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">NetDeviceContainer</span> <span class="n">d</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">NetDeviceContainer</span> <span class="n">d</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">NodeContainer</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">NodeContainer</span> <span class="n">n</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">deviceid</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAscii</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">deviceid</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAsciiAll</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAsciiAll</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">);</span>
</pre></div>
</div>
<p>You are encouraged to peruse the Doxygen for class <code class="docutils literal notranslate"><span class="pre">TraceHelperForDevice</span></code> to
find the details of these methods; but to summarize …</p>
<p>There are twice as many methods available for ASCII tracing as there were for
pcap tracing. This is because, in addition to the pcap-style model where traces
from each unique node/device pair are written to a unique file, we support a
model in which trace information for many node/device pairs is written to a
common file.  This means that the &lt;prefix&gt;-&lt;node&gt;-&lt;device&gt; file name generation
mechanism is replaced by a mechanism to refer to a common file; and the number
of API methods is doubled to allow all combinations.</p>
<p>Just as in pcap tracing, you can enable ASCII tracing on a particular
node/net-device pair by providing a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;NetDevice&gt;</span></code> to an <code class="docutils literal notranslate"><span class="pre">EnableAscii</span></code>
method. The <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Node&gt;</span></code> is implicit since the net device must belong to
exactly one <code class="docutils literal notranslate"><span class="pre">Node</span></code>. For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">nd</span><span class="p">);</span>
</pre></div>
</div>
<p>In this case, no trace contexts are written to the ASCII trace file since they
would be redundant. The system will pick the file name to be created using the
same rules as described in the pcap section, except that the file will have the
suffix “.tr” instead of “.pcap”.</p>
<p>If you want to enable ASCII tracing on more than one net device and have all
traces sent to a single file, you can do that as well by using an object to
refer to a single file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd1</span><span class="p">;</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">NetDevice</span><span class="o">&gt;</span> <span class="n">nd2</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">asciiTraceHelper</span><span class="p">.</span><span class="n">CreateFileStream</span> <span class="p">(</span><span class="s">&quot;trace-file-name.tr&quot;</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">nd1</span><span class="p">);</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">nd2</span><span class="p">);</span>
</pre></div>
</div>
<p>In this case, trace contexts are written to the ASCII trace file since they
are required to disambiguate traces from the two devices.  Note that since the
user is completely specifying the file name, the string should include the “.tr”
for consistency.</p>
<p>You can enable ASCII tracing on a particular node/net-device pair by providing a
<code class="docutils literal notranslate"><span class="pre">std::string</span></code> representing an object name service string to an
<code class="docutils literal notranslate"><span class="pre">EnablePcap</span></code> method.  The <code class="docutils literal notranslate"><span class="pre">Ptr&lt;NetDevice&gt;</span></code> is looked up from the name
string.  Again, the <code class="docutils literal notranslate"><span class="pre">&lt;Node&gt;</span></code> is implicit since the named net device must
belong to exactly one <code class="docutils literal notranslate"><span class="pre">Node</span></code>.  For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;client&quot;</span> <span class="p">...);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;client/eth0&quot;</span> <span class="p">...);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;server&quot;</span> <span class="p">...);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;server/eth0&quot;</span> <span class="p">...);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="s">&quot;client/eth0&quot;</span><span class="p">);</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="s">&quot;server/eth0&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in two files named <code class="docutils literal notranslate"><span class="pre">prefix-client-eth0.tr</span></code> and
<code class="docutils literal notranslate"><span class="pre">prefix-server-eth0.tr</span></code> with traces for each device in the respective trace
file. Since all of the EnableAscii functions are overloaded to take a stream
wrapper, you can use that form as well:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;client&quot;</span> <span class="p">...);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;client/eth0&quot;</span> <span class="p">...);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;server&quot;</span> <span class="p">...);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;server/eth0&quot;</span> <span class="p">...);</span>
<span class="p">...</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">asciiTraceHelper</span><span class="p">.</span><span class="n">CreateFileStream</span> <span class="p">(</span><span class="s">&quot;trace-file-name.tr&quot;</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s">&quot;client/eth0&quot;</span><span class="p">);</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s">&quot;server/eth0&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in a single trace file called <code class="docutils literal notranslate"><span class="pre">trace-file-name.tr</span></code> that
contains all of the trace events for both devices. The events would be
disambiguated by trace context strings.</p>
<p>You can enable ASCII tracing on a collection of node/net-device pairs by
providing a <code class="docutils literal notranslate"><span class="pre">NetDeviceContainer</span></code>. For each <code class="docutils literal notranslate"><span class="pre">NetDevice</span></code> in the container the
type is checked. For each device of the proper type (the same type as is managed
by the device helper), tracing is enabled. Again, the <code class="docutils literal notranslate"><span class="pre">&lt;Node&gt;</span></code> is implicit
since the found net device must belong to exactly one <code class="docutils literal notranslate"><span class="pre">Node</span></code>.  For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NetDeviceContainer</span> <span class="n">d</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in a number of ASCII trace files being created, each of which
follows the &lt;prefix&gt;-&lt;node id&gt;-&lt;device id&gt;.tr convention. Combining all of the
traces into a single file is accomplished similarly to the examples above:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NetDeviceContainer</span> <span class="n">d</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">...</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">asciiTraceHelper</span><span class="p">.</span><span class="n">CreateFileStream</span> <span class="p">(</span><span class="s">&quot;trace-file-name.tr&quot;</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable ascii tracing on a collection of node/net-device pairs by
providing a <code class="docutils literal notranslate"><span class="pre">NodeContainer</span></code>. For each <code class="docutils literal notranslate"><span class="pre">Node</span></code> in the <code class="docutils literal notranslate"><span class="pre">NodeContainer</span></code> its
attached <code class="docutils literal notranslate"><span class="pre">NetDevices</span></code> are iterated.  For each <code class="docutils literal notranslate"><span class="pre">NetDevice</span></code> attached to each
node in the container, the type of that device is checked.  For each device of
the proper type (the same type as is managed by the device helper), tracing is
enabled.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NodeContainer</span> <span class="n">n</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in a number of ASCII trace files being created, each of which
follows the &lt;prefix&gt;-&lt;node id&gt;-&lt;device id&gt;.tr convention. Combining all of the
traces into a single file is accomplished similarly to the examples above:</p>
<p>You can enable pcap tracing on the basis of node ID and device ID as well as
with explicit <code class="docutils literal notranslate"><span class="pre">Ptr</span></code>. Each <code class="docutils literal notranslate"><span class="pre">Node</span></code> in the system has an integer node ID and
each device connected to a node has an integer device ID.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">helper</span><span class="p">.</span><span class="n">EnableAscii</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Of course, the traces can be combined into a single file as shown above.</p>
<p>Finally, you can enable pcap tracing for all devices in the system, with the
same type as that managed by the device helper.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiAll</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in a number of ASCII trace files being created, one for
every device in the system of the type managed by the helper. All of these
files will follow the &lt;prefix&gt;-&lt;node id&gt;-&lt;device id&gt;.tr convention. Combining
all of the traces into a single file is accomplished similarly to the examples
above.</p>
</div>
<div class="section" id="ascii-tracing-device-helper-filename-selection">
<h5>Ascii Tracing Device Helper Filename Selection<a class="headerlink" href="#ascii-tracing-device-helper-filename-selection" title="Permalink to this headline">¶</a></h5>
<p>Implicit in the prefix-style method descriptions above is the construction of
the complete filenames by the implementation method. By convention, ASCII traces
in the <em>ns-3</em> system are of the form <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;-&lt;node</span> <span class="pre">id&gt;-&lt;device</span> <span class="pre">id&gt;.tr</span></code>.</p>
<p>As previously mentioned, every node in the system will have a system-assigned
node id; and every device will have an interface index (also called a device id)
relative to its node.  By default, then, an ASCII trace file created as a result
of enabling tracing on the first device of node 21, using the prefix “prefix”,
would be <code class="docutils literal notranslate"><span class="pre">prefix-21-1.tr</span></code>.</p>
<p>You can always use the <em>ns-3</em> object name service to make this more clear.  For
example, if you use the object name service to assign the name “server” to node
21, the resulting ASCII trace file name will automatically become,
<code class="docutils literal notranslate"><span class="pre">prefix-server-1.tr</span></code> and if you also assign the name “eth0” to the device,
your ASCII trace file name will automatically pick this up and be called
<code class="docutils literal notranslate"><span class="pre">prefix-server-eth0.tr</span></code>.</p>
</div>
</div>
<div class="section" id="pcap-tracing-protocol-helpers">
<h4>Pcap Tracing Protocol Helpers<a class="headerlink" href="#pcap-tracing-protocol-helpers" title="Permalink to this headline">¶</a></h4>
<p>The goal of these <code class="docutils literal notranslate"><span class="pre">mixins</span></code> is to make it easy to add a consistent pcap trace
facility to protocols. We want all of the various flavors of pcap tracing to
work the same across all protocols, so the methods of these helpers are
inherited by stack helpers. Take a look at <code class="docutils literal notranslate"><span class="pre">src/network/helper/trace-helper.h</span></code> if you
want to follow the discussion while looking at real code.</p>
<p>In this section we will be illustrating the methods as applied to the protocol
<code class="docutils literal notranslate"><span class="pre">Ipv4</span></code>.  To specify traces in similar protocols, just substitute the
appropriate type.  For example, use a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Ipv6&gt;</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Ipv4&gt;</span></code>
and call <code class="docutils literal notranslate"><span class="pre">EnablePcapIpv6</span></code> instead of <code class="docutils literal notranslate"><span class="pre">EnablePcapIpv4</span></code>.</p>
<p>The class <code class="docutils literal notranslate"><span class="pre">PcapHelperForIpv4</span></code> provides the high level functionality for using
pcap tracing in the <code class="docutils literal notranslate"><span class="pre">Ipv4</span></code> protocol.  Each protocol helper enabling these
methods must implement a single virtual method inherited from this class.  There
will be a separate implementation for <code class="docutils literal notranslate"><span class="pre">Ipv6</span></code>, for example, but the only
difference will be in the method names and signatures.  Different method names
are required to disambiguate class <code class="docutils literal notranslate"><span class="pre">Ipv4</span></code> from <code class="docutils literal notranslate"><span class="pre">Ipv6</span></code> which are both derived
from class <code class="docutils literal notranslate"><span class="pre">Object</span></code>, and methods that share the same signature.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">EnablePcapIpv4Internal</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>The signature of this method reflects the protocol and interface-centric view of
the situation at this level. All of the public methods inherited from class
<code class="docutils literal notranslate"><span class="pre">PcapHelperForIpv4</span></code> reduce to calling this single device-dependent
implementation method.  For example, the lowest level pcap method,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">EnablePcapIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>
</pre></div>
</div>
<p>will call the device implementation of <code class="docutils literal notranslate"><span class="pre">EnablePcapIpv4Internal</span></code> directly.  All
other public pcap tracing methods build on this implementation to provide
additional user-level functionality. What this means to the user is that all
protocol helpers in the system will have all of the pcap trace methods
available; and these methods will all work in the same way across protocols if
the helper implements <code class="docutils literal notranslate"><span class="pre">EnablePcapIpv4Internal</span></code> correctly.</p>
<div class="section" id="pcap-tracing-protocol-helper-methods">
<h5>Pcap Tracing Protocol Helper Methods<a class="headerlink" href="#pcap-tracing-protocol-helper-methods" title="Permalink to this headline">¶</a></h5>
<p>These methods are designed to be in one-to-one correspondence with the <code class="docutils literal notranslate"><span class="pre">Node</span></code>-
and <code class="docutils literal notranslate"><span class="pre">NetDevice</span></code>- centric versions of the device versions. Instead of
<code class="docutils literal notranslate"><span class="pre">Node</span></code> and <code class="docutils literal notranslate"><span class="pre">NetDevice</span></code> pair constraints, we use protocol and interface
constraints.</p>
<p>Note that just like in the device version, there are six methods:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">EnablePcapIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcapIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ipv4Name</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcapIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ipv4InterfaceContainer</span> <span class="n">c</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcapIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">NodeContainer</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcapIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnablePcapIpv4All</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">);</span>
</pre></div>
</div>
<p>You are encouraged to peruse the Doxygen for class <code class="docutils literal notranslate"><span class="pre">PcapHelperForIpv4</span></code> to find
the details of these methods; but to summarize …</p>
<p>You can enable pcap tracing on a particular protocol/interface pair by providing
a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Ipv4&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">interface</span></code> to an <code class="docutils literal notranslate"><span class="pre">EnablePcap</span></code> method.  For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span> <span class="o">=</span> <span class="n">node</span><span class="o">-&gt;</span><span class="n">GetObject</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcapIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">ipv4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable pcap tracing on a particular node/net-device pair by providing a
<code class="docutils literal notranslate"><span class="pre">std::string</span></code> representing an object name service string to an <code class="docutils literal notranslate"><span class="pre">EnablePcap</span></code>
method.  The <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Ipv4&gt;</span></code> is looked up from the name string.  For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;serverIPv4&quot;</span> <span class="p">...);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcapIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="s">&quot;serverIpv4&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable pcap tracing on a collection of protocol/interface pairs by
providing an <code class="docutils literal notranslate"><span class="pre">Ipv4InterfaceContainer</span></code>. For each <code class="docutils literal notranslate"><span class="pre">Ipv4</span></code> / interface pair in
the container the protocol type is checked. For each protocol of the proper type
(the same type as is managed by the device helper), tracing is enabled for the
corresponding interface.  For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NodeContainer</span> <span class="n">nodes</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">NetDeviceContainer</span> <span class="n">devices</span> <span class="o">=</span> <span class="n">deviceHelper</span><span class="p">.</span><span class="n">Install</span> <span class="p">(</span><span class="n">nodes</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">Ipv4AddressHelper</span> <span class="n">ipv4</span><span class="p">;</span>
<span class="n">ipv4</span><span class="p">.</span><span class="n">SetBase</span> <span class="p">(</span><span class="s">&quot;10.1.1.0&quot;</span><span class="p">,</span> <span class="s">&quot;255.255.255.0&quot;</span><span class="p">);</span>
<span class="n">Ipv4InterfaceContainer</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="n">ipv4</span><span class="p">.</span><span class="n">Assign</span> <span class="p">(</span><span class="n">devices</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcapIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable pcap tracing on a collection of protocol/interface pairs by
providing a <code class="docutils literal notranslate"><span class="pre">NodeContainer</span></code>. For each <code class="docutils literal notranslate"><span class="pre">Node</span></code> in the <code class="docutils literal notranslate"><span class="pre">NodeContainer</span></code> the
appropriate protocol is found. For each protocol, its interfaces are enumerated
and tracing is enabled on the resulting pairs. For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NodeContainer</span> <span class="n">n</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnablePcapIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable pcap tracing on the basis of node ID and interface as well. In
this case, the node-id is translated to a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Node&gt;</span></code> and the appropriate
protocol is looked up in the node. The resulting protocol and interface are used
to specify the resulting trace source.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">helper</span><span class="p">.</span><span class="n">EnablePcapIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Finally, you can enable pcap tracing for all interfaces in the system, with
associated protocol being the same type as that managed by the device helper.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">helper</span><span class="p">.</span><span class="n">EnablePcapIpv4All</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="pcap-tracing-protocol-helper-filename-selection">
<h5>Pcap Tracing Protocol Helper Filename Selection<a class="headerlink" href="#pcap-tracing-protocol-helper-filename-selection" title="Permalink to this headline">¶</a></h5>
<p>Implicit in all of the method descriptions above is the construction of the
complete filenames by the implementation method. By convention, pcap traces
taken for devices in the <em>ns-3</em> system are of the form <code class="docutils literal notranslate"><span class="pre">&lt;prefix&gt;-&lt;node</span>
<span class="pre">id&gt;-&lt;device</span> <span class="pre">id&gt;.pcap</span></code>. In the case of protocol traces, there is a one-to-one
correspondence between protocols and <code class="docutils literal notranslate"><span class="pre">Nodes</span></code>. This is because protocol
<code class="docutils literal notranslate"><span class="pre">Objects</span></code> are aggregated to <code class="docutils literal notranslate"><span class="pre">Node</span> <span class="pre">Objects</span></code>. Since there is no global
protocol id in the system, we use the corresponding node id in file naming.
Therefore there is a possibility for file name collisions in automatically
chosen trace file names. For this reason, the file name convention is changed
for protocol traces.</p>
<p>As previously mentioned, every node in the system will have a system-assigned
node id. Since there is a one-to-one correspondence between protocol instances
and node instances we use the node id. Each interface has an interface id
relative to its protocol. We use the convention “&lt;prefix&gt;-n&lt;node id&gt;-i&lt;interface
id&gt;.pcap” for trace file naming in protocol helpers.</p>
<p>Therefore, by default, a pcap trace file created as a result of enabling tracing
on interface 1 of the Ipv4 protocol of node 21 using the prefix “prefix”
would be “prefix-n21-i1.pcap”.</p>
<p>You can always use the <em>ns-3</em> object name service to make this more clear.
For example, if you use the object name service to assign the name “serverIpv4”
to the Ptr&lt;Ipv4&gt; on node 21, the resulting pcap trace file name will
automatically become, “prefix-nserverIpv4-i1.pcap”.</p>
</div>
</div>
<div class="section" id="ascii-tracing-protocol-helpers">
<h4>Ascii Tracing Protocol Helpers<a class="headerlink" href="#ascii-tracing-protocol-helpers" title="Permalink to this headline">¶</a></h4>
<p>The behavior of the ASCII trace helpers is substantially similar to the pcap
case.  Take a look at <code class="docutils literal notranslate"><span class="pre">src/network/helper/trace-helper.h</span></code> if you want to follow the
discussion while looking at real code.</p>
<p>In this section we will be illustrating the methods as applied to the protocol
<code class="docutils literal notranslate"><span class="pre">Ipv4</span></code>. To specify traces in similar protocols, just substitute the
appropriate type. For example, use a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Ipv6&gt;</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Ipv4&gt;</span></code>
and call <code class="docutils literal notranslate"><span class="pre">EnableAsciiIpv6</span></code> instead of <code class="docutils literal notranslate"><span class="pre">EnableAsciiIpv4</span></code>.</p>
<p>The class <code class="docutils literal notranslate"><span class="pre">AsciiTraceHelperForIpv4</span></code> adds the high level functionality for
using ASCII tracing to a protocol helper. Each protocol that enables these
methods must implement a single virtual method inherited from this class.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">EnableAsciiIpv4Internal</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span>
                                      <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre></div>
</div>
<p>The signature of this method reflects the protocol- and interface-centric view
of the situation at this level; and also the fact that the helper may be writing
to a shared output stream.  All of the public methods inherited from class
<code class="docutils literal notranslate"><span class="pre">PcapAndAsciiTraceHelperForIpv4</span></code> reduce to calling this single device-
dependent implementation method. For example, the lowest level ascii trace
methods,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>
</pre></div>
</div>
<p>will call the device implementation of <code class="docutils literal notranslate"><span class="pre">EnableAsciiIpv4Internal</span></code> directly,
providing either the prefix or the stream. All other public ascii tracing
methods will build on these low-level functions to provide additional user-level
functionality. What this means to the user is that all device helpers in the
system will have all of the ascii trace methods available; and these methods
will all work in the same way across protocols if the protocols implement
<code class="docutils literal notranslate"><span class="pre">EnablAsciiIpv4Internal</span></code> correctly.</p>
<div class="section" id="id1">
<h5>Ascii Tracing Device Helper Methods<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ipv4Name</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ipv4Name</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">Ipv4InterfaceContainer</span> <span class="n">c</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">Ipv4InterfaceContainer</span> <span class="n">c</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">NodeContainer</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="n">NodeContainer</span> <span class="n">n</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">deviceid</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">nodeid</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">EnableAsciiIpv4All</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">EnableAsciiIpv4All</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span><span class="p">);</span>
</pre></div>
</div>
<p>You are encouraged to peruse the Doxygen for class <code class="docutils literal notranslate"><span class="pre">PcapAndAsciiHelperForIpv4</span></code>
to find the details of these methods; but to summarize …</p>
<p>There are twice as many methods available for ASCII tracing as there were for
pcap tracing. This is because, in addition to the pcap-style model where traces
from each unique protocol/interface pair are written to a unique file, we
support a model in which trace information for many protocol/interface pairs is
written to a common file. This means that the &lt;prefix&gt;-n&lt;node id&gt;-&lt;interface&gt;
file name generation mechanism is replaced by a mechanism to refer to a common
file; and the number of API methods is doubled to allow all combinations.</p>
<p>Just as in pcap tracing, you can enable ASCII tracing on a particular
protocol/interface pair by providing a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Ipv4&gt;</span></code> and an <code class="docutils literal notranslate"><span class="pre">interface</span></code> to an
<code class="docutils literal notranslate"><span class="pre">EnableAscii</span></code> method.  For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">ipv4</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>In this case, no trace contexts are written to the ASCII trace file since they
would be redundant. The system will pick the file name to be created using the
same rules as described in the pcap section, except that the file will have the
suffix “.tr” instead of “.pcap”.</p>
<p>If you want to enable ASCII tracing on more than one interface and have all
traces sent to a single file, you can do that as well by using an object to
refer to a single file. We have already something similar to this in the “cwnd”
example above:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">protocol1</span> <span class="o">=</span> <span class="n">node1</span><span class="o">-&gt;</span><span class="n">GetObject</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">protocol2</span> <span class="o">=</span> <span class="n">node2</span><span class="o">-&gt;</span><span class="n">GetObject</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="p">...</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">asciiTraceHelper</span><span class="p">.</span><span class="n">CreateFileStream</span> <span class="p">(</span><span class="s">&quot;trace-file-name.tr&quot;</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">protocol1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">protocol2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>In this case, trace contexts are written to the ASCII trace file since they are
required to disambiguate traces from the two interfaces. Note that since the
user is completely specifying the file name, the string should include the “.tr”
for consistency.</p>
<p>You can enable ASCII tracing on a particular protocol by providing a
<code class="docutils literal notranslate"><span class="pre">std::string</span></code> representing an object name service string to an <code class="docutils literal notranslate"><span class="pre">EnablePcap</span></code>
method.  The <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Ipv4&gt;</span></code> is looked up from the name string.  The <code class="docutils literal notranslate"><span class="pre">&lt;Node&gt;</span></code> in
the resulting filenames is implicit since there is a one-to-one correspondence
between protocol instances and nodes, For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;node1Ipv4&quot;</span> <span class="p">...);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;node2Ipv4&quot;</span> <span class="p">...);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="s">&quot;node1Ipv4&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="s">&quot;node2Ipv4&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in two files named “prefix-nnode1Ipv4-i1.tr” and
“prefix-nnode2Ipv4-i1.tr” with traces for each interface in the respective
trace file. Since all of the EnableAscii functions are overloaded to take a
stream wrapper, you can use that form as well:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;node1Ipv4&quot;</span> <span class="p">...);</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;node2Ipv4&quot;</span> <span class="p">...);</span>
<span class="p">...</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">asciiTraceHelper</span><span class="p">.</span><span class="n">CreateFileStream</span> <span class="p">(</span><span class="s">&quot;trace-file-name.tr&quot;</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s">&quot;node1Ipv4&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="s">&quot;node2Ipv4&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in a single trace file called “trace-file-name.tr” that
contains all of the trace events for both interfaces. The events would be
disambiguated by trace context strings.</p>
<p>You can enable ASCII tracing on a collection of protocol/interface pairs by
providing an <code class="docutils literal notranslate"><span class="pre">Ipv4InterfaceContainer</span></code>. For each protocol of the proper type
(the same type as is managed by the device helper), tracing is enabled for the
corresponding interface.  Again, the <code class="docutils literal notranslate"><span class="pre">&lt;Node&gt;</span></code> is implicit since there is a
one-to-one correspondence between each protocol and its node. For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NodeContainer</span> <span class="n">nodes</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">NetDeviceContainer</span> <span class="n">devices</span> <span class="o">=</span> <span class="n">deviceHelper</span><span class="p">.</span><span class="n">Install</span> <span class="p">(</span><span class="n">nodes</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">Ipv4AddressHelper</span> <span class="n">ipv4</span><span class="p">;</span>
<span class="n">ipv4</span><span class="p">.</span><span class="n">SetBase</span> <span class="p">(</span><span class="s">&quot;10.1.1.0&quot;</span><span class="p">,</span> <span class="s">&quot;255.255.255.0&quot;</span><span class="p">);</span>
<span class="n">Ipv4InterfaceContainer</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="n">ipv4</span><span class="p">.</span><span class="n">Assign</span> <span class="p">(</span><span class="n">devices</span><span class="p">);</span>
<span class="p">...</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in a number of ASCII trace files being created, each of which
follows the &lt;prefix&gt;-n&lt;node id&gt;-i&lt;interface&gt;.tr convention. Combining all of the
traces into a single file is accomplished similarly to the examples above:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NodeContainer</span> <span class="n">nodes</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">NetDeviceContainer</span> <span class="n">devices</span> <span class="o">=</span> <span class="n">deviceHelper</span><span class="p">.</span><span class="n">Install</span> <span class="p">(</span><span class="n">nodes</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">Ipv4AddressHelper</span> <span class="n">ipv4</span><span class="p">;</span>
<span class="n">ipv4</span><span class="p">.</span><span class="n">SetBase</span> <span class="p">(</span><span class="s">&quot;10.1.1.0&quot;</span><span class="p">,</span> <span class="s">&quot;255.255.255.0&quot;</span><span class="p">);</span>
<span class="n">Ipv4InterfaceContainer</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="n">ipv4</span><span class="p">.</span><span class="n">Assign</span> <span class="p">(</span><span class="n">devices</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">OutputStreamWrapper</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">asciiTraceHelper</span><span class="p">.</span><span class="n">CreateFileStream</span> <span class="p">(</span><span class="s">&quot;trace-file-name.tr&quot;</span><span class="p">);</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">);</span>
</pre></div>
</div>
<p>You can enable ASCII tracing on a collection of protocol/interface pairs by
providing a <code class="docutils literal notranslate"><span class="pre">NodeContainer</span></code>. For each <code class="docutils literal notranslate"><span class="pre">Node</span></code> in the <code class="docutils literal notranslate"><span class="pre">NodeContainer</span></code> the
appropriate protocol is found.  For each protocol, its interfaces are enumerated
and tracing is enabled on the resulting pairs. For example,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NodeContainer</span> <span class="n">n</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in a number of ASCII trace files being created, each of which
follows the &lt;prefix&gt;-&lt;node id&gt;-&lt;device id&gt;.tr convention. Combining all of the
traces into a single file is accomplished similarly to the examples above:</p>
<p>You can enable pcap tracing on the basis of node ID and device ID as well. In
this case, the node-id is translated to a <code class="docutils literal notranslate"><span class="pre">Ptr&lt;Node&gt;</span></code> and the appropriate
protocol is looked up in the node.  The resulting protocol and interface are
used to specify the resulting trace source.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>Of course, the traces can be combined into a single file as shown above.</p>
<p>Finally, you can enable ASCII tracing for all interfaces in the system, with
associated protocol being the same type as that managed by the device helper.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">helper</span><span class="p">.</span><span class="n">EnableAsciiIpv4All</span> <span class="p">(</span><span class="s">&quot;prefix&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>This would result in a number of ASCII trace files being created, one for
every interface in the system related to a protocol of the type managed by the
helper. All of these files will follow the &lt;prefix&gt;-n&lt;node id&gt;-i&lt;interface.tr
convention. Combining all of the traces into a single file is accomplished
similarly to the examples above.</p>
</div>
<div class="section" id="id2">
<h5>Ascii Tracing Device Helper Filename Selection<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<p>Implicit in the prefix-style method descriptions above is the construction of
the complete filenames by the implementation method. By convention, ASCII traces
in the <em>ns-3</em> system are of the form “&lt;prefix&gt;-&lt;node id&gt;-&lt;device id&gt;.tr.”</p>
<p>As previously mentioned, every node in the system will have a system-assigned
node id. Since there is a one-to-one correspondence between protocols and nodes
we use to node-id to identify the protocol identity. Every interface on a given
protocol will have an interface index (also called simply an interface) relative
to its protocol. By default, then, an ASCII trace file created as a result of
enabling tracing on the first device of node 21, using the prefix “prefix”,
would be “prefix-n21-i1.tr”. Use the prefix to disambiguate multiple protocols
per node.</p>
<p>You can always use the <em>ns-3</em> object name service to make this more clear.
For example, if you use the object name service to assign the name “serverIpv4”
to the protocol on node 21, and also specify interface one, the resulting ASCII
trace file name will automatically become, “prefix-nserverIpv4-1.tr”.</p>
</div>
</div>
</div>
<div class="section" id="tracing-implementation-details">
<h3>Tracing implementation details<a class="headerlink" href="#tracing-implementation-details" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<span id="document-data-collection"></span><div class="section" id="data-collection">
<h2>Data Collection<a class="headerlink" href="#data-collection" title="Permalink to this headline">¶</a></h2>
<p>This chapter describes the ns-3 Data Collection Framework (DCF), which
provides capabilities to obtain data generated by models in the simulator,
to perform on-line reduction and data processing, and to marshal raw
or transformed data into various output formats.</p>
<p>The framework presently supports standalone ns-3 runs that don’t rely on
any external program execution control.  The objects provided by the
DCF may be hooked to <em>ns-3</em> trace sources to enable data processing.</p>
<p>The source code for the classes lives in the directory <code class="docutils literal notranslate"><span class="pre">src/stats</span></code>.</p>
<p>This chapter is organized as follows.  First, an overview of the architecture
is presented.  Next, the helpers for these classes are presented; this
initial treatment should allow basic use of the data collection framework
for many use cases.  Users who wish to produce output outside of the
scope of the current helpers, or who wish to create their own data
collection objects, should read the remainder of the chapter, which
goes into detail about all of the basic DCF object types and provides
low-level coding examples.</p>
<div class="toctree-wrapper compound">
<span id="document-data-collection-overview"></span><div class="section" id="design">
<h3>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h3>
<p>The DCF consists of three basic classes:</p>
<ul class="simple">
<li><p><em>Probe</em> is a mechanism to instrument and control the output of
simulation data that is used to monitor interesting events. It
produces output in the form of one or more <em>ns-3</em> trace sources.
Probe objects are hooked up to one or more trace <em>sinks</em> (called
<em>Collectors</em>), which process samples on-line and prepare them for
output.</p></li>
<li><p><em>Collector</em> consumes the data generated by one or more Probe objects.
It performs transformations on the data, such as normalization, reduction, and
the computation of basic statistics. Collector objects do not produce
data that is directly output by the ns-3 run; instead, they output data
downstream to another type of object, called <em>Aggregator</em>, which performs
that function.  Typically, Collectors output their data in the form of
trace sources as well, allowing collectors to be chained in series.</p></li>
<li><p><em>Aggregator</em> is the end point of the data collected by a network of Probes and Collectors.
The main responsibility of the Aggregator is to marshal data and their
corresponding metadata, into different output
formats such as plain text files, spreadsheet files, or databases.</p></li>
</ul>
<p>All three of these classes provide the capability to dynamically turn themselves on or off throughout a simulation.</p>
<p>Any standalone <em>ns-3</em> simulation run that uses the DCF will typically create
at least one instance of each of the three classes above.</p>
<div class="figure align-default" id="id1">
<span id="dcf-overview"></span><img alt="_images/dcf-overview.png" src="_images/dcf-overview.png" />
<p class="caption"><span class="caption-text">Data Collection Framework overview</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>The overall flow of data processing is depicted in <a class="reference internal" href="#dcf-overview"><span class="std std-ref">Data Collection Framework overview</span></a>.  On
the left side, a running <em>ns-3</em> simulation is depicted.  In the course
of running the simulation, data is made available by models through
trace sources, or via other means.  The diagram depicts that probes
can be connected to these trace sources to receive data asynchronously,
or probes can poll for data.  Data is then passed to a collector object
that transforms the data.  Finally, an aggregator can be connected
to the outputs of the collector, to generate plots, files, or databases.</p>
<div class="figure align-default" id="id2">
<span id="dcf-overview-with-aggregation"></span><img alt="_images/dcf-overview-with-aggregation.png" src="_images/dcf-overview-with-aggregation.png" />
<p class="caption"><span class="caption-text">Data Collection Framework aggregation</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>A variation on the above figure is provided
in <a class="reference internal" href="#dcf-overview-with-aggregation"><span class="std std-ref">Data Collection Framework aggregation</span></a>.
This second figure illustrates that the DCF objects may be chained
together in a manner that downstream objects take inputs from multiple
upstream objects.  The figure conceptually shows that multiple probes
may generate output that is fed into a single collector; as an example,
a collector that outputs a ratio of two counters would typically acquire
each counter data from separate probes.  Multiple collectors can also
feed into a single aggregator, which (as its name implies) may collect
a number of data streams for inclusion into a single plot, file, or
database.</p>
</div>
<span id="document-data-collection-helpers"></span><div class="section" id="data-collection-helpers">
<h3>Data Collection Helpers<a class="headerlink" href="#data-collection-helpers" title="Permalink to this headline">¶</a></h3>
<p>The full flexibility of the data collection framework is provided by
the interconnection of probes, collectors, and aggregators.  Performing
all of these interconnections leads to many configuration statements
in user programs.  For ease of use, some of the most common operations
can be combined and encapsulated in helper functions.  In addition,
some statements involving <em>ns-3</em> trace sources do not have Python
bindings, due to limitations in the bindings.</p>
<div class="section" id="data-collection-helpers-overview">
<h4>Data Collection Helpers Overview<a class="headerlink" href="#data-collection-helpers-overview" title="Permalink to this headline">¶</a></h4>
<p>In this section, we provide an overview of some helper classes that
have been created to ease the configuration of the data collection
framework for some common use cases.  The helpers allow users to form
common operations with only a few statements in their C++ or Python
programs.  But, this ease of use comes at the cost of significantly
less flexibility than low-level configuration can provide, and the
need to explicitly code support for new Probe types into the helpers
(to work around an issue described below).</p>
<p>The emphasis on the current helpers is to marshal data out of <em>ns-3</em>
trace sources into gnuplot plots or text files, without a high degree
of output customization or statistical processing (initially).  Also,
the use is constrained to the available probe types in <em>ns-3</em>.  Later
sections of this documentation will go into more detail about creating
new Probe types, as well as details about hooking together Probes,
Collectors, and Aggregators in custom arrangements.</p>
<p>To date, two Data Collection helpers have been implemented:</p>
<ul class="simple">
<li><p>GnuplotHelper</p></li>
<li><p>FileHelper</p></li>
</ul>
</div>
<div class="section" id="gnuplothelper">
<h4>GnuplotHelper<a class="headerlink" href="#gnuplothelper" title="Permalink to this headline">¶</a></h4>
<p>The GnuplotHelper is a helper class for producing output files used to
make gnuplots.  The overall goal is to provide the ability for users
to quickly make plots from data exported in <em>ns-3</em> trace sources.  By
default, a minimal amount of data transformation is performed; the
objective is to generate plots with as few (default) configuration
statements as possible.</p>
<div class="section" id="gnuplothelper-overview">
<h5>GnuplotHelper Overview<a class="headerlink" href="#gnuplothelper-overview" title="Permalink to this headline">¶</a></h5>
<p>The GnuplotHelper will create 3 different files at the end of the
simulation:</p>
<ul class="simple">
<li><p>A space separated gnuplot data file</p></li>
<li><p>A gnuplot control file</p></li>
<li><p>A shell script to generate the gnuplot</p></li>
</ul>
<p>There are two configuration statements that are needed to produce plots.
The first statement configures the plot (filename, title, legends, and
output type, where the output type defaults to PNG if unspecified):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">ConfigurePlot</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">outputFileNameWithoutExtension</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">title</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">xLegend</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">yLegend</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">terminalType</span> <span class="o">=</span> <span class="s">&quot;.png&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The second statement hooks the trace source of interest:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">PlotProbe</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">typeId</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">probeTraceSource</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">title</span><span class="p">);</span>
</pre></div>
</div>
<p>The arguments are as follows:</p>
<ul class="simple">
<li><p>typeId:  The <em>ns-3</em> TypeId of the Probe</p></li>
<li><p>path:  The path in the <em>ns-3</em> configuration namespace to one or more trace sources</p></li>
<li><p>probeTraceSource:  Which output of the probe (itself a trace source) should be plotted</p></li>
<li><p>title:  The title to associate with the dataset(s) (in the gnuplot legend)</p></li>
</ul>
<p>A variant on the PlotProbe above is to specify a fifth optional argument
that controls where in the plot the key (legend) is placed.</p>
<p>A fully worked example (from <code class="docutils literal notranslate"><span class="pre">seventh.cc</span></code>) is shown below:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create the gnuplot helper.</span>
<span class="n">GnuplotHelper</span> <span class="n">plotHelper</span><span class="p">;</span>

<span class="c1">// Configure the plot.</span>
<span class="c1">// Configure the plot.  The first argument is the file name prefix</span>
<span class="c1">// for the output files generated.  The second, third, and fourth</span>
<span class="c1">// arguments are, respectively, the plot title, x-axis, and y-axis labels</span>
<span class="n">plotHelper</span><span class="p">.</span><span class="n">ConfigurePlot</span> <span class="p">(</span><span class="s">&quot;seventh-packet-byte-count&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Packet Byte Count vs. Time&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Time (Seconds)&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Packet Byte Count&quot;</span><span class="p">,</span>
                          <span class="s">&quot;png&quot;</span><span class="p">);</span>

<span class="c1">// Specify the probe type, trace source path (in configuration namespace), and</span>
<span class="c1">// probe output trace source (&quot;OutputBytes&quot;) to plot.  The fourth argument</span>
<span class="c1">// specifies the name of the data series label on the plot.  The last</span>
<span class="c1">// argument formats the plot by specifying where the key should be placed.</span>
<span class="n">plotHelper</span><span class="p">.</span><span class="n">PlotProbe</span> <span class="p">(</span><span class="n">probeType</span><span class="p">,</span>
                      <span class="n">tracePath</span><span class="p">,</span>
                      <span class="s">&quot;OutputBytes&quot;</span><span class="p">,</span>
                      <span class="s">&quot;Packet Byte Count&quot;</span><span class="p">,</span>
                      <span class="n">GnuplotAggregator</span><span class="o">::</span><span class="n">KEY_BELOW</span><span class="p">);</span>
</pre></div>
</div>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">probeType</span></code> and <code class="docutils literal notranslate"><span class="pre">tracePath</span></code> are as follows (for IPv4):</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">probeType</span> <span class="o">=</span> <span class="s">&quot;ns3::Ipv4PacketProbe&quot;</span><span class="p">;</span>
<span class="n">tracePath</span> <span class="o">=</span> <span class="s">&quot;/NodeList/*/$ns3::Ipv4L3Protocol/Tx&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>The probeType is a key parameter for this helper to work.  This TypeId
must be registered in the system, and the signature on the Probe’s trace
sink must match that of the trace source it is being hooked to.  Probe
types are pre-defined for a number of data types corresponding to <em>ns-3</em>
traced values, and for a few other trace source signatures such as the
‘Tx’ trace source of <code class="docutils literal notranslate"><span class="pre">ns3::Ipv4L3Protocol</span></code> class.</p>
<p>Note that the trace source path specified may contain wildcards.
In this case, multiple
datasets are plotted on one plot; one for each matched path.</p>
<p>The main output produced will be three files:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">seventh</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="n">byte</span><span class="o">-</span><span class="n">count</span><span class="p">.</span><span class="n">dat</span>
<span class="n">seventh</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="n">byte</span><span class="o">-</span><span class="n">count</span><span class="p">.</span><span class="n">plt</span>
<span class="n">seventh</span><span class="o">-</span><span class="n">packet</span><span class="o">-</span><span class="n">byte</span><span class="o">-</span><span class="n">count</span><span class="p">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>At this point, users can either hand edit the .plt file for further
customizations, or just run it through gnuplot.  Running
<cite>sh seventh-packet-byte-count.sh</cite> simply runs the plot through gnuplot,
as shown below.</p>
<div class="figure align-default" id="id3">
<span id="seventh-packet-byte-count"></span><img alt="_images/seventh-packet-byte-count.png" src="_images/seventh-packet-byte-count.png" />
<p class="caption"><span class="caption-text">2-D Gnuplot Created by seventh.cc Example.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>It can be seen that the key elements (legend, title, legend placement,
xlabel, ylabel, and path for the data) are all placed on the plot.
Since there were two matches to the configuration path provided, the
two data series are shown:</p>
<ul class="simple">
<li><p>Packet Byte Count-0 corresponds to /NodeList/0/$ns3::Ipv4L3Protocol/Tx</p></li>
<li><p>Packet Byte Count-1 corresponds to /NodeList/1/$ns3::Ipv4L3Protocol/Tx</p></li>
</ul>
</div>
<div class="section" id="gnuplothelper-configureplot">
<h5>GnuplotHelper ConfigurePlot<a class="headerlink" href="#gnuplothelper-configureplot" title="Permalink to this headline">¶</a></h5>
<p>The GnuplotHelper’s <code class="docutils literal notranslate"><span class="pre">ConfigurePlot()</span></code> function can be used
to configure plots.</p>
<p>It has the following prototype:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">ConfigurePlot</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">outputFileNameWithoutExtension</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">title</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">xLegend</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">yLegend</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">terminalType</span> <span class="o">=</span> <span class="s">&quot;.png&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>It has the following arguments:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>outputFileNameWithoutExtension</p></td>
<td><p>Name of gnuplot related files
to write with no extension.</p></td>
</tr>
<tr class="row-odd"><td><p>title</p></td>
<td><p>Plot title string to use for
this plot.</p></td>
</tr>
<tr class="row-even"><td><p>xLegend</p></td>
<td><p>The legend for the x
horizontal axis.</p></td>
</tr>
<tr class="row-odd"><td><p>yLegend</p></td>
<td><p>The legend for the y
vertical axis.</p></td>
</tr>
<tr class="row-even"><td><p>terminalType</p></td>
<td><p>Terminal type setting string
for output.  The default
terminal type is “png”.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The GnuplotHelper’s <code class="docutils literal notranslate"><span class="pre">ConfigurePlot()</span></code> function configures plot
related parameters for this gnuplot helper so
that it will create a space separated gnuplot data file named
outputFileNameWithoutExtension + “.dat”, a gnuplot control file
named outputFileNameWithoutExtension + “.plt”, and a shell script
to generate the gnuplot named outputFileNameWithoutExtension +
“.sh”.</p>
<p>An example of how to use this function can be seen in the
<code class="docutils literal notranslate"><span class="pre">seventh.cc</span></code> code described above where it was used as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">plotHelper</span><span class="p">.</span><span class="n">ConfigurePlot</span> <span class="p">(</span><span class="s">&quot;seventh-packet-byte-count&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Packet Byte Count vs. Time&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Time (Seconds)&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Packet Byte Count&quot;</span><span class="p">,</span>
                          <span class="s">&quot;png&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="gnuplothelper-plotprobe">
<h5>GnuplotHelper PlotProbe<a class="headerlink" href="#gnuplothelper-plotprobe" title="Permalink to this headline">¶</a></h5>
<p>The GnuplotHelper’s <code class="docutils literal notranslate"><span class="pre">PlotProbe()</span></code> function can be used
to plot values generated by probes.</p>
<p>It has the following prototype:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">PlotProbe</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">typeId</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">probeTraceSource</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">title</span><span class="p">,</span>
                <span class="k">enum</span> <span class="n">GnuplotAggregator</span><span class="o">::</span><span class="n">KeyLocation</span> <span class="n">keyLocation</span> <span class="o">=</span> <span class="n">GnuplotAggregator</span><span class="o">::</span><span class="n">KEY_INSIDE</span><span class="p">);</span>
</pre></div>
</div>
<p>It has the following arguments:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>typeId</p></td>
<td><p>The type ID for the probe
created by this helper.</p></td>
</tr>
<tr class="row-odd"><td><p>path</p></td>
<td><p>Config path to access the
trace source.</p></td>
</tr>
<tr class="row-even"><td><p>probeTraceSource</p></td>
<td><p>The probe trace source to
access.</p></td>
</tr>
<tr class="row-odd"><td><p>title</p></td>
<td><p>The title to be associated
to this dataset</p></td>
</tr>
<tr class="row-even"><td><p>keyLocation</p></td>
<td><p>The location of the key in
the plot.  The default
location is inside.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The GnuplotHelper’s <code class="docutils literal notranslate"><span class="pre">PlotProbe()</span></code> function
plots a dataset generated by hooking the <em>ns-3</em> trace source with a
probe created by the helper, and then plotting the values from the
probeTraceSource.
The dataset will have the provided title, and will consist of
the ‘newValue’ at each timestamp.</p>
<p>If the config path has more than one match in the system because
there is a wildcard, then one dataset for each match will
be plotted.  The dataset titles will be suffixed with the matched
characters for each of the wildcards in the config path,
separated by spaces.  For example, if the proposed dataset title
is the string “bytes”, and there are two wildcards in the path,
then dataset titles like “bytes-0 0” or “bytes-12 9” will be
possible as labels for the datasets that are plotted.</p>
<p>An example of how to use this function can be seen in the
<code class="docutils literal notranslate"><span class="pre">seventh.cc</span></code> code described above where it was used (with
variable substitution) as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">plotHelper</span><span class="p">.</span><span class="n">PlotProbe</span> <span class="p">(</span><span class="s">&quot;ns3::Ipv4PacketProbe&quot;</span><span class="p">,</span>
                      <span class="s">&quot;/NodeList/*/$ns3::Ipv4L3Protocol/Tx&quot;</span><span class="p">,</span>
                      <span class="s">&quot;OutputBytes&quot;</span><span class="p">,</span>
                      <span class="s">&quot;Packet Byte Count&quot;</span><span class="p">,</span>
                      <span class="n">GnuplotAggregator</span><span class="o">::</span><span class="n">KEY_BELOW</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="other-examples">
<h5>Other Examples<a class="headerlink" href="#other-examples" title="Permalink to this headline">¶</a></h5>
<div class="section" id="gnuplot-helper-example">
<h6>Gnuplot Helper Example<a class="headerlink" href="#gnuplot-helper-example" title="Permalink to this headline">¶</a></h6>
<p>A slightly simpler example than the <code class="docutils literal notranslate"><span class="pre">seventh.cc</span></code> example can be
found in <code class="docutils literal notranslate"><span class="pre">src/stats/examples/gnuplot-helper-example.cc</span></code>.  The
following 2-D gnuplot was created using the example.</p>
<div class="figure align-default" id="id4">
<span id="id1"></span><img alt="_images/gnuplot-helper-example.png" src="_images/gnuplot-helper-example.png" />
<p class="caption"><span class="caption-text">2-D Gnuplot Created by gnuplot-helper-example.cc Example.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>In this example, there is an Emitter object that increments
its counter according to a Poisson process and then emits the counter’s
value as a trace source.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="n">emitter</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;/Names/Emitter&quot;</span><span class="p">,</span> <span class="n">emitter</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that because there are no wildcards in the path
used below, only 1 datastream was drawn in the plot.
This single datastream in the plot is simply labeled
“Emitter Count”, with no extra suffixes like one would
see if there were wildcards in the path.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create the gnuplot helper.</span>
<span class="n">GnuplotHelper</span> <span class="n">plotHelper</span><span class="p">;</span>

<span class="c1">// Configure the plot.</span>
<span class="n">plotHelper</span><span class="p">.</span><span class="n">ConfigurePlot</span> <span class="p">(</span><span class="s">&quot;gnuplot-helper-example&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Emitter Counts vs. Time&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Time (Seconds)&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Emitter Count&quot;</span><span class="p">,</span>
                          <span class="s">&quot;png&quot;</span><span class="p">);</span>

<span class="c1">// Plot the values generated by the probe.  The path that we provide</span>
<span class="c1">// helps to disambiguate the source of the trace.</span>
<span class="n">plotHelper</span><span class="p">.</span><span class="n">PlotProbe</span> <span class="p">(</span><span class="s">&quot;ns3::Uinteger32Probe&quot;</span><span class="p">,</span>
                      <span class="s">&quot;/Names/Emitter/Counter&quot;</span><span class="p">,</span>
                      <span class="s">&quot;Output&quot;</span><span class="p">,</span>
                      <span class="s">&quot;Emitter Count&quot;</span><span class="p">,</span>
                      <span class="n">GnuplotAggregator</span><span class="o">::</span><span class="n">KEY_INSIDE</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="filehelper">
<h4>FileHelper<a class="headerlink" href="#filehelper" title="Permalink to this headline">¶</a></h4>
<p>The FileHelper is a helper class used to put data values into a file.
The overall goal is to provide the ability for users
to quickly make formatted text files from data exported in <em>ns-3</em>
trace sources.  By default, a minimal amount of data transformation is
performed; the objective is to generate files with as few (default)
configuration statements as possible.</p>
<div class="section" id="filehelper-overview">
<h5>FileHelper Overview<a class="headerlink" href="#filehelper-overview" title="Permalink to this headline">¶</a></h5>
<p>The FileHelper will create 1 or more text files at the end of the
simulation.</p>
<p>The FileHelper can create 4 different types of text files:</p>
<ul class="simple">
<li><p>Formatted</p></li>
<li><p>Space separated (the default)</p></li>
<li><p>Comma separated</p></li>
<li><p>Tab separated</p></li>
</ul>
<p>Formatted files use C-style format strings and the sprintf() function
to print their values in the file being written.</p>
<p>The following text file with 2 columns of formatted values named
<code class="docutils literal notranslate"><span class="pre">seventh-packet-byte-count-0.txt</span></code> was created using more new
code that was added to the original <em>ns-3</em> Tutorial example’s code.
Only the first 10 lines of this file are shown here for brevity.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Time (Seconds) = 1.000e+00    Packet Byte Count = 40
Time (Seconds) = 1.004e+00    Packet Byte Count = 40
Time (Seconds) = 1.004e+00    Packet Byte Count = 576
Time (Seconds) = 1.009e+00    Packet Byte Count = 576
Time (Seconds) = 1.009e+00    Packet Byte Count = 576
Time (Seconds) = 1.015e+00    Packet Byte Count = 512
Time (Seconds) = 1.017e+00    Packet Byte Count = 576
Time (Seconds) = 1.017e+00    Packet Byte Count = 544
Time (Seconds) = 1.025e+00    Packet Byte Count = 576
Time (Seconds) = 1.025e+00    Packet Byte Count = 544

...
</pre></div>
</div>
<p>The following different text file with 2 columns of formatted
values named <code class="docutils literal notranslate"><span class="pre">seventh-packet-byte-count-1.txt</span></code> was also
created using the same new code that was added to the original
<em>ns-3</em> Tutorial example’s code.  Only the first 10 lines of this
file are shown here for brevity.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Time (Seconds) = 1.002e+00    Packet Byte Count = 40
Time (Seconds) = 1.007e+00    Packet Byte Count = 40
Time (Seconds) = 1.013e+00    Packet Byte Count = 40
Time (Seconds) = 1.020e+00    Packet Byte Count = 40
Time (Seconds) = 1.028e+00    Packet Byte Count = 40
Time (Seconds) = 1.036e+00    Packet Byte Count = 40
Time (Seconds) = 1.045e+00    Packet Byte Count = 40
Time (Seconds) = 1.053e+00    Packet Byte Count = 40
Time (Seconds) = 1.061e+00    Packet Byte Count = 40
Time (Seconds) = 1.069e+00    Packet Byte Count = 40

...
</pre></div>
</div>
<p>The new code that was added to produce the two text files is below.
More details about this API will be covered in a later section.</p>
<p>Note that because there were 2 matches for the wildcard in the path,
2 separate text files were created.  The first text file, which is
named “seventh-packet-byte-count-0.txt”, corresponds to the
wildcard match with the “*” replaced with “0”.  The second text file,
which is named “seventh-packet-byte-count-1.txt”, corresponds to
the wildcard match with the “*” replaced with “1”.  Also, note that
the function call to <code class="docutils literal notranslate"><span class="pre">WriteProbe()</span></code> will give an error message if
there are no matches for a path that contains wildcards.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create the file helper.</span>
<span class="n">FileHelper</span> <span class="n">fileHelper</span><span class="p">;</span>

<span class="c1">// Configure the file to be written.</span>
<span class="n">fileHelper</span><span class="p">.</span><span class="n">ConfigureFile</span> <span class="p">(</span><span class="s">&quot;seventh-packet-byte-count&quot;</span><span class="p">,</span>
                          <span class="n">FileAggregator</span><span class="o">::</span><span class="n">FORMATTED</span><span class="p">);</span>

<span class="c1">// Set the labels for this formatted output file.</span>
<span class="n">fileHelper</span><span class="p">.</span><span class="n">Set2dFormat</span> <span class="p">(</span><span class="s">&quot;Time (Seconds) = %.3e</span><span class="se">\t</span><span class="s">Packet Byte Count = %.0f&quot;</span><span class="p">);</span>

<span class="c1">// Write the values generated by the probe.</span>
<span class="n">fileHelper</span><span class="p">.</span><span class="n">WriteProbe</span> <span class="p">(</span><span class="s">&quot;ns3::Ipv4PacketProbe&quot;</span><span class="p">,</span>
                       <span class="s">&quot;/NodeList/*/$ns3::Ipv4L3Protocol/Tx&quot;</span><span class="p">,</span>
                       <span class="s">&quot;OutputBytes&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="filehelper-configurefile">
<h5>FileHelper ConfigureFile<a class="headerlink" href="#filehelper-configurefile" title="Permalink to this headline">¶</a></h5>
<p>The FileHelper’s <code class="docutils literal notranslate"><span class="pre">ConfigureFile()</span></code> function can be used
to configure text files.</p>
<p>It has the following prototype:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">ConfigureFile</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">outputFileNameWithoutExtension</span><span class="p">,</span>
                    <span class="k">enum</span> <span class="n">FileAggregator</span><span class="o">::</span><span class="n">FileType</span> <span class="n">fileType</span> <span class="o">=</span> <span class="n">FileAggregator</span><span class="o">::</span><span class="n">SPACE_SEPARATED</span><span class="p">);</span>
</pre></div>
</div>
<p>It has the following arguments:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>outputFileNameWithoutExtension</p></td>
<td><p>Name of output file to write
with no extension.</p></td>
</tr>
<tr class="row-odd"><td><p>fileType</p></td>
<td><p>Type of file to write.  The
default type of file is space
separated.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The FileHelper’s <code class="docutils literal notranslate"><span class="pre">ConfigureFile()</span></code> function configures text file
related parameters for the file helper so that
it will create a file named outputFileNameWithoutExtension plus
possible extra information from wildcard matches plus “.txt” with
values printed as specified by fileType.  The default file type
is space-separated.</p>
<p>An example of how to use this function can be seen in the
<code class="docutils literal notranslate"><span class="pre">seventh.cc</span></code> code described above where it was used as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">fileHelper</span><span class="p">.</span><span class="n">ConfigureFile</span> <span class="p">(</span><span class="s">&quot;seventh-packet-byte-count&quot;</span><span class="p">,</span>
                          <span class="n">FileAggregator</span><span class="o">::</span><span class="n">FORMATTED</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="filehelper-writeprobe">
<h5>FileHelper WriteProbe<a class="headerlink" href="#filehelper-writeprobe" title="Permalink to this headline">¶</a></h5>
<p>The FileHelper’s <code class="docutils literal notranslate"><span class="pre">WriteProbe()</span></code> function can be used
to write values generated by probes to text files.</p>
<p>It has the following prototype:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">WriteProbe</span> <span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">typeId</span><span class="p">,</span>
                 <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">path</span><span class="p">,</span>
                 <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">probeTraceSource</span><span class="p">);</span>
</pre></div>
</div>
<p>It has the following arguments:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 38%" />
<col style="width: 63%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>typeId</p></td>
<td><p>The type ID for the probe
to be created.</p></td>
</tr>
<tr class="row-odd"><td><p>path</p></td>
<td><p>Config path to access the
trace source.</p></td>
</tr>
<tr class="row-even"><td><p>probeTraceSource</p></td>
<td><p>The probe trace source to
access.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The FileHelper’s <code class="docutils literal notranslate"><span class="pre">WriteProbe()</span></code> function
creates output text files generated by hooking the ns-3 trace source
with a probe created by the helper, and then writing the values from the
probeTraceSource. The output file names will have the text stored
in the member variable  m_outputFileNameWithoutExtension plus “.txt”,
and will consist of the ‘newValue’ at each timestamp.</p>
<p>If the config path has more than one match in the system because
there is a wildcard, then one output file for each match
will be created.  The output file names will contain the text in
m_outputFileNameWithoutExtension plus the matched characters for
each of the wildcards in the config path, separated by dashes,
plus “.txt”.  For example, if the value in
m_outputFileNameWithoutExtension is the string
“packet-byte-count”, and there are two wildcards in the path,
then output file names like “packet-byte-count-0-0.txt” or
“packet-byte-count-12-9.txt” will be possible as names for the
files that will be created.</p>
<p>An example of how to use this function can be seen in the
<code class="docutils literal notranslate"><span class="pre">seventh.cc</span></code> code described above where it was used as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">fileHelper</span><span class="p">.</span><span class="n">WriteProbe</span> <span class="p">(</span><span class="s">&quot;ns3::Ipv4PacketProbe&quot;</span><span class="p">,</span>
                       <span class="s">&quot;/NodeList/*/$ns3::Ipv4L3Protocol/Tx&quot;</span><span class="p">,</span>
                       <span class="s">&quot;OutputBytes&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Other Examples<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<div class="section" id="file-helper-example">
<h6>File Helper Example<a class="headerlink" href="#file-helper-example" title="Permalink to this headline">¶</a></h6>
<p>A slightly simpler example than the <code class="docutils literal notranslate"><span class="pre">seventh.cc</span></code> example can be
found in <code class="docutils literal notranslate"><span class="pre">src/stats/examples/file-helper-example.cc</span></code>.
This example only uses the FileHelper.</p>
<p>The following text file with 2 columns of formatted values named
<code class="docutils literal notranslate"><span class="pre">file-helper-example.txt</span></code> was created using the example.
Only the first 10 lines of this file are shown here for brevity.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Time (Seconds) = 0.203  Count = 1
Time (Seconds) = 0.702  Count = 2
Time (Seconds) = 1.404  Count = 3
Time (Seconds) = 2.368  Count = 4
Time (Seconds) = 3.364  Count = 5
Time (Seconds) = 3.579  Count = 6
Time (Seconds) = 5.873  Count = 7
Time (Seconds) = 6.410  Count = 8
Time (Seconds) = 6.472  Count = 9
...
</pre></div>
</div>
<p>In this example, there is an Emitter object that increments
its counter according to a Poisson process and then emits the counter’s
value as a trace source.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="n">emitter</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;/Names/Emitter&quot;</span><span class="p">,</span> <span class="n">emitter</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that because there are no wildcards in the path
used below, only 1 text file was created.
This single text file is simply named
“file-helper-example.txt”, with no extra suffixes like
you would see if there were wildcards in the path.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create the file helper.</span>
<span class="n">FileHelper</span> <span class="n">fileHelper</span><span class="p">;</span>

<span class="c1">// Configure the file to be written.</span>
<span class="n">fileHelper</span><span class="p">.</span><span class="n">ConfigureFile</span> <span class="p">(</span><span class="s">&quot;file-helper-example&quot;</span><span class="p">,</span>
                          <span class="n">FileAggregator</span><span class="o">::</span><span class="n">FORMATTED</span><span class="p">);</span>

<span class="c1">// Set the labels for this formatted output file.</span>
<span class="n">fileHelper</span><span class="p">.</span><span class="n">Set2dFormat</span> <span class="p">(</span><span class="s">&quot;Time (Seconds) = %.3e</span><span class="se">\t</span><span class="s">Count = %.0f&quot;</span><span class="p">);</span>

<span class="c1">// Write the values generated by the probe.  The path that we</span>
<span class="c1">// provide helps to disambiguate the source of the trace.</span>
<span class="n">fileHelper</span><span class="p">.</span><span class="n">WriteProbe</span> <span class="p">(</span><span class="s">&quot;ns3::Uinteger32Probe&quot;</span><span class="p">,</span>
                       <span class="s">&quot;/Names/Emitter/Counter&quot;</span><span class="p">,</span>
                       <span class="s">&quot;Output&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="scope-and-limitations">
<h4>Scope and Limitations<a class="headerlink" href="#scope-and-limitations" title="Permalink to this headline">¶</a></h4>
<p>Currently, only these Probes have been implemented and connected
to the GnuplotHelper and to the FileHelper:</p>
<ul class="simple">
<li><p>BooleanProbe</p></li>
<li><p>DoubleProbe</p></li>
<li><p>Uinteger8Probe</p></li>
<li><p>Uinteger16Probe</p></li>
<li><p>Uinteger32Probe</p></li>
<li><p>TimeProbe</p></li>
<li><p>PacketProbe</p></li>
<li><p>ApplicationPacketProbe</p></li>
<li><p>Ipv4PacketProbe</p></li>
</ul>
<p>These Probes, therefore, are the only TypeIds available to be used
in <code class="docutils literal notranslate"><span class="pre">PlotProbe()</span></code> and <code class="docutils literal notranslate"><span class="pre">WriteProbe()</span></code>.</p>
<p>In the next few sections, we cover each of the fundamental object
types (Probe, Collector, and Aggregator) in more detail, and show
how they can be connected together using lower-level API.</p>
</div>
</div>
<span id="document-probe"></span><div class="section" id="probes">
<h3>Probes<a class="headerlink" href="#probes" title="Permalink to this headline">¶</a></h3>
<p>This section details the functionalities provided by the Probe class
to an <em>ns-3</em> simulation, and gives examples on how to code them in a
program. This section is meant for users interested in developing
simulations with the <em>ns-3</em> tools and using the Data Collection
Framework, of which the Probe class is a part, to generate data output
with their simulation’s results.</p>
<div class="section" id="probe-overview">
<h4>Probe Overview<a class="headerlink" href="#probe-overview" title="Permalink to this headline">¶</a></h4>
<p>A Probe object is supposed to be connected to a variable from the
simulation whose values throughout the experiment are relevant to the user.
The Probe will record what were values assumed by the variable throughout
the simulation and pass such data to another member of the Data Collection
Framework.  While it is out of this section’s scope to discuss what happens
after the Probe produces its output, it is sufficient to say that, by the
end of the simulation, the user will have detailed information about what
values were stored inside the variable being probed during the simulation.</p>
<p>Typically, a Probe is connected to an <em>ns-3</em> trace source.  In this manner,
whenever the trace source exports a new value, the Probe consumes the
value (and exports it downstream to another object via its own trace source).</p>
<p>The Probe can be thought of as kind of a filter on trace sources.  The
main reasons for possibly hooking to a Probe rather than directly to a
trace source are as follows:</p>
<ul>
<li><p>Probes may be dynamically turned on and off during the simulation
with calls to <code class="docutils literal notranslate"><span class="pre">Enable()</span></code> and <code class="docutils literal notranslate"><span class="pre">Disable()</span></code>.  For example, the
outputting of data may be turned off during the simulation warmup
phase.</p></li>
<li><p>Probes may perform operations on the data to extract values from more
complicated structures; for instance, outputting the packet size value
from a received ns3::Packet.</p></li>
<li><p>Probes register a name in the ns3::Config namespace (using
<code class="docutils literal notranslate"><span class="pre">Names::Add</span> <span class="pre">()</span></code>) so that other objects may refer to them.</p></li>
<li><p>Probes provide a static method that allows one to manipulate a Probe
by name, such as what is done in ns2measure <a class="reference internal" href="index.html#cic06" id="id1"><span>[Cic06]</span></a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Stat</span><span class="o">::</span><span class="n">put</span> <span class="p">(</span><span class="s">&quot;my_metric&quot;</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">sample</span><span class="p">);</span>
</pre></div>
</div>
<p>The ns-3 equivalent of the above ns2measure code is, e.g.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">DoubleProbe</span><span class="o">::</span><span class="n">SetValueByPath</span> <span class="p">(</span><span class="s">&quot;/path/to/probe&quot;</span><span class="p">,</span> <span class="n">sample</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="creation">
<h5>Creation<a class="headerlink" href="#creation" title="Permalink to this headline">¶</a></h5>
<p>Note that a Probe base class object can not be created because it
is an abstract base class, i.e. it has pure virtual functions that
have not been implemented.  An object of type DoubleProbe,
which is a subclass of the Probe class, will be created here to
show what needs to be done.</p>
<p>One declares a DoubleProbe in dynamic memory by using the smart pointer class
(Ptr&lt;T&gt;). To create a DoubleProbe in dynamic memory with smart pointers, one
just needs to call the <em>ns-3</em> method <code class="docutils literal notranslate"><span class="pre">CreateObject()</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="n">myprobe</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="p">();</span>
</pre></div>
</div>
<p>The declaration above creates DoubleProbes using the default values for its
attributes.  There are four attributes in the DoubleProbe class; two in the
base class object DataCollectionObject, and two in the Probe base class:</p>
<ul class="simple">
<li><p>“Name” (DataCollectionObject), a StringValue</p></li>
<li><p>“Enabled” (DataCollectionObject), a BooleanValue</p></li>
<li><p>“Start” (Probe), a TimeValue</p></li>
<li><p>“Stop” (Probe), a TimeValue</p></li>
</ul>
<p>One can set such attributes at object creation by using the following
method:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="n">myprobe</span> <span class="o">=</span> <span class="n">CreateObjectWithAttributes</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="p">(</span>
    <span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;myprobe&quot;</span><span class="p">),</span>
    <span class="s">&quot;Enabled&quot;</span><span class="p">,</span> <span class="n">BooleanValue</span> <span class="p">(</span><span class="nb">false</span><span class="p">),</span>
    <span class="s">&quot;Start&quot;</span><span class="p">,</span> <span class="n">TimeValue</span> <span class="p">(</span><span class="n">Seconds</span> <span class="p">(</span><span class="mf">100.0</span><span class="p">)),</span>
    <span class="s">&quot;Stop&quot;</span><span class="p">,</span> <span class="n">TimeValue</span> <span class="p">(</span><span class="n">Seconds</span> <span class="p">(</span><span class="mf">1000.0</span><span class="p">)));</span>
</pre></div>
</div>
<p>Start and Stop are Time variables which determine the interval of action
of the Probe. The Probe will only output data if the current time of the
Simulation is inside of that interval.  The special time value of 0 seconds
for Stop will disable this attribute (i.e. keep the Probe on for the whole
simulation).  Enabled is a flag that turns the
Probe on or off, and must be set to true for the Probe to export data.
The Name is the object’s name in the DCF framework.</p>
</div>
<div class="section" id="importing-and-exporting-data">
<h5>Importing and exporting data<a class="headerlink" href="#importing-and-exporting-data" title="Permalink to this headline">¶</a></h5>
<p><em>ns-3</em> trace sources are strongly typed, so the mechanisms for hooking
Probes to a trace source and for exporting data belong to its
subclasses.  For instance, the default distribution of <em>ns-3</em> provides
a class DoubleProbe that is designed to hook to a trace source
exporting a double value.  We’ll next detail the operation of the
DoubleProbe, and then discuss how other Probe classes may be defined
by the user.</p>
</div>
</div>
<div class="section" id="doubleprobe-overview">
<h4>DoubleProbe Overview<a class="headerlink" href="#doubleprobe-overview" title="Permalink to this headline">¶</a></h4>
<p>The DoubleProbe connects to a double-valued <em>ns-3</em> trace source, and itself
exports a different double-valued <em>ns-3</em> trace source.</p>
<p>The following code, drawn from
<code class="docutils literal notranslate"><span class="pre">src/stats/examples/double-probe-example.cc</span></code>, shows the basic
operations of plumbing the DoubleProbe into a simulation, where it is
probing a Counter exported by an emitter object (class Emitter).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="n">emitter</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;/Names/Emitter&quot;</span><span class="p">,</span> <span class="n">emitter</span><span class="p">);</span>
<span class="p">...</span>

<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="n">probe1</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="p">();</span>

<span class="c1">// Connect the probe to the emitter&#39;s Counter</span>
<span class="kt">bool</span> <span class="n">connected</span> <span class="o">=</span> <span class="n">probe1</span><span class="o">-&gt;</span><span class="n">ConnectByObject</span> <span class="p">(</span><span class="s">&quot;Counter&quot;</span><span class="p">,</span> <span class="n">emitter</span><span class="p">);</span>
</pre></div>
</div>
<p>The following code is probing the same Counter exported by the same
emitter object.  This DoubleProbe, however, is using a path in the
configuration namespace to make the connection.  Note that the emitter
registered itself in the configuration namespace after it was created;
otherwise, the ConnectByPath would not work.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="n">probe2</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="p">();</span>

<span class="c1">// Note, no return value is checked here</span>
<span class="n">probe2</span><span class="o">-&gt;</span><span class="n">ConnectByPath</span> <span class="p">(</span><span class="s">&quot;/Names/Emitter/Counter&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The next DoubleProbe shown that is shown below will have its value set using
its path in the configuration namespace.  Note that this time the
DoubleProbe registered itself in the configuration namespace after it was
created.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="n">probe3</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">probe3</span><span class="o">-&gt;</span><span class="n">SetName</span> <span class="p">(</span><span class="s">&quot;StaticallyAccessedProbe&quot;</span><span class="p">);</span>

<span class="c1">// We must add it to the config database</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;/Names/Probes&quot;</span><span class="p">,</span> <span class="n">probe3</span><span class="o">-&gt;</span><span class="n">GetName</span> <span class="p">(),</span> <span class="n">probe3</span><span class="p">);</span>
</pre></div>
</div>
<p>The emitter’s Count() function is now able to set the value for this DoubleProbe as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="n">Emitter</span><span class="o">::</span><span class="n">Count</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="p">...</span>
  <span class="n">m_counter</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="n">DoubleProbe</span><span class="o">::</span><span class="n">SetValueByPath</span> <span class="p">(</span><span class="s">&quot;/Names/StaticallyAccessedProbe&quot;</span><span class="p">,</span> <span class="n">m_counter</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example shows how the code calling the Probe does not have to
have an explicit reference to the Probe, but can direct the value
setting through the Config namespace.  This is similar in functionality
to the <cite>Stat::Put</cite> method introduced by ns2measure paper <a class="reference internal" href="index.html#cic06" id="id2"><span>[Cic06]</span></a>, and allows
users to temporarily insert Probe statements like <cite>printf</cite> statements within
existing <em>ns-3</em> models.  Note that in order to be able to use the DoubleProbe in this example like this, 2 things were necessary:</p>
<ol class="arabic simple">
<li><p>the stats module header file was included in the example .cc file</p></li>
<li><p>the example was made dependent on the stats module in its wscript file.</p></li>
</ol>
<p>Analogous things need to be done in order to add other Probes in other places in the <em>ns-3</em> code base.</p>
<p>The values for the DoubleProbe can also be set using the function
DoubleProbe::SetValue(), while the values for the DoubleProbe can be gotten
using the function DoubleProbe::GetValue().</p>
<p>The DoubleProbe exports double values in its “Output” trace source;
a downstream object can hook a trace sink (NotifyViaProbe) to this as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">connected</span> <span class="o">=</span> <span class="n">probe1</span><span class="o">-&gt;</span><span class="n">TraceConnect</span> <span class="p">(</span><span class="s">&quot;Output&quot;</span><span class="p">,</span> <span class="n">probe1</span><span class="o">-&gt;</span><span class="n">GetName</span> <span class="p">(),</span> <span class="n">MakeCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">NotifyViaProbe</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="other-probes">
<h4>Other probes<a class="headerlink" href="#other-probes" title="Permalink to this headline">¶</a></h4>
<p>Besides the DoubleProbe, the following Probes are also available:</p>
<ul class="simple">
<li><p>Uinteger8Probe connects to an <em>ns-3</em> trace source exporting an uint8_t.</p></li>
<li><p>Uinteger16Probe connects to an <em>ns-3</em> trace source exporting an uint16_t.</p></li>
<li><p>Uinteger32Probe connects to an <em>ns-3</em> trace source exporting an uint32_t.</p></li>
<li><p>PacketProbe connects to an <em>ns-3</em> trace source exporting a packet.</p></li>
<li><p>ApplicationPacketProbe connects to an <em>ns-3</em> trace source exporting a packet and a socket address.</p></li>
<li><p>Ipv4PacketProbe connects to an <em>ns-3</em> trace source exporting a packet, an IPv4 object, and an interface.</p></li>
</ul>
</div>
<div class="section" id="creating-new-probe-types">
<h4>Creating new Probe types<a class="headerlink" href="#creating-new-probe-types" title="Permalink to this headline">¶</a></h4>
<p>To create a new Probe type, you need to perform the following steps:</p>
<ul class="simple">
<li><p>Be sure that your new Probe class is derived from the Probe base class.</p></li>
<li><p>Be sure that the pure virtual functions that your new Probe class
inherits from the Probe base class are implemented.</p></li>
<li><p>Find an existing Probe class that uses a trace source that is
closest in type to the type of trace source your Probe will be
using.</p></li>
<li><p>Copy that existing Probe class’s header file (.h) and implementation
file (.cc) to two new files with names matching your new Probe.</p></li>
<li><p>Replace the types, arguments, and variables in the copied files with
the appropriate type for your Probe.</p></li>
<li><p>Make necessary modifications to make the code compile and to make it
behave as you would like.</p></li>
</ul>
</div>
<div class="section" id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<p>Two examples will be discussed in detail here:</p>
<ul class="simple">
<li><p>Double Probe Example</p></li>
<li><p>IPv4 Packet Plot Example</p></li>
</ul>
<div class="section" id="double-probe-example">
<h5>Double Probe Example<a class="headerlink" href="#double-probe-example" title="Permalink to this headline">¶</a></h5>
<p>The double probe example has been discussed previously.  The example
program can be found in
<code class="docutils literal notranslate"><span class="pre">src/stats/examples/double-probe-example.cc</span></code>.  To
summarize what occurs in this program, there is an emitter that
exports a counter that increments according to a Poisson process.  In
particular, two ways of emitting data are shown:</p>
<ol class="arabic">
<li><p>through a traced variable hooked to one Probe:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TracedValue</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">m_counter</span><span class="p">;</span>  <span class="c1">// normally this would be integer type</span>
</pre></div>
</div>
</li>
<li><p>through a counter whose value is posted to a second Probe, referenced by its name in the Config system:</p></li>
</ol>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="n">Emitter</span><span class="o">::</span><span class="n">Count</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NS_LOG_FUNCTION</span> <span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="n">NS_LOG_DEBUG</span> <span class="p">(</span><span class="s">&quot;Counting at &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">Simulator</span><span class="o">::</span><span class="n">Now</span> <span class="p">().</span><span class="n">GetSeconds</span> <span class="p">());</span>
  <span class="n">m_counter</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="n">DoubleProbe</span><span class="o">::</span><span class="n">SetValueByPath</span> <span class="p">(</span><span class="s">&quot;/Names/StaticallyAccessedProbe&quot;</span><span class="p">,</span> <span class="n">m_counter</span><span class="p">);</span>
  <span class="n">Simulator</span><span class="o">::</span><span class="n">Schedule</span> <span class="p">(</span><span class="n">Seconds</span> <span class="p">(</span><span class="n">m_var</span><span class="o">-&gt;</span><span class="n">GetValue</span> <span class="p">()),</span> <span class="o">&amp;</span><span class="n">Emitter</span><span class="o">::</span><span class="n">Count</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>Let’s look at the Probe more carefully.  Probes can receive their values
in a multiple ways:</p>
<ol class="arabic simple">
<li><p>by the Probe accessing the trace source directly and connecting
a trace sink to it</p></li>
<li><p>by the Probe accessing the trace source through the config namespace
and connecting a trace sink to it</p></li>
<li><p>by the calling code explicitly calling the Probe’s <cite>SetValue()</cite> method</p></li>
<li><p>by the calling code explicitly calling <cite>SetValueByPath (“/path/through/Config/namespace”, …)</cite></p></li>
</ol>
<p>The first two techniques are expected to be the most common.  Also in the
example, the hooking of a normal callback function is shown,
as is typically done in <em>ns-3</em>.  This callback function is not associated
with a Probe object.  We’ll call this case 0) below.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// This is a function to test hooking a raw function to the trace source</span>
<span class="kt">void</span>
<span class="nf">NotifyViaTraceSource</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">context</span><span class="p">,</span> <span class="kt">double</span> <span class="n">oldVal</span><span class="p">,</span> <span class="kt">double</span> <span class="n">newVal</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NS_LOG_DEBUG</span> <span class="p">(</span><span class="s">&quot;context: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">context</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; old &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">oldVal</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; new &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">newVal</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>First, the emitter needs to be setup:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="n">emitter</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;/Names/Emitter&quot;</span><span class="p">,</span> <span class="n">emitter</span><span class="p">);</span>

<span class="c1">// The Emitter object is not associated with an ns-3 node, so</span>
<span class="c1">// it won&#39;t get started automatically, so we need to do this ourselves</span>
<span class="n">Simulator</span><span class="o">::</span><span class="n">Schedule</span> <span class="p">(</span><span class="n">Seconds</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">Emitter</span><span class="o">::</span><span class="n">Start</span><span class="p">,</span> <span class="n">emitter</span><span class="p">);</span>
</pre></div>
</div>
<p>The various DoubleProbes interact with the emitter in the example as
shown below.</p>
<p>Case 0):</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// The below shows typical functionality without a probe</span>
<span class="c1">// (connect a sink function to a trace source)</span>
<span class="c1">//</span>
<span class="n">connected</span> <span class="o">=</span> <span class="n">emitter</span><span class="o">-&gt;</span><span class="n">TraceConnect</span> <span class="p">(</span><span class="s">&quot;Counter&quot;</span><span class="p">,</span> <span class="s">&quot;sample context&quot;</span><span class="p">,</span> <span class="n">MakeCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">NotifyViaTraceSource</span><span class="p">));</span>
<span class="n">NS_ASSERT_MSG</span> <span class="p">(</span><span class="n">connected</span><span class="p">,</span> <span class="s">&quot;Trace source not connected&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>case 1):</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span>
<span class="c1">// Probe1 will be hooked directly to the Emitter trace source object</span>
<span class="c1">//</span>

<span class="c1">// probe1 will be hooked to the Emitter trace source</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="n">probe1</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="c1">// the probe&#39;s name can serve as its context in the tracing</span>
<span class="n">probe1</span><span class="o">-&gt;</span><span class="n">SetName</span> <span class="p">(</span><span class="s">&quot;ObjectProbe&quot;</span><span class="p">);</span>

<span class="c1">// Connect the probe to the emitter&#39;s Counter</span>
<span class="n">connected</span> <span class="o">=</span> <span class="n">probe1</span><span class="o">-&gt;</span><span class="n">ConnectByObject</span> <span class="p">(</span><span class="s">&quot;Counter&quot;</span><span class="p">,</span> <span class="n">emitter</span><span class="p">);</span>
<span class="n">NS_ASSERT_MSG</span> <span class="p">(</span><span class="n">connected</span><span class="p">,</span> <span class="s">&quot;Trace source not connected to probe1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>case 2):</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span>
<span class="c1">// Probe2 will be hooked to the Emitter trace source object by</span>
<span class="c1">// accessing it by path name in the Config database</span>
<span class="c1">//</span>

<span class="c1">// Create another similar probe; this will hook up via a Config path</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="n">probe2</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">probe2</span><span class="o">-&gt;</span><span class="n">SetName</span> <span class="p">(</span><span class="s">&quot;PathProbe&quot;</span><span class="p">);</span>

<span class="c1">// Note, no return value is checked here</span>
<span class="n">probe2</span><span class="o">-&gt;</span><span class="n">ConnectByPath</span> <span class="p">(</span><span class="s">&quot;/Names/Emitter/Counter&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>case 4) (case 3 is not shown in this example):</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span>
<span class="c1">// Probe3 will be called by the emitter directly through the</span>
<span class="c1">// static method SetValueByPath().</span>
<span class="c1">//</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="n">probe3</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">DoubleProbe</span><span class="o">&gt;</span> <span class="p">();</span>
<span class="n">probe3</span><span class="o">-&gt;</span><span class="n">SetName</span> <span class="p">(</span><span class="s">&quot;StaticallyAccessedProbe&quot;</span><span class="p">);</span>
<span class="c1">// We must add it to the config database</span>
<span class="n">Names</span><span class="o">::</span><span class="n">Add</span> <span class="p">(</span><span class="s">&quot;/Names/Probes&quot;</span><span class="p">,</span> <span class="n">probe3</span><span class="o">-&gt;</span><span class="n">GetName</span> <span class="p">(),</span> <span class="n">probe3</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>And finally, the example shows how the probes can be hooked to
generate output:</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// The probe itself should generate output.  The context that we provide</span>
<span class="c1">// to this probe (in this case, the probe name) will help to disambiguate</span>
<span class="c1">// the source of the trace</span>
<span class="n">connected</span> <span class="o">=</span> <span class="n">probe3</span><span class="o">-&gt;</span><span class="n">TraceConnect</span> <span class="p">(</span><span class="s">&quot;Output&quot;</span><span class="p">,</span>
                                  <span class="s">&quot;/Names/Probes/StaticallyAccessedProbe/Output&quot;</span><span class="p">,</span>
                                  <span class="n">MakeCallback</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">NotifyViaProbe</span><span class="p">));</span>
<span class="n">NS_ASSERT_MSG</span> <span class="p">(</span><span class="n">connected</span><span class="p">,</span> <span class="s">&quot;Trace source not .. connected to probe3 Output&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>The following callback is hooked to the Probe in this example for
illustrative purposes; normally, the Probe would be hooked to a
Collector object.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// This is a function to test hooking it to the probe output</span>
<span class="kt">void</span>
<span class="nf">NotifyViaProbe</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">context</span><span class="p">,</span> <span class="kt">double</span> <span class="n">oldVal</span><span class="p">,</span> <span class="kt">double</span> <span class="n">newVal</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NS_LOG_DEBUG</span> <span class="p">(</span><span class="s">&quot;context: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">context</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; old &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">oldVal</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; new &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">newVal</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ipv4-packet-plot-example">
<h5>IPv4 Packet Plot Example<a class="headerlink" href="#ipv4-packet-plot-example" title="Permalink to this headline">¶</a></h5>
<p>The IPv4 packet plot example is based on the fifth.cc example from the <em>ns-3</em>
Tutorial.  It can be found in
<code class="docutils literal notranslate"><span class="pre">src/stats/examples/ipv4-packet-plot-example.cc</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>      node 0                 node 1
+----------------+    +----------------+
|    ns-3 TCP    |    |    ns-3 TCP    |
+----------------+    +----------------+
|    10.1.1.1    |    |    10.1.1.2    |
+----------------+    +----------------+
| point-to-point |    | point-to-point |
+----------------+    +----------------+
        |                     |
        +---------------------+
</pre></div>
</div>
<p>We’ll just look at the Probe, as it illustrates that Probes may also
unpack values from structures (in this case, packets) and report
those values as trace source outputs, rather than just passing through
the same type of data.</p>
<p>There are other aspects of this example that will be explained later in
the documentation.  The two types of data that are exported are the packet
itself (<cite>Output</cite>) and a count of the number of bytes in the packet
(<cite>OutputBytes</cite>).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TypeId</span>
<span class="n">Ipv4PacketProbe</span><span class="o">::</span><span class="n">GetTypeId</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;ns3::Ipv4PacketProbe&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">SetParent</span><span class="o">&lt;</span><span class="n">Probe</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">AddConstructor</span><span class="o">&lt;</span><span class="n">Ipv4PacketProbe</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">AddTraceSource</span> <span class="p">(</span> <span class="s">&quot;Output&quot;</span><span class="p">,</span>
                      <span class="s">&quot;The packet plus its IPv4 object and interface that serve as the output for this probe&quot;</span><span class="p">,</span>
                      <span class="n">MakeTraceSourceAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">Ipv4PacketProbe</span><span class="o">::</span><span class="n">m_output</span><span class="p">))</span>
    <span class="p">.</span><span class="n">AddTraceSource</span> <span class="p">(</span> <span class="s">&quot;OutputBytes&quot;</span><span class="p">,</span>
                      <span class="s">&quot;The number of bytes in the packet&quot;</span><span class="p">,</span>
                      <span class="n">MakeTraceSourceAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">Ipv4PacketProbe</span><span class="o">::</span><span class="n">m_outputBytes</span><span class="p">))</span>
  <span class="p">;</span>
  <span class="k">return</span> <span class="n">tid</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When the Probe’s trace sink gets a packet, if the Probe is enabled, then
it will output the packet on its <cite>Output</cite> trace source, but it will also
output the number of bytes on the <cite>OutputBytes</cite> trace source.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="n">Ipv4PacketProbe</span><span class="o">::</span><span class="n">TraceSink</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">Packet</span><span class="o">&gt;</span> <span class="n">packet</span><span class="p">,</span> <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Ipv4</span><span class="o">&gt;</span> <span class="n">ipv4</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">interface</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NS_LOG_FUNCTION</span> <span class="p">(</span><span class="k">this</span> <span class="o">&lt;&lt;</span> <span class="n">packet</span> <span class="o">&lt;&lt;</span> <span class="n">ipv4</span> <span class="o">&lt;&lt;</span> <span class="n">interface</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">IsEnabled</span> <span class="p">())</span>
    <span class="p">{</span>
      <span class="n">m_packet</span>    <span class="o">=</span> <span class="n">packet</span><span class="p">;</span>
      <span class="n">m_ipv4</span>      <span class="o">=</span> <span class="n">ipv4</span><span class="p">;</span>
      <span class="n">m_interface</span> <span class="o">=</span> <span class="n">interface</span><span class="p">;</span>
      <span class="n">m_output</span> <span class="p">(</span><span class="n">packet</span><span class="p">,</span> <span class="n">ipv4</span><span class="p">,</span> <span class="n">interface</span><span class="p">);</span>

      <span class="kt">uint32_t</span> <span class="n">packetSizeNew</span> <span class="o">=</span> <span class="n">packet</span><span class="o">-&gt;</span><span class="n">GetSize</span> <span class="p">();</span>
      <span class="n">m_outputBytes</span> <span class="p">(</span><span class="n">m_packetSizeOld</span><span class="p">,</span> <span class="n">packetSizeNew</span><span class="p">);</span>
      <span class="n">m_packetSizeOld</span> <span class="o">=</span> <span class="n">packetSizeNew</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="references">
<h4>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h4>
<dl class="citation">
<dt class="label" id="cic06"><span class="brackets">Cic06</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>)</span></dt>
<dd><p>Claudio Cicconetti, Enzo Mingozzi, Giovanni Stea, “An Integrated
Framework for Enabling Effective Data Collection and Statistical
Analysis with ns2, Workshop on ns-2 (WNS2), Pisa, Italy, October 2006.</p>
</dd>
</dl>
</div>
</div>
<span id="document-collector"></span><div class="section" id="collectors">
<h3>Collectors<a class="headerlink" href="#collectors" title="Permalink to this headline">¶</a></h3>
<p>This section is a placeholder to detail the functionalities provided by
the Collector
class to an <em>ns-3</em> simulation, and gives examples on how to code them
in a program.</p>
<p><strong>Note:</strong> As of ns-3.18, Collectors are still under development and
not yet provided as part of the framework.</p>
</div>
<span id="document-aggregator"></span><div class="section" id="aggregators">
<h3>Aggregators<a class="headerlink" href="#aggregators" title="Permalink to this headline">¶</a></h3>
<p>This section details the functionalities provided by the Aggregator
class to an <em>ns-3</em> simulation. This section is meant for users
interested in developing simulations with the <em>ns-3</em> tools and using
the Data Collection Framework, of which the Aggregator class is a
part, to generate data output with their simulation’s results.</p>
<div class="section" id="aggregator-overview">
<h4>Aggregator Overview<a class="headerlink" href="#aggregator-overview" title="Permalink to this headline">¶</a></h4>
<p>An Aggregator object is supposed to be hooked to one or more trace
sources in order to receive input. Aggregators are the end point of
the data collected by the network of Probes and Collectors during the
simulation.  It is the Aggregator’s job to take these values and
transform them into their final output format such as plain text
files, spreadsheet files, plots, or databases.</p>
<p>Typically, an aggregator is connected to one or more Collectors.  In
this manner, whenever the Collectors’ trace sources export new values,
the Aggregator can process the value so that it can be used in the
final output format where the data values will reside after the
simulation.</p>
<p>Note the following about Aggregators:</p>
<ul class="simple">
<li><p>Aggregators may be dynamically turned on and off during the
simulation with calls to <code class="docutils literal notranslate"><span class="pre">Enable()</span></code> and <code class="docutils literal notranslate"><span class="pre">Disable()</span></code>.  For
example, the aggregating of data may be turned off during the
simulation warmup phase, which means those values won’t be included
in the final output medium.</p></li>
<li><p>Aggregators receive data from Collectors via callbacks. When a
Collector is associated to an aggregator, a call to TraceConnect is
made to establish the Aggregator’s trace sink method as a callback.</p></li>
</ul>
<p>To date, two Aggregators have been implemented:</p>
<ul class="simple">
<li><p>GnuplotAggregator</p></li>
<li><p>FileAggregator</p></li>
</ul>
</div>
<div class="section" id="gnuplotaggregator">
<h4>GnuplotAggregator<a class="headerlink" href="#gnuplotaggregator" title="Permalink to this headline">¶</a></h4>
<p>The GnuplotAggregator produces output files used to make gnuplots.</p>
<p>The GnuplotAggregator will create 3 different files at the end of the
simulation:</p>
<ul class="simple">
<li><p>A space separated gnuplot data file</p></li>
<li><p>A gnuplot control file</p></li>
<li><p>A shell script to generate the gnuplot</p></li>
</ul>
<div class="section" id="creation">
<h5>Creation<a class="headerlink" href="#creation" title="Permalink to this headline">¶</a></h5>
<p>An object of type GnuplotAggregator will be created here to show what needs
to be done.</p>
<p>One declares a GnuplotAggregator in dynamic memory by using the smart
pointer class (Ptr&lt;T&gt;). To create a GnuplotAggregator in dynamic
memory with smart pointers, one just needs to call the <em>ns-3</em> method
<code class="docutils literal notranslate"><span class="pre">CreateObject()</span></code>.  The following code from
<code class="docutils literal notranslate"><span class="pre">src/stats/examples/gnuplot-aggregator-example.cc</span></code> shows
how to do this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">string</span> <span class="n">fileNameWithoutExtension</span> <span class="o">=</span> <span class="s">&quot;gnuplot-aggregator&quot;</span><span class="p">;</span>

<span class="c1">// Create an aggregator.</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">GnuplotAggregator</span><span class="o">&gt;</span> <span class="n">aggregator</span> <span class="o">=</span>
  <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">GnuplotAggregator</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">fileNameWithoutExtension</span><span class="p">);</span>
</pre></div>
</div>
<p>The first argument for the constructor, fileNameWithoutExtension, is
the name of the gnuplot related files to write with no extension.
This GnuplotAggregator will create a space separated gnuplot data file
named “gnuplot-aggregator.dat”, a gnuplot control file named
“gnuplot-aggregator.plt”, and a shell script to generate the gnuplot
named + “gnuplot-aggregator.sh”.</p>
<p>The gnuplot that is created can have its key in 4 different locations:</p>
<ul class="simple">
<li><p>No key</p></li>
<li><p>Key inside the plot (the default)</p></li>
<li><p>Key above the plot</p></li>
<li><p>Key below the plot</p></li>
</ul>
<p>The following gnuplot key location enum values are allowed to specify the key’s position:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">KeyLocation</span> <span class="p">{</span>
  <span class="n">NO_KEY</span><span class="p">,</span>
  <span class="n">KEY_INSIDE</span><span class="p">,</span>
  <span class="n">KEY_ABOVE</span><span class="p">,</span>
  <span class="n">KEY_BELOW</span>
<span class="p">};</span>
</pre></div>
</div>
<p>If it was desired to have the key below rather than the default position of inside, then you could do the following.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">SetKeyLocation</span><span class="p">(</span><span class="n">GnuplotAggregator</span><span class="o">::</span><span class="n">KEY_BELOW</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<p>One example will be discussed in detail here:</p>
<ul class="simple">
<li><p>Gnuplot Aggregator Example</p></li>
</ul>
<div class="section" id="gnuplot-aggregator-example">
<h6>Gnuplot Aggregator Example<a class="headerlink" href="#gnuplot-aggregator-example" title="Permalink to this headline">¶</a></h6>
<p>An example that exercises the GnuplotAggregator can be found in
<code class="docutils literal notranslate"><span class="pre">src/stats/examples/gnuplot-aggregator-example.cc</span></code>.</p>
<p>The following 2-D gnuplot was created using the example.</p>
<div class="figure align-default" id="id3">
<span id="gnuplot-aggregator"></span><img alt="_images/gnuplot-aggregator.png" src="_images/gnuplot-aggregator.png" />
<p class="caption"><span class="caption-text">2-D Gnuplot Created by gnuplot-aggregator-example.cc Example.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>This code from the example shows how to construct the
GnuplotAggregator as was discussed above.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">Create2dPlot</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

  <span class="n">string</span> <span class="n">fileNameWithoutExtension</span> <span class="o">=</span> <span class="s">&quot;gnuplot-aggregator&quot;</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">plotTitle</span>                <span class="o">=</span> <span class="s">&quot;Gnuplot Aggregator Plot&quot;</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">plotXAxisHeading</span>         <span class="o">=</span> <span class="s">&quot;Time (seconds)&quot;</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">plotYAxisHeading</span>         <span class="o">=</span> <span class="s">&quot;Double Values&quot;</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">plotDatasetLabel</span>         <span class="o">=</span> <span class="s">&quot;Data Values&quot;</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">datasetContext</span>           <span class="o">=</span> <span class="s">&quot;Dataset/Context/String&quot;</span><span class="p">;</span>

  <span class="c1">// Create an aggregator.</span>
  <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">GnuplotAggregator</span><span class="o">&gt;</span> <span class="n">aggregator</span> <span class="o">=</span>
    <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">GnuplotAggregator</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">fileNameWithoutExtension</span><span class="p">);</span>
</pre></div>
</div>
<p>Various GnuplotAggregator attributes are set including the 2-D dataset
that will be plotted.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Set the aggregator&#39;s properties.</span>
<span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">SetTerminal</span> <span class="p">(</span><span class="s">&quot;png&quot;</span><span class="p">);</span>
<span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">SetTitle</span> <span class="p">(</span><span class="n">plotTitle</span><span class="p">);</span>
<span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">SetLegend</span> <span class="p">(</span><span class="n">plotXAxisHeading</span><span class="p">,</span> <span class="n">plotYAxisHeading</span><span class="p">);</span>

<span class="c1">// Add a data set to the aggregator.</span>
<span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Add2dDataset</span> <span class="p">(</span><span class="n">datasetContext</span><span class="p">,</span> <span class="n">plotDatasetLabel</span><span class="p">);</span>

<span class="c1">// aggregator must be turned on</span>
<span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Enable</span> <span class="p">();</span>
</pre></div>
</div>
<p>Next, the 2-D values are calculated, and each one is individually
written to the GnuplotAggregator using the <code class="docutils literal notranslate"><span class="pre">Write2d()</span></code> function.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="kt">double</span> <span class="n">time</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">value</span><span class="p">;</span>

  <span class="c1">// Create the 2-D dataset.</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">time</span> <span class="o">&lt;=</span> <span class="o">+</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">time</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// Calculate the 2-D curve</span>
      <span class="c1">//</span>
      <span class="c1">//                   2</span>
      <span class="c1">//     value  =  time   .</span>
      <span class="c1">//</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">time</span> <span class="o">*</span> <span class="n">time</span><span class="p">;</span>

      <span class="c1">// Add this point to the plot.</span>
      <span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Write2d</span> <span class="p">(</span><span class="n">datasetContext</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="c1">// Disable logging of data for the aggregator.</span>
  <span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Disable</span> <span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fileaggregator">
<h4>FileAggregator<a class="headerlink" href="#fileaggregator" title="Permalink to this headline">¶</a></h4>
<p>The FileAggregator sends the values it receives to a file.</p>
<p>The FileAggregator can create 4 different types of files:</p>
<ul class="simple">
<li><p>Formatted</p></li>
<li><p>Space separated (the default)</p></li>
<li><p>Comma separated</p></li>
<li><p>Tab separated</p></li>
</ul>
<p>Formatted files use C-style format strings and the sprintf() function
to print their values in the file being written.</p>
<div class="section" id="id1">
<h5>Creation<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<p>An object of type FileAggregator will be created here to show what needs
to be done.</p>
<p>One declares a FileAggregator in dynamic memory by using the smart
pointer class (Ptr&lt;T&gt;). To create a FileAggregator in dynamic memory
with smart pointers, one just needs to call the <em>ns-3</em> method
CreateObject.  The following code from
<code class="docutils literal notranslate"><span class="pre">src/stats/examples/file-aggregator-example.cc</span></code> shows how
to do this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">string</span> <span class="n">fileName</span>       <span class="o">=</span> <span class="s">&quot;file-aggregator-formatted-values.txt&quot;</span><span class="p">;</span>

<span class="c1">// Create an aggregator that will have formatted values.</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FileAggregator</span><span class="o">&gt;</span> <span class="n">aggregator</span> <span class="o">=</span>
  <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">FileAggregator</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">FileAggregator</span><span class="o">::</span><span class="n">FORMATTED</span><span class="p">);</span>
</pre></div>
</div>
<p>The first argument for the constructor, filename, is the name of the
file to write; the second argument, fileType, is type of file to
write. This FileAggregator will create a file named
“file-aggregator-formatted-values.txt” with its values printed as
specified by fileType, i.e., formatted in this case.</p>
<p>The following file type enum values are allowed:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">FileType</span> <span class="p">{</span>
  <span class="n">FORMATTED</span><span class="p">,</span>
  <span class="n">SPACE_SEPARATED</span><span class="p">,</span>
  <span class="n">COMMA_SEPARATED</span><span class="p">,</span>
  <span class="n">TAB_SEPARATED</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Examples<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<p>One example will be discussed in detail here:</p>
<ul class="simple">
<li><p>File Aggregator Example</p></li>
</ul>
<div class="section" id="file-aggregator-example">
<h6>File Aggregator Example<a class="headerlink" href="#file-aggregator-example" title="Permalink to this headline">¶</a></h6>
<p>An example that exercises the FileAggregator can be found in
<code class="docutils literal notranslate"><span class="pre">src/stats/examples/file-aggregator-example.cc</span></code>.</p>
<p>The following text file with 2 columns of values separated by commas
was created using the example.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span>
<span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">16</span>
<span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span>
<span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span>
<span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">1</span>
<span class="mi">2</span><span class="p">,</span><span class="mi">4</span>
<span class="mi">3</span><span class="p">,</span><span class="mi">9</span>
<span class="mi">4</span><span class="p">,</span><span class="mi">16</span>
<span class="mi">5</span><span class="p">,</span><span class="mi">25</span>
</pre></div>
</div>
<p>This code from the example shows how to construct the
FileAggregator as was discussed above.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">CreateCommaSeparatedFile</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

  <span class="n">string</span> <span class="n">fileName</span>       <span class="o">=</span> <span class="s">&quot;file-aggregator-comma-separated.txt&quot;</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">datasetContext</span> <span class="o">=</span> <span class="s">&quot;Dataset/Context/String&quot;</span><span class="p">;</span>

  <span class="c1">// Create an aggregator.</span>
  <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FileAggregator</span><span class="o">&gt;</span> <span class="n">aggregator</span> <span class="o">=</span>
    <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">FileAggregator</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">FileAggregator</span><span class="o">::</span><span class="n">COMMA_SEPARATED</span><span class="p">);</span>
</pre></div>
</div>
<p>FileAggregator attributes are set.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// aggregator must be turned on</span>
<span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Enable</span> <span class="p">();</span>
</pre></div>
</div>
<p>Next, the 2-D values are calculated, and each one is individually
written to the FileAggregator using the <code class="docutils literal notranslate"><span class="pre">Write2d()</span></code> function.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="kt">double</span> <span class="n">time</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">value</span><span class="p">;</span>

  <span class="c1">// Create the 2-D dataset.</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">time</span> <span class="o">&lt;=</span> <span class="o">+</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">time</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// Calculate the 2-D curve</span>
      <span class="c1">//</span>
      <span class="c1">//                   2</span>
      <span class="c1">//     value  =  time   .</span>
      <span class="c1">//</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">time</span> <span class="o">*</span> <span class="n">time</span><span class="p">;</span>

      <span class="c1">// Add this point to the plot.</span>
      <span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Write2d</span> <span class="p">(</span><span class="n">datasetContext</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="c1">// Disable logging of data for the aggregator.</span>
  <span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Disable</span> <span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following text file with 2 columns of formatted values was also
created using the example.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Time</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.000e+00</span>     <span class="n">Value</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">Time</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4.000e+00</span>     <span class="n">Value</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">Time</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.000e+00</span>     <span class="n">Value</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">Time</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.000e+00</span>     <span class="n">Value</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">Time</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.000e+00</span>     <span class="n">Value</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Time</span> <span class="o">=</span> <span class="mf">0.000e+00</span>      <span class="n">Value</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Time</span> <span class="o">=</span> <span class="mf">1.000e+00</span>      <span class="n">Value</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Time</span> <span class="o">=</span> <span class="mf">2.000e+00</span>      <span class="n">Value</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">Time</span> <span class="o">=</span> <span class="mf">3.000e+00</span>      <span class="n">Value</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">Time</span> <span class="o">=</span> <span class="mf">4.000e+00</span>      <span class="n">Value</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">Time</span> <span class="o">=</span> <span class="mf">5.000e+00</span>      <span class="n">Value</span> <span class="o">=</span> <span class="mi">25</span>
</pre></div>
</div>
<p>This code from the example shows how to construct the
FileAggregator as was discussed above.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">CreateFormattedFile</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

  <span class="n">string</span> <span class="n">fileName</span>       <span class="o">=</span> <span class="s">&quot;file-aggregator-formatted-values.txt&quot;</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">datasetContext</span> <span class="o">=</span> <span class="s">&quot;Dataset/Context/String&quot;</span><span class="p">;</span>

  <span class="c1">// Create an aggregator that will have formatted values.</span>
  <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FileAggregator</span><span class="o">&gt;</span> <span class="n">aggregator</span> <span class="o">=</span>
    <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">FileAggregator</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">FileAggregator</span><span class="o">::</span><span class="n">FORMATTED</span><span class="p">);</span>
</pre></div>
</div>
<p>FileAggregator attributes are set, including the C-style format string
to use.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Set the format for the values.</span>
<span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Set2dFormat</span> <span class="p">(</span><span class="s">&quot;Time = %.3e</span><span class="se">\t</span><span class="s">Value = %.0f&quot;</span><span class="p">);</span>

<span class="c1">// aggregator must be turned on</span>
<span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Enable</span> <span class="p">();</span>
</pre></div>
</div>
<p>Next, the 2-D values are calculated, and each one is individually
written to the FileAggregator using the <code class="docutils literal notranslate"><span class="pre">Write2d()</span></code> function.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>  <span class="kt">double</span> <span class="n">time</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">value</span><span class="p">;</span>

  <span class="c1">// Create the 2-D dataset.</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">time</span> <span class="o">&lt;=</span> <span class="o">+</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">time</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// Calculate the 2-D curve</span>
      <span class="c1">//</span>
      <span class="c1">//                   2</span>
      <span class="c1">//     value  =  time   .</span>
      <span class="c1">//</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">time</span> <span class="o">*</span> <span class="n">time</span><span class="p">;</span>

      <span class="c1">// Add this point to the plot.</span>
      <span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Write2d</span> <span class="p">(</span><span class="n">datasetContext</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="c1">// Disable logging of data for the aggregator.</span>
  <span class="n">aggregator</span><span class="o">-&gt;</span><span class="n">Disable</span> <span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-adaptor"></span><div class="section" id="adaptors">
<h3>Adaptors<a class="headerlink" href="#adaptors" title="Permalink to this headline">¶</a></h3>
<p>This section details the functionalities provided by the Adaptor
class to an <em>ns-3</em> simulation. This section is meant for users
interested in developing simulations with the <em>ns-3</em> tools and using
the Data Collection Framework, of which the Adaptor class is a
part, to generate data output with their simulation’s results.</p>
<p>Note:  the term ‘adaptor’ may also be spelled ‘adapter’; we chose
the spelling aligned with the C++ standard.</p>
<div class="section" id="adaptor-overview">
<h4>Adaptor Overview<a class="headerlink" href="#adaptor-overview" title="Permalink to this headline">¶</a></h4>
<p>An Adaptor is used to make connections between different types of DCF
objects.</p>
<p>To date, one Adaptor has been implemented:</p>
<ul class="simple">
<li><p>TimeSeriesAdaptor</p></li>
</ul>
</div>
<div class="section" id="time-series-adaptor">
<h4>Time Series Adaptor<a class="headerlink" href="#time-series-adaptor" title="Permalink to this headline">¶</a></h4>
<p>The TimeSeriesAdaptor lets Probes connect directly to Aggregators
without needing any Collector in between.</p>
<p>Both of the implemented DCF helpers utilize TimeSeriesAdaptors
in order to take probed values of different types and output the
current time plus the value with both converted to doubles.</p>
<p>The role of the TimeSeriesAdaptor class is that of an adaptor, which
takes raw-valued probe data of different types and outputs a tuple of
two double values.  The first is a timestamp, which may be set to
different resolutions (e.g. Seconds, Milliseconds, etc.) in the future
but which is presently hardcoded to Seconds.
The second is the conversion of a non-double
value to a double value (possibly with loss of precision).</p>
</div>
</div>
<span id="document-scope-and-limitations"></span><div class="section" id="scope-limitations">
<h3>Scope/Limitations<a class="headerlink" href="#scope-limitations" title="Permalink to this headline">¶</a></h3>
<p>This section discusses the scope and limitations of the Data
Collection Framework.</p>
<p>Currently, only these Probes have been implemented in DCF:</p>
<ul class="simple">
<li><p>BooleanProbe</p></li>
<li><p>DoubleProbe</p></li>
<li><p>Uinteger8Probe</p></li>
<li><p>Uinteger16Probe</p></li>
<li><p>Uinteger32Probe</p></li>
<li><p>TimeProbe</p></li>
<li><p>PacketProbe</p></li>
<li><p>ApplicationPacketProbe</p></li>
<li><p>Ipv4PacketProbe</p></li>
</ul>
<p>Currently, no Collectors are available in the DCF, although a
BasicStatsCollector is under development.</p>
<p>Currently, only these Aggregators have been implemented in DCF:</p>
<ul class="simple">
<li><p>GnuplotAggregator</p></li>
<li><p>FileAggregator</p></li>
</ul>
<p>Currently, only this Adaptor has been implemented in DCF:</p>
<p>Time-Series Adaptor.</p>
<div class="section" id="future-work">
<h4>Future Work<a class="headerlink" href="#future-work" title="Permalink to this headline">¶</a></h4>
<p>This section discusses the future work to be done on the Data
Collection Framework.</p>
<p>Here are some things that still need to be done:</p>
<ul class="simple">
<li><p>Hook up more trace sources in <em>ns-3</em> code to get more values out of the simulator.</p></li>
<li><p>Implement more types of Probes than there currently are.</p></li>
<li><p>Implement more than just the single current 2-D Collector, BasicStatsCollector.</p></li>
<li><p>Implement more Aggregators.</p></li>
<li><p>Implement more than just Adaptors.</p></li>
</ul>
</div>
</div>
</div>
</div>
<span id="document-statistics"></span><div class="section" id="statistical-framework">
<h2>Statistical Framework<a class="headerlink" href="#statistical-framework" title="Permalink to this headline">¶</a></h2>
<p>This chapter outlines work on simulation data collection and the
statistical framework for ns-3.</p>
<p>The source code for the statistical framework lives in the directory
<code class="docutils literal notranslate"><span class="pre">src/stats</span></code>.</p>
<div class="section" id="goals">
<h3>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h3>
<p>Primary objectives for this effort are the following:</p>
<ul class="simple">
<li><p>Provide functionality to record, calculate, and present data and statistics for analysis of network simulations.</p></li>
<li><p>Boost simulation performance by reducing the need to generate extensive trace logs in order to collect data.</p></li>
<li><p>Enable simulation control via online statistics, e.g. terminating simulations or repeating trials.</p></li>
</ul>
<p>Derived sub-goals and other target features include the following:</p>
<ul class="simple">
<li><p>Integration with the existing ns-3 tracing system as the basic instrumentation framework of the internal simulation engine, e.g. network stacks, net devices, and channels.</p></li>
<li><p>Enabling users to utilize the statistics framework without requiring use of the tracing system.</p></li>
<li><p>Helping users create, aggregate, and analyze data over multiple trials.</p></li>
<li><p>Support for user created instrumentation, e.g. of application specific events and measures.</p></li>
<li><p>Low memory and CPU overhead when the package is not in use.</p></li>
<li><p>Leveraging existing analysis and output tools as much as possible.  The framework may provide some basic statistics, but the focus is on collecting data and making it accessible for manipulation in established tools.</p></li>
<li><p>Eventual support for distributing independent replications is important but not included in the first round of features.</p></li>
</ul>
</div>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The statistics framework includes the following features:</p>
<ul class="simple">
<li><p>The core framework and two basic data collectors: A counter, and a min/max/avg/total observer.</p></li>
<li><p>Extensions of those to easily work with times and packets.</p></li>
<li><p>Plaintext output formatted for <a class="reference external" href="http://www.omnetpp.org">OMNet++</a>.</p></li>
<li><p>Database output using <a class="reference external" href="http://www.sqlite.org">SQLite</a>, a standalone, lightweight, high performance SQL engine.</p></li>
<li><p>Mandatory and open ended metadata for describing and working with runs.</p></li>
<li><p>An example based on the notional experiment of examining the properties of NS-3’s default ad hoc WiFi performance.  It incorporates the following:</p>
<ul>
<li><p>Constructs of a two node ad hoc WiFi network, with the nodes a parameterized distance apart.</p></li>
<li><p>UDP traffic source and sink applications with slightly different behavior and measurement hooks than the stock classes.</p></li>
<li><p>Data collection from the NS-3 core via existing trace signals, in particular data on frames transmitted and received by the WiFi MAC objects.</p></li>
<li><p>Instrumentation of custom applications by connecting new trace signals to the stat framework, as well as via direct updates.  Information is recorded about total packets sent and received, bytes transmitted, and end-to-end delay.</p></li>
<li><p>An example of using packet tags to track end-to-end delay.</p></li>
<li><p>A simple control script which runs a number of trials of the experiment at varying distances and queries the resulting database to produce a graph using GNUPlot.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="to-do">
<h3>To-Do<a class="headerlink" href="#to-do" title="Permalink to this headline">¶</a></h3>
<p>High priority items include:</p>
<ul class="simple">
<li><p>Inclusion of online statistics code, e.g. for memory efficient confidence intervals.</p></li>
<li><p>Provisions in the data collectors for terminating runs, i.e. when a threshold or confidence is met.</p></li>
<li><p>Data collectors for logging samples over time, and output to the various formats.</p></li>
<li><p>Demonstrate writing simple cyclic event glue to regularly poll some value.</p></li>
</ul>
<p>Each of those should prove straightforward to incorporate in the current framework.</p>
</div>
<div class="section" id="approach">
<h3>Approach<a class="headerlink" href="#approach" title="Permalink to this headline">¶</a></h3>
<p>The framework is based around the following core principles:</p>
<ul class="simple">
<li><p>One experiment trial is conducted by one instance of a simulation program, whether in parallel or serially.</p></li>
<li><p>A control script executes instances of the simulation, varying parameters as necessary.</p></li>
<li><p>Data is collected and stored for plotting and analysis using external scripts and existing tools.</p></li>
<li><p>Measures within the ns-3 core are taken by connecting the stat framework to existing trace signals.</p></li>
<li><p>Trace signals or direct manipulation of the framework may be used to instrument custom simulation code.</p></li>
</ul>
<p>Those basic components of the framework and their interactions are depicted in the following figure.</p>
<img alt="_images/Stat-framework-arch.png" src="_images/Stat-framework-arch.png" />
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>This section goes through the process of constructing an experiment in the framework and producing data for analysis (graphs) from it, demonstrating the structure and API along the way.</p>
<div class="section" id="question">
<h4>Question<a class="headerlink" href="#question" title="Permalink to this headline">¶</a></h4>
<p>‘’What is the (simulated) performance of ns-3’s WiFi NetDevices (using the default settings)?  How far apart can wireless nodes be in a simulation before they cannot communicate reliably?’’</p>
<ul class="simple">
<li><p>Hypothesis: Based on knowledge of real life performance, the nodes should communicate reasonably well to at least 100m apart.  Communication beyond 200m shouldn’t be feasible.</p></li>
</ul>
<p>Although not a very common question in simulation contexts, this is an important property of which simulation developers should have a basic understanding.  It is also a common study done on live hardware.</p>
</div>
<div class="section" id="simulation-program">
<h4>Simulation Program<a class="headerlink" href="#simulation-program" title="Permalink to this headline">¶</a></h4>
<p>The first thing to do in implementing this experiment is developing the simulation program.  The code for this example can be found in <code class="docutils literal notranslate"><span class="pre">examples/stats/wifi-example-sim.cc</span></code>.  It does the following main steps.</p>
<ul>
<li><p>Declaring parameters and parsing the command line using <code class="docutils literal notranslate"><span class="pre">ns3::CommandLine</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">distance</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">;</span>
<span class="n">string</span> <span class="nf">format</span> <span class="p">(</span><span class="s">&quot;OMNet++&quot;</span><span class="p">);</span>
<span class="n">string</span> <span class="nf">experiment</span> <span class="p">(</span><span class="s">&quot;wifi-distance-test&quot;</span><span class="p">);</span>
<span class="n">string</span> <span class="nf">strategy</span> <span class="p">(</span><span class="s">&quot;wifi-default&quot;</span><span class="p">);</span>
<span class="n">string</span> <span class="n">runID</span><span class="p">;</span>

<span class="n">COMMANDLINE</span> <span class="p">(</span><span class="n">cmd</span><span class="p">);</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">AddValue</span><span class="p">(</span><span class="s">&quot;distance&quot;</span><span class="p">,</span>   <span class="s">&quot;Distance apart to place nodes (in meters).&quot;</span><span class="p">,</span> <span class="n">distance</span><span class="p">);</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">AddValue</span><span class="p">(</span><span class="s">&quot;format&quot;</span><span class="p">,</span>     <span class="s">&quot;Format to use for data output.&quot;</span><span class="p">,</span>             <span class="n">format</span><span class="p">);</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">AddValue</span><span class="p">(</span><span class="s">&quot;experiment&quot;</span><span class="p">,</span> <span class="s">&quot;Identifier for experiment.&quot;</span><span class="p">,</span>                 <span class="n">experiment</span><span class="p">);</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">AddValue</span><span class="p">(</span><span class="s">&quot;strategy&quot;</span><span class="p">,</span>   <span class="s">&quot;Identifier for strategy.&quot;</span><span class="p">,</span>                   <span class="n">strategy</span><span class="p">);</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">AddValue</span><span class="p">(</span><span class="s">&quot;run&quot;</span><span class="p">,</span>        <span class="s">&quot;Identifier for run.&quot;</span><span class="p">,</span>                        <span class="n">runID</span><span class="p">);</span>
<span class="n">cmd</span><span class="p">.</span><span class="n">Parse</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Creating nodes and network stacks using <code class="docutils literal notranslate"><span class="pre">ns3::NodeContainer</span></code>, <code class="docutils literal notranslate"><span class="pre">ns3::WiFiHelper</span></code>, and <code class="docutils literal notranslate"><span class="pre">ns3::InternetStackHelper</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NodeContainer</span> <span class="n">nodes</span><span class="p">;</span>
<span class="n">nodes</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="n">WifiHelper</span> <span class="n">wifi</span><span class="p">;</span>
<span class="n">wifi</span><span class="p">.</span><span class="n">SetMac</span><span class="p">(</span><span class="s">&quot;ns3::AdhocWifiMac&quot;</span><span class="p">);</span>
<span class="n">wifi</span><span class="p">.</span><span class="n">SetPhy</span><span class="p">(</span><span class="s">&quot;ns3::WifiPhy&quot;</span><span class="p">);</span>
<span class="n">NetDeviceContainer</span> <span class="n">nodeDevices</span> <span class="o">=</span> <span class="n">wifi</span><span class="p">.</span><span class="n">Install</span><span class="p">(</span><span class="n">nodes</span><span class="p">);</span>

<span class="n">InternetStackHelper</span> <span class="n">internet</span><span class="p">;</span>
<span class="n">internet</span><span class="p">.</span><span class="n">Install</span><span class="p">(</span><span class="n">nodes</span><span class="p">);</span>
<span class="n">Ipv4AddressHelper</span> <span class="n">ipAddrs</span><span class="p">;</span>
<span class="n">ipAddrs</span><span class="p">.</span><span class="n">SetBase</span><span class="p">(</span><span class="s">&quot;192.168.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;255.255.255.0&quot;</span><span class="p">);</span>
<span class="n">ipAddrs</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="n">nodeDevices</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Positioning the nodes using <code class="docutils literal notranslate"><span class="pre">ns3::MobilityHelper</span></code>.  By default the nodes have static mobility and won’t move, but must be positioned the given distance apart.  There are several ways to do this; it is done here using <code class="docutils literal notranslate"><span class="pre">ns3::ListPositionAllocator</span></code>, which draws positions from a given list.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MobilityHelper</span> <span class="n">mobility</span><span class="p">;</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ListPositionAllocator</span><span class="o">&gt;</span> <span class="n">positionAlloc</span> <span class="o">=</span>
  <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">ListPositionAllocator</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">positionAlloc</span><span class="o">-&gt;</span><span class="n">Add</span><span class="p">(</span><span class="n">Vector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">));</span>
<span class="n">positionAlloc</span><span class="o">-&gt;</span><span class="n">Add</span><span class="p">(</span><span class="n">Vector</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">));</span>
<span class="n">mobility</span><span class="p">.</span><span class="n">SetPositionAllocator</span><span class="p">(</span><span class="n">positionAlloc</span><span class="p">);</span>
<span class="n">mobility</span><span class="p">.</span><span class="n">Install</span><span class="p">(</span><span class="n">nodes</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Installing a traffic generator and a traffic sink.  The stock <code class="docutils literal notranslate"><span class="pre">Applications</span></code> could be used, but the example includes custom objects in <code class="docutils literal notranslate"><span class="pre">src/test/test02-apps.(cc|h)</span></code>.  These have a simple behavior, generating a given number of packets spaced at a given interval.  As there is only one of each they are installed manually; for a larger set the <code class="docutils literal notranslate"><span class="pre">ns3::ApplicationHelper</span></code> class could be used.  The commented-out <code class="docutils literal notranslate"><span class="pre">Config::Set</span></code> line changes the destination of the packets, set to broadcast by default in this example.  Note that in general WiFi may have different performance for broadcast and unicast frames due to different rate control and MAC retransmission policies.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">appSource</span> <span class="o">=</span> <span class="n">NodeList</span><span class="o">::</span><span class="n">GetNode</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Sender</span><span class="o">&gt;</span> <span class="n">sender</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Sender</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">appSource</span><span class="o">-&gt;</span><span class="n">AddApplication</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span>
<span class="n">sender</span><span class="o">-&gt;</span><span class="n">Start</span><span class="p">(</span><span class="n">Seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>

<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">appSink</span> <span class="o">=</span> <span class="n">NodeList</span><span class="o">::</span><span class="n">GetNode</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Receiver</span><span class="o">&gt;</span> <span class="n">receiver</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">Receiver</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">appSink</span><span class="o">-&gt;</span><span class="n">AddApplication</span><span class="p">(</span><span class="n">receiver</span><span class="p">);</span>
<span class="n">receiver</span><span class="o">-&gt;</span><span class="n">Start</span><span class="p">(</span><span class="n">Seconds</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

<span class="c1">//  Config::Set(&quot;/NodeList/*/ApplicationList/*/$Sender/Destination&quot;,</span>
<span class="c1">//              Ipv4AddressValue(&quot;192.168.0.2&quot;));</span>
</pre></div>
</div>
</li>
<li><p>Configuring the data and statistics to be collected.  The basic paradigm is that an <code class="docutils literal notranslate"><span class="pre">ns3::DataCollector</span></code> object is created to hold information about this particular run, to which observers and calculators are attached to actually generate data.  Importantly, run information includes labels for the ‘’experiment’’, ‘’strategy’’, ‘’input’’, and ‘’run’’.  These are used to later identify and easily group data from multiple trials.</p>
<ul class="simple">
<li><p>The experiment is the study of which this trial is a member.  Here it is on WiFi performance and distance.</p></li>
<li><p>The strategy is the code or parameters being examined in this trial.  In this example it is fixed, but an obvious extension would be to investigate different WiFi bit rates, each of which would be a different strategy.</p></li>
<li><p>The input is the particular problem given to this trial.  Here it is simply the distance between the two nodes.</p></li>
<li><p>The runID is a unique identifier for this trial with which it’s information is tagged for identification in later analysis.  If no run ID is given the example program makes a (weak) run ID using the current time.</p></li>
</ul>
<p>Those four pieces of metadata are required, but more may be desired.  They may be added to the record using the <code class="docutils literal notranslate"><span class="pre">ns3::DataCollector::AddMetadata()</span></code> method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">DataCollector</span> <span class="n">data</span><span class="p">;</span>
<span class="n">data</span><span class="p">.</span><span class="n">DescribeRun</span><span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">strategy</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">runID</span><span class="p">);</span>
<span class="n">data</span><span class="p">.</span><span class="n">AddMetadata</span><span class="p">(</span><span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="s">&quot;tjkopena&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Actual observation and calculating is done by <code class="docutils literal notranslate"><span class="pre">ns3::DataCalculator</span></code> objects, of which several different types exist.  These are created by the simulation program, attached to reporting or sampling code, and then registered with the <code class="docutils literal notranslate"><span class="pre">ns3::DataCollector</span></code> so they will be queried later for their output.  One easy observation mechanism is to use existing trace sources, for example to instrument objects in the ns-3 core without changing their code.  Here a counter is attached directly to a trace signal in the WiFi MAC layer on the target node.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">PacketCounterCalculator</span><span class="o">&gt;</span> <span class="n">totalRx</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">PacketCounterCalculator</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">totalRx</span><span class="o">-&gt;</span><span class="n">SetKey</span><span class="p">(</span><span class="s">&quot;wifi-rx-frames&quot;</span><span class="p">);</span>
<span class="n">Config</span><span class="o">::</span><span class="n">Connect</span><span class="p">(</span><span class="s">&quot;/NodeList/1/DeviceList/*/$ns3::WifiNetDevice/Rx&quot;</span><span class="p">,</span>
                <span class="n">MakeCallback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PacketCounterCalculator</span><span class="o">::</span><span class="n">FrameUpdate</span><span class="p">,</span> <span class="n">totalRx</span><span class="p">));</span>
<span class="n">data</span><span class="p">.</span><span class="n">AddDataCalculator</span><span class="p">(</span><span class="n">totalRx</span><span class="p">);</span>
</pre></div>
</div>
<p>Calculators may also be manipulated directly.  In this example, a counter is created and passed to the traffic sink application to be updated when packets are received.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">CounterCalculator</span><span class="o">&lt;&gt;</span> <span class="o">&gt;</span> <span class="n">appRx</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">CounterCalculator</span><span class="o">&lt;&gt;</span> <span class="o">&gt;</span><span class="p">();</span>
<span class="n">appRx</span><span class="o">-&gt;</span><span class="n">SetKey</span><span class="p">(</span><span class="s">&quot;receiver-rx-packets&quot;</span><span class="p">);</span>
<span class="n">receiver</span><span class="o">-&gt;</span><span class="n">SetCounter</span><span class="p">(</span><span class="n">appRx</span><span class="p">);</span>
<span class="n">data</span><span class="p">.</span><span class="n">AddDataCalculator</span><span class="p">(</span><span class="n">appRx</span><span class="p">);</span>
</pre></div>
</div>
<p>To increment the count, the sink’s packet processing code then calls one of the calculator’s update methods.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">m_calc</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">();</span>
</pre></div>
</div>
<p>The program includes several other examples as well, using both the primitive calculators such as <code class="docutils literal notranslate"><span class="pre">ns3::CounterCalculator</span></code> and those adapted for observing packets and times.  In <code class="docutils literal notranslate"><span class="pre">src/test/test02-apps.(cc|h)</span></code> it also creates a simple custom tag which it uses to track end-to-end delay for generated packets, reporting results to a <code class="docutils literal notranslate"><span class="pre">ns3::TimeMinMaxAvgTotalCalculator</span></code> data calculator.</p>
</li>
<li><p>Running the simulation, which is very straightforward once constructed.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Simulator</span><span class="o">::</span><span class="n">Run</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>Generating either <a class="reference external" href="http://www.omnetpp.org">OMNet++</a> or <a class="reference external" href="http://www.sqlite.org">SQLite</a> output, depending on the command line arguments.  To do this a <code class="docutils literal notranslate"><span class="pre">ns3::DataOutputInterface</span></code> object is created and configured.  The specific type of this will determine the output format.  This object is then given the <code class="docutils literal notranslate"><span class="pre">ns3::DataCollector</span></code> object which it interrogates to produce the output.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DataOutputInterface</span><span class="o">&gt;</span> <span class="n">output</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">format</span> <span class="o">==</span> <span class="s">&quot;OMNet++&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">NS_LOG_INFO</span><span class="p">(</span><span class="s">&quot;Creating OMNet++ formatted data output.&quot;</span><span class="p">);</span>
  <span class="n">output</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">OmnetDataOutput</span><span class="o">&gt;</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="cp">#   ifdef STAT_USE_DB</span>
    <span class="n">NS_LOG_INFO</span><span class="p">(</span><span class="s">&quot;Creating SQLite formatted data output.&quot;</span><span class="p">);</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">CreateObject</span><span class="o">&lt;</span><span class="n">SqliteDataOutput</span><span class="o">&gt;</span><span class="p">();</span>
<span class="cp">#   endif</span>
<span class="p">}</span>

<span class="n">output</span><span class="o">-&gt;</span><span class="n">Output</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Freeing any memory used by the simulation.  This should come at the end of the main function for the example.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Simulator</span><span class="o">::</span><span class="n">Destroy</span><span class="p">();</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="logging">
<h5>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h5>
<p>To see what the example program, applications, and stat framework are doing in detail, set the <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> variable appropriately.  The following will provide copious output from all three.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">NS_LOG</span><span class="o">=</span>WiFiDistanceExperiment:WiFiDistanceApps
</pre></div>
</div>
<p>Note that this slows down the simulation extraordinarily.</p>
</div>
<div class="section" id="sample-output">
<h5>Sample Output<a class="headerlink" href="#sample-output" title="Permalink to this headline">¶</a></h5>
<p>Compiling and simply running the test program will append <a class="reference external" href="http://www.omnetpp.org">OMNet++</a> formatted output such as the following to <code class="docutils literal notranslate"><span class="pre">data.sca</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>run run-1212239121

attr experiment &quot;wifi-distance-test&quot;
attr strategy &quot;wifi-default&quot;
attr input &quot;50&quot;
attr description &quot;&quot;

attr &quot;author&quot; &quot;tjkopena&quot;

scalar wifi-tx-frames count 30
scalar wifi-rx-frames count 30
scalar sender-tx-packets count 30
scalar receiver-rx-packets count 30
scalar tx-pkt-size count 30
scalar tx-pkt-size total 1920
scalar tx-pkt-size average 64
scalar tx-pkt-size max 64
scalar tx-pkt-size min 64
scalar delay count 30
scalar delay total 5884980ns
scalar delay average 196166ns
scalar delay max 196166ns
scalar delay min 196166ns
</pre></div>
</div>
</div>
</div>
<div class="section" id="control-script">
<h4>Control Script<a class="headerlink" href="#control-script" title="Permalink to this headline">¶</a></h4>
<p>In order to automate data collection at a variety of inputs (distances), a simple Bash script is used to execute a series of simulations.  It can be found at <code class="docutils literal notranslate"><span class="pre">examples/stats/wifi-example-db.sh</span></code>.  The script is meant to be run from the <code class="docutils literal notranslate"><span class="pre">examples/stats/</span></code> directory.</p>
<p>The script runs through a set of distances, collecting the results into an <a class="reference external" href="http://www.sqlite.org">SQLite</a> database.  At each distance five trials are conducted to give a better picture of expected performance.  The entire experiment takes only a few dozen seconds to run on a low end machine as there is no output during the simulation and little traffic is generated.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="nv">DISTANCES</span><span class="o">=</span><span class="s2">&quot;25 50 75 100 125 145 147 150 152 155 157 160 162 165 167 170 172 175 177 180&quot;</span>
<span class="nv">TRIALS</span><span class="o">=</span><span class="s2">&quot;1 2 3 4 5&quot;</span>

<span class="nb">echo</span> WiFi Experiment Example

<span class="k">if</span> <span class="o">[</span> -e data.db <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> Kill data.db?
  <span class="nb">read</span> ANS
  <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$ANS</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span> -o <span class="s2">&quot;</span><span class="nv">$ANS</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span> <span class="o">]</span>
  <span class="k">then</span>
    <span class="nb">echo</span> Deleting database
    rm data.db
  <span class="k">fi</span>
<span class="k">fi</span>

<span class="k">for</span> trial in <span class="nv">$TRIALS</span>
<span class="k">do</span>
  <span class="k">for</span> distance in <span class="nv">$DISTANCES</span>
  <span class="k">do</span>
    <span class="nb">echo</span> Trial <span class="nv">$trial</span>, distance <span class="nv">$distance</span>
    ./bin/test02 --format<span class="o">=</span>db --distance<span class="o">=</span><span class="nv">$distance</span> --run<span class="o">=</span>run-<span class="nv">$distance</span>-<span class="nv">$trial</span>
  <span class="k">done</span>
<span class="k">done</span>
</pre></div>
</div>
</div>
<div class="section" id="analysis-and-conclusion">
<h4>Analysis and Conclusion<a class="headerlink" href="#analysis-and-conclusion" title="Permalink to this headline">¶</a></h4>
<p>Once all trials have been conducted, the script executes a simple SQL query over the database using the <a class="reference external" href="http://www.sqlite.org">SQLite</a> command line program.  The query computes average packet loss in each set of trials associated with each distance.  It does not take into account different strategies, but the information is present in the database to make some simple extensions and do so.  The collected data is then passed to GNUPlot for graphing.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">CMD</span><span class="o">=</span><span class="ss">&quot;select exp.input,avg(100-((rx.value*100)/tx.value)) \</span>
<span class="ss">    from Singletons rx, Singletons tx, Experiments exp \</span>
<span class="ss">    where rx.run = tx.run AND \</span>
<span class="ss">          rx.run = exp.run AND \</span>
<span class="ss">          rx.name=&#39;receiver-rx-packets&#39; AND \</span>
<span class="ss">          tx.name=&#39;sender-tx-packets&#39; \</span>
<span class="ss">    group by exp.input \</span>
<span class="ss">    order by abs(exp.input) ASC;&quot;</span>

<span class="n">sqlite3</span> <span class="o">-</span><span class="n">noheader</span> <span class="k">data</span><span class="p">.</span><span class="n">db</span> <span class="ss">&quot;$CMD&quot;</span> <span class="o">&gt;</span> <span class="n">wifi</span><span class="o">-</span><span class="k">default</span><span class="p">.</span><span class="k">data</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="ss">&quot;s/|/   /&quot;</span> <span class="n">wifi</span><span class="o">-</span><span class="k">default</span><span class="p">.</span><span class="k">data</span>
<span class="n">gnuplot</span> <span class="n">wifi</span><span class="o">-</span><span class="n">example</span><span class="p">.</span><span class="n">gnuplot</span>
</pre></div>
</div>
<p>The GNUPlot script found at <code class="docutils literal notranslate"><span class="pre">examples/stats/wifi-example.gnuplot</span></code> simply defines the output format and some basic formatting for the graph.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> terminal postscript portrait enhanced lw <span class="m">2</span> <span class="s2">&quot;Helvetica&quot;</span> <span class="m">14</span>

<span class="nb">set</span> size <span class="m">1</span>.0, <span class="m">0</span>.66

<span class="c1">#-------------------------------------------------------</span>
<span class="nb">set</span> out <span class="s2">&quot;wifi-default.eps&quot;</span>
<span class="c1">#set title &quot;Packet Loss Over Distance&quot;</span>
<span class="nb">set</span> xlabel <span class="s2">&quot;Distance (m) --- average of 5 trials per point&quot;</span>
<span class="nb">set</span> xrange <span class="o">[</span><span class="m">0</span>:200<span class="o">]</span>
<span class="nb">set</span> ylabel <span class="s2">&quot;% Packet Loss&quot;</span>
<span class="nb">set</span> yrange <span class="o">[</span><span class="m">0</span>:110<span class="o">]</span>

plot <span class="s2">&quot;wifi-default.data&quot;</span> with lines title <span class="s2">&quot;WiFi Defaults&quot;</span>
</pre></div>
</div>
<div class="section" id="end-result">
<h5>End Result<a class="headerlink" href="#end-result" title="Permalink to this headline">¶</a></h5>
<p>The resulting graph provides no evidence that the default WiFi model’s performance is necessarily unreasonable and lends some confidence to an at least token faithfulness to reality.  More importantly, this simple investigation has been carried all the way through using the statistical framework.  Success!</p>
<img alt="_images/Wifi-default.png" src="_images/Wifi-default.png" />
</div>
</div>
</div>
</div>
<span id="document-realtime"></span><div class="section" id="realtime">
<h2>RealTime<a class="headerlink" href="#realtime" title="Permalink to this headline">¶</a></h2>
<p><em>ns-3</em> has been designed for integration into testbed and virtual machine
environments. To integrate with real network stacks and emit/consume packets, a
real-time scheduler is needed to try to lock the simulation clock with the
hardware clock. We describe here a component of this: the RealTime scheduler.</p>
<p>The purpose of the realtime scheduler is to cause the progression of the
simulation clock to occur synchronously with respect to some external time base.
Without the presence of an external time base (wall clock), simulation time
jumps instantly from one simulated time to the next.</p>
<div class="section" id="behavior">
<h3>Behavior<a class="headerlink" href="#behavior" title="Permalink to this headline">¶</a></h3>
<p>When using a non-realtime scheduler (the default in <em>ns-3</em>), the simulator
advances the simulation time to the next scheduled event. During event
execution, simulation time is frozen. With the realtime scheduler, the behavior
is similar from the perspective of simulation models (i.e., simulation time is
frozen during event execution), but between events, the simulator will attempt
to keep the simulation clock aligned with the machine clock.</p>
<p>When an event is finished executing, and the scheduler moves to the next event,
the scheduler compares the next event execution time with the machine clock.  If
the next event is scheduled for a future time, the simulator sleeps until that
realtime is reached and then executes the next event.</p>
<p>It may happen that, due to the processing inherent in the execution of
simulation events, that the simulator cannot keep up with realtime.  In such a
case, it is up to the user configuration what to do. There are two <em>ns-3</em>
attributes that govern the behavior. The first is
<code class="docutils literal notranslate"><span class="pre">ns3::RealTimeSimulatorImpl::SynchronizationMode</span></code>. The two entries possible
for this attribute are <code class="docutils literal notranslate"><span class="pre">BestEffort</span></code> (the default) or <code class="docutils literal notranslate"><span class="pre">HardLimit</span></code>. In
“BestEffort” mode, the simulator will just try to catch up to realtime by
executing events until it reaches a point where the next event is in the
(realtime) future, or else the simulation ends. In BestEffort mode, then, it is
possible for the simulation to consume more time than the wall clock time. The
other option “HardLimit” will cause the simulation to abort if the tolerance
threshold is exceeded.  This attribute is
<code class="docutils literal notranslate"><span class="pre">ns3::RealTimeSimulatorImpl::HardLimit</span></code> and the default is 0.1 seconds.</p>
<p>A different mode of operation is one in which simulated time is <strong>not</strong> frozen
during an event execution. This mode of realtime simulation was implemented but
removed from the <em>ns-3</em> tree because of questions of whether it would be useful.
If users are interested in a realtime simulator for which simulation time does
not freeze during event execution (i.e., every call to <code class="docutils literal notranslate"><span class="pre">Simulator::Now()</span></code>
returns the current wall clock time, not the time at which the event started
executing), please contact the ns-developers mailing list.</p>
</div>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h3>
<p>The usage of the realtime simulator is straightforward, from a scripting
perspective.  Users just need to set the attribute
<code class="docutils literal notranslate"><span class="pre">SimulatorImplementationType</span></code> to the Realtime simulator, such as follows:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">GlobalValue</span><span class="o">::</span><span class="n">Bind</span> <span class="p">(</span><span class="s">&quot;SimulatorImplementationType&quot;</span><span class="p">,</span>
  <span class="n">StringValue</span> <span class="p">(</span><span class="s">&quot;ns3::RealtimeSimulatorImpl&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>There is a script in <code class="docutils literal notranslate"><span class="pre">examples/realtime/realtime-udp-echo.cc</span></code> that
has an example of how to configure the realtime behavior.  Try:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run realtime-udp-echo
</pre></div>
</div>
<p>Whether the simulator will work in a best effort or hard limit policy fashion is
governed by the attributes explained in the previous section.</p>
</div>
<div class="section" id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h3>
<p>The implementation is contained in the following files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">src/core/model/realtime-simulator-impl.{cc,h}</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/core/model/wall-clock-synchronizer.{cc,h}</span></code></p></li>
</ul>
<p>In order to create a realtime scheduler, to a first approximation you just want
to cause simulation time jumps to consume real time. We propose doing this using
a combination of sleep- and busy- waits. Sleep-waits cause the calling process
(thread) to yield the processor for some amount of time. Even though this
specified amount of time can be passed to nanosecond resolution, it is actually
converted to an OS-specific granularity. In Linux, the granularity is called a
Jiffy. Typically this resolution is insufficient for our needs (on the order of
a ten milliseconds), so we round down and sleep for some smaller number of
Jiffies. The process is then awakened after the specified number of Jiffies has
passed. At this time, we have some residual time to wait. This time is generally
smaller than the minimum sleep time, so we busy-wait for the remainder of the
time. This means that the thread just sits in a for loop consuming cycles until
the desired time arrives. After the combination of sleep- and busy-waits, the
elapsed realtime (wall) clock should agree with the simulation time of the next
event and the simulation proceeds.</p>
</div>
</div>
<span id="document-helpers"></span><div class="section" id="helpers">
<h2>Helpers<a class="headerlink" href="#helpers" title="Permalink to this headline">¶</a></h2>
<p>The above chapters introduced you to various <em>ns-3</em> programming concepts such as
smart pointers for reference-counted memory management, attributes, namespaces,
callbacks, etc. Users who work at this low-level API can interconnect <em>ns-3</em>
objects with fine granularity. However, a simulation program written entirely
using the low-level API would be quite long and tedious to code. For this
reason, a separate so-called “helper API” has been overlaid on the core <em>ns-3</em>
API. If you have read the <em>ns-3</em> tutorial, you will already be familiar with the
helper API, since it is the API that new users are typically introduced to
first.  In this chapter, we introduce the design philosophy of the helper API
and contrast it to the low-level API. If you become a heavy user of <em>ns-3</em>, you
will likely move back and forth between these APIs even in the same program.</p>
<p>The helper API has a few goals:</p>
<ol class="arabic simple">
<li><p>the rest of <code class="docutils literal notranslate"><span class="pre">src/</span></code> has no dependencies on the helper API; anything that can
be done with the helper API can be coded also at the low-level API</p></li>
<li><p><strong>Containers:</strong> Often simulations will need to do a number of identical
actions to groups of objects. The helper API makes heavy use of containers of
similar objects to which similar or identical operations can be performed.</p></li>
<li><p>The helper API is not generic; it does not strive to maximize code reuse. So,
programming constructs such as polymorphism and templates that achieve code
reuse are not as prevalent. For instance, there are separate CsmaNetDevice
helpers and PointToPointNetDevice helpers but they do not derive from a
common NetDevice base class.</p></li>
<li><p>The helper API typically works with stack-allocated (vs. heap-allocated)
objects. For some programs, <em>ns-3</em> users may not need to worry about any low
level Object Create or Ptr handling; they can make do with containers of
objects and stack-allocated helpers that operate on them.</p></li>
</ol>
<p>The helper API is really all about making <em>ns-3</em> programs easier to write and
read, without taking away the power of the low-level interface. The rest of this
chapter provides some examples of the programming conventions of the helper API.</p>
</div>
<span id="document-utilities"></span><div class="section" id="utilities">
<span id="id1"></span><h2>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h2>
<div class="section" id="print-introspected-doxygen">
<h3>Print-introspected-doxygen<a class="headerlink" href="#print-introspected-doxygen" title="Permalink to this headline">¶</a></h3>
<p><cite>print-introspected-doxygen</cite> is used to generate doxygen documentation
using various TypeIds defined throughout the <em>ns-3</em> source code.
The tool returns the various config paths, attributes, trace sources,
etc. for the various files in <em>ns-3</em>.</p>
<div class="section" id="invocation">
<h4>Invocation<a class="headerlink" href="#invocation" title="Permalink to this headline">¶</a></h4>
<p>This tool is run automatically by the build system when generating
the Doxygen API docs, so you don’t normally have to run it by hand.</p>
<p>However, since it does give a fair bit of information about TypeIds
it can be useful to run from the command line and
search for specific information.</p>
<p>To run it, simply open terminal and type</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run print-introspected-doxygen
</pre></div>
</div>
<p>This will give all the output, formatted for Doxygen, which can be viewed
in a text editor.</p>
<p>One way to use this is to capture it to a file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run print-introspected-doxygen &gt; doc.html
</pre></div>
</div>
<p>Some users might prefer to use tools like grep
to locate the required piece of information from the documentation
instead of using an editor. For such uses-cases and more,
<cite>print-introspected-doxygen</cite> can return plain text:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run <span class="s2">&quot;print-introspected-doxygen --output-text&quot;</span>
</pre></div>
</div>
<p>(Note the quotes around the inner command and options.)</p>
<blockquote>
<div><p>$ ./waf –run “print-introspected-doxygen –output-text” | grep “hello”</p>
</div></blockquote>
<p>This will output the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>* HelloInterval: HELLO messages emission interval.
* DeletePeriod: DeletePeriod is intended to provide an upper bound on the <span class="nb">time</span> <span class="k">for</span> which an upstream node A can have a neighbor B as an active next hop <span class="k">for</span> destination D, <span class="k">while</span> B has invalidated the route to D. <span class="o">=</span> <span class="m">5</span> * max <span class="o">(</span>HelloInterval, ActiveRouteTimeout<span class="o">)</span>
* AllowedHelloLoss: Number of hello messages which may be loss <span class="k">for</span> valid link.
* EnableHello: Indicates whether a hello messages enable.
* HelloInterval: HELLO messages emission interval.
* HelloInterval: HELLO messages emission interval.
* DeletePeriod: DeletePeriod is intended to provide an upper bound on the <span class="nb">time</span> <span class="k">for</span> which an upstream node A can have a neighbor B as an active next hop <span class="k">for</span> destination D, <span class="k">while</span> B has invalidated the route to D. <span class="o">=</span> <span class="m">5</span> * max <span class="o">(</span>HelloInterval, ActiveRouteTimeout<span class="o">)</span>
* AllowedHelloLoss: Number of hello messages which may be loss <span class="k">for</span> valid link.
* EnableHello: Indicates whether a hello messages enable.
* HelloInterval: HELLO messages emission interval.
</pre></div>
</div>
</div>
</div>
<div class="section" id="bench-simulator">
<h3>Bench-simulator<a class="headerlink" href="#bench-simulator" title="Permalink to this headline">¶</a></h3>
<p>This tool is used to benchmark the scheduler algorithms used in <em>ns-3</em>.</p>
<div class="section" id="command-line-arguments">
<h4>Command-line Arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run <span class="s2">&quot;bench-simulator --help&quot;</span>

Program Options:
    --cal:    use CalendarSheduler <span class="o">[</span>false<span class="o">]</span>
    --heap:   use HeapScheduler <span class="o">[</span>false<span class="o">]</span>
    --list:   use ListSheduler <span class="o">[</span>false<span class="o">]</span>
    --map:    use MapScheduler <span class="o">(</span>default<span class="o">)</span> <span class="o">[</span>true<span class="o">]</span>
    --debug:  <span class="nb">enable</span> debugging output <span class="o">[</span>false<span class="o">]</span>
    --pop:    event population size <span class="o">(</span>default 1E5<span class="o">)</span> <span class="o">[</span><span class="m">100000</span><span class="o">]</span>
    --total:  total number of events to run <span class="o">(</span>default 1E6<span class="o">)</span> <span class="o">[</span><span class="m">1000000</span><span class="o">]</span>
    --runs:   number of runs <span class="o">(</span>default <span class="m">1</span><span class="o">)</span> <span class="o">[</span><span class="m">1</span><span class="o">]</span>
    --file:   file of relative event <span class="nb">times</span> <span class="o">[]</span>
    --prec:   printed output precision <span class="o">[</span><span class="m">6</span><span class="o">]</span>
</pre></div>
</div>
<p>You can change the Scheduler being benchmarked by passing
the appropriate flags, for example if you want to
benchmark the CalendarScheduler pass <cite>–cal</cite> to the program.</p>
<p>The default total number of events, runs or population size
can be overridden by passing <cite>–total=value</cite>, <cite>–runs=value</cite>
and <cite>–pop=value</cite> respectively.</p>
<p>If you want to use event distribution which is stored in a file,
you can pass the file option by <cite>–file=FILE_NAME</cite>.</p>
<p><cite>–prec</cite> can be used to change the output precision value and
<cite>–debug</cite> as the name suggests enables debugging.</p>
</div>
<div class="section" id="id2">
<h4>Invocation<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>To run it, simply open the terminal and type</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run bench-simulator
</pre></div>
</div>
<p>It will show something like this depending upon the scheduler being benchmarked:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ns3-dev-bench-simulator-debug:
ns3-dev-bench-simulator-debug: scheduler: ns3::MapScheduler
ns3-dev-bench-simulator-debug: population: <span class="m">100000</span>
ns3-dev-bench-simulator-debug: total events: <span class="m">1000000</span>
ns3-dev-bench-simulator-debug: runs: <span class="m">1</span>
ns3-dev-bench-simulator-debug: using default exponential distribution

Run        Inititialization:                   Simulation:
            Time <span class="o">(</span>s<span class="o">)</span>    Rate <span class="o">(</span>ev/s<span class="o">)</span> Per <span class="o">(</span>s/ev<span class="o">)</span>  Time <span class="o">(</span>s<span class="o">)</span>    Rate <span class="o">(</span>ev/s<span class="o">)</span> Per <span class="o">(</span>s/ev<span class="o">)</span>
----------- ----------- ----------- ----------- ----------- ----------- -----------
<span class="o">(</span>prime<span class="o">)</span>     <span class="m">0</span>.4         <span class="m">250000</span>      4e-06       <span class="m">1</span>.84        <span class="m">543478</span>      <span class="m">1</span>.84e-06
<span class="m">0</span>           <span class="m">0</span>.15        <span class="m">666667</span>      <span class="m">1</span>.5e-06     <span class="m">1</span>.86        <span class="m">537634</span>      <span class="m">1</span>.86e-06
</pre></div>
</div>
<p>Suppose we had to benchmark <cite>CalendarScheduler</cite> instead, we would have written</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run <span class="s2">&quot;bench-simulator --cal&quot;</span>
</pre></div>
</div>
<p>And the output would look something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ns3-dev-bench-simulator-debug:
ns3-dev-bench-simulator-debug: scheduler: ns3::CalendarScheduler
ns3-dev-bench-simulator-debug: population: <span class="m">100000</span>
ns3-dev-bench-simulator-debug: total events: <span class="m">1000000</span>
ns3-dev-bench-simulator-debug: runs: <span class="m">1</span>
ns3-dev-bench-simulator-debug: using default exponential distribution

Run        Inititialization:                   Simulation:
            Time <span class="o">(</span>s<span class="o">)</span>    Rate <span class="o">(</span>ev/s<span class="o">)</span> Per <span class="o">(</span>s/ev<span class="o">)</span>  Time <span class="o">(</span>s<span class="o">)</span>    Rate <span class="o">(</span>ev/s<span class="o">)</span> Per <span class="o">(</span>s/ev<span class="o">)</span>
----------- ----------- ----------- ----------- ----------- ----------- -----------
<span class="o">(</span>prime<span class="o">)</span>     <span class="m">1</span>.19        <span class="m">84033</span>.6     <span class="m">1</span>.19e-05    <span class="m">32</span>.03       <span class="m">31220</span>.7     <span class="m">3</span>.203e-05
<span class="m">0</span>           <span class="m">0</span>.99        <span class="m">101010</span>      <span class="m">9</span>.9e-06     <span class="m">31</span>.22       <span class="m">32030</span>.7     <span class="m">3</span>.122e-05
<span class="sb">```</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-gnuplot"></span><div class="section" id="making-plots-using-the-gnuplot-class">
<h2>Making Plots using the Gnuplot Class<a class="headerlink" href="#making-plots-using-the-gnuplot-class" title="Permalink to this headline">¶</a></h2>
<p>There are 2 common methods to make a plot using <em>ns-3</em> and gnuplot (<a class="reference external" href="http://www.gnuplot.info">http://www.gnuplot.info</a>):</p>
<ol class="arabic simple">
<li><p>Create a gnuplot control file using <em>ns-3</em>’s Gnuplot class.</p></li>
<li><p>Create a gnuplot data file using values generated by <em>ns-3</em>.</p></li>
</ol>
<p>This section is about method 1, i.e. it is about how to make a plot using <em>ns-3</em>’s Gnuplot class.  If you are interested in method 2, see the “A Real Example” subsection under the “Tracing” section in the <em>ns-3</em> <a class="reference external" href="http://www.nsnam.org/tutorials.html">Tutorial</a>.</p>
<div class="section" id="creating-plots-using-the-gnuplot-class">
<h3>Creating Plots Using the Gnuplot Class<a class="headerlink" href="#creating-plots-using-the-gnuplot-class" title="Permalink to this headline">¶</a></h3>
<p>The following steps must be taken in order to create a plot using <em>ns-3</em>’s Gnuplot class:</p>
<ol class="arabic simple">
<li><p>Modify your code so that is uses the Gnuplot class and its functions.</p></li>
<li><p>Run your code so that it creates a gnuplot control file.</p></li>
<li><p>Call gnuplot with the name of the gnuplot control file.</p></li>
<li><p>View the graphics file that was produced in your favorite graphics viewer.</p></li>
</ol>
<p>See the code from the example plots that are discussed below for details on step 1.</p>
</div>
<div class="section" id="an-example-program-that-uses-the-gnuplot-class">
<h3>An Example Program that Uses the Gnuplot Class<a class="headerlink" href="#an-example-program-that-uses-the-gnuplot-class" title="Permalink to this headline">¶</a></h3>
<p>An example program that uses <em>ns-3</em>’s Gnuplot class can be found here:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>src/stats/examples/gnuplot-example.cc
</pre></div>
</div>
<p>In order to run this example, do the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run src/stats/examples/gnuplot-example
</pre></div>
</div>
<p>This should produce the following gnuplot control files:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>plot-2d.plt
plot-2d-with-error-bars.plt
plot-3d.plt
</pre></div>
</div>
<p>In order to process these gnuplot control files, do the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gnuplot plot-2d.plt
$ gnuplot plot-2d-with-error-bars.plt
$ gnuplot plot-3d.plt
</pre></div>
</div>
<p>This should produce the following graphics files:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>plot-2d.png
plot-2d-with-error-bars.png
plot-3d.png
</pre></div>
</div>
<p>You can view these graphics files in your favorite graphics viewer.  If you have gimp installed on your machine, for example, you can do this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gimp plot-2d.png
$ gimp plot-2d-with-error-bars.png
$ gimp plot-3d.png
</pre></div>
</div>
</div>
<div class="section" id="an-example-2-dimensional-plot">
<h3>An Example 2-Dimensional Plot<a class="headerlink" href="#an-example-2-dimensional-plot" title="Permalink to this headline">¶</a></h3>
<p>The following 2-Dimensional plot</p>
<div class="figure align-default" id="plot-2d">
<img alt="_images/plot-2d.png" src="_images/plot-2d.png" />
</div>
<p>was created using the following code from gnuplot-example.cc:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">string</span> <span class="n">fileNameWithNoExtension</span> <span class="o">=</span> <span class="s">&quot;plot-2d&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">graphicsFileName</span>        <span class="o">=</span> <span class="n">fileNameWithNoExtension</span> <span class="o">+</span> <span class="s">&quot;.png&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">plotFileName</span>            <span class="o">=</span> <span class="n">fileNameWithNoExtension</span> <span class="o">+</span> <span class="s">&quot;.plt&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">plotTitle</span>               <span class="o">=</span> <span class="s">&quot;2-D Plot&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">dataTitle</span>               <span class="o">=</span> <span class="s">&quot;2-D Data&quot;</span><span class="p">;</span>

<span class="c1">// Instantiate the plot and set its title.</span>
<span class="n">Gnuplot</span> <span class="nf">plot</span> <span class="p">(</span><span class="n">graphicsFileName</span><span class="p">);</span>
<span class="n">plot</span><span class="p">.</span><span class="n">SetTitle</span> <span class="p">(</span><span class="n">plotTitle</span><span class="p">);</span>

<span class="c1">// Make the graphics file, which the plot file will create when it</span>
<span class="c1">// is used with Gnuplot, be a PNG file.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">SetTerminal</span> <span class="p">(</span><span class="s">&quot;png&quot;</span><span class="p">);</span>

<span class="c1">// Set the labels for each axis.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">SetLegend</span> <span class="p">(</span><span class="s">&quot;X Values&quot;</span><span class="p">,</span> <span class="s">&quot;Y Values&quot;</span><span class="p">);</span>

<span class="c1">// Set the range for the x axis.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AppendExtra</span> <span class="p">(</span><span class="s">&quot;set xrange [-6:+6]&quot;</span><span class="p">);</span>

<span class="c1">// Instantiate the dataset, set its title, and make the points be</span>
<span class="c1">// plotted along with connecting lines.</span>
<span class="n">Gnuplot2dDataset</span> <span class="n">dataset</span><span class="p">;</span>
<span class="n">dataset</span><span class="p">.</span><span class="n">SetTitle</span> <span class="p">(</span><span class="n">dataTitle</span><span class="p">);</span>
<span class="n">dataset</span><span class="p">.</span><span class="n">SetStyle</span> <span class="p">(</span><span class="n">Gnuplot2dDataset</span><span class="o">::</span><span class="n">LINES_POINTS</span><span class="p">);</span>

<span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">y</span><span class="p">;</span>

<span class="c1">// Create the 2-D dataset.</span>
<span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="o">+</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// Calculate the 2-D curve</span>
    <span class="c1">//</span>
    <span class="c1">//            2</span>
    <span class="c1">//     y  =  x   .</span>
    <span class="c1">//</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span>

    <span class="c1">// Add this point.</span>
    <span class="n">dataset</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
  <span class="p">}</span>

<span class="c1">// Add the dataset to the plot.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AddDataset</span> <span class="p">(</span><span class="n">dataset</span><span class="p">);</span>

<span class="c1">// Open the plot file.</span>
<span class="n">ofstream</span> <span class="nf">plotFile</span> <span class="p">(</span><span class="n">plotFileName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

<span class="c1">// Write the plot file.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">GenerateOutput</span> <span class="p">(</span><span class="n">plotFile</span><span class="p">);</span>

<span class="c1">// Close the plot file.</span>
<span class="n">plotFile</span><span class="p">.</span><span class="n">close</span> <span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="an-example-2-dimensional-plot-with-error-bars">
<h3>An Example 2-Dimensional Plot with Error Bars<a class="headerlink" href="#an-example-2-dimensional-plot-with-error-bars" title="Permalink to this headline">¶</a></h3>
<p>The following 2-Dimensional plot with error bars in the x and y directions</p>
<div class="figure align-default" id="plot-2d-with-error-bars">
<img alt="_images/plot-2d-with-error-bars.png" src="_images/plot-2d-with-error-bars.png" />
</div>
<p>was created using the following code from gnuplot-example.cc:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">string</span> <span class="n">fileNameWithNoExtension</span> <span class="o">=</span> <span class="s">&quot;plot-2d-with-error-bars&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">graphicsFileName</span>        <span class="o">=</span> <span class="n">fileNameWithNoExtension</span> <span class="o">+</span> <span class="s">&quot;.png&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">plotFileName</span>            <span class="o">=</span> <span class="n">fileNameWithNoExtension</span> <span class="o">+</span> <span class="s">&quot;.plt&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">plotTitle</span>               <span class="o">=</span> <span class="s">&quot;2-D Plot With Error Bars&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">dataTitle</span>               <span class="o">=</span> <span class="s">&quot;2-D Data With Error Bars&quot;</span><span class="p">;</span>

<span class="c1">// Instantiate the plot and set its title.</span>
<span class="n">Gnuplot</span> <span class="nf">plot</span> <span class="p">(</span><span class="n">graphicsFileName</span><span class="p">);</span>
<span class="n">plot</span><span class="p">.</span><span class="n">SetTitle</span> <span class="p">(</span><span class="n">plotTitle</span><span class="p">);</span>

<span class="c1">// Make the graphics file, which the plot file will create when it</span>
<span class="c1">// is used with Gnuplot, be a PNG file.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">SetTerminal</span> <span class="p">(</span><span class="s">&quot;png&quot;</span><span class="p">);</span>

<span class="c1">// Set the labels for each axis.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">SetLegend</span> <span class="p">(</span><span class="s">&quot;X Values&quot;</span><span class="p">,</span> <span class="s">&quot;Y Values&quot;</span><span class="p">);</span>

<span class="c1">// Set the range for the x axis.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AppendExtra</span> <span class="p">(</span><span class="s">&quot;set xrange [-6:+6]&quot;</span><span class="p">);</span>

<span class="c1">// Instantiate the dataset, set its title, and make the points be</span>
<span class="c1">// plotted with no connecting lines.</span>
<span class="n">Gnuplot2dDataset</span> <span class="n">dataset</span><span class="p">;</span>
<span class="n">dataset</span><span class="p">.</span><span class="n">SetTitle</span> <span class="p">(</span><span class="n">dataTitle</span><span class="p">);</span>
<span class="n">dataset</span><span class="p">.</span><span class="n">SetStyle</span> <span class="p">(</span><span class="n">Gnuplot2dDataset</span><span class="o">::</span><span class="n">POINTS</span><span class="p">);</span>

<span class="c1">// Make the dataset have error bars in both the x and y directions.</span>
<span class="n">dataset</span><span class="p">.</span><span class="n">SetErrorBars</span> <span class="p">(</span><span class="n">Gnuplot2dDataset</span><span class="o">::</span><span class="n">XY</span><span class="p">);</span>

<span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">xErrorDelta</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">yErrorDelta</span><span class="p">;</span>

<span class="c1">// Create the 2-D dataset.</span>
<span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="o">+</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// Calculate the 2-D curve</span>
    <span class="c1">//</span>
    <span class="c1">//            2</span>
    <span class="c1">//     y  =  x   .</span>
    <span class="c1">//</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span>

    <span class="c1">// Make the uncertainty in the x direction be constant and make</span>
    <span class="c1">// the uncertainty in the y direction be a constant fraction of</span>
    <span class="c1">// y&#39;s value.</span>
    <span class="n">xErrorDelta</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">;</span>
    <span class="n">yErrorDelta</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>

    <span class="c1">// Add this point with uncertainties in both the x and y</span>
    <span class="c1">// direction.</span>
    <span class="n">dataset</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xErrorDelta</span><span class="p">,</span> <span class="n">yErrorDelta</span><span class="p">);</span>
  <span class="p">}</span>

<span class="c1">// Add the dataset to the plot.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AddDataset</span> <span class="p">(</span><span class="n">dataset</span><span class="p">);</span>

<span class="c1">// Open the plot file.</span>
<span class="n">ofstream</span> <span class="nf">plotFile</span> <span class="p">(</span><span class="n">plotFileName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

<span class="c1">// Write the plot file.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">GenerateOutput</span> <span class="p">(</span><span class="n">plotFile</span><span class="p">);</span>

<span class="c1">// Close the plot file.</span>
<span class="n">plotFile</span><span class="p">.</span><span class="n">close</span> <span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="an-example-3-dimensional-plot">
<h3>An Example 3-Dimensional Plot<a class="headerlink" href="#an-example-3-dimensional-plot" title="Permalink to this headline">¶</a></h3>
<p>The following 3-Dimensional plot</p>
<div class="figure align-default" id="plot-3d">
<img alt="_images/plot-3d.png" src="_images/plot-3d.png" />
</div>
<p>was created using the following code from gnuplot-example.cc:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>

<span class="n">string</span> <span class="n">fileNameWithNoExtension</span> <span class="o">=</span> <span class="s">&quot;plot-3d&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">graphicsFileName</span>        <span class="o">=</span> <span class="n">fileNameWithNoExtension</span> <span class="o">+</span> <span class="s">&quot;.png&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">plotFileName</span>            <span class="o">=</span> <span class="n">fileNameWithNoExtension</span> <span class="o">+</span> <span class="s">&quot;.plt&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">plotTitle</span>               <span class="o">=</span> <span class="s">&quot;3-D Plot&quot;</span><span class="p">;</span>
<span class="n">string</span> <span class="n">dataTitle</span>               <span class="o">=</span> <span class="s">&quot;3-D Data&quot;</span><span class="p">;</span>

<span class="c1">// Instantiate the plot and set its title.</span>
<span class="n">Gnuplot</span> <span class="nf">plot</span> <span class="p">(</span><span class="n">graphicsFileName</span><span class="p">);</span>
<span class="n">plot</span><span class="p">.</span><span class="n">SetTitle</span> <span class="p">(</span><span class="n">plotTitle</span><span class="p">);</span>

<span class="c1">// Make the graphics file, which the plot file will create when it</span>
<span class="c1">// is used with Gnuplot, be a PNG file.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">SetTerminal</span> <span class="p">(</span><span class="s">&quot;png&quot;</span><span class="p">);</span>

<span class="c1">// Rotate the plot 30 degrees around the x axis and then rotate the</span>
<span class="c1">// plot 120 degrees around the new z axis.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AppendExtra</span> <span class="p">(</span><span class="s">&quot;set view 30, 120, 1.0, 1.0&quot;</span><span class="p">);</span>

<span class="c1">// Make the zero for the z-axis be in the x-axis and y-axis plane.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AppendExtra</span> <span class="p">(</span><span class="s">&quot;set ticslevel 0&quot;</span><span class="p">);</span>

<span class="c1">// Set the labels for each axis.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AppendExtra</span> <span class="p">(</span><span class="s">&quot;set xlabel &#39;X Values&#39;&quot;</span><span class="p">);</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AppendExtra</span> <span class="p">(</span><span class="s">&quot;set ylabel &#39;Y Values&#39;&quot;</span><span class="p">);</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AppendExtra</span> <span class="p">(</span><span class="s">&quot;set zlabel &#39;Z Values&#39;&quot;</span><span class="p">);</span>

<span class="c1">// Set the ranges for the x and y axis.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AppendExtra</span> <span class="p">(</span><span class="s">&quot;set xrange [-5:+5]&quot;</span><span class="p">);</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AppendExtra</span> <span class="p">(</span><span class="s">&quot;set yrange [-5:+5]&quot;</span><span class="p">);</span>

<span class="c1">// Instantiate the dataset, set its title, and make the points be</span>
<span class="c1">// connected by lines.</span>
<span class="n">Gnuplot3dDataset</span> <span class="n">dataset</span><span class="p">;</span>
<span class="n">dataset</span><span class="p">.</span><span class="n">SetTitle</span> <span class="p">(</span><span class="n">dataTitle</span><span class="p">);</span>
<span class="n">dataset</span><span class="p">.</span><span class="n">SetStyle</span> <span class="p">(</span><span class="s">&quot;with lines&quot;</span><span class="p">);</span>

<span class="kt">double</span> <span class="n">x</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">y</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">z</span><span class="p">;</span>

<span class="c1">// Create the 3-D dataset.</span>
<span class="k">for</span> <span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="o">+</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="p">)</span>
  <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="o">+</span><span class="mf">5.0</span><span class="p">;</span> <span class="n">y</span> <span class="o">+=</span> <span class="mf">1.0</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="c1">// Calculate the 3-D surface</span>
        <span class="c1">//</span>
        <span class="c1">//            2      2</span>
        <span class="c1">//     z  =  x   *  y   .</span>
        <span class="c1">//</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>

        <span class="c1">// Add this point.</span>
        <span class="n">dataset</span><span class="p">.</span><span class="n">Add</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">);</span>
      <span class="p">}</span>

  <span class="c1">// The blank line is necessary at the end of each x value&#39;s data</span>
  <span class="c1">// points for the 3-D surface grid to work.</span>
  <span class="n">dataset</span><span class="p">.</span><span class="n">AddEmptyLine</span> <span class="p">();</span>
  <span class="p">}</span>

<span class="c1">// Add the dataset to the plot.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">AddDataset</span> <span class="p">(</span><span class="n">dataset</span><span class="p">);</span>

<span class="c1">// Open the plot file.</span>
<span class="n">ofstream</span> <span class="nf">plotFile</span> <span class="p">(</span><span class="n">plotFileName</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

<span class="c1">// Write the plot file.</span>
<span class="n">plot</span><span class="p">.</span><span class="n">GenerateOutput</span> <span class="p">(</span><span class="n">plotFile</span><span class="p">);</span>

<span class="c1">// Close the plot file.</span>
<span class="n">plotFile</span><span class="p">.</span><span class="n">close</span> <span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<span id="document-python"></span><div class="section" id="using-python-to-run-ns3">
<h2>Using Python to Run <em>ns-3</em><a class="headerlink" href="#using-python-to-run-ns3" title="Permalink to this headline">¶</a></h2>
<p>Python bindings allow the C++ code in <em>ns-3</em> to be called from Python.</p>
<p>This chapter shows you how to create a Python script that can run <em>ns-3</em> and also the process of creating Python bindings for a C++ <em>ns-3</em> module.</p>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>Python bindings provide support for importing <em>ns-3</em> model libraries as Python
modules.  Coverage of most of the <em>ns-3</em> C++ API is provided.  The intent
has been to allow the programmer to write complete simulation scripts in
Python, to allow integration of <em>ns-3</em> with other Python tools and workflows.
The intent is not to provide a different language choice to author new
<em>ns-3</em> models implemented in Python.</p>
<p>Python bindings for <em>ns-3</em> use a tool called PyBindGen (<a class="reference external" href="https://github.com/gjcarneiro/pybindgen">https://github.com/gjcarneiro/pybindgen</a>) to create Python modules from the C++ libraries built by
Waf.  The Python bindings that PyBindGen uses are maintained in a
<code class="docutils literal notranslate"><span class="pre">bindings</span></code> directory in each module, and must be maintained to match the
C++ API of that ns-3 module.  If the C++ API changes, the Python bindings file
must either be modified by hand accordingly, or the bindings must be
regenerated by an automated scanning process.</p>
<p>If a user is not interested in Python, he or she may disable the use of
Python bindings at Waf configure time.  In this case, changes to the C++
API of a provided module will not cause the module to fail to compile.</p>
<p>The process for automatically generating Python bindings relies on a toolchain
involving a development installation of the Clang compiler, a program called
CastXML (<a class="reference external" href="https://github.com/CastXML/CastXML">https://github.com/CastXML/CastXML</a>), and a program called
pygccxml (<a class="reference external" href="https://github.com/gccxml/pygccxml">https://github.com/gccxml/pygccxml</a>).  The toolchain can be installed
using the ns-3 <code class="docutils literal notranslate"><span class="pre">bake</span></code> build tool.</p>
</div>
<div class="section" id="an-example-python-script-that-runs-ns3">
<h3>An Example Python Script that Runs <em>ns-3</em><a class="headerlink" href="#an-example-python-script-that-runs-ns3" title="Permalink to this headline">¶</a></h3>
<p>Here is some example code that is written in Python and that runs <em>ns-3</em>, which is written in C++.  This Python example can be found in <code class="docutils literal notranslate"><span class="pre">examples/tutorial/first.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ns.applications</span>
<span class="kn">import</span> <span class="nn">ns.core</span>
<span class="kn">import</span> <span class="nn">ns.internet</span>
<span class="kn">import</span> <span class="nn">ns.network</span>
<span class="kn">import</span> <span class="nn">ns.point_to_point</span>

<span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LogComponentEnable</span><span class="p">(</span><span class="s2">&quot;UdpEchoClientApplication&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LOG_LEVEL_INFO</span><span class="p">)</span>
<span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LogComponentEnable</span><span class="p">(</span><span class="s2">&quot;UdpEchoServerApplication&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">LOG_LEVEL_INFO</span><span class="p">)</span>

<span class="n">nodes</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">NodeContainer</span><span class="p">()</span>
<span class="n">nodes</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="n">pointToPoint</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">point_to_point</span><span class="o">.</span><span class="n">PointToPointHelper</span><span class="p">()</span>
<span class="n">pointToPoint</span><span class="o">.</span><span class="n">SetDeviceAttribute</span><span class="p">(</span><span class="s2">&quot;DataRate&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StringValue</span><span class="p">(</span><span class="s2">&quot;5Mbps&quot;</span><span class="p">))</span>
<span class="n">pointToPoint</span><span class="o">.</span><span class="n">SetChannelAttribute</span><span class="p">(</span><span class="s2">&quot;Delay&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">StringValue</span><span class="p">(</span><span class="s2">&quot;2ms&quot;</span><span class="p">))</span>

<span class="n">devices</span> <span class="o">=</span> <span class="n">pointToPoint</span><span class="o">.</span><span class="n">Install</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

<span class="n">stack</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">internet</span><span class="o">.</span><span class="n">InternetStackHelper</span><span class="p">()</span>
<span class="n">stack</span><span class="o">.</span><span class="n">Install</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>

<span class="n">address</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">internet</span><span class="o">.</span><span class="n">Ipv4AddressHelper</span><span class="p">()</span>
<span class="n">address</span><span class="o">.</span><span class="n">SetBase</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Ipv4Address</span><span class="p">(</span><span class="s2">&quot;10.1.1.0&quot;</span><span class="p">),</span> <span class="n">ns</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Ipv4Mask</span><span class="p">(</span><span class="s2">&quot;255.255.255.0&quot;</span><span class="p">))</span>

<span class="n">interfaces</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">Assign</span> <span class="p">(</span><span class="n">devices</span><span class="p">);</span>

<span class="n">echoServer</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">UdpEchoServerHelper</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

<span class="n">serverApps</span> <span class="o">=</span> <span class="n">echoServer</span><span class="o">.</span><span class="n">Install</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">serverApps</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Seconds</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
<span class="n">serverApps</span><span class="o">.</span><span class="n">Stop</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Seconds</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span>

<span class="n">echoClient</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">UdpEchoClientHelper</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">echoClient</span><span class="o">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s2">&quot;MaxPackets&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">UintegerValue</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">echoClient</span><span class="o">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s2">&quot;Interval&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">TimeValue</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Seconds</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">)))</span>
<span class="n">echoClient</span><span class="o">.</span><span class="n">SetAttribute</span><span class="p">(</span><span class="s2">&quot;PacketSize&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">UintegerValue</span><span class="p">(</span><span class="mi">1024</span><span class="p">))</span>

<span class="n">clientApps</span> <span class="o">=</span> <span class="n">echoClient</span><span class="o">.</span><span class="n">Install</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">clientApps</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Seconds</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="n">clientApps</span><span class="o">.</span><span class="n">Stop</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Seconds</span><span class="p">(</span><span class="mf">10.0</span><span class="p">))</span>

<span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Simulator</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
<span class="n">ns</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Simulator</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="running-python-scripts">
<h3>Running Python Scripts<a class="headerlink" href="#running-python-scripts" title="Permalink to this headline">¶</a></h3>
<p>waf contains some options that automatically update the python path to find the ns3 module.  To run example programs, there are two ways to use waf to take care of this.  One is to run a waf shell; e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf shell
$ python examples/wireless/mixed-wireless.py
</pre></div>
</div>
<p>and the other is to use the –pyrun option to waf:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --pyrun examples/wireless/mixed-wireless.py
</pre></div>
</div>
<p>As of ns-3.30, a –pyrun-no-build option was added to allow the running of
a program without invoking a project rebuild.  This option may be useful
to improve execution time when running the same program repeatedly but with
different arguments, such as from scripts. It can be used in place of
–pyrun such as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --pyrun-no-build examples/wireless/mixed-wireless.py
</pre></div>
</div>
<p>To run a python script under the C debugger:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf shell
$ gdb --args python examples/wireless/mixed-wireless.py
</pre></div>
</div>
<p>To run your own Python script that calls <em>ns-3</em> and that has this path, <code class="docutils literal notranslate"><span class="pre">/path/to/your/example/my-script.py</span></code>, do the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf shell
$ python /path/to/your/example/my-script.py
</pre></div>
</div>
</div>
<div class="section" id="caveats">
<h3>Caveats<a class="headerlink" href="#caveats" title="Permalink to this headline">¶</a></h3>
<p>Python bindings for <em>ns-3</em> are a work in progress, and some limitations are known by developers.  Some of these limitations (not all) are listed here.</p>
<div class="section" id="incomplete-coverage">
<h4>Incomplete Coverage<a class="headerlink" href="#incomplete-coverage" title="Permalink to this headline">¶</a></h4>
<p>First of all, keep in mind that not 100% of the API is supported in Python.  Some of the reasons are:</p>
<ol class="arabic simple">
<li><p>some of the APIs involve pointers, which require knowledge of what kind of memory passing semantics (who owns what memory). Such knowledge is not part of the function signatures, and is either documented or sometimes not even documented.  Annotations are needed to bind those functions;</p></li>
<li><p>Sometimes a unusual fundamental data type or C++ construct is used which is not yet supported by PyBindGen;</p></li>
<li><p>GCC-XML does not report template based classes unless they are instantiated. (Note:  Need to confirm this limitation still exists with CastXML)</p></li>
</ol>
<p>Most of the missing APIs can be wrapped, given enough time, patience, and expertise, and will likely be wrapped if bug reports are submitted.  However, don’t file a bug report saying “bindings are incomplete”, because we do not have manpower to complete 100% of the bindings.</p>
</div>
<div class="section" id="conversion-constructors">
<h4>Conversion Constructors<a class="headerlink" href="#conversion-constructors" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://publib.boulder.ibm.com/infocenter/compbgpl/v9v111/topic/com.ibm.xlcpp9.bg.doc/language_ref/cplr384.htm">Conversion constructors</a> are not fully supported yet by PyBindGen, and they always act as explicit constructors when translating an API into Python.  For example, in C++ you can do this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ipv4AddressHelper</span> <span class="n">ipAddrs</span><span class="p">;</span>
<span class="n">ipAddrs</span><span class="p">.</span><span class="n">SetBase</span> <span class="p">(</span><span class="s">&quot;192.168.0.0&quot;</span><span class="p">,</span> <span class="s">&quot;255.255.255.0&quot;</span><span class="p">);</span>
<span class="n">ipAddrs</span><span class="p">.</span><span class="n">Assign</span> <span class="p">(</span><span class="n">backboneDevices</span><span class="p">);</span>
</pre></div>
</div>
<p>In Python, for the time being you have to do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ipAddrs</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">internet</span><span class="o">.</span><span class="n">Ipv4AddressHelper</span><span class="p">()</span>
<span class="n">ipAddrs</span><span class="o">.</span><span class="n">SetBase</span><span class="p">(</span><span class="n">ns</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Ipv4Address</span><span class="p">(</span><span class="s2">&quot;192.168.0.0&quot;</span><span class="p">),</span> <span class="n">ns</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Ipv4Mask</span><span class="p">(</span><span class="s2">&quot;255.255.255.0&quot;</span><span class="p">))</span>
<span class="n">ipAddrs</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span><span class="n">backboneDevices</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="commandline">
<h4>CommandLine<a class="headerlink" href="#commandline" title="Permalink to this headline">¶</a></h4>
<p><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CommandLine::AddValue()</span></code> works differently in Python than it does in <em>ns-3</em>.  In Python, the first parameter is a string that represents the command-line option name.  When the option is set, an attribute with the same name as the option name is set on the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">CommandLine()</span></code> object.  Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NUM_NODES_SIDE_DEFAULT</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">cmd</span> <span class="o">=</span> <span class="n">ns3</span><span class="o">.</span><span class="n">CommandLine</span><span class="p">()</span>

<span class="n">cmd</span><span class="o">.</span><span class="n">NumNodesSide</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">AddValue</span><span class="p">(</span><span class="s2">&quot;NumNodesSide&quot;</span><span class="p">,</span> <span class="s2">&quot;Grid side number of nodes (total number of nodes will be this number squared)&quot;</span><span class="p">)</span>

<span class="n">cmd</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>

<span class="p">[</span><span class="o">...</span><span class="p">]</span>

<span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">NumNodesSide</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">num_nodes_side</span> <span class="o">=</span> <span class="n">NUM_NODES_SIDE_DEFAULT</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">num_nodes_side</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">NumNodesSide</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tracing">
<h4>Tracing<a class="headerlink" href="#tracing" title="Permalink to this headline">¶</a></h4>
<p>Callback based tracing is not yet properly supported for Python, as new <em>ns-3</em> API needs to be provided for this to be supported.</p>
<p>Pcap file writing is supported via the normal API.</p>
<p>ASCII tracing is supported since <em>ns-3</em>.4 via the normal C++ API translated to Python.  However, ASCII tracing requires the creation of an ostream object to pass into the ASCII tracing methods.  In Python, the C++ std::ofstream has been minimally wrapped to allow this.  For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ascii</span> <span class="o">=</span> <span class="n">ns3</span><span class="o">.</span><span class="n">ofstream</span><span class="p">(</span><span class="s2">&quot;wifi-ap.tr&quot;</span><span class="p">)</span> <span class="c1"># create the file</span>
<span class="n">ns3</span><span class="o">.</span><span class="n">YansWifiPhyHelper</span><span class="o">.</span><span class="n">EnableAsciiAll</span><span class="p">(</span><span class="n">ascii</span><span class="p">)</span>
<span class="n">ns3</span><span class="o">.</span><span class="n">Simulator</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
<span class="n">ns3</span><span class="o">.</span><span class="n">Simulator</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
<span class="n">ascii</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># close the file</span>
</pre></div>
</div>
<p>There is one caveat: you must not allow the file object to be garbage collected while <em>ns-3</em> is still using it.  That means that the ‘ascii’ variable above must not be allowed to go out of scope or else the program will crash.</p>
</div>
</div>
<div class="section" id="working-with-python-bindings">
<h3>Working with Python Bindings<a class="headerlink" href="#working-with-python-bindings" title="Permalink to this headline">¶</a></h3>
<p>Python bindings are built on a module-by-module basis, and can be found in each module’s  <code class="docutils literal notranslate"><span class="pre">bindings</span></code> directory.</p>
<div class="section" id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>The python bindings are generated into an ‘ns’ namespace.  Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ns.network</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="n">n1</span> <span class="o">=</span> <span class="n">Node</span><span class="p">()</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ns.network</span>
<span class="n">n1</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">Node</span><span class="p">()</span>
</pre></div>
</div>
<p>The best way to explore the bindings is to look at the various example
programs provided in <em>ns-3</em>; some C++ examples have a corresponding Python
example.  There is no structured documentation for the Python bindings
like there is Doxygen for the C++ API, but the Doxygen can be consulted
to understand how the C++ API works.</p>
</div>
<div class="section" id="python-bindings-workflow">
<h4>Python Bindings Workflow<a class="headerlink" href="#python-bindings-workflow" title="Permalink to this headline">¶</a></h4>
<p>The process by which Python bindings are handled is the following:</p>
<ol class="arabic simple">
<li><p>Periodically a developer uses a CastXML (<a class="reference external" href="https://github.com/CastXML/CastXML">https://github.com/CastXML/CastXML</a>) based API scanning script, which saves the scanned API definition as <code class="docutils literal notranslate"><span class="pre">bindings/python/ns3_module_*.py</span></code> files or as Python files in each modules’ <code class="docutils literal notranslate"><span class="pre">bindings</span></code> directory.  These files are kept under version control in the main <em>ns-3</em> repository;</p></li>
<li><p>Other developers clone the repository and use the already scanned API definitions;</p></li>
<li><p>When configuring <em>ns-3</em>, pybindgen will be automatically downloaded if not already installed.  Released <em>ns-3</em> tarballs will ship a copy of pybindgen.</p></li>
</ol>
<p>If something goes wrong with compiling Python bindings and you just want to ignore them and move on with C++, you can disable Python with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure --disable-python ...
</pre></div>
</div>
<p>To add support for modular bindings to an existing or new <em>ns-3</em> module, simply add the following line to its wscript build() function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bld</span><span class="o">.</span><span class="n">ns3_python_bindings</span><span class="p">()</span>
</pre></div>
</div>
<p>One must also provide the bindings files (usually by running the scanning
framework).</p>
</div>
<div class="section" id="regenerating-the-python-bindings">
<h4>Regenerating the Python bindings<a class="headerlink" href="#regenerating-the-python-bindings" title="Permalink to this headline">¶</a></h4>
<p><em>ns-3</em> will fail to successfully compile the Python bindings if the C++
headers are changed and no longer align with the stored Python bindings.
In this case, the developer has two main choices:  1) disable Python
as described above, or 2) update the bindings to align with the new C++
API.</p>
<div class="section" id="process-overview">
<h5>Process Overview<a class="headerlink" href="#process-overview" title="Permalink to this headline">¶</a></h5>
<p><em>ns-3</em> has an automated process to regenerate Python bindings from the C++
header files.  The process is only supported for Linux at the moment
(ns-3.29) because we are in the midst of transition to new tools.  The
current process is outlined below.  In short, the process currently
requires the following steps.</p>
<ol class="arabic simple">
<li><p>Prepare the system for scanning by installing the prerequisites,
including a development version of <code class="docutils literal notranslate"><span class="pre">clang</span></code>, the <code class="docutils literal notranslate"><span class="pre">CastXML</span></code> package,
and <code class="docutils literal notranslate"><span class="pre">pygccxml</span></code>.</p></li>
<li><p>Perform a scan of the module of interest or all modules</p></li>
</ol>
</div>
<div class="section" id="installing-a-clang-development-environment">
<h5>Installing a clang development environment<a class="headerlink" href="#installing-a-clang-development-environment" title="Permalink to this headline">¶</a></h5>
<p>Make sure you have a development version of the clang compiler installed
on your system.  This can take a long time to build from source.  Linux
distributions provide binary library packages such as <code class="docutils literal notranslate"><span class="pre">clang-dev</span></code> or
<code class="docutils literal notranslate"><span class="pre">clang-devel</span></code>.  The version should not be too important; version 3.8 is
known to work.  Note that there is a problem with the Ubuntu
package installation of <code class="docutils literal notranslate"><span class="pre">clang-dev</span></code>; see the Installation wiki page for
details on how to fix using some symlinks.</p>
</div>
<div class="section" id="installing-other-prerequisites">
<h5>Installing other prerequisites<a class="headerlink" href="#installing-other-prerequisites" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">cxxfilt</span></code> is a new requirement, typically installed using <code class="docutils literal notranslate"><span class="pre">pip</span></code>; e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo pip install cxxfilt
</pre></div>
</div>
<p>See also the wiki for installation notes for your system.</p>
</div>
<div class="section" id="set-up-a-bake-build-environment">
<h5>Set up a <code class="docutils literal notranslate"><span class="pre">bake</span></code> build environment<a class="headerlink" href="#set-up-a-bake-build-environment" title="Permalink to this headline">¶</a></h5>
<p>Try the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> bake
$ <span class="nb">export</span> <span class="nv">BAKE_HOME</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$BAKE_HOME</span>/build/bin
$ <span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:<span class="nv">$BAKE_HOME</span>/build/lib
$ <span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$PYTHONPATH</span>:<span class="nv">$BAKE_HOME</span>/build/lib
$ mkdir -p build/lib
</pre></div>
</div>
</div>
<div class="section" id="configure">
<h5>Configure<a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h5>
<p>Perform a configuration at the bake level:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./bake.py configure -e ns-3-dev -e pygccxml-1.9.1
</pre></div>
</div>
<p>The output of <code class="docutils literal notranslate"><span class="pre">bake</span> <span class="pre">show</span></code> should show something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./bake.py show
</pre></div>
</div>
<p>Should say:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-- System Dependencies --
 &gt; clang-dev - OK
 &gt; g++ - OK
 &gt; libxml2-dev - OK
 &gt; pygoocanvas - OK
 &gt; pygraphviz - OK
 &gt; python-dev - OK
 &gt; qt - OK
 &gt; setuptools - OK
</pre></div>
</div>
</div>
<div class="section" id="download">
<h5>Download<a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h5>
<p>Try the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./bake.py download
 &gt;&gt; Searching <span class="k">for</span> system dependency python-dev - OK
 &gt;&gt; Searching <span class="k">for</span> system dependency clang-dev - OK
 &gt;&gt; Searching <span class="k">for</span> system dependency g++ - OK
 &gt;&gt; Searching <span class="k">for</span> system dependency setuptools - OK
 &gt;&gt; Searching <span class="k">for</span> system dependency pygoocanvas - OK
 &gt;&gt; Searching <span class="k">for</span> system dependency pygraphviz - OK
 &gt;&gt; Searching <span class="k">for</span> system dependency qt - OK
 &gt;&gt; Downloading castxml - OK
 &gt;&gt; Downloading netanim - OK
 &gt;&gt; Downloading pygccxml-1.9.1 - OK
 &gt;&gt; Downloading pygccxml - OK
 &gt;&gt; Downloading pybindgen - OK
 &gt;&gt; Downloading ns-3-dev - OK
</pre></div>
</div>
</div>
<div class="section" id="build">
<h5>Build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h5>
<p>Try the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mkdir -p build/lib
$ ./bake.py build
</pre></div>
</div>
<p>It should fail on the <em>ns-3</em> bindings complilation.</p>
<p>The output of ‘./waf configure’ can be inspected to see if Python API scanning
support is enabled:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Python API Scanning Support   : enabled
</pre></div>
</div>
<p>It may say something like this, if the support is not active:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Python API Scanning Support   : not enabled (Missing &#39;pygccxml&#39; Python module)
</pre></div>
</div>
<p>In this case, the user must take steps to install castxml and pygccxml;
castxml binary must be in the shell’s path, and pygccxml must be in the
Python path.</p>
</div>
<div class="section" id="lp64-vs-ilp32-bindings">
<h5>LP64 vs ILP32 bindings<a class="headerlink" href="#lp64-vs-ilp32-bindings" title="Permalink to this headline">¶</a></h5>
<p>Linux (64-bit, as most modern installations use) and MacOS use different
data models, as explained here:  <a class="reference external" href="https://www.ibm.com/support/knowledgecenter/en/SSLTBW_2.3.0/com.ibm.zos.v2r3.cbcpx01/datatypesize64.htm">https://www.ibm.com/support/knowledgecenter/en/SSLTBW_2.3.0/com.ibm.zos.v2r3.cbcpx01/datatypesize64.htm</a></p>
<p>Linux uses the LP64 model, and MacOS (as well as 32-bit Linux) use the ILP32
model.  Users will note that there are two versions of bindings files in
each ns-3 module directory; one with an ILP32.py suffix and one with
an LP64.py suffix.  Only one is used on any given platform.  The main
difference is in the representation of the 64 bit integer type as either
a ‘long’ (LP64) or ‘long long’ (ILP32).</p>
<p>The process (only supported on Linux at present) generates the LP64
bindings using the toolchain and then copies the LP64 bindings to the
ILP32 bindings with some type subsitutions automated by Waf scripts.</p>
</div>
<div class="section" id="rescanning-a-module">
<h5>Rescanning a module<a class="headerlink" href="#rescanning-a-module" title="Permalink to this headline">¶</a></h5>
<p>To re-scan a module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> source/ns-3-dev
$ ./waf --apiscan<span class="o">=</span>wifi
</pre></div>
</div>
<p>To re-scan all modules:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> source/ns-3-dev
$ ./waf --apiscan<span class="o">=</span>all
</pre></div>
</div>
</div>
<div class="section" id="generating-bindings-on-macos">
<h5>Generating bindings on MacOS<a class="headerlink" href="#generating-bindings-on-macos" title="Permalink to this headline">¶</a></h5>
<p>In principle, this should work (and should generate the 32-bit bindings).
However, maintainers have not been able to complete this port as of ns-3.29.
We would welcome suggestions on how to enable scanning for MacOS.</p>
</div>
</div>
<div class="section" id="organization-of-the-modular-python-bindings">
<h4>Organization of the Modular Python Bindings<a class="headerlink" href="#organization-of-the-modular-python-bindings" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">src/&lt;module&gt;/bindings</span></code> directory may contain the following files, some of them optional:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">callbacks_list.py</span></code>: this is a scanned file, DO NOT TOUCH.  Contains a list of Callback&lt;…&gt; template instances found in the scanned headers;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">modulegen__gcc_LP64.py</span></code>: this is a scanned file, DO NOT TOUCH.  Scanned API definitions for the GCC, LP64 architecture (64-bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">modulegen__gcc_ILP32.py</span></code>: this is a scanned file, DO NOT TOUCH.  Scanned API definitions for the GCC, ILP32 architecture (32-bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">modulegen_customizations.py</span></code>: you may optionally add this file in order to customize the pybindgen code generation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scan-header.h</span></code>: you may optionally add this file to customize what header file is scanned for the module.  Basically this file is scanned instead of ns3/&lt;module&gt;-module.h.  Typically, the first statement is #include “ns3/&lt;module&gt;-module.h”, plus some other stuff to force template instantiations;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">module_helpers.cc</span></code>: you may add additional files, such as this, to be linked to python extension module, but they have to be registered in the wscript. Look at src/core/wscript for an example of how to do so;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;module&gt;.py</span></code>: if this file exists, it becomes the “frontend” python module for the ns3 module, and the extension module (.so file) becomes _&lt;module&gt;.so instead of &lt;module&gt;.so.  The &lt;module&gt;.py file has to import all symbols from the module _&lt;module&gt; (this is more tricky than it sounds, see src/core/bindings/core.py for an example), and then can add some additional pure-python definitions.</p></li>
</ul>
</div>
</div>
<div class="section" id="more-information-for-developers">
<h3>More Information for Developers<a class="headerlink" href="#more-information-for-developers" title="Permalink to this headline">¶</a></h3>
<p>If you are a developer and need more information on <em>ns-3</em>’s Python bindings, please see the <a class="reference external" href="http://www.nsnam.org/wiki/NS-3_Python_Bindings">Python Bindings wiki page</a>.</p>
</div>
</div>
<span id="document-tests"></span><div class="section" id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-test-overview"></span><div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>This chapter is concerned with the testing and validation of <em>ns-3</em> software.</p>
<p>This chapter provides</p>
<ul class="simple">
<li><p>background about terminology and software testing</p></li>
<li><p>a description of the ns-3 testing framework</p></li>
<li><p>a guide to model developers or new model contributors for how to write tests</p></li>
</ul>
</div>
<span id="document-test-background"></span><div class="section" id="background">
<h3>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h3>
<p><strong>This chapter may be skipped by readers familiar with the basics of
software testing.</strong></p>
<p>Writing defect-free software is a difficult proposition.  There are many
dimensions to the problem and there is much confusion regarding what is
meant by different terms in different contexts.  We have found it worthwhile
to spend a little time reviewing the subject and defining some terms.</p>
<p>Software testing may be loosely defined as the process of executing a program
with the intent of finding errors.  When one enters a discussion regarding
software testing, it quickly becomes apparent that there are many distinct
mind-sets with which one can approach the subject.</p>
<p>For example, one could break the process into broad functional categories
like ‘’correctness testing,’’ ‘’performance testing,’’ ‘’robustness testing’’
and ‘’security testing.’’  Another way to look at the problem is by life-cycle:
‘’requirements testing,’’ ‘’design testing,’’ ‘’acceptance testing,’’ and
‘’maintenance testing.’’  Yet another view is by the scope of the tested system.
In this case one may speak of ‘’unit testing,’’ ‘’component testing,’’
‘’integration testing,’’ and ‘’system testing.’’  These terms are also not
standardized in any way, and so ‘’maintenance testing’’ and ‘’regression
testing’’ may be heard interchangeably.  Additionally, these terms are often
misused.</p>
<p>There are also a number of different philosophical approaches to software
testing.  For example, some organizations advocate writing test programs
before actually implementing the desired software, yielding ‘’test-driven
development.’’  Some organizations advocate testing from a customer perspective
as soon as possible, following a parallel with the agile development process:
‘’test early and test often.’’  This is sometimes called ‘’agile testing.’’  It
seems that there is at least one approach to testing for every development
methodology.</p>
<p>The <em>ns-3</em> project is not in the business of advocating for any one of
these processes, but the project as a whole has requirements that help inform
the test process.</p>
<p>Like all major software products, <em>ns-3</em> has a number of qualities that
must be present for the product to succeed.  From a testing perspective, some
of these qualities that must be addressed are that <em>ns-3</em> must be
‘’correct,’’ ‘’robust,’’  ‘’performant’’ and ‘’maintainable.’’  Ideally there
should be metrics for each of these dimensions that are checked by the tests
to identify when the product fails to meet its expectations / requirements.</p>
<div class="section" id="correctness">
<h4>Correctness<a class="headerlink" href="#correctness" title="Permalink to this headline">¶</a></h4>
<p>The essential purpose of testing is to determine that a piece of software
behaves ‘’correctly.’’  For <em>ns-3</em> this means that if we simulate
something, the simulation should faithfully represent some physical entity or
process to a specified accuracy and precision.</p>
<p>It turns out that there are two perspectives from which one can view
correctness.  Verifying that a particular model is implemented according
to its specification is generically called <em>verification</em>.  The process of
deciding that the model is correct for its intended use is generically called
<em>validation</em>.</p>
</div>
<div class="section" id="validation-and-verification">
<h4>Validation and Verification<a class="headerlink" href="#validation-and-verification" title="Permalink to this headline">¶</a></h4>
<p>A computer model is a mathematical or logical representation of something. It
can represent a vehicle, an elephant (see
<a class="reference external" href="http://simutools.org/2009/">David Harel’s talk about modeling an elephant at SIMUTools 2009</a>, or a networking card.  Models can also represent
processes such as global warming, freeway traffic flow or a specification of a
networking protocol.  Models can be completely faithful representations of a
logical process specification, but they necessarily can never completely
simulate a physical object or process.  In most cases, a number of
simplifications are made to the model to make simulation computationally
tractable.</p>
<p>Every model has a <em>target system</em> that it is attempting to simulate.  The
first step in creating a simulation model is to identify this target system and
the level of detail and accuracy that the simulation is desired to reproduce.
In the case of a logical process, the target system may be identified as ‘’TCP
as defined by RFC 793.’’  In this case, it will probably be desirable to create
a model that completely and faithfully reproduces RFC 793.  In the case of a
physical process this will not be possible. If, for example, you would like to
simulate a wireless networking card, you may determine that you need,  ‘’an
accurate MAC-level implementation of the 802.11 specification and […] a
not-so-slow PHY-level model of the 802.11a specification.’’</p>
<p>Once this is done, one can develop an abstract model of the target system.  This
is typically an exercise in managing the tradeoffs between complexity, resource
requirements and accuracy.  The process of developing an abstract model has been
called <em>model qualification</em> in the literature.  In the case of a TCP
protocol, this process results in a design for a collection of objects,
interactions and behaviors that will fully implement RFC 793 in <em>ns-3</em>.
In the case of the wireless card, this process results in a number of tradeoffs
to allow the physical layer to be simulated and the design of a network device
and channel for ns-3, along with the desired objects, interactions and behaviors.</p>
<p>This abstract model is then developed into an <em>ns-3</em> model that
implements the abstract model as a computer program.  The process of getting the
implementation to agree with the abstract model is called <em>model
verification</em> in the literature.</p>
<p>The process so far is open loop. What remains is to make a determination that a
given ns-3 model has some connection to some reality – that a model is an
accurate representation of a real system, whether a logical process or a physical
entity.</p>
<p>If one is going to use a simulation model to try and predict how some real
system is going to behave, there must be some reason to believe your results –
i.e., can one trust that an inference made from the model translates into a
correct prediction for the real system.  The process of getting the ns-3 model
behavior to agree with the desired target system behavior as defined by the model
qualification process is called <em>model validation</em> in the literature. In the
case of a TCP implementation, you may want to compare the behavior of your ns-3
TCP model to some reference implementation in order to validate your model.  In
the case of a wireless physical layer simulation, you may want to compare the
behavior of your model to that of real hardware in a controlled setting,</p>
<p>The <em>ns-3</em> testing environment provides tools to allow for both model
validation and testing, and encourages the publication of validation results.</p>
</div>
<div class="section" id="robustness">
<h4>Robustness<a class="headerlink" href="#robustness" title="Permalink to this headline">¶</a></h4>
<p>Robustness is the quality of being able to withstand stresses, or changes in
environments, inputs or calculations, etc.  A system or design is ‘’robust’’
if it can deal with such changes with minimal loss of functionality.</p>
<p>This kind of testing is usually done with a particular focus.  For example, the
system as a whole can be run on many different system configurations to
demonstrate that it can perform correctly in a large number of environments.</p>
<p>The system can be also be stressed by operating close to or beyond capacity by
generating or simulating resource exhaustion of various kinds.  This genre of
testing is called ‘’stress testing.’’</p>
<p>The system and its components may be exposed to so-called ‘’clean tests’’ that
demonstrate a positive result – that is that the system operates correctly in
response to a large variation of expected configurations.</p>
<p>The system and its components may also be exposed to ‘’dirty tests’’ which
provide inputs outside the expected range.  For example, if a module expects a
zero-terminated string representation of an integer, a dirty test might provide
an unterminated string of random characters to verify that the system does not
crash as a result of this unexpected input.  Unfortunately, detecting such
‘’dirty’’ input and taking preventive measures to ensure the system does not
fail catastrophically can require a huge amount of development overhead.  In
order to reduce development time, a decision was taken early on in the project
to minimize the amount of parameter validation and error handling in the
<em>ns-3</em> codebase.  For this reason, we do not spend much time on dirty
testing – it would just uncover the results of the design decision we know
we took.</p>
<p>We do want to demonstrate that <em>ns-3</em> software does work across some set
of conditions.  We borrow a couple of definitions to narrow this down a bit.
The <em>domain of applicability</em> is a set of prescribed conditions for which
the model has been tested, compared against reality to the extent possible, and
judged  suitable for use.  The <em>range of accuracy</em> is an agreement between
the computerized model and reality within a domain of applicability.</p>
<p>The <em>ns-3</em> testing environment provides tools to allow for setting up
and running test environments over multiple systems (buildbot) and provides
classes to encourage clean tests to verify the operation of the system over the
expected ‘’domain of applicability’’ and ‘’range of accuracy.’’</p>
</div>
<div class="section" id="performant">
<h4>Performant<a class="headerlink" href="#performant" title="Permalink to this headline">¶</a></h4>
<p>Okay, ‘’performant’’ isn’t a real English word.  It is, however, a very concise
neologism that is quite often used to describe what we want <em>ns-3</em> to
be: powerful and fast enough to get the job done.</p>
<p>This is really about the broad subject of software performance testing.  One of
the key things that is done is to compare two systems to find which performs
better (cf benchmarks).  This is used to demonstrate that, for example,
<em>ns-3</em> can perform a basic kind of simulation at least as fast as a
competing tool, or can be used to identify parts of the system that perform
badly.</p>
<p>In the <em>ns-3</em> test framework, we provide support for timing various kinds
of tests.</p>
</div>
<div class="section" id="maintainability">
<h4>Maintainability<a class="headerlink" href="#maintainability" title="Permalink to this headline">¶</a></h4>
<p>A software product must be maintainable.  This is, again, a very broad
statement, but a testing framework can help with the task.  Once a model has
been developed, validated and verified, we can repeatedly execute the suite
of tests for the entire system to ensure that it remains valid and verified
over its lifetime.</p>
<p>When a feature stops functioning as intended after some kind of change to the
system is integrated, it is called generically a <em>regression</em>.
Originally the
term regression referred to a change that caused a previously fixed bug to
reappear, but the term has evolved to describe any kind of change that breaks
existing functionality.  There are many kinds of regressions that may occur
in practice.</p>
<p>A <em>local regression</em> is one in which a change affects the changed component
directly.  For example, if a component is modified to allocate and free memory
but stale pointers are used, the component itself fails.</p>
<p>A <em>remote regression</em> is one in which a change to one component breaks
functionality in another component.  This reflects violation of an implied but
possibly unrecognized contract between components.</p>
<p>An <em>unmasked regression</em> is one that creates a situation where a previously
existing bug that had no affect is suddenly exposed in the system.  This may
be as simple as exercising a code path for the first time.</p>
<p>A <em>performance regression</em> is one that causes the performance requirements
of the system to be violated.  For example, doing some work in a low level
function that may be repeated large numbers of times may suddenly render the
system unusable from certain perspectives.</p>
<p>The <em>ns-3</em> testing framework provides tools for automating the process
used to validate and verify the code in nightly test suites to help quickly
identify possible regressions.</p>
</div>
</div>
<span id="document-test-framework"></span><div class="section" id="testing-framework">
<h3>Testing framework<a class="headerlink" href="#testing-framework" title="Permalink to this headline">¶</a></h3>
<p><em>ns-3</em> consists of a simulation core engine, a set of models, example programs,
and tests.  Over time, new contributors contribute models, tests, and
examples.  A Python test program <code class="docutils literal notranslate"><span class="pre">test.py</span></code> serves as the test
execution manager; <code class="docutils literal notranslate"><span class="pre">test.py</span></code> can run test code and examples to
look for regressions, can output the results into a number of forms, and
can manage code coverage analysis tools.  On top of this, we layer
<em>buildslaves</em> that are automated build robots that perform
robustness testing by running the test framework on different systems
and with different configuration options.</p>
<div class="section" id="buildslaves">
<h4>Buildslaves<a class="headerlink" href="#buildslaves" title="Permalink to this headline">¶</a></h4>
<p>At the highest level of <em>ns-3</em> testing are the buildslaves (build robots).
If you are unfamiliar with
this system look at <a class="reference external" href="https://ns-buildmaster.ee.washington.edu:8010/">https://ns-buildmaster.ee.washington.edu:8010/</a>.
This is an open-source automated system that allows <em>ns-3</em> to be rebuilt
and tested daily.  By running the buildbots on a number
of different systems we can ensure that <em>ns-3</em> builds and executes
properly on all of its supported systems.</p>
<p>Users (and developers) typically will not interact with the buildslave system other
than to read its messages regarding test results.  If a failure is detected in
one of the automated build and test jobs, the buildbot will send an email to the
<em>ns-commits</em> mailing list.  This email will look something like</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[Ns-commits] Build failed in Jenkins: daily-ubuntu-without-valgrind » Ubuntu-64-15.04 #926

...
281 of 285 tests passed (281 passed, 3 skipped, 1 failed, 0 crashed, 0 valgrind errors)
List of SKIPped tests:
  ns3-tcp-cwnd
  ns3-tcp-interoperability
  nsc-tcp-loss
List of FAILed tests:
  random-variable-stream-generators
+ exit 1
Build step &#39;Execute shell&#39; marked build as failure
</pre></div>
</div>
<p>In the full details URL shown in the email, one can find links to the detailed test output.</p>
<p>The buildslave system will do its job quietly if there are no errors, and the
system will undergo build and test cycles every day to verify that all is well.</p>
</div>
<div class="section" id="test-py">
<h4>Test.py<a class="headerlink" href="#test-py" title="Permalink to this headline">¶</a></h4>
<p>The buildbots use a Python program, <code class="docutils literal notranslate"><span class="pre">test.py</span></code>, that is responsible for
running all of the tests and collecting the resulting reports into a human-
readable form.  This program is also available for use by users and developers
as well.</p>
<p><code class="docutils literal notranslate"><span class="pre">test.py</span></code> is very flexible in allowing the user to specify the number
and kind of tests to run; and also the amount and kind of output to generate.</p>
<p>Before running <code class="docutils literal notranslate"><span class="pre">test.py</span></code>, make sure that ns3’s examples and tests
have been built by doing the following</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure --enable-examples --enable-tests
$ ./waf build
</pre></div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">test.py</span></code> will run all available tests and report status
back in a very concise form.  Running the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py
</pre></div>
</div>
<p>will result in a number of <code class="docutils literal notranslate"><span class="pre">PASS</span></code>, <code class="docutils literal notranslate"><span class="pre">FAIL</span></code>, <code class="docutils literal notranslate"><span class="pre">CRASH</span></code> or <code class="docutils literal notranslate"><span class="pre">SKIP</span></code>
indications followed by the kind of test that was run and its display name.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Waf: Entering directory `/home/craigdo/repos/ns-3-allinone-test/ns-3-dev/build&#39;
Waf: Leaving directory `/home/craigdo/repos/ns-3-allinone-test/ns-3-dev/build&#39;
&#39;build&#39; finished successfully (0.939s)
FAIL: TestSuite propagation-loss-model
PASS: TestSuite object-name-service
PASS: TestSuite pcap-file-object
PASS: TestSuite ns3-tcp-cwnd
...
PASS: TestSuite ns3-tcp-interoperability
PASS: Example csma-broadcast
PASS: Example csma-multicast
</pre></div>
</div>
<p>This mode is intended to be used by users who are interested in determining if
their distribution is working correctly, and by developers who are interested
in determining if changes they have made have caused any regressions.</p>
<p>There are a number of options available to control the behavior of <code class="docutils literal notranslate"><span class="pre">test.py</span></code>.
if you run <code class="docutils literal notranslate"><span class="pre">test.py</span> <span class="pre">--help</span></code> you should see a command summary like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Usage: test.py [options]

Options:
  -h, --help            show this help message and exit
  -b BUILDPATH, --buildpath=BUILDPATH
                        specify the path where ns-3 was built (defaults to the
                        build directory for the current variant)
  -c KIND, --constrain=KIND
                        constrain the test-runner by kind of test
  -e EXAMPLE, --example=EXAMPLE
                        specify a single example to run (no relative path is
                        needed)
  -d, --duration        print the duration of each test suite and example
  -e EXAMPLE, --example=EXAMPLE
                        specify a single example to run (no relative path is
                        needed)
  -u, --update-data     If examples use reference data files, get them to re-
                        generate them
  -f FULLNESS, --fullness=FULLNESS
                        choose the duration of tests to run: QUICK, EXTENSIVE,
                        or TAKES_FOREVER, where EXTENSIVE includes QUICK and
                        TAKES_FOREVER includes QUICK and EXTENSIVE (only QUICK
                        tests are run by default)
  -g, --grind           run the test suites and examples using valgrind
  -k, --kinds           print the kinds of tests available
  -l, --list            print the list of known tests
  -m, --multiple        report multiple failures from test suites and test
                        cases
  -n, --nowaf           do not run waf before starting testing
  -p PYEXAMPLE, --pyexample=PYEXAMPLE
                        specify a single python example to run (with relative
                        path)
  -r, --retain          retain all temporary files (which are normally
                        deleted)
  -s TEST-SUITE, --suite=TEST-SUITE
                        specify a single test suite to run
  -t TEXT-FILE, --text=TEXT-FILE
                        write detailed test results into TEXT-FILE.txt
  -v, --verbose         print progress and informational messages
  -w HTML-FILE, --web=HTML-FILE, --html=HTML-FILE
                        write detailed test results into HTML-FILE.html
  -x XML-FILE, --xml=XML-FILE
                        write detailed test results into XML-FILE.xml
</pre></div>
</div>
<p>If one specifies an optional output style, one can generate detailed descriptions
of the tests and status.  Available styles are <code class="docutils literal notranslate"><span class="pre">text</span></code> and <code class="docutils literal notranslate"><span class="pre">HTML</span></code>.
The buildbots will select the HTML option to generate HTML test reports for the
nightly builds using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --html<span class="o">=</span>nightly.html
</pre></div>
</div>
<p>In this case, an HTML file named ‘’nightly.html’’ would be created with a pretty
summary of the testing done.  A ‘’human readable’’ format is available for users
interested in the details.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --text<span class="o">=</span>results.txt
</pre></div>
</div>
<p>In the example above, the test suite checking the <em>ns-3</em> wireless
device propagation loss models failed.  By default no further information is
provided.</p>
<p>To further explore the failure, <code class="docutils literal notranslate"><span class="pre">test.py</span></code> allows a single test suite
to be specified.  Running the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --suite<span class="o">=</span>propagation-loss-model
</pre></div>
</div>
<p>or equivalently</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py -s propagation-loss-model
</pre></div>
</div>
<p>results in that single test suite being run.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>FAIL: TestSuite propagation-loss-model
</pre></div>
</div>
<p>To find detailed information regarding the failure, one must specify the kind
of output desired.  For example, most people will probably be interested in
a text file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --suite<span class="o">=</span>propagation-loss-model --text<span class="o">=</span>results.txt
</pre></div>
</div>
<p>This will result in that single test suite being run with the test status written to
the file ‘’results.txt’’.</p>
<p>You should find something similar to the following in that file</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>FAIL: Test Suite &#39;&#39;propagation-loss-model&#39;&#39; (real 0.02 user 0.01 system 0.00)
PASS: Test Case &quot;Check ... Friis ... model ...&quot; (real 0.01 user 0.00 system 0.00)
FAIL: Test Case &quot;Check ... Log Distance ... model&quot; (real 0.01 user 0.01 system 0.00)
  Details:
    Message:   Got unexpected SNR value
    Condition: [long description of what actually failed]
    Actual:    176.395
    Limit:     176.407 +- 0.0005
    File:      ../src/test/ns3wifi/propagation-loss-models-test-suite.cc
    Line:      360
</pre></div>
</div>
<p>Notice that the Test Suite is composed of two Test Cases.  The first test case
checked the Friis propagation loss model and passed.  The second test case
failed checking the Log Distance propagation model.  In this case, an SNR of
176.395 was found, and the test expected a value of 176.407 correct to three
decimal places.  The file which implemented the failing test is listed as well
as the line of code which triggered the failure.</p>
<p>If you desire, you could just as easily have written an HTML file using the
<code class="docutils literal notranslate"><span class="pre">--html</span></code> option as described above.</p>
<p>Typically a user will run all tests at least once after downloading
<em>ns-3</em> to ensure that his or her environment has been built correctly
and is generating correct results according to the test suites.  Developers
will typically run the test suites before and after making a change to ensure
that they have not introduced a regression with their changes.  In this case,
developers may not want to run all tests, but only a subset.  For example,
the developer might only want to run the unit tests periodically while making
changes to a repository.  In this case, <code class="docutils literal notranslate"><span class="pre">test.py</span></code> can be told to constrain
the types of tests being run to a particular class of tests.  The following
command will result in only the unit tests being run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --constrain<span class="o">=</span>unit
</pre></div>
</div>
<p>To see a quick list of the legal kinds of constraints, you can ask for them
to be listed.  The following command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --kinds
</pre></div>
</div>
<p>will result in the following list being displayed:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Waf: Entering directory `/home/craigdo/repos/ns-3-allinone-test/ns-3-dev/build&#39;
Waf: Leaving directory `/home/craigdo/repos/ns-3-allinone-test/ns-3-dev/build&#39;
&#39;build&#39; finished successfully (0.939s)Waf: Entering directory `/home/craigdo/repos/ns-3-allinone-test/ns-3-dev/build&#39;
core:        Run all TestSuite-based tests (exclude examples)
example:     Examples (to see if example programs run successfully)
performance: Performance Tests (check to see if the system is as fast as expected)
system:      System Tests (spans modules to check integration of modules)
unit:        Unit Tests (within modules to check basic functionality)
</pre></div>
</div>
<p>Any of these kinds of test can be provided as a constraint using the <code class="docutils literal notranslate"><span class="pre">--constraint</span></code>
option.</p>
<p>To see a quick list of all of the test suites available, you can ask for them
to be listed.  The following command,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --list
</pre></div>
</div>
<p>will result in a list of the test suite being displayed, similar to</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Waf: Entering directory `/home/craigdo/repos/ns-3-allinone-test/ns-3-dev/build&#39;
Waf: Leaving directory `/home/craigdo/repos/ns-3-allinone-test/ns-3-dev/build&#39;
&#39;build&#39; finished successfully (0.939s)

Test Type    Test Name
---------    ---------
performance  many-uniform-random-variables-one-get-value-call
performance  one-uniform-random-variable-many-get-value-calls
performance  type-id-perf
system       buildings-pathloss-test
system       buildings-shadowing-test
system       devices-mesh-dot11s-regression
system       devices-mesh-flame-regression
system       epc-gtpu
...
unit         wimax-phy-layer
unit         wimax-service-flow
unit         wimax-ss-mac-layer
unit         wimax-tlv
example      adhoc-aloha-ideal-phy
example      adhoc-aloha-ideal-phy-matrix-propagation-loss-model
example      adhoc-aloha-ideal-phy-with-microwave-oven
example      aodv
...
</pre></div>
</div>
<p>Any of these listed suites can be selected to be run by itself using the
<code class="docutils literal notranslate"><span class="pre">--suite</span></code> option as shown above.</p>
<p>To run multiple test suites at once it is possible to use a ‘Unix filename pattern matching’
style, e.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ../test.py -s <span class="s1">&#39;ipv6*&#39;</span>
</pre></div>
</div>
<p>Note the use of quotes. The result is similar to</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>PASS: TestSuite ipv6-protocol
PASS: TestSuite ipv6-packet-info-tag
PASS: TestSuite ipv6-list-routing
PASS: TestSuite ipv6-extension-header
PASS: TestSuite ipv6-address-generator
PASS: TestSuite ipv6-raw
PASS: TestSuite ipv6-dual-stack
PASS: TestSuite ipv6-fragmentation
PASS: TestSuite ipv6-address-helper
PASS: TestSuite ipv6-address
PASS: TestSuite ipv6-forwarding
PASS: TestSuite ipv6-ripng
</pre></div>
</div>
<p>Similarly to test suites, one can run a single C++ example program
using the <code class="docutils literal notranslate"><span class="pre">--example</span></code> option.  Note that the relative path for the
example does not need to be included and that the executables built
for C++ examples do not have extensions.  Furthermore, the example
must be registered as an example to the test framework; it is not
sufficient to create an example and run it through test.py; it must
be added to the relevant <code class="docutils literal notranslate"><span class="pre">examples-to-run.py</span></code> file, explained below.
Entering</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --example<span class="o">=</span>udp-echo
</pre></div>
</div>
<p>results in that single example being run.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>PASS: Example examples/udp/udp-echo
</pre></div>
</div>
<p>You can specify the directory where <em>ns-3</em> was built using the
<code class="docutils literal notranslate"><span class="pre">--buildpath</span></code> option as follows.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --buildpath<span class="o">=</span>/home/craigdo/repos/ns-3-allinone-test/ns-3-dev/build/debug --example<span class="o">=</span>wifi-simple-adhoc
</pre></div>
</div>
<p>One can run a single Python example program using the <code class="docutils literal notranslate"><span class="pre">--pyexample</span></code>
option.  Note that the relative path for the example must be included
and that Python examples do need their extensions.  Entering</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --pyexample<span class="o">=</span>examples/tutorial/first.py
</pre></div>
</div>
<p>results in that single example being run.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>PASS: Example examples/tutorial/first.py
</pre></div>
</div>
<p>Because Python examples are not built, you do not need to specify the
directory where <em>ns-3</em> was built to run them.</p>
<p>Normally when example programs are executed, they write a large amount of trace
file data.  This is normally saved to the base directory of the distribution
(e.g., /home/user/ns-3-dev).  When <code class="docutils literal notranslate"><span class="pre">test.py</span></code> runs an example, it really
is completely unconcerned with the trace files.  It just wants to to determine
if the example can be built and run without error.  Since this is the case, the
trace files are written into a <code class="docutils literal notranslate"><span class="pre">/tmp/unchecked-traces</span></code> directory.  If you
run the above example, you should be able to find the associated
<code class="docutils literal notranslate"><span class="pre">udp-echo.tr</span></code> and <code class="docutils literal notranslate"><span class="pre">udp-echo-n-1.pcap</span></code> files there.</p>
<p>The list of available examples is defined by the contents of the ‘’examples’’
directory in the distribution.  If you select an example for execution using
the <code class="docutils literal notranslate"><span class="pre">--example</span></code> option, <code class="docutils literal notranslate"><span class="pre">test.py</span></code> will not make any attempt to decide
if the example has been configured or not, it will just try to run it and
report the result of the attempt.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">test.py</span></code> runs, by default it will first ensure that the system has
been completely built.  This can be defeated by selecting the <code class="docutils literal notranslate"><span class="pre">--nowaf</span></code>
option.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --list --nowaf
</pre></div>
</div>
<p>will result in a list of the currently built test suites being displayed, similar to:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>propagation-loss-model
ns3-tcp-cwnd
ns3-tcp-interoperability
pcap-file
object-name-service
random-variable-stream-generators
</pre></div>
</div>
<p>Note the absence of the <code class="docutils literal notranslate"><span class="pre">Waf</span></code> build messages.</p>
<p><code class="docutils literal notranslate"><span class="pre">test.py</span></code> also supports running the test suites and examples under valgrind.
Valgrind is a flexible program for debugging and profiling Linux executables.  By
default, valgrind runs a tool called memcheck, which performs a range of memory-
checking functions, including detecting accesses to uninitialised memory, misuse
of allocated memory (double frees, access after free, etc.) and detecting memory
leaks.  This can be selected by using the <code class="docutils literal notranslate"><span class="pre">--grind</span></code> option.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --grind
</pre></div>
</div>
<p>As it runs, <code class="docutils literal notranslate"><span class="pre">test.py</span></code> and the programs that it runs indirectly, generate large
numbers of temporary files.  Usually, the content of these files is not interesting,
however in some cases it can be useful (for debugging purposes) to view these files.
<code class="docutils literal notranslate"><span class="pre">test.py</span></code> provides a <code class="docutils literal notranslate"><span class="pre">--retain</span></code> option which will cause these temporary
files to be kept after the run is completed.  The files are saved in a directory
named <code class="docutils literal notranslate"><span class="pre">testpy-output</span></code> under a subdirectory named according to the current Coordinated
Universal Time (also known as Greenwich Mean Time).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --retain
</pre></div>
</div>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">test.py</span></code> provides a <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> option which will print
large amounts of information about its progress.  It is not expected that this
will be terribly useful unless there is an error.  In this case, you can get
access to the standard output and standard error reported by running test suites
and examples.  Select verbose in the following way:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --verbose
</pre></div>
</div>
<p>All of these options can be mixed and matched.  For example, to run all of the
<em>ns-3</em> core test suites under valgrind, in verbose mode, while generating an HTML
output file, one would do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py --verbose --grind --constrain<span class="o">=</span>core --html<span class="o">=</span>results.html
</pre></div>
</div>
</div>
<div class="section" id="testtaxonomy">
<h4>TestTaxonomy<a class="headerlink" href="#testtaxonomy" title="Permalink to this headline">¶</a></h4>
<p>As mentioned above, tests are grouped into a number of broadly defined
classifications to allow users to selectively run tests to address the different
kinds of testing that need to be done.</p>
<ul class="simple">
<li><p>Build Verification Tests</p></li>
<li><p>Unit Tests</p></li>
<li><p>System Tests</p></li>
<li><p>Examples</p></li>
<li><p>Performance Tests</p></li>
</ul>
<p>Moreover, each test is further classified according to the expected time needed to
run it. Tests are classified as:</p>
<ul class="simple">
<li><p>QUICK</p></li>
<li><p>EXTENSIVE</p></li>
<li><p>TAKES_FOREVER</p></li>
</ul>
<p>Note that specifying EXTENSIVE fullness will also run tests in QUICK category.
Specifying TAKES_FOREVER will run tests in EXTENSIVE and QUICK categories.
By default, only QUICK tests are ran.</p>
<p>As a rule of thumb, tests that must be run to ensure <em>ns-3</em> coherence should be
QUICK (i.e., take a few seconds). Tests that could be skipped, but are nice to do
can be EXTENSIVE; these are tests that typically need minutes. TAKES_FOREVER is
left for tests that take a really long time, in the order of several minutes.
The main classification goal is to be able to run the buildbots in a reasonable
time, and still be able to perform more extensive tests when needed.</p>
<div class="section" id="unit-tests">
<h5>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h5>
<p>Unit tests are more involved tests that go into detail to make sure that a
piece of code works as advertised in isolation.  There is really no reason
for this kind of test to be built into an <em>ns-3</em> module.  It turns out, for
example, that the unit tests for the object name service are about the same
size as the object name service code itself.  Unit tests are tests that
check a single bit of functionality that are not built into the <em>ns-3</em> code,
but live in the same directory as the code it tests.  It is possible that
these tests check integration of multiple implementation files in a module
as well.  The file src/core/test/names-test-suite.cc is an example of this kind
of test.  The file src/network/test/pcap-file-test-suite.cc is another example
that uses a known good pcap file as a test vector file.  This file is stored
locally in the src/network directory.</p>
</div>
<div class="section" id="system-tests">
<h5>System Tests<a class="headerlink" href="#system-tests" title="Permalink to this headline">¶</a></h5>
<p>System tests are those that involve more than one module in the system.  We
have lots of this kind of test running in our current regression framework,
but they are typically overloaded examples.  We provide a new place
for this kind of test in the directory <code class="docutils literal notranslate"><span class="pre">src/test</span></code>.  The file
src/test/ns3tcp/ns3-interop-test-suite.cc is an example of this kind of
test.  It uses NSC TCP to test the <em>ns-3</em> TCP implementation.  Often there
will be test vectors required for this kind of test, and they are stored in
the directory where the test lives.  For example,
ns3tcp-interop-response-vectors.pcap is a file consisting of a number of TCP
headers that are used as the expected responses of the <em>ns-3</em> TCP under test
to a stimulus generated by the NSC TCP which is used as a ‘’known good’’
implementation.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<p>The examples are tested by the framework to make sure they built and will
run.  Nothing is checked, and currently the pcap files are just written off
into /tmp to be discarded.  If the examples run (don’t crash) they pass this
smoke test.</p>
</div>
<div class="section" id="performance-tests">
<h5>Performance Tests<a class="headerlink" href="#performance-tests" title="Permalink to this headline">¶</a></h5>
<p>Performance tests are those which exercise a particular part of the system
and determine if the tests have executed to completion in a reasonable time.</p>
</div>
</div>
<div class="section" id="running-tests">
<h4>Running Tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h4>
<p>Tests are typically run using the high level <code class="docutils literal notranslate"><span class="pre">test.py</span></code> program. To get a list of the available command-line options, run <code class="docutils literal notranslate"><span class="pre">test.py</span> <span class="pre">--help</span></code></p>
<p>The test program <code class="docutils literal notranslate"><span class="pre">test.py</span></code> will run both tests and those examples that
have been added to the list to check.  The difference between tests
and examples is as follows.  Tests generally check that specific simulation
output or events conforms to expected behavior.  In contrast, the output
of examples is not checked, and the test program merely checks the exit
status of the example program to make sure that it runs without error.</p>
<p>Briefly, to run all tests, first one must configure tests during configuration
stage, and also (optionally) examples if examples are to be checked:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --configure --enable-examples --enable-tests
</pre></div>
</div>
<p>Then, build <em>ns-3</em>, and after it is built, just run <code class="docutils literal notranslate"><span class="pre">test.py</span></code>.  <code class="docutils literal notranslate"><span class="pre">test.py</span> <span class="pre">-h</span></code>
will show a number of configuration options that modify the behavior
of test.py.</p>
<p>The program <code class="docutils literal notranslate"><span class="pre">test.py</span></code> invokes, for C++ tests and examples, a lower-level
C++ program called <code class="docutils literal notranslate"><span class="pre">test-runner</span></code> to actually run the tests.  As discussed
below, this <code class="docutils literal notranslate"><span class="pre">test-runner</span></code> can be a helpful way to debug tests.</p>
</div>
<div class="section" id="debugging-tests">
<h4>Debugging Tests<a class="headerlink" href="#debugging-tests" title="Permalink to this headline">¶</a></h4>
<p>The debugging of the test programs is best performed running the low-level
test-runner program. The test-runner is the bridge from generic Python
code to <em>ns-3</em> code. It is written in C++ and uses the automatic test
discovery process in the <em>ns-3</em> code to find and allow execution of all
of the various tests.</p>
<p>The main reason why <code class="docutils literal notranslate"><span class="pre">test.py</span></code> is not suitable for debugging is that it is
not allowed for logging to be turned on using the <code class="docutils literal notranslate"><span class="pre">NS_LOG</span></code> environmental
variable when test.py runs.  This limitation does not apply to the test-runner
executable. Hence, if you want to see logging output from your tests, you
have to run them using the test-runner directly.</p>
<p>In order to execute the test-runner, you run it like any other <em>ns-3</em> executable
– using <code class="docutils literal notranslate"><span class="pre">waf</span></code>.  To get a list of available options, you can type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run <span class="s2">&quot;test-runner --help&quot;</span>
</pre></div>
</div>
<p>You should see something like the following</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Usage: /home/craigdo/repos/ns-3-allinone-test/ns-3-dev/build/utils/ns3-dev-test-runner-debug [OPTIONS]

Options:
--help                 : print these options
--print-test-name-list : print the list of names of tests available
--list                 : an alias for --print-test-name-list
--print-test-types     : print the type of tests along with their names
--print-test-type-list : print the list of types of tests available
--print-temp-dir       : print name of temporary directory before running
                         the tests
--test-type=TYPE       : process only tests of type TYPE
--test-name=NAME       : process only test whose name matches NAME
--suite=NAME           : an alias (here for compatibility reasons only)
                         for --test-name=NAME
--assert-on-failure    : when a test fails, crash immediately (useful
                         when running under a debugger
--stop-on-failure      : when a test fails, stop immediately
--fullness=FULLNESS    : choose the duration of tests to run: QUICK,
                         EXTENSIVE, or TAKES_FOREVER, where EXTENSIVE
                         includes QUICK and TAKES_FOREVER includes
                         QUICK and EXTENSIVE (only QUICK tests are
                         run by default)
--verbose              : print details of test execution
--xml                  : format test run output as xml
--tempdir=DIR          : set temp dir for tests to store output files
--datadir=DIR          : set data dir for tests to read reference files
--out=FILE             : send test result to FILE instead of standard output
--append=FILE          : append test result to FILE instead of standard output
</pre></div>
</div>
<p>There are a number of things available to you which will be familiar to you if
you have looked at <code class="docutils literal notranslate"><span class="pre">test.py</span></code>.  This should be expected since the test-
runner is just an interface between <code class="docutils literal notranslate"><span class="pre">test.py</span></code> and <em>ns-3</em>.  You
may notice that example-related commands are missing here.  That is because
the examples are really not <em>ns-3</em> tests.  <code class="docutils literal notranslate"><span class="pre">test.py</span></code> runs them
as if they were to present a unified testing environment, but they are really
completely different and not to be found here.</p>
<p>The first new option that appears here, but not in test.py is the <code class="docutils literal notranslate"><span class="pre">--assert-on-failure</span></code>
option.  This option is useful when debugging a test case when running under a
debugger like <code class="docutils literal notranslate"><span class="pre">gdb</span></code>.  When selected, this option tells the underlying
test case to cause a segmentation violation if an error is detected.  This has
the nice side-effect of causing program execution to stop (break into the
debugger) when an error is detected.  If you are using gdb, you could use this
option something like,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf shell
$ <span class="nb">cd</span> build/utils
$ gdb ns3-dev-test-runner-debug
$ run --suite<span class="o">=</span>global-value --assert-on-failure
</pre></div>
</div>
<p>If an error is then found in the global-value test suite, a segfault would be
generated and the (source level) debugger would stop at the <code class="docutils literal notranslate"><span class="pre">NS_TEST_ASSERT_MSG</span></code>
that detected the error.</p>
<p>To run one of the tests directly from the test-runner
using <code class="docutils literal notranslate"><span class="pre">waf</span></code>, you will need to specify the test suite to run.
So you could use the shell and do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run <span class="s2">&quot;test-runner --suite=pcap-file&quot;</span>
</pre></div>
</div>
<p><em>ns-3</em> logging is available when you run it this way, such as:</p>
<blockquote>
<div><p>$ NS_LOG=”Packet” ./waf –run “test-runner –suite=pcap-file”</p>
</div></blockquote>
<div class="section" id="test-output">
<h5>Test output<a class="headerlink" href="#test-output" title="Permalink to this headline">¶</a></h5>
<p>Many test suites need to write temporary files (such as pcap files)
in the process of running the tests.  The tests then need a temporary directory
to write to.  The Python test utility (test.py) will provide a temporary file
automatically, but if run stand-alone this temporary directory must be provided.
It can be annoying to continually have to provide
a <code class="docutils literal notranslate"><span class="pre">--tempdir</span></code>, so the test runner will figure one out for you if you don’t
provide one.  It first looks for environment variables named <code class="docutils literal notranslate"><span class="pre">TMP</span></code> and
<code class="docutils literal notranslate"><span class="pre">TEMP</span></code> and uses those.  If neither <code class="docutils literal notranslate"><span class="pre">TMP</span></code> nor <code class="docutils literal notranslate"><span class="pre">TEMP</span></code> are defined
it picks <code class="docutils literal notranslate"><span class="pre">/tmp</span></code>.  The code then tacks on an identifier indicating what
created the directory (ns-3) then the time (hh.mm.ss) followed by a large random
number.  The test runner creates a directory of that name to be used as the
temporary directory.  Temporary files then go into a directory that will be
named something like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/tmp/ns-3.10.25.37.61537845
</pre></div>
</div>
<p>The time is provided as a hint so that you can relatively easily reconstruct
what directory was used if you need to go back and look at the files that were
placed in that directory.</p>
<p>Another class of output is test output like pcap traces that are generated
to compare to reference output.  The test program will typically delete
these after the test suites all run.  To disable the deletion of test
output, run <code class="docutils literal notranslate"><span class="pre">test.py</span></code> with the “retain” option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py -r
</pre></div>
</div>
<p>and test output can be found in the <code class="docutils literal notranslate"><span class="pre">testpy-output/</span></code> directory.</p>
</div>
<div class="section" id="reporting-of-test-failures">
<h5>Reporting of test failures<a class="headerlink" href="#reporting-of-test-failures" title="Permalink to this headline">¶</a></h5>
<p>When you run a test suite using the test-runner it will run the test
and report PASS or FAIL.
To run more quietly, you need to specify an output file to which the tests will write their status using the <code class="docutils literal notranslate"><span class="pre">--out</span></code> option.
Try,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run <span class="s2">&quot;test-runner --suite=pcap-file --out=myfile.txt&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="debugging-test-suite-failures">
<h5>Debugging test suite failures<a class="headerlink" href="#debugging-test-suite-failures" title="Permalink to this headline">¶</a></h5>
<p>To debug test crashes, such as</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>CRASH: TestSuite wifi-interference
</pre></div>
</div>
<p>You can access the underlying test-runner program via gdb as follows, and
then pass the “–basedir=`pwd`” argument to run (you can also pass other
arguments as needed, but basedir is the minimum needed):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --command-template<span class="o">=</span><span class="s2">&quot;gdb %s&quot;</span> --run <span class="s2">&quot;test-runner&quot;</span>
Waf: Entering directory <span class="sb">`</span>/home/tomh/hg/sep09/ns-3-allinone/ns-3-dev-678/build<span class="s1">&#39;</span>
<span class="s1">Waf: Leaving directory `/home/tomh/hg/sep09/ns-3-allinone/ns-3-dev-678/build&#39;</span>
<span class="s1">&#39;build&#39;</span> finished successfully <span class="o">(</span><span class="m">0</span>.380s<span class="o">)</span>
GNU gdb <span class="m">6</span>.8-debian
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2008</span> Free Software Foundation, Inc.
L cense GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
This GDB was configured as <span class="s2">&quot;x86_64-linux-gnu&quot;</span>...
<span class="o">(</span>gdb<span class="o">)</span> r --suite<span class="o">=</span>
Starting program: &lt;..&gt;/build/utils/ns3-dev-test-runner-debug --suite<span class="o">=</span>wifi-interference
<span class="o">[</span>Thread debugging using libthread_db enabled<span class="o">]</span>
assert failed. <span class="nv">file</span><span class="o">=</span>../src/core/model/type-id.cc, <span class="nv">line</span><span class="o">=</span><span class="m">138</span>, <span class="nv">cond</span><span class="o">=</span><span class="s2">&quot;uid &lt;= m_information.size () &amp;&amp; uid != 0&quot;</span>
...
</pre></div>
</div>
<p>Here is another example of how to use valgrind to debug a memory problem
such as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>VALGR: TestSuite devices-mesh-dot11s-regression

$ ./waf --command-template<span class="o">=</span><span class="s2">&quot;valgrind %s --suite=devices-mesh-dot11s-regression&quot;</span> --run test-runner
</pre></div>
</div>
</div>
</div>
<div class="section" id="class-testrunner">
<h4>Class TestRunner<a class="headerlink" href="#class-testrunner" title="Permalink to this headline">¶</a></h4>
<p>The executables that run dedicated test programs use a TestRunner class.  This
class provides for automatic test registration and listing, as well as a way to
execute the individual tests.  Individual test suites use C++ global
constructors
to add themselves to a collection of test suites managed by the test runner.
The test runner is used to list all of the available tests and to select a test
to be run.  This is a quite simple class that provides three static methods to
provide or Adding and Getting test suites to a collection of tests.  See the
doxygen for class <code class="docutils literal notranslate"><span class="pre">ns3::TestRunner</span></code> for details.</p>
</div>
<div class="section" id="test-suite">
<h4>Test Suite<a class="headerlink" href="#test-suite" title="Permalink to this headline">¶</a></h4>
<p>All <em>ns-3</em> tests are classified into Test Suites and Test Cases.  A
test suite is a collection of test cases that completely exercise a given kind
of functionality.  As described above, test suites can be classified as,</p>
<ul class="simple">
<li><p>Build Verification Tests</p></li>
<li><p>Unit Tests</p></li>
<li><p>System Tests</p></li>
<li><p>Examples</p></li>
<li><p>Performance Tests</p></li>
</ul>
<p>This classification is exported from the TestSuite class.  This class is quite
simple, existing only as a place to export this type and to accumulate test
cases.  From a user perspective, in order to create a new TestSuite in the
system one only has to define a new class that inherits from class <code class="docutils literal notranslate"><span class="pre">TestSuite</span></code>
and perform these two duties.</p>
<p>The following code will define a new class that can be run by <code class="docutils literal notranslate"><span class="pre">test.py</span></code>
as a ‘’unit’’ test with the display name, <code class="docutils literal notranslate"><span class="pre">my-test-suite-name</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySuite</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TestSuite</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">MyTestSuite</span> <span class="p">();</span>
<span class="p">};</span>

<span class="n">MyTestSuite</span><span class="o">::</span><span class="n">MyTestSuite</span> <span class="p">()</span>
  <span class="o">:</span> <span class="n">TestSuite</span> <span class="p">(</span><span class="s">&quot;my-test-suite-name&quot;</span><span class="p">,</span> <span class="n">UNIT</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">AddTestCase</span> <span class="p">(</span><span class="k">new</span> <span class="n">MyTestCase</span><span class="p">,</span> <span class="n">TestCase</span><span class="o">::</span><span class="n">QUICK</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">MyTestSuite</span> <span class="n">myTestSuite</span><span class="p">;</span>
</pre></div>
</div>
<p>The base class takes care of all of the registration and reporting required to
be a good citizen in the test framework.</p>
<p>Avoid putting initialization logic into the test suite or test case
constructors.  This is
because an instance of the test suite is created at run time
(due to the static variable above) regardless of whether the test is being
run or not.  Instead, the TestCase provides a virtual <code class="docutils literal notranslate"><span class="pre">DoSetup</span></code> method
that can be specialized to perform setup before <code class="docutils literal notranslate"><span class="pre">DoRun</span></code> is called.</p>
</div>
<div class="section" id="test-case">
<h4>Test Case<a class="headerlink" href="#test-case" title="Permalink to this headline">¶</a></h4>
<p>Individual tests are created using a TestCase class.  Common models for the use
of a test case include “one test case per feature”, and “one test case per method.”
Mixtures of these models may be used.</p>
<p>In order to create a new test case in the system, all one has to do is to inherit
from the  <code class="docutils literal notranslate"><span class="pre">TestCase</span></code> base class, override the constructor to give the test
case a name and override the <code class="docutils literal notranslate"><span class="pre">DoRun</span></code> method to run the test.  Optionally,
override also the <code class="docutils literal notranslate"><span class="pre">DoSetup</span></code> method.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTestCase</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TestCase</span>
<span class="p">{</span>
  <span class="n">MyTestCase</span> <span class="p">();</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">DoSetup</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">DoRun</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="p">};</span>

<span class="n">MyTestCase</span><span class="o">::</span><span class="n">MyTestCase</span> <span class="p">()</span>
  <span class="o">:</span> <span class="n">TestCase</span> <span class="p">(</span><span class="s">&quot;Check some bit of functionality&quot;</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="n">MyTestCase</span><span class="o">::</span><span class="n">DoRun</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NS_TEST_ASSERT_MSG_EQ</span> <span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="s">&quot;Some failure message&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="utilities">
<h4>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h4>
<p>There are a number of utilities of various kinds that are also part of the
testing framework.  Examples include a generalized pcap file useful for
storing test vectors; a generic container useful for transient storage of
test vectors during test execution; and tools for generating presentations
based on validation and verification testing results.</p>
<p>These utilities are not documented here, but for example, please see
how the TCP tests found in <code class="docutils literal notranslate"><span class="pre">src/test/ns3tcp/</span></code> use pcap files and reference
output.</p>
</div>
</div>
<span id="document-how-to-write-tests"></span><div class="section" id="how-to-write-tests">
<h3>How to write tests<a class="headerlink" href="#how-to-write-tests" title="Permalink to this headline">¶</a></h3>
<p>A primary goal of the ns-3 project is to help users to improve the
validity and credibility of their results.  There are many elements
to obtaining valid models and simulations, and testing is a major
component.  If you contribute models or examples to ns-3, you may
be asked to contribute test code.  Models that you contribute will be
used for many years by other people, who probably have no idea upon
first glance whether the model is correct.  The test code that you
write for your model will help to avoid future regressions in
the output and will aid future users in understanding the verification
and bounds of applicability of your models.</p>
<p>There are many ways to verify the correctness of a model’s implementation.
In this section,
we hope to cover some common cases that can be used as a guide to
writing new tests.</p>
<div class="section" id="sample-testsuite-skeleton">
<h4>Sample TestSuite skeleton<a class="headerlink" href="#sample-testsuite-skeleton" title="Permalink to this headline">¶</a></h4>
<p>When starting from scratch (i.e. not adding a TestCase to an existing
TestSuite), these things need to be decided up front:</p>
<ul class="simple">
<li><p>What the test suite will be called</p></li>
<li><p>What type of test it will be (Build Verification Test, Unit Test,
System Test, or Performance Test)</p></li>
<li><p>Where the test code will live (either in an existing ns-3 module or
separately in src/test/ directory).  You will have to edit the wscript
file in that directory to compile your new code, if it is a new file.</p></li>
</ul>
<p>A program called <code class="docutils literal notranslate"><span class="pre">src/create-module.py</span></code> is a good starting point.
This program can be invoked such as <code class="docutils literal notranslate"><span class="pre">create-module.py</span> <span class="pre">router</span></code> for
a hypothetical new module called <code class="docutils literal notranslate"><span class="pre">router</span></code>.  Once you do this, you
will see a <code class="docutils literal notranslate"><span class="pre">router</span></code> directory, and a <code class="docutils literal notranslate"><span class="pre">test/router-test-suite.cc</span></code>
test suite.  This file can be a starting point for your initial test.
This is a working test suite, although the actual tests performed are
trivial.  Copy it over to your module’s test directory, and do a global
substitution of “Router” in that file for something pertaining to
the model that you want to test.  You can also edit things such as a
more descriptive test case name.</p>
<p>You also need to add a block into your wscript to get this test to
compile:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">module_test</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;test/router-test-suite.cc&#39;</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Before you actually start making this do useful things, it may help
to try to run the skeleton.  Make sure that ns-3 has been configured with
the “–enable-tests” option.  Let’s assume that your new test suite
is called “router” such as here:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">RouterTestSuite</span><span class="o">::</span><span class="n">RouterTestSuite</span> <span class="p">()</span>
  <span class="o">:</span> <span class="n">TestSuite</span> <span class="p">(</span><span class="s">&quot;router&quot;</span><span class="p">,</span> <span class="n">UNIT</span><span class="p">)</span>
</pre></div>
</div>
<p>Try this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./test.py -s router
</pre></div>
</div>
<p>Output such as below should be produced:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>PASS: TestSuite router
1 of 1 tests passed (1 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
<p>See src/lte/test/test-lte-antenna.cc for a worked example.</p>
</div>
<div class="section" id="test-macros">
<h4>Test macros<a class="headerlink" href="#test-macros" title="Permalink to this headline">¶</a></h4>
<p>There are a number of macros available for checking test program
output with expected output.  These macros are defined in
<code class="docutils literal notranslate"><span class="pre">src/core/model/test.h</span></code>.</p>
<p>The main set of macros that are used include the following:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NS_TEST_ASSERT_MSG_EQ</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="n">NS_TEST_ASSERT_MSG_NE</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="n">NS_TEST_ASSERT_MSG_LT</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="n">NS_TEST_ASSERT_MSG_GT</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="n">NS_TEST_ASSERT_MSG_EQ_TOL</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<p>The first argument <code class="docutils literal notranslate"><span class="pre">actual</span></code> is the value under test, the second value
<code class="docutils literal notranslate"><span class="pre">limit</span></code> is the expected value (or the value to test against), and the
last argument <code class="docutils literal notranslate"><span class="pre">msg</span></code> is the error message to print out if the test fails.</p>
<p>The first four macros above test for equality, inequality, less than, or
greater than, respectively.  The fifth macro above tests for equality,
but within a certain tolerance.  This variant is useful when testing
floating point numbers for equality against a limit, where you want to
avoid a test failure due to rounding errors.</p>
<p>Finally, there are variants of the above where the keyword <code class="docutils literal notranslate"><span class="pre">ASSERT</span></code>
is replaced by <code class="docutils literal notranslate"><span class="pre">EXPECT</span></code>.  These variants are designed specially for
use in methods (especially callbacks) returning void.  Reserve their
use for callbacks that you use in your test programs; otherwise,
use the <code class="docutils literal notranslate"><span class="pre">ASSERT</span></code> variants.</p>
</div>
<div class="section" id="how-to-add-an-example-program-to-the-test-suite">
<h4>How to add an example program to the test suite<a class="headerlink" href="#how-to-add-an-example-program-to-the-test-suite" title="Permalink to this headline">¶</a></h4>
<p>One can “smoke test” that examples compile and run successfully
to completion (without memory leaks) using the <code class="docutils literal notranslate"><span class="pre">examples-to-run.py</span></code>
script located in your module’s test directory.  Briefly, by including
an instance of this file in your test directory, you can cause the
test runner to execute the examples listed.  It is usually best to make
sure that you select examples that have reasonably short run times so as
to not bog down the tests.  See the example in <code class="docutils literal notranslate"><span class="pre">src/lte/test/</span></code>
directory.</p>
</div>
<div class="section" id="testing-for-boolean-outcomes">
<h4>Testing for boolean outcomes<a class="headerlink" href="#testing-for-boolean-outcomes" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="testing-outcomes-when-randomness-is-involved">
<h4>Testing outcomes when randomness is involved<a class="headerlink" href="#testing-outcomes-when-randomness-is-involved" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="testing-output-data-against-a-known-distribution">
<h4>Testing output data against a known distribution<a class="headerlink" href="#testing-output-data-against-a-known-distribution" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="providing-non-trivial-input-vectors-of-data">
<h4>Providing non-trivial input vectors of data<a class="headerlink" href="#providing-non-trivial-input-vectors-of-data" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="storing-and-referencing-non-trivial-output-data">
<h4>Storing and referencing non-trivial output data<a class="headerlink" href="#storing-and-referencing-non-trivial-output-data" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="presenting-your-output-test-data">
<h4>Presenting your output test data<a class="headerlink" href="#presenting-your-output-test-data" title="Permalink to this headline">¶</a></h4>
</div>
</div>
</div>
</div>
<span id="document-support"></span><div class="section" id="support">
<h2>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-new-models"></span><div class="section" id="creating-a-new-ns3-model">
<h3>Creating a new <em>ns-3</em> model<a class="headerlink" href="#creating-a-new-ns3-model" title="Permalink to this headline">¶</a></h3>
<p>This chapter walks through the design process of an <em>ns-3</em> model.  In many
research cases, users will not be satisfied to merely adapt existing models, but
may want to extend the core of the simulator in a novel way. We will use the
example of adding an ErrorModel to a simple <em>ns-3</em> link as a motivating example
of how one might approach this problem and proceed through a design and
implementation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Documentation</p>
<p>Here we focus on the process of creating new models
and new modules, and some of the design choices involved.
For the sake of clarity, we defer discussion of the
<em>mechanics</em> of documenting models and source code to the
<a class="reference internal" href="index.html#document-documentation"><span class="doc">Documentation</span></a> chapter.</p>
</div>
<div class="section" id="design-approach">
<h4>Design Approach<a class="headerlink" href="#design-approach" title="Permalink to this headline">¶</a></h4>
<p>Consider how you want it to work; what should it do. Think about these things:</p>
<ul class="simple">
<li><p><em>functionality:</em>  What functionality should it have?  What attributes or
configuration is exposed to the user?</p></li>
<li><p><em>reusability:</em>  How much should others be able to reuse my design?  Can I
reuse code from <em>ns-2</em> to get started?  How does a user integrate the model
with the rest of another simulation?</p></li>
<li><p><em>dependencies:</em>  How can I reduce the introduction of outside dependencies on
my new code as much as possible (to make it more modular)?  For instance,
should I avoid any dependence on IPv4 if I want it to also be used by IPv6?
Should I avoid any dependency on IP at all?</p></li>
</ul>
<p>Do not be hesitant to contact the <cite>ns-3-users</cite> or <cite>ns-developers</cite> list if you have
questions. In particular, it is important to think about the public API of your
new model and ask for feedback. It also helps to let others know of your work in
case you are interested in collaborators.</p>
<div class="section" id="example-errormodel">
<h5>Example: <cite>ErrorModel</cite><a class="headerlink" href="#example-errormodel" title="Permalink to this headline">¶</a></h5>
<p>An error model exists in <em>ns-2</em>. It allows packets to be passed to a stateful
object that determines, based on a random variable, whether the packet is
corrupted.  The caller can then decide what to do with the packet (drop it,
etc.).</p>
<p>The main API of the error model is a function to pass a packet to, and the
return value of this function is a boolean that tells the caller whether any
corruption occurred.  Note that depending on the error model, the packet data
buffer may or may not be corrupted.  Let’s call this function “IsCorrupt()”.</p>
<p>So far, in our design, we have:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ErrorModel</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
 <span class="cm">/**</span>
<span class="cm">  * \returns true if the Packet is to be considered as errored/corrupted</span>
<span class="cm">  * \param pkt Packet to apply error model to</span>
<span class="cm">  */</span>
  <span class="kt">bool</span> <span class="n">IsCorrupt</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="n">pkt</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Note that we do not pass a const pointer, thereby allowing the function to
modify the packet if IsCorrupt() returns true. Not all error models will
actually modify the packet; whether or not the packet data buffer is corrupted
should be documented.</p>
<p>We may also want specialized versions of this, such as in <em>ns-2</em>, so although it
is not the only design choice for polymorphism, we assume that we will subclass
a base class ErrorModel for specialized classes, such as RateErrorModel,
ListErrorModel, etc, such as is done in <em>ns-2</em>.</p>
<p>You may be thinking at this point, “Why not make IsCorrupt() a virtual method?”.
That is one approach; the other is to make the public non-virtual function
indirect through a private virtual function (this in C++ is known as the non
virtual interface idiom and is adopted in the <em>ns-3</em> ErrorModel class).</p>
<p>Next, should this device have any dependencies on IP or other protocols?  We do
not want to create dependencies on Internet protocols (the error model should be
applicable to non-Internet protocols too), so we’ll keep that in mind later.</p>
<p>Another consideration is how objects will include this error model.  We envision
putting an explicit setter in certain NetDevice implementations, for example.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Attach a receive ErrorModel to the PointToPointNetDevice.</span>
<span class="cm"> *</span>
<span class="cm"> * The PointToPointNetDevice may optionally include an ErrorModel in</span>
<span class="cm"> * the packet receive chain.</span>
<span class="cm"> *</span>
<span class="cm"> * @see ErrorModel</span>
<span class="cm"> * @param em Ptr to the ErrorModel.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">PointToPointNetDevice</span><span class="o">::</span><span class="n">SetReceiveErrorModel</span><span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ErrorModel</span><span class="o">&gt;</span> <span class="n">em</span><span class="p">);</span>
</pre></div>
</div>
<p>Again, this is not the only choice we have (error models could be aggregated to
lots of other objects), but it satisfies our primary use case, which is to allow
a user to force errors on otherwise successful packet transmissions, at the
NetDevice level.</p>
<p>After some thinking and looking at existing <em>ns-2</em> code, here is a sample API of
a base class and first subclass that could be posted for initial review:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ErrorModel</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">ErrorModel</span> <span class="p">();</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">ErrorModel</span> <span class="p">();</span>
  <span class="kt">bool</span> <span class="nf">IsCorrupt</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="n">pkt</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">Reset</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">Enable</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">Disable</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="nf">IsEnabled</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">DoCorrupt</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="n">pkt</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">DoReset</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ErrorUnit</span>
  <span class="p">{</span>
    <span class="n">EU_BIT</span><span class="p">,</span>
    <span class="n">EU_BYTE</span><span class="p">,</span>
    <span class="n">EU_PKT</span>
  <span class="p">};</span>

<span class="c1">// Determine which packets are errored corresponding to an underlying</span>
<span class="c1">// random variable distribution, an error rate, and unit for the rate.</span>
<span class="k">class</span> <span class="nc">RateErrorModel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ErrorModel</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">RateErrorModel</span> <span class="p">();</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">RateErrorModel</span> <span class="p">();</span>
  <span class="k">enum</span> <span class="n">ErrorUnit</span> <span class="nf">GetUnit</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">SetUnit</span> <span class="p">(</span><span class="k">enum</span> <span class="n">ErrorUnit</span> <span class="n">error_unit</span><span class="p">);</span>
  <span class="kt">double</span> <span class="nf">GetRate</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">SetRate</span> <span class="p">(</span><span class="kt">double</span> <span class="n">rate</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">SetRandomVariable</span> <span class="p">(</span><span class="k">const</span> <span class="n">RandomVariable</span> <span class="o">&amp;</span><span class="n">ranvar</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">DoCorrupt</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="n">pkt</span><span class="p">);</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">DoReset</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="scaffolding">
<h4>Scaffolding<a class="headerlink" href="#scaffolding" title="Permalink to this headline">¶</a></h4>
<p>Let’s say that you are ready to start implementing; you have a fairly clear
picture of what you want to build, and you may have solicited some initial
review or suggestions from the list.  One way to approach the next step
(implementation) is to create scaffolding and fill in the details as the design
matures.</p>
<p>This section walks through many of the steps you should consider to define
scaffolding, or a non-functional skeleton of what your model will eventually
implement. It is usually good practice to not wait to get these details
integrated at the end, but instead to plumb a skeleton of your model into the
system early and then add functions later once the API and integration seems
about right.</p>
<p>Note that you will want to modify a few things in the below presentation for
your model since if you follow the error model verbatim, the code you produce
will collide with the existing error model. The below is just an outline of how
ErrorModel was built that you can adapt to other models.</p>
<div class="section" id="review-the-ns3-coding-style-document">
<h5>Review the <em>ns-3</em> Coding Style Document<a class="headerlink" href="#review-the-ns3-coding-style-document" title="Permalink to this headline">¶</a></h5>
<p>At this point, you may want to pause and read the <em>ns-3</em> coding style document,
especially if you are considering to contribute your code back to the project.
The coding style document is linked off the main project page: <a class="reference external" href="http://www.nsnam.org/developers/contributing-code/coding-style/">ns-3 coding
style</a>.</p>
</div>
<div class="section" id="decide-where-in-the-source-tree-the-model-should-reside">
<h5>Decide Where in the Source Tree the Model Should Reside<a class="headerlink" href="#decide-where-in-the-source-tree-the-model-should-reside" title="Permalink to this headline">¶</a></h5>
<p>All of the <em>ns-3</em> model source code is in the directory <code class="docutils literal notranslate"><span class="pre">src/</span></code>.  You will need
to choose which subdirectory it resides in. If it is new model code of some
sort, it makes sense to put it into the <code class="docutils literal notranslate"><span class="pre">src/</span></code> directory somewhere,
particularly for ease of integrating with the build system.</p>
<p>In the case of the error model, it is very related to the packet class, so it
makes sense to implement this in the <code class="docutils literal notranslate"><span class="pre">src/network/</span></code> module where <em>ns-3</em>
packets are implemented.</p>
</div>
<div class="section" id="waf-and-wscript">
<h5><cite>waf</cite> and <cite>wscript</cite><a class="headerlink" href="#waf-and-wscript" title="Permalink to this headline">¶</a></h5>
<p><em>ns-3</em> uses the <a class="reference external" href="http://www.freehackers.org/~tnagy/waf.html">Waf</a> build system.
You will want to integrate your new <em>ns-3</em> uses the Waf build system. You will
want to integrate your new source files into this system. This requires that you
add your files to the <code class="docutils literal notranslate"><span class="pre">wscript</span></code> file found in each directory.</p>
<p>Let’s start with empty files error-model.h and error-model.cc, and add this to
<code class="docutils literal notranslate"><span class="pre">src/network/wscript</span></code>. It is really just a matter of adding the .cc file to the
rest of the source files, and the .h file to the list of the header files.</p>
<p>Now, pop up to the top level directory and type “./test.py”.  You
shouldn’t have broken anything by this operation.</p>
</div>
<div class="section" id="include-guards">
<h5>Include Guards<a class="headerlink" href="#include-guards" title="Permalink to this headline">¶</a></h5>
<p>Next, let’s add some <a class="reference external" href="http://en.wikipedia.org/wiki/Include_guard">include guards</a> in our header file.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef ERROR_MODEL_H</span>
<span class="cp">#define ERROR_MODEL_H</span>
<span class="p">...</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="section" id="namespace-ns3">
<h5><cite>namespace ns3</cite><a class="headerlink" href="#namespace-ns3" title="Permalink to this headline">¶</a></h5>
<p><em>ns-3</em> uses the <em>ns-3</em> <a class="reference external" href="http://en.wikipedia.org/wiki/Namespace_(computer_science)#Use_in_common_languages">namespace</a>
to isolate its symbols from other namespaces. Typically, a user will next put
an <em>ns-3</em> namespace block in both the cc and h file.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">ns3</span> <span class="p">{</span>
<span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At this point, we have some skeletal files in which we can start defining
our new classes. The header file looks like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef ERROR_MODEL_H</span>
<span class="cp">#define ERROR_MODEL_H</span>

<span class="k">namespace</span> <span class="n">ns3</span> <span class="p">{</span>

<span class="p">}</span> <span class="c1">// namespace ns3</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>while the <code class="docutils literal notranslate"><span class="pre">error-model.cc</span></code> file simply looks like this:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;error-model.h&quot;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">ns3</span> <span class="p">{</span>

<span class="p">}</span> <span class="c1">// namespace ns3</span>
</pre></div>
</div>
<p>These files should compile since they don’t really have any contents.  We’re now
ready to start adding classes.</p>
</div>
</div>
<div class="section" id="initial-implementation">
<h4>Initial Implementation<a class="headerlink" href="#initial-implementation" title="Permalink to this headline">¶</a></h4>
<p>At this point, we’re still working on some scaffolding, but we can begin to
define our classes, with the functionality to be added later.</p>
<div class="section" id="inherit-from-the-object-class">
<h5>Inherit from the <cite>Object</cite> Class?<a class="headerlink" href="#inherit-from-the-object-class" title="Permalink to this headline">¶</a></h5>
<p>This is an important design step; whether to use class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> as a
base class for your new classes.</p>
<p>As described in the chapter on the <em>ns-3</em> <a class="reference internal" href="index.html#object-model"><span class="std std-ref">Object model</span></a>, classes that
inherit from class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> get special properties:</p>
<ul class="simple">
<li><p>the <em>ns-3</em> type and attribute system (see <a class="reference internal" href="index.html#attributes"><span class="std std-ref">Configuration and Attributes</span></a>)</p></li>
<li><p>an object aggregation system</p></li>
<li><p>a smart-pointer reference counting system (class Ptr)</p></li>
</ul>
<p>Classes that derive from class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">ObjectBase</span></code>} get the first two
properties above, but do not get smart pointers. Classes that derive from class
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">RefCountBase</span></code> get only the smart-pointer reference counting system.</p>
<p>In practice, class <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> is the variant of the three above that
the <em>ns-3</em> developer will most commonly encounter.</p>
<p>In our case, we want to make use of the attribute system, and we will be passing
instances of this object across the <em>ns-3</em> public API, so class
<code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">Object</span></code> is appropriate for us.</p>
</div>
<div class="section" id="initial-classes">
<h5>Initial Classes<a class="headerlink" href="#initial-classes" title="Permalink to this headline">¶</a></h5>
<p>One way to proceed is to start by defining the bare minimum functions and see if
they will compile. Let’s review what all is needed to implement when we derive
from class Object.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef ERROR_MODEL_H</span>
<span class="cp">#define ERROR_MODEL_H</span>

<span class="cp">#include</span> <span class="cpf">&quot;ns3/object.h&quot;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">ns3</span> <span class="p">{</span>

<span class="k">class</span> <span class="nc">ErrorModel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Object</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

  <span class="n">ErrorModel</span> <span class="p">();</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">ErrorModel</span> <span class="p">();</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">RateErrorModel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ErrorModel</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

  <span class="n">RateErrorModel</span> <span class="p">();</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">RateErrorModel</span> <span class="p">();</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>A few things to note here. We need to include <code class="docutils literal notranslate"><span class="pre">object.h</span></code>. The convention in
<em>ns-3</em> is that if the header file is co-located in the same directory, it may be
included without any path prefix. Therefore, if we were implementing ErrorModel
in <code class="docutils literal notranslate"><span class="pre">src/core/model</span></code> directory, we could have just said “<code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;object.h&quot;</span></code>”.
But we are in <code class="docutils literal notranslate"><span class="pre">src/network/model</span></code>, so we must include it as “<code class="docutils literal notranslate"><span class="pre">#include</span>
<span class="pre">&quot;ns3/object.h&quot;</span></code>”. Note also that this goes outside the namespace declaration.</p>
<p>Second, each class must implement a static public member function called
<code class="docutils literal notranslate"><span class="pre">GetTypeId</span> <span class="pre">(void)</span></code>.</p>
<p>Third, it is a good idea to implement constructors and destructors rather than
to let the compiler generate them, and to make the destructor virtual. In C++,
note also that copy assignment operator and copy constructors are auto-generated
if they are not defined, so if you do not want those, you should implement those
as private members. This aspect of C++ is discussed in Scott Meyers’ Effective
C++ book. item 45.</p>
<p>Let’s now look at some corresponding skeletal implementation code in the .cc
file.:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;error-model.h&quot;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">ns3</span> <span class="p">{</span>

<span class="n">NS_OBJECT_ENSURE_REGISTERED</span> <span class="p">(</span><span class="n">ErrorModel</span><span class="p">);</span>

<span class="n">TypeId</span> <span class="n">ErrorModel</span><span class="o">::</span><span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;ns3::ErrorModel&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">SetParent</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">SetGroupName</span> <span class="p">(</span><span class="s">&quot;Network&quot;</span><span class="p">)</span>
    <span class="p">;</span>
  <span class="k">return</span> <span class="n">tid</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">ErrorModel</span><span class="o">::</span><span class="n">ErrorModel</span> <span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">ErrorModel</span><span class="o">::~</span><span class="n">ErrorModel</span> <span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">NS_OBJECT_ENSURE_REGISTERED</span> <span class="p">(</span><span class="n">RateErrorModel</span><span class="p">);</span>

<span class="n">TypeId</span> <span class="n">RateErrorModel</span><span class="o">::</span><span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;ns3::RateErrorModel&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">SetParent</span><span class="o">&lt;</span><span class="n">ErrorModel</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">SetGroupName</span> <span class="p">(</span><span class="s">&quot;Network&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">AddConstructor</span><span class="o">&lt;</span><span class="n">RateErrorModel</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">;</span>
  <span class="k">return</span> <span class="n">tid</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">RateErrorModel</span><span class="o">::</span><span class="n">RateErrorModel</span> <span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="n">RateErrorModel</span><span class="o">::~</span><span class="n">RateErrorModel</span> <span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>What is the <code class="docutils literal notranslate"><span class="pre">GetTypeId</span> <span class="pre">(void)</span></code> function? This function does a few things.  It
registers a unique string into the TypeId system. It establishes  the hierarchy
of objects in the attribute system (via <code class="docutils literal notranslate"><span class="pre">SetParent</span></code>). It also declares that
certain objects can be created via the object creation framework
(<code class="docutils literal notranslate"><span class="pre">AddConstructor</span></code>).</p>
<p>The macro <code class="docutils literal notranslate"><span class="pre">NS_OBJECT_ENSURE_REGISTERED</span> <span class="pre">(classname)</span></code> is needed also once for
every class that defines a new GetTypeId method, and it does the actual
registration of the class into the system.  The <a class="reference internal" href="index.html#object-model"><span class="std std-ref">Object model</span></a> chapter
discusses this in more detail.</p>
</div>
<div class="section" id="including-external-files">
<h5>Including External Files<a class="headerlink" href="#including-external-files" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="logging-support">
<h5>Logging Support<a class="headerlink" href="#logging-support" title="Permalink to this headline">¶</a></h5>
<p><em>Here, write a bit about adding |ns3| logging macros. Note that
LOG_COMPONENT_DEFINE is done outside the namespace ns3</em></p>
</div>
<div class="section" id="constructor-empty-function-prototypes">
<h5>Constructor, Empty Function Prototypes<a class="headerlink" href="#constructor-empty-function-prototypes" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="key-variables-default-values-attributes">
<h5>Key Variables (Default Values, Attributes)<a class="headerlink" href="#key-variables-default-values-attributes" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="test-program-1">
<h5>Test Program 1<a class="headerlink" href="#test-program-1" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="object-framework">
<h5>Object Framework<a class="headerlink" href="#object-framework" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="adding-a-sample-script">
<h4>Adding a Sample Script<a class="headerlink" href="#adding-a-sample-script" title="Permalink to this headline">¶</a></h4>
<p>At this point, one may want to try to take the basic scaffolding defined above
and add it into the system. Performing this step now allows one to use a simpler
model when plumbing into the system and may also reveal whether any design or
API modifications need to be made. Once this is done, we will return to building
out the functionality of the ErrorModels themselves.</p>
<div class="section" id="add-basic-support-in-the-class">
<h5>Add Basic Support in the Class<a class="headerlink" href="#add-basic-support-in-the-class" title="Permalink to this headline">¶</a></h5>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* point-to-point-net-device.h */</span>
  <span class="k">class</span> <span class="nc">ErrorModel</span><span class="p">;</span>

  <span class="cm">/**</span>
<span class="cm">   * Error model for receive packet events</span>
<span class="cm">   */</span>
  <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ErrorModel</span><span class="o">&gt;</span> <span class="n">m_receiveErrorModel</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="add-accessor">
<h5>Add Accessor<a class="headerlink" href="#add-accessor" title="Permalink to this headline">¶</a></h5>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="n">PointToPointNetDevice</span><span class="o">::</span><span class="n">SetReceiveErrorModel</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ErrorModel</span><span class="o">&gt;</span> <span class="n">em</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NS_LOG_FUNCTION</span> <span class="p">(</span><span class="k">this</span> <span class="o">&lt;&lt;</span> <span class="n">em</span><span class="p">);</span>
  <span class="n">m_receiveErrorModel</span> <span class="o">=</span> <span class="n">em</span><span class="p">;</span>
<span class="p">}</span>

   <span class="p">.</span><span class="n">AddAttribute</span> <span class="p">(</span><span class="s">&quot;ReceiveErrorModel&quot;</span><span class="p">,</span>
                   <span class="s">&quot;The receiver error model used to simulate packet loss&quot;</span><span class="p">,</span>
                   <span class="n">PointerValue</span> <span class="p">(),</span>
                   <span class="n">MakePointerAccessor</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">PointToPointNetDevice</span><span class="o">::</span><span class="n">m_receiveErrorModel</span><span class="p">),</span>
                   <span class="n">MakePointerChecker</span><span class="o">&lt;</span><span class="n">ErrorModel</span><span class="o">&gt;</span> <span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="plumb-into-the-system">
<h5>Plumb Into the System<a class="headerlink" href="#plumb-into-the-system" title="Permalink to this headline">¶</a></h5>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">PointToPointNetDevice</span><span class="o">::</span><span class="n">Receive</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="n">packet</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NS_LOG_FUNCTION</span> <span class="p">(</span><span class="k">this</span> <span class="o">&lt;&lt;</span> <span class="n">packet</span><span class="p">);</span>
  <span class="kt">uint16_t</span> <span class="n">protocol</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">m_receiveErrorModel</span> <span class="o">&amp;&amp;</span> <span class="n">m_receiveErrorModel</span><span class="o">-&gt;</span><span class="n">IsCorrupt</span> <span class="p">(</span><span class="n">packet</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
<span class="c1">//</span>
<span class="c1">// If we have an error model and it indicates that it is time to lose a</span>
<span class="c1">// corrupted packet, don&#39;t forward this packet up, let it go.</span>
<span class="c1">//</span>
      <span class="n">m_dropTrace</span> <span class="p">(</span><span class="n">packet</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">else</span>
    <span class="p">{</span>
<span class="c1">//</span>
<span class="c1">// Hit the receive trace hook, strip off the point-to-point protocol header</span>
<span class="c1">// and forward this packet up the protocol stack.</span>
<span class="c1">//</span>
      <span class="n">m_rxTrace</span> <span class="p">(</span><span class="n">packet</span><span class="p">);</span>
      <span class="n">ProcessHeader</span><span class="p">(</span><span class="n">packet</span><span class="p">,</span> <span class="n">protocol</span><span class="p">);</span>
      <span class="n">m_rxCallback</span> <span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">packet</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">GetRemote</span> <span class="p">());</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">m_promiscCallback</span><span class="p">.</span><span class="n">IsNull</span> <span class="p">())</span>
        <span class="p">{</span>           <span class="n">m_promiscCallback</span> <span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">packet</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">GetRemote</span> <span class="p">(),</span>
                      <span class="n">GetAddress</span> <span class="p">(),</span> <span class="n">NetDevice</span><span class="o">::</span><span class="n">PACKET_HOST</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="create-null-functional-script">
<h5>Create Null Functional Script<a class="headerlink" href="#create-null-functional-script" title="Permalink to this headline">¶</a></h5>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/* simple-error-model.cc */</span>

  <span class="c1">// Error model</span>
  <span class="c1">// We want to add an error model to node 3&#39;s NetDevice</span>
  <span class="c1">// We can obtain a handle to the NetDevice via the channel and node</span>
  <span class="c1">// pointers</span>
  <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">PointToPointNetDevice</span><span class="o">&gt;</span> <span class="n">nd3</span> <span class="o">=</span> <span class="n">PointToPointTopology</span><span class="o">::</span><span class="n">GetNetDevice</span>
    <span class="p">(</span><span class="n">n3</span><span class="p">,</span> <span class="n">channel2</span><span class="p">);</span>
  <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ErrorModel</span><span class="o">&gt;</span> <span class="n">em</span> <span class="o">=</span> <span class="n">Create</span><span class="o">&lt;</span><span class="n">ErrorModel</span><span class="o">&gt;</span> <span class="p">();</span>
  <span class="n">nd3</span><span class="o">-&gt;</span><span class="n">SetReceiveErrorModel</span> <span class="p">(</span><span class="n">em</span><span class="p">);</span>


<span class="kt">bool</span>
<span class="n">ErrorModel</span><span class="o">::</span><span class="n">DoCorrupt</span> <span class="p">(</span><span class="n">Packet</span><span class="o">&amp;</span> <span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">NS_LOG_FUNCTION</span><span class="p">;</span>
  <span class="n">NS_LOG_UNCOND</span><span class="p">(</span><span class="s">&quot;Corrupt!&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>At this point, we can run the program with our trivial ErrorModel plumbed into
the receive path of the PointToPointNetDevice. It prints out the string
“Corrupt!” for each packet received at node n3. Next, we return to the error
model to add in a subclass that performs more interesting error modeling.</p>
</div>
</div>
<div class="section" id="add-a-subclass">
<h4>Add a Subclass<a class="headerlink" href="#add-a-subclass" title="Permalink to this headline">¶</a></h4>
<p>The trivial base class ErrorModel does not do anything interesting, but it
provides a useful base class interface (Corrupt () and Reset ()), forwarded to
virtual functions that can be subclassed. Let’s next consider what we call a
BasicErrorModel which is based on the <em>ns-2</em> ErrorModel class (in
<code class="docutils literal notranslate"><span class="pre">ns-2/queue/errmodel.{cc,h}</span></code>).</p>
<p>What properties do we want this to have, from a user interface perspective? We
would like for the user to be able to trivially swap out the type of ErrorModel
used in the NetDevice. We would also like the capability to set configurable
parameters.</p>
<p>Here are a few simple requirements we will consider:</p>
<ul class="simple">
<li><p>Ability to set the random variable that governs the losses (default is
UniformVariable)</p></li>
<li><p>Ability to set the unit (bit, byte, packet, time) of granularity over which
errors are applied.</p></li>
<li><p>Ability to set the rate of errors (e.g. 10^-3) corresponding to the above unit
of granularity.</p></li>
<li><p>Ability to enable/disable (default is enabled)</p></li>
</ul>
<div class="section" id="how-to-subclass">
<h5>How to Subclass<a class="headerlink" href="#how-to-subclass" title="Permalink to this headline">¶</a></h5>
<p>We declare BasicErrorModel to be a subclass of ErrorModel as follows,:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BasicErrorModel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">ErrorModel</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
  <span class="p">...</span>
<span class="k">private</span><span class="o">:</span>
  <span class="c1">// Implement base class pure virtual functions</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">DoCorrupt</span> <span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Packet</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">);</span>
  <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">DoReset</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and configure the subclass GetTypeId function by setting a unique TypeId string
and setting the Parent to ErrorModel:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">TypeId</span> <span class="n">RateErrorModel</span><span class="o">::</span><span class="n">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">TypeId</span> <span class="n">tid</span> <span class="o">=</span> <span class="n">TypeId</span> <span class="p">(</span><span class="s">&quot;ns3::RateErrorModel&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">SetParent</span><span class="o">&lt;</span><span class="n">ErrorModel</span><span class="o">&gt;</span> <span class="p">()</span>
    <span class="p">.</span><span class="n">SetGroupName</span> <span class="p">(</span><span class="s">&quot;Network&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">AddConstructor</span><span class="o">&lt;</span><span class="n">RateErrorModel</span><span class="o">&gt;</span> <span class="p">()</span>
  <span class="p">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-core-functions-and-unit-tests">
<h4>Build Core Functions and Unit Tests<a class="headerlink" href="#build-core-functions-and-unit-tests" title="Permalink to this headline">¶</a></h4>
<div class="section" id="assert-macros">
<h5>Assert Macros<a class="headerlink" href="#assert-macros" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="writing-unit-tests">
<h5>Writing Unit Tests<a class="headerlink" href="#writing-unit-tests" title="Permalink to this headline">¶</a></h5>
</div>
</div>
</div>
<span id="document-new-modules"></span><div class="section" id="adding-a-new-module-to-ns3">
<h3>Adding a New Module to <em>ns-3</em><a class="headerlink" href="#adding-a-new-module-to-ns3" title="Permalink to this headline">¶</a></h3>
<p>When you have created a group of related classes, examples, and tests,
they can be combined together into an <em>ns-3</em> module so that they can be
used with existing <em>ns-3</em> modules and by other researchers.</p>
<p>This chapter walks you through the steps necessary to add a new module
to <em>ns-3</em>.</p>
<div class="section" id="step-0-module-layout">
<span id="step-0"></span><h4>Step 0 - Module Layout<a class="headerlink" href="#step-0-module-layout" title="Permalink to this headline">¶</a></h4>
<p>All modules can be found in the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory.  Each module can be
found in a directory that has the same name as the module.  For
example, the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> module can be found here: <code class="docutils literal notranslate"><span class="pre">src/spectrum</span></code>.
We’ll be quoting from the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> module for illustration.</p>
<p>A prototypical module has the following directory structure and
required files:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>src/
  module-name/
    bindings/
    doc/
    examples/
      wscript
    helper/
    model/
    test/
      examples-to-run.py
    wscript
</pre></div>
</div>
<p>Not all directories will be present in each module.</p>
</div>
<div class="section" id="step-1-create-a-module-skeleton">
<h4>Step 1 - Create a Module Skeleton<a class="headerlink" href="#step-1-create-a-module-skeleton" title="Permalink to this headline">¶</a></h4>
<p>A python program is provided in the source directory that
will create a skeleton for a new module.  For the purposes
of this discussion we will assume that your new module
is called <code class="docutils literal notranslate"><span class="pre">new-module</span></code>.  From the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory, do the following
to create the new module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./create-module.py new-module
</pre></div>
</div>
<p>Next, <code class="docutils literal notranslate"><span class="pre">cd</span></code> into <code class="docutils literal notranslate"><span class="pre">new-module</span></code>; you will find this directory layout:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cd new-module
$ ls
doc examples  helper  model  test  wscript
</pre></div>
</div>
<p>In more detail, the <code class="docutils literal notranslate"><span class="pre">create-module.py</span></code> script will create the
directories as well as initial skeleton <code class="docutils literal notranslate"><span class="pre">wscript</span></code>, <code class="docutils literal notranslate"><span class="pre">.h</span></code>, <code class="docutils literal notranslate"><span class="pre">.cc</span></code>
and <code class="docutils literal notranslate"><span class="pre">.rst</span></code> files.  The complete module with skeleton files looks like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>src/
  new-module/
    doc/
      new-module.rst
    examples/
      new-module-example.cc
      wscript
    helper/
      new-module-helper.cc
      new-module-helper.h
    model/
      new-module.cc
      new-module.h
    test/
      new-module-test-suite.cc
    wscript
</pre></div>
</div>
<p>(If required the <code class="docutils literal notranslate"><span class="pre">bindings/</span></code> directory listed in
<a class="reference internal" href="#step-0"><span class="std std-ref">Step-0</span></a> will be created automatically during
the build.)</p>
<p>We next walk through how to customize this module.  Informing <code class="docutils literal notranslate"><span class="pre">waf</span></code>
about the files which make up your module is done by editing the two
<code class="docutils literal notranslate"><span class="pre">wscript</span></code> files.  We will walk through the main steps in this chapter.</p>
<p>All <em>ns-3</em> modules depend on the <code class="docutils literal notranslate"><span class="pre">core</span></code> module and usually on
other modules.  This dependency is specified in the <code class="docutils literal notranslate"><span class="pre">wscript</span></code> file
(at the top level of the module, not the separate <code class="docutils literal notranslate"><span class="pre">wscript</span></code> file
in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> directory!).  In the skeleton <code class="docutils literal notranslate"><span class="pre">wscript</span></code>
the call that will declare your new module to <code class="docutils literal notranslate"><span class="pre">waf</span></code> will look
like this (before editing):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">bld</span><span class="p">):</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">create_ns3_module</span><span class="p">(</span><span class="s1">&#39;new-module&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;core&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Let’s assume that <code class="docutils literal notranslate"><span class="pre">new-module</span></code> depends on the <code class="docutils literal notranslate"><span class="pre">internet</span></code>,
<code class="docutils literal notranslate"><span class="pre">mobility</span></code>, and <code class="docutils literal notranslate"><span class="pre">aodv</span></code> modules.  After editing it the <code class="docutils literal notranslate"><span class="pre">wscript</span></code> file
should look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">bld</span><span class="p">):</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">create_ns3_module</span><span class="p">(</span><span class="s1">&#39;new-module&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;internet&#39;</span><span class="p">,</span> <span class="s1">&#39;mobility&#39;</span><span class="p">,</span> <span class="s1">&#39;aodv&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Note that only first level module dependencies should be listed, which
is why we removed <code class="docutils literal notranslate"><span class="pre">core</span></code>; the <code class="docutils literal notranslate"><span class="pre">internet</span></code> module in turn depends on
<code class="docutils literal notranslate"><span class="pre">core</span></code>.</p>
<p>Your module will most likely have model source files.  Initial skeletons
(which will compile successfully) are created in <code class="docutils literal notranslate"><span class="pre">model/new-module.cc</span></code>
and <code class="docutils literal notranslate"><span class="pre">model/new-module.h</span></code>.</p>
<p>If your module will have helper source files, then they will go into
the <code class="docutils literal notranslate"><span class="pre">helper/</span></code> directory; again, initial skeletons are created
in that directory.</p>
<p>Finally, it is good practice to write tests and examples.  These will
almost certainly be required for new modules to be accepted into
the official <em>ns-3</em> source tree.  A skeleton
test suite and test case is created in the <code class="docutils literal notranslate"><span class="pre">test/</span></code> directory.
The skeleton test suite will contain the below constructor,
which declares a new unit test named <code class="docutils literal notranslate"><span class="pre">new-module</span></code>,
with a single test case consisting of the class <code class="docutils literal notranslate"><span class="pre">NewModuleTestCase1</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NewModuleTestSuite</span><span class="o">::</span><span class="n">NewModuleTestSuite</span> <span class="p">()</span>
  <span class="o">:</span> <span class="n">TestSuite</span> <span class="p">(</span><span class="s">&quot;new-module&quot;</span><span class="p">,</span> <span class="n">UNIT</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">AddTestCase</span> <span class="p">(</span><span class="k">new</span> <span class="n">NewModuleTestCase1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-declare-source-files">
<h4>Step 3 - Declare Source Files<a class="headerlink" href="#step-3-declare-source-files" title="Permalink to this headline">¶</a></h4>
<p>The public header and source code files for your new module
should be specified in the <code class="docutils literal notranslate"><span class="pre">wscript</span></code> file by modifying it with
your text editor.</p>
<p>As an example, after declaring the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> module,
the <code class="docutils literal notranslate"><span class="pre">src/spectrum/wscript</span></code> specifies the source code files
with the following list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">bld</span><span class="p">):</span>

  <span class="n">module</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">create_ns3_module</span><span class="p">(</span><span class="s1">&#39;spectrum&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;internet&#39;</span><span class="p">,</span> <span class="s1">&#39;propagation&#39;</span><span class="p">,</span> <span class="s1">&#39;antenna&#39;</span><span class="p">,</span> <span class="s1">&#39;applications&#39;</span><span class="p">])</span>

  <span class="n">module</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s1">&#39;model/spectrum-model.cc&#39;</span><span class="p">,</span>
      <span class="s1">&#39;model/spectrum-value.cc&#39;</span><span class="p">,</span>
            <span class="o">.</span>
            <span class="o">.</span>
            <span class="o">.</span>
      <span class="s1">&#39;model/microwave-oven-spectrum-value-helper.cc&#39;</span><span class="p">,</span>
      <span class="s1">&#39;helper/spectrum-helper.cc&#39;</span><span class="p">,</span>
      <span class="s1">&#39;helper/adhoc-aloha-noack-ideal-phy-helper.cc&#39;</span><span class="p">,</span>
      <span class="s1">&#39;helper/waveform-generator-helper.cc&#39;</span><span class="p">,</span>
      <span class="s1">&#39;helper/spectrum-analyzer-helper.cc&#39;</span><span class="p">,</span>
      <span class="p">]</span>
</pre></div>
</div>
<p>The objects resulting from compiling these sources will be assembled
into a link library, which will be linked to any programs relying on this
module.</p>
<p>But how do such programs learn the public API of our new module?  Read on!</p>
</div>
<div class="section" id="step-4-declare-public-header-files">
<h4>Step 4 - Declare Public Header Files<a class="headerlink" href="#step-4-declare-public-header-files" title="Permalink to this headline">¶</a></h4>
<p>The header files defining the public API of your model and helpers
also should be specified in the <code class="docutils literal notranslate"><span class="pre">wscript</span></code> file.</p>
<p>Continuing with the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> model illustration,
the public header files are specified with the following stanza.
(Note that the argument to the <code class="docutils literal notranslate"><span class="pre">bld</span></code> function tells
<code class="docutils literal notranslate"><span class="pre">waf</span></code> to install this module’s headers with the other <em>ns-3</em> headers):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">headers</span> <span class="o">=</span> <span class="n">bld</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="s1">&#39;ns3header&#39;</span><span class="p">)</span>

<span class="n">headers</span><span class="o">.</span><span class="n">module</span> <span class="o">=</span> <span class="s1">&#39;spectrum&#39;</span>

<span class="n">headers</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;model/spectrum-model.h&#39;</span><span class="p">,</span>
    <span class="s1">&#39;model/spectrum-value.h&#39;</span><span class="p">,</span>
           <span class="o">.</span>
           <span class="o">.</span>
           <span class="o">.</span>
    <span class="s1">&#39;model/microwave-oven-spectrum-value-helper.h&#39;</span><span class="p">,</span>
    <span class="s1">&#39;helper/spectrum-helper.h&#39;</span><span class="p">,</span>
    <span class="s1">&#39;helper/adhoc-aloha-noack-ideal-phy-helper.h&#39;</span><span class="p">,</span>
    <span class="s1">&#39;helper/waveform-generator-helper.h&#39;</span><span class="p">,</span>
    <span class="s1">&#39;helper/spectrum-analyzer-helper.h&#39;</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Headers made public in this way will be accessible to users of your model
with include statements like</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;ns3/spectrum-model.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>Headers used strictly internally in your implementation should not
be included here.  They are still accessible to your implementation by
include statements like</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;my-module-implementation.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="step-5-declare-tests">
<h4>Step 5 - Declare Tests<a class="headerlink" href="#step-5-declare-tests" title="Permalink to this headline">¶</a></h4>
<p>If your new module has tests, then they must be specified in your
<code class="docutils literal notranslate"><span class="pre">wscript</span></code> file by modifying it with your text editor.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> model tests are specified with the following stanza:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">module_test</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">create_ns3_module_test_library</span><span class="p">(</span><span class="s1">&#39;spectrum&#39;</span><span class="p">)</span>

<span class="n">module_test</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;test/spectrum-interference-test.cc&#39;</span><span class="p">,</span>
    <span class="s1">&#39;test/spectrum-value-test.cc&#39;</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#document-tests"><span class="doc">Tests</span></a> for more information on how to write test cases.</p>
</div>
<div class="section" id="step-6-declare-examples">
<h4>Step 6 - Declare Examples<a class="headerlink" href="#step-6-declare-examples" title="Permalink to this headline">¶</a></h4>
<p>If your new module has examples, then they must be specified in your
<code class="docutils literal notranslate"><span class="pre">examples/wscript</span></code> file.  (The skeleton top-level <code class="docutils literal notranslate"><span class="pre">wscript</span></code> will
recursively include <code class="docutils literal notranslate"><span class="pre">examples/wscript</span></code> only if the examples were
enabled at configure time.)</p>
<p>The <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> model defines it’s first example in
<code class="docutils literal notranslate"><span class="pre">src/spectrum/examples/wscript</span></code> with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">bld</span><span class="p">):</span>
  <span class="n">obj</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">create_ns3_program</span><span class="p">(</span><span class="s1">&#39;adhoc-aloha-ideal-phy&#39;</span><span class="p">,</span>
                               <span class="p">[</span><span class="s1">&#39;spectrum&#39;</span><span class="p">,</span> <span class="s1">&#39;mobility&#39;</span><span class="p">])</span>
  <span class="n">obj</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;adhoc-aloha-ideal-phy.cc&#39;</span>
</pre></div>
</div>
<p>Note that the second argument to the function <code class="docutils literal notranslate"><span class="pre">create_ns3_program()</span></code>
is the list of modules that the program being created depends on; again,
don’t forget to include <code class="docutils literal notranslate"><span class="pre">new-module</span></code> in the list.  It’s best practice
to list only the direct module dependencies, and let <code class="docutils literal notranslate"><span class="pre">waf</span></code> deduce
the full dependency tree.</p>
<p>Occasionally, for clarity, you may want to split the implementation
for your example among several source files.  In this case, just
include those files as additional explicit sources of the example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="n">bld</span><span class="o">.</span><span class="n">create_ns3_program</span><span class="p">(</span><span class="s1">&#39;new-module-example&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">new</span><span class="o">-</span><span class="n">module</span><span class="p">])</span>
<span class="n">obj</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;new-module-example.cc&#39;</span><span class="p">,</span> <span class="s1">&#39;new-module-example-part.cc&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Python examples are specified using the following
function call.  Note that the second argument for the function
<code class="docutils literal notranslate"><span class="pre">register_ns3_script()</span></code> is the list of modules that the Python example
depends on:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bld</span><span class="o">.</span><span class="n">register_ns3_script</span><span class="p">(</span><span class="s1">&#39;new-module-example.py&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;new-module&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="step-7-examples-run-as-tests">
<h4>Step 7 - Examples Run as Tests<a class="headerlink" href="#step-7-examples-run-as-tests" title="Permalink to this headline">¶</a></h4>
<p>In addition to running explicit test code, the test framework
can also be instrumented to run full example programs to
try to catch regressions in the examples.  However, not all examples
are suitable for regression tests.  The file <code class="docutils literal notranslate"><span class="pre">test/examples-to-run.py</span></code>
controls the invocation of the examples when the test framework runs.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> model examples run by <code class="docutils literal notranslate"><span class="pre">test.py</span></code> are specified in
<code class="docutils literal notranslate"><span class="pre">src/spectrum/test/examples-to-run.py</span></code> using the following
two lists of C++ and Python examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># A list of C++ examples to run in order to ensure that they remain</span>
<span class="c1"># buildable and runnable over time.  Each tuple in the list contains</span>
<span class="c1">#</span>
<span class="c1">#     (example_name, do_run, do_valgrind_run).</span>
<span class="c1">#</span>
<span class="c1"># See test.py for more information.</span>
<span class="n">cpp_examples</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;adhoc-aloha-ideal-phy&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;adhoc-aloha-ideal-phy-with-microwave-oven&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;adhoc-aloha-ideal-phy-matrix-propagation-loss-model&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># A list of Python examples to run in order to ensure that they remain</span>
<span class="c1"># runnable over time.  Each tuple in the list contains</span>
<span class="c1">#</span>
<span class="c1">#     (example_name, do_run).</span>
<span class="c1">#</span>
<span class="c1"># See test.py for more information.</span>
<span class="n">python_examples</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;sample-simulator.py&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>As indicated in the comment, each entry in the C++ list of examples to run
contains the tuple <code class="docutils literal notranslate"><span class="pre">(example_name,</span> <span class="pre">do_run,</span> <span class="pre">do_valgrind_run)</span></code>, where</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">example_name</span></code> is the executable to be run,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">do_run</span></code> is a condition under which to run the example, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">do_valgrind_run</span></code> is a condition under which to run the example
under valgrind.  (This is needed because NSC causes illegal instruction
crashes with some tests when they are run under valgrind.)</p></li>
</ul>
</div></blockquote>
<p>Note that the two conditions are Python statements that
can depend on <code class="docutils literal notranslate"><span class="pre">waf</span></code> configuration variables.  For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s2">&quot;tcp-nsc-lfn&quot;</span><span class="p">,</span> <span class="s2">&quot;NSC_ENABLED == True&quot;</span><span class="p">,</span> <span class="s2">&quot;NSC_ENABLED == False&quot;</span><span class="p">),</span>
</pre></div>
</div>
<p>Each entry in the Python list of examples to run contains the tuple
<code class="docutils literal notranslate"><span class="pre">(example_name,</span> <span class="pre">do_run)</span></code>, where, as for the C++ examples,</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">example_name</span></code> is the Python script to be run, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">do_run</span></code> is a condition under which to run the example.</p></li>
</ul>
</div></blockquote>
<p>Again, the condition is a Python statement that can
depend on <code class="docutils literal notranslate"><span class="pre">waf</span></code> configuration variables.  For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s2">&quot;realtime-udp-echo.py&quot;</span><span class="p">,</span> <span class="s2">&quot;ENABLE_REAL_TIME == False&quot;</span><span class="p">),</span>
</pre></div>
</div>
</div>
<div class="section" id="step-8-configure-and-build">
<h4>Step 8 - Configure and Build<a class="headerlink" href="#step-8-configure-and-build" title="Permalink to this headline">¶</a></h4>
<p>You can now configure, build and test your module as normal.
You must reconfigure the project as a first step so that <code class="docutils literal notranslate"><span class="pre">waf</span></code>
caches the new information in your <code class="docutils literal notranslate"><span class="pre">wscript</span></code> files,
or else your new module will not be included in the build.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure --enable-examples --enable-tests
$ ./waf build
$ ./test.py
</pre></div>
</div>
<p>Look for your new module’s test suite (and example programs,
if your module has any enabled) in the test output.</p>
</div>
<div class="section" id="step-9-python-bindings">
<h4>Step 9 - Python Bindings<a class="headerlink" href="#step-9-python-bindings" title="Permalink to this headline">¶</a></h4>
<p>Adding Python bindings to your module is optional, and the step is
commented out by default in the <code class="docutils literal notranslate"><span class="pre">create-module.py</span></code> script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># bld.ns3_python_bindings()</span>
</pre></div>
</div>
<p>If you want to include Python bindings (needed only if you want
to write Python ns-3 programs instead of C++ ns-3 programs), you
should uncomment the above and install the Python API scanning
system (covered elsewhere in this manual) and scan your module to
generate new bindings.</p>
</div>
</div>
<span id="document-documentation"></span><div class="section" id="creating-documentation">
<h3>Creating Documentation<a class="headerlink" href="#creating-documentation" title="Permalink to this headline">¶</a></h3>
<p><em>ns-3</em> supplies two kinds of documentation:  expository “user-guide”-style
chapters, and source code API documentation.</p>
<p>The “user-guide” chapters are written by hand in <a class="reference external" href="http://sphinx-doc.org/rest.html">reStructuredText</a>
format (<code class="docutils literal notranslate"><span class="pre">.rst</span></code>), which is processed by the Python documentation
system <a class="reference external" href="http://sphinx-doc.org/">Sphinx</a> to generate web pages and pdf files.
The API documentation is generated from the source code itself,
using <a class="reference external" href="http://www.doxygen.org/">Doxygen</a>, to generate cross-linked web pages.
Both of these are important:  the Sphinx chapters explain the <em>why</em>
and overview of using a model; the API documentation explains the
<em>how</em> details.</p>
<p>This chapter gives a quick overview of these
tools, emphasizing preferred usage and customizations for <em>ns-3</em>.</p>
<p>To build all the standard documentation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf docs
</pre></div>
</div>
<p>For more specialized options, read on.</p>
<div class="section" id="documenting-with-sphinx">
<h4>Documenting with Sphinx<a class="headerlink" href="#documenting-with-sphinx" title="Permalink to this headline">¶</a></h4>
<p>We use <a class="reference external" href="http://sphinx-doc.org/">Sphinx</a> to generate expository chapters describing
the design and usage of each module.  Right now you are reading the
<a class="reference internal" href="index.html#document-documentation"><span class="doc">Documentation</span></a> Chapter.
If you are reading the html version, the
<a class="reference external" href="_sources/documentation.txt">Show Source</a> link in the sidebar
will show you the reStructuredText source for this chapter.</p>
<div class="section" id="adding-new-chapters">
<h5>Adding New Chapters<a class="headerlink" href="#adding-new-chapters" title="Permalink to this headline">¶</a></h5>
<p>Adding a new chapter takes three steps (described in more detail below):</p>
<ol class="arabic simple">
<li><p>Choose <a class="reference internal" href="#where">Where?</a> the documentation file(s) will live.</p></li>
<li><p><a class="reference internal" href="#link">Link</a> from an existing page to the new documentation.</p></li>
<li><p>Add the new file to the <a class="reference internal" href="#makefile">Makefile</a>.</p></li>
</ol>
<div class="section" id="where">
<h6>Where?<a class="headerlink" href="#where" title="Permalink to this headline">¶</a></h6>
<p>Documentation for a specific module, <code class="docutils literal notranslate"><span class="pre">foo</span></code>, should normally go in
<code class="docutils literal notranslate"><span class="pre">src/foo/doc/</span></code>.  For example <code class="docutils literal notranslate"><span class="pre">src/foo/doc/foo.rst</span></code> would be the
top-level document for the module.  The <code class="docutils literal notranslate"><span class="pre">src/create-module.py</span></code> script
will create this file for you.</p>
<p>Some models require several <code class="docutils literal notranslate"><span class="pre">.rst</span></code> files, and figures; these should
all go in the <code class="docutils literal notranslate"><span class="pre">src/foo/doc/</span></code> directory.  The docs are actually built
by a Sphinx Makefile.  For especially involved
documentation, it may be helpful to have a local <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>
in the <code class="docutils literal notranslate"><span class="pre">src/foo/doc/</span></code> directory to
simplify building the documentation for this module
(<a class="reference external" href="http://www.nsnam.org/docs/models/html/antenna.html">Antenna</a> is an example).  Setting this up
is not particularly hard, but is beyond the scope of this chapter.</p>
<p>In some cases, documentation spans multiple models; the
<a class="reference external" href="http://www.nsnam.org/docs/models/html/network.html">Network</a> chapter is an example.  In these cases
adding the <code class="docutils literal notranslate"><span class="pre">.rst</span></code> files directly to <code class="docutils literal notranslate"><span class="pre">doc/models/source/</span></code> might
be appropriate.</p>
</div>
<div class="section" id="link">
<h6>Link<a class="headerlink" href="#link" title="Permalink to this headline">¶</a></h6>
<p>Sphinx has to know <em>where</em> your new chapter should appear.  In most
cases, a new model chapter should appear the in <cite>Models</cite> book.
To add your chapter there, edit <code class="docutils literal notranslate"><span class="pre">doc/models/source/index.rst</span></code></p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">toctree</span><span class="p">::</span>
   <span class="nc">:maxdepth:</span> 1

  organization
  animation
  antenna
  aodv
  applications
<span class="cp">  ...</span>
</pre></div>
</div>
<p>Add the name of your document (without the <code class="docutils literal notranslate"><span class="pre">.rst</span></code> extension) to
this list.  Please keep the Model chapters in alphabetical order,
to ease visual scanning for specific chapters.</p>
</div>
<div class="section" id="makefile">
<h6>Makefile<a class="headerlink" href="#makefile" title="Permalink to this headline">¶</a></h6>
<p>You also have to add your document to the appropriate <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>,
so <code class="docutils literal notranslate"><span class="pre">make</span></code> knows to check it for updates.  The Models book Makefile
is <code class="docutils literal notranslate"><span class="pre">doc/models/Makefile</span></code>, the Manual book Makefile is
<code class="docutils literal notranslate"><span class="pre">doc/manual/Makefile</span></code>.</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="c"># list all model library .rst files that need to be copied to $SOURCETEMP</span>
<span class="nv">SOURCES</span> <span class="o">=</span> <span class="se">\</span>
        source/conf.py <span class="se">\</span>
        source/_static <span class="se">\</span>
        source/index.rst <span class="se">\</span>
        source/replace.txt <span class="se">\</span>
        source/organization.rst <span class="se">\</span>
        ...
        <span class="k">$(</span>SRC<span class="k">)</span>/antenna/doc/source/antenna.rst <span class="se">\</span>
        ...
</pre></div>
</div>
<p>You add your <code class="docutils literal notranslate"><span class="pre">.rst</span></code> files to the <code class="docutils literal notranslate"><span class="pre">SOURCES</span></code> variable.  To add figures,
read the comments in the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> to see which variable should contain
your image files.  Again, please keep these in alphabetical order.</p>
</div>
</div>
<div class="section" id="building-sphinx-docs">
<h5>Building Sphinx Docs<a class="headerlink" href="#building-sphinx-docs" title="Permalink to this headline">¶</a></h5>
<p>Building the Sphinx documentation is pretty simple.
To build all the Sphinx documentation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf sphinx
</pre></div>
</div>
<p>To build just the Models documentation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ make -C doc/models html
</pre></div>
</div>
<p>To see the generated documentation point your browser at
<code class="docutils literal notranslate"><span class="pre">doc/models/build/html</span></code>.</p>
<p>As you can see, Sphinx uses Make to guide the process.
The default target builds all enabled output forms, which in
<em>ns-3</em> are the multi-page <code class="docutils literal notranslate"><span class="pre">html</span></code>, single-page <code class="docutils literal notranslate"><span class="pre">singlehtml</span></code>, and pdf
(<code class="docutils literal notranslate"><span class="pre">latex</span></code>).  To build just the multi-page html, you add the <code class="docutils literal notranslate"><span class="pre">html</span></code> target:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ make -C doc/models html
</pre></div>
</div>
<p>This can be helpful to reduce the build time (and the size of the
build chatter) as you are writing your chapter.</p>
<p>Before committing your documentation to the repo, please check
that it builds without errors or warnings.  The build process
generates lots of output (mostly normal chatter from LaTeX),
which can make it difficult to see if there are any Sphinx
warnings or errors.  To find important warnings and errors
build just the <code class="docutils literal notranslate"><span class="pre">html</span></code> version, then search the build log
for <code class="docutils literal notranslate"><span class="pre">warning</span></code> or <code class="docutils literal notranslate"><span class="pre">error</span></code>.</p>
</div>
<div class="section" id="ns3-specifics">
<h5><em>ns-3</em> Specifics<a class="headerlink" href="#ns3-specifics" title="Permalink to this headline">¶</a></h5>
<p>The Sphinx <a class="reference external" href="http://sphinx-doc.org/contents.html">documentation</a> and <a class="reference external" href="http://sphinx-doc.org/tutorial.html">tutorial</a> are pretty good.  We won’t duplicate
the basics here, instead focusing on preferred usage for <em>ns-3</em>.</p>
<ul>
<li><p>Start documents with these two lines:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">include</span><span class="p">::</span> replace.txt
<span class="p">..</span> <span class="ow">highlight</span><span class="p">::</span> cpp
</pre></div>
</div>
<p>The first line enables some simple replacements.  For example,
typing <code class="docutils literal notranslate"><span class="pre">|ns3|</span></code> renders as <em>ns-3</em>.
The second sets the default source code highlighting language explicitly
for the file, since the parser guess isn’t always accurate.
(It’s also possible to set the language explicitly for a single code block,
see below.)</p>
</li>
<li><p>Sections:</p>
<p>Sphinx is pretty liberal about marking section headings.  By convention,
we prefer this hierarchy:</p>
<div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="cp">.. heading hierarchy:</span>
<span class="cp">   ------------- Chapter</span>
<span class="cp">   ************* Section (#.#)</span>
<span class="cp">   ============= Subsection (#.#.#)</span>
<span class="cp">   ############# Sub-subsection</span>
</pre></div>
</div>
</li>
<li><p>Syntax Highlighting:</p>
<p>To use the default syntax highlighter, simply start a sourcecode block:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Sphinx Source</p></th>
<th class="head"><p>Rendered Output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>The <span class="s">``Frobnitz``</span> is accessed by<span class="se">::</span>

<span class="s">  Foo::Frobnitz frob;</span>
<span class="s">  frob.Set (...);</span>
</pre></div>
</div>
</td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">Frobnitz</span></code> is accessed by:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Foo</span><span class="o">::</span><span class="n">Frobnitz</span> <span class="n">frob</span><span class="p">;</span>
<span class="n">frob</span><span class="p">.</span><span class="n">Set</span> <span class="p">(...);</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>To use a specific syntax highlighter, for example, <code class="docutils literal notranslate"><span class="pre">bash</span></code> shell commands:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Sphinx Source</p></th>
<th class="head"><p>Rendered Output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">sourcecode</span><span class="p">::</span> bash

   $ ls
</pre></div>
</div>
</td>
<td><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ls
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</li>
<li><p>Shorthand Notations:</p>
<p>These shorthands are defined:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Sphinx Source</p></th>
<th class="head"><p>Rendered Output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>|ns3|
</pre></div>
</div>
</td>
<td><p><em>ns-3</em></p></td>
</tr>
<tr class="row-odd"><td><div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>|ns2|
</pre></div>
</div>
</td>
<td><p><em>ns-2</em></p></td>
</tr>
<tr class="row-even"><td><div class="highlight-rest notranslate"><div class="highlight"><pre><span></span>|check|
</pre></div>
</div>
</td>
<td><p><img class="math" src="_images/math/eb43d5592546eaaff233c50b390d221dc5c75cd9.png" alt="\checkmark"/></p></td>
</tr>
<tr class="row-odd"><td><div class="highlight-rest notranslate"><div class="highlight"><pre><span></span><span class="na">:rfc:</span><span class="nv">`6282`</span>
</pre></div>
</div>
</td>
<td><p><span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc6282.html"><strong>RFC 6282</strong></a></p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
<div class="section" id="documenting-with-doxygen">
<h4>Documenting with Doxygen<a class="headerlink" href="#documenting-with-doxygen" title="Permalink to this headline">¶</a></h4>
<p>We use <a class="reference external" href="http://www.doxygen.org/">Doxygen</a> to generate <a class="reference external" href="https://www.nsnam.org/docs/doxygen">browsable</a> API documentation.  Doxygen
provides a number of useful features:</p>
<ul class="simple">
<li><p>Summary table of all class members.</p></li>
<li><p>Graphs of inheritance and collaboration for all classes.</p></li>
<li><p>Links to the source code implementing each function.</p></li>
<li><p>Links to every place a member is used.</p></li>
<li><p>Links to every object used in implementing a function.</p></li>
<li><p>Grouping of related classes, such as all the classes related to
a specific protocol.</p></li>
</ul>
<p>In addition, we use the <code class="docutils literal notranslate"><span class="pre">TypeId</span></code> system to add to the documentation
for every class</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">Config</span></code> paths by which such objects can be reached.</p></li>
<li><p>Documentation for any <code class="docutils literal notranslate"><span class="pre">Attributes</span></code>, including <code class="docutils literal notranslate"><span class="pre">Attributes</span></code>
defined in parent classes.</p></li>
<li><p>Documentation for any <code class="docutils literal notranslate"><span class="pre">Trace</span></code> sources defined by the class.</p></li>
<li><p>The memory footprint for each class.</p></li>
</ul>
<p>Doxygen operates by scanning the source code, looking for
specially marked comments.  It also creates a cross reference,
indicating <em>where</em> each file, class, method, and variable is used.</p>
<div class="section" id="preferred-style">
<h5>Preferred Style<a class="headerlink" href="#preferred-style" title="Permalink to this headline">¶</a></h5>
<p>The preferred style for Doxygen comments is the JavaDoc style:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> *  Brief description of this class or method.</span>
<span class="cm"> *  Adjacent lines become a single paragraph.</span>
<span class="cm"> *</span>
<span class="cm"> *  Longer description, with lots of details.</span>
<span class="cm"> *</span>
<span class="cm"> *  Blank lines separate paragraphs.</span>
<span class="cm"> *</span>
<span class="cm"> *  Explain what the class or method does, using what algorithm.</span>
<span class="cm"> *  Explain the units of arguments and return values.</span>
<span class="cm"> *</span>
<span class="cm"> *  \note Note any limitations or gotchas.</span>
<span class="cm"> *</span>
<span class="cm"> *  (For functions with arguments or return valued:)</span>
<span class="cm"> *  \param [in] foo Brief noun phrase describing this argument. Note</span>
<span class="cm"> *                  that we indicate if the argument is input,</span>
<span class="cm"> *                  output, or both.</span>
<span class="cm"> *  \param [in,out] bar Note Sentence case, and terminating period.</span>
<span class="cm"> *  \param [in] baz Indicate boolean values with \c true or \c false.</span>
<span class="cm"> *  \return Brief noun phrase describing the value.</span>
<span class="cm"> *</span>
<span class="cm"> *  \internal</span>
<span class="cm"> *</span>
<span class="cm"> *  You can also discuss internal implementation details.</span>
<span class="cm"> *  Understanding this material shouldn&#39;t be necessary to using</span>
<span class="cm"> *  the class or method.</span>
<span class="cm"> */</span>
 <span class="kt">void</span> <span class="nf">ExampleFunction</span> <span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">foo</span><span class="p">,</span> <span class="kt">double</span> <span class="o">&amp;</span> <span class="n">bar</span><span class="p">,</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">baz</span><span class="p">);</span>
</pre></div>
</div>
<p>In this style the Doxygen comment block begins with two `*’ characters:
<code class="docutils literal notranslate"><span class="pre">/**</span></code>, and precedes the item being documented.</p>
<p>For items needing only a brief description, either of these short forms
is appropriate:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Destructor implementation. */</span>
<span class="kt">void</span> <span class="nf">DoDispose</span> <span class="p">();</span>

<span class="kt">int</span> <span class="n">m_count</span><span class="p">;</span>  <span class="c1">//!&lt; Count of ...</span>
</pre></div>
</div>
<p>Note the special form of the end of line comment, <code class="docutils literal notranslate"><span class="pre">//!&lt;</span></code>, indicating
that it refers to the <em>preceding</em> item.</p>
<p>Some items to note:</p>
<ul class="simple">
<li><p>Use sentence case, including the initial capital.</p></li>
<li><p>Use punctuation, especially `.’s at the end of sentences or phrases.</p></li>
<li><dl class="simple">
<dt>The <code class="docutils literal notranslate"><span class="pre">\brief</span></code> tag is not needed; the first sentence will be</dt><dd><p>used as the brief description.</p>
</dd>
</dl>
</li>
</ul>
<p>Every class, method, typedef, member variable, function argument
and return value should be documented in all source code files
which form the formal API and implementation for <em>ns-3</em>, such as
<code class="docutils literal notranslate"><span class="pre">src/&lt;module&gt;/model/*</span></code>, <code class="docutils literal notranslate"><span class="pre">src/&lt;module&gt;/helper/*</span></code> and
<code class="docutils literal notranslate"><span class="pre">src/&lt;module&gt;/utils/*</span></code>.  Documentation for items in <code class="docutils literal notranslate"><span class="pre">src/&lt;module&gt;/test/*</span></code>
and <code class="docutils literal notranslate"><span class="pre">src/&lt;module&gt;/examples/*</span></code> is preferred, but not required.</p>
</div>
<div class="section" id="useful-features">
<h5>Useful Features<a class="headerlink" href="#useful-features" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p>Inherited members will automatically inherit docs from the parent,
(but can be replaced by local documentation).</p>
<ol class="arabic">
<li><p>Document the base class.</p></li>
<li><p>In the sub class mark inherited functions with an ordinary comment:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Inherited methods</span>
<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">FooBar</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">virtual</span> <span class="kt">int</span> <span class="nf">BarFoo</span> <span class="p">(</span><span class="kt">double</span> <span class="n">baz</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that the signatures have to match exactly, so include the formal
argument <code class="docutils literal notranslate"><span class="pre">(void)</span></code></p>
<p>This doesn’t work for static functions; see <code class="docutils literal notranslate"><span class="pre">GetTypeId</span></code>, below, for an
example.</p>
</li>
</ol>
</li>
</ul>
</div>
<div class="section" id="building-doxygen-docs">
<h5>Building Doxygen Docs<a class="headerlink" href="#building-doxygen-docs" title="Permalink to this headline">¶</a></h5>
<p>Building the Doxygen documentation is pretty simple:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf doxygen
</pre></div>
</div>
<p>This builds using the default configuration, which generates
documentation sections for <em>all</em> items, even if they do not have
explicit comment documentation blocks.  This has the effect of
suppressing warnings for undocumented items, but makes sure everything
appears in the generated output, which is usually what you want for
general use.  Note that we generate documentation even for modules
which are disabled, to make it easier to see all the features
available in <em>ns-3</em>.</p>
<p>When writing documentation, it’s often more useful to see which items
are generating warnings, typically about missing documentation.  To
see the full warnings list, use the <code class="docutils literal notranslate"><span class="pre">doc/doxygen.warnings.report.sh</span></code>
script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ doc/doxygen.warnings.report.sh

doxygen.warnings.report.sh:
Building and running print-introspected-doxygen...done.
Rebuilding doxygen <span class="o">(</span>v1.8.10<span class="o">)</span> docs with full errors...done.


Report of Doxygen warnings
----------------------------------------

<span class="o">(</span>All counts are lower bounds.<span class="o">)</span>

Warnings by module/directory:

Count Directory
----- ----------------------------------
<span class="m">3414</span> src/lte/model
<span class="m">1532</span> src/wimax/model
 <span class="m">825</span> src/lte/test
....
   <span class="m">1</span> src/applications/test
 <span class="m">97</span> additional undocumented parameters.
----------------------------------------
 <span class="m">12460</span> total warnings
   <span class="m">100</span> directories with warnings


Warnings by file <span class="o">(</span>alphabetical<span class="o">)</span>

Count File
----- ----------------------------------
  <span class="m">15</span> examples/routing/manet-routing-compare.cc
  <span class="m">26</span> examples/stats/wifi-example-apps.h
  <span class="m">12</span> examples/tutorial/fifth.cc
....
  <span class="m">17</span> utils/python-unit-tests.py
----------------------------------------
   <span class="m">771</span> files with warnings


Warnings by file <span class="o">(</span>numerical<span class="o">)</span>

Count File
----- ----------------------------------
 <span class="m">273</span> src/lte/model/lte-rrc-sap.h
 <span class="m">272</span> src/core/model/simulator.h
 <span class="m">221</span> src/netanim/model/animation-interface.h
....
   <span class="m">1</span> src/wimax/model/ul-job.cc
----------------------------------------
   <span class="m">771</span> files with warnings


Doxygen Warnings Summary
----------------------------------------
   <span class="m">100</span> directories
   <span class="m">771</span> files
 <span class="m">12460</span> warnings
</pre></div>
</div>
<p>(This snippet has <em>a lot</em> of lines suppressed!)</p>
<p>The script modifies the configuration to show all warnings, and to
shorten the run time.  (It shortens the run time primarily by
disabling creation of diagrams, such as call trees, and doesn’t
generate documentation for undocumented items, in order to trigger the
warnings.)  As you can see, at this writing we have <em>a lot</em> of
undocumented items.  The report summarizes warnings by module
<code class="docutils literal notranslate"><span class="pre">src/*/*</span></code>, and by file, in alphabetically and numerical order.</p>
<p>The script has a few options to pare things down and make the output more
manageable.  For help, use the <code class="docutils literal notranslate"><span class="pre">-h</span></code> option.  Having run it once
to do the Doxygen build and generate the full warnings log,
you can reprocess the log file with various “filters,”
without having to do the full Doxygen build again by
using the <code class="docutils literal notranslate"><span class="pre">-s</span></code> option.  You can exclude warnings
from <code class="docutils literal notranslate"><span class="pre">*/examples/*</span></code> files (<code class="docutils literal notranslate"><span class="pre">-e</span></code> option), and/or <code class="docutils literal notranslate"><span class="pre">*/test/*</span></code> files
(<code class="docutils literal notranslate"><span class="pre">-t</span></code>).  Just to be clear, all of the filter options do the complete
fast doxygen build; they just filter doxygen log and warnings output.</p>
<p>Perhaps the most useful option when writing documentation comments
is <code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">&lt;module&gt;</span></code>, which will limit the report to just files matching
<code class="docutils literal notranslate"><span class="pre">src/&lt;module&gt;/*</span></code>, and follow the report with the actual warning lines.
Combine with <code class="docutils literal notranslate"><span class="pre">-et</span></code> and you can focus on the warnings that are most
urgent in a single module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ doc/doxygen.warnings.report.sh -m mesh/helper
...
Doxygen Warnings Summary
----------------------------------------
  <span class="m">1</span> directories
  <span class="m">3</span> files
<span class="m">149</span> warnings


Filtered <span class="nv">Warnings</span>
<span class="o">========================================</span>
src/mesh/helper/dot11s/dot11s-installer.h:72: warning: Member m_root <span class="o">(</span>variable<span class="o">)</span> of class ns3::Dot11sStack is not documented.
src/mesh/helper/dot11s/dot11s-installer.h:35: warning: <span class="k">return</span> <span class="nb">type</span> of member ns3::Dot11sStack::GetTypeId is not documented
src/mesh/helper/dot11s/dot11s-installer.h:56: warning: <span class="k">return</span> <span class="nb">type</span> of member ns3::Dot11sStack::InstallStack is not documented
src/mesh/helper/flame/lfame-installer.h:40: warning: Member GetTypeId<span class="o">()</span> <span class="o">(</span><span class="k">function</span><span class="o">)</span> of class ns3::FlameStack is not documented.
src/mesh/helper/flame/flame-installer.h:60: warning: <span class="k">return</span> <span class="nb">type</span> of member ns3::FlameStack::InstallStack is not documented
src/mesh/helper/mesh-helper.h:213: warning: Member m_nInterfaces <span class="o">(</span>variable<span class="o">)</span> of class ns3::MeshHelper is not documented.
src/mesh/helper/mesh-helper.h:214: warning: Member m_spreadChannelPolicy <span class="o">(</span>variable<span class="o">)</span> of class ns3::MeshHelper is not documented.
src/mesh/helper/mesh-helper.h:215: warning: Member m_stack <span class="o">(</span>variable<span class="o">)</span> of class ns3::MeshHelper is not documented.
src/mesh/helper/mesh-helper.h:216: warning: Member m_stackFactory <span class="o">(</span>variable<span class="o">)</span> of class ns3::MeshHelper is not documented.
src/mesh/helper/mesh-helper.h:209: warning: parameters of member ns3::MeshHelper::CreateInterface are not <span class="o">(</span>all<span class="o">)</span> documented
src/mesh/helper/mesh-helper.h:119: warning: parameters of member ns3::MeshHelper::SetStandard are not <span class="o">(</span>all<span class="o">)</span> documented
</pre></div>
</div>
<p>Finally, note that undocumented items (classes, methods, functions,
typedefs, <em>etc.</em> won’t produce documentation when you build with
<code class="docutils literal notranslate"><span class="pre">doxygen.warnings.report.sh</span></code>, and only the outermost item
will produce a warning.  As a result, if you don’t see documentation
for a class method in the generated documentation, the class itself
probably needs documentation.</p>
<p>Now it’s just a matter of understanding the code, and writing some
docs!</p>
</div>
<div class="section" id="id1">
<h5><em>ns-3</em> Specifics<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<p>As for Sphinx, the Doxygen <a class="reference external" href="http://www.stack.nl/~dimitri/doxygen/index.html">docs</a> and <a class="reference external" href="http://www.stack.nl/~dimitri/doxygen/manual/commands.html">reference</a> are pretty good.
We won’t duplicate the basics here, instead focusing on preferred
usage for <em>ns-3</em>.</p>
<ul>
<li><p>Use Doxygen <code class="docutils literal notranslate"><span class="pre">Modules</span></code> to group related items.</p>
<p>In the main header for a module, create a Doxgyen group:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> *  \defgroup foo Foo protocol.</span>
<span class="cm"> *  Implementation of the Foo protocol.</span>
<span class="cm"> */</span>
</pre></div>
</div>
<p>The symbol <code class="docutils literal notranslate"><span class="pre">foo</span></code> is how other items can add themselves to this group.
The string following that will be the title for the group.  Any further
text will be the detailed description for the group page.</p>
</li>
<li><p>Document each file, assigning it to the relevant group.  In a header file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> *  \file</span>
<span class="cm"> *  \ingroup foo</span>
<span class="cm"> *  Class Foo declaration.</span>
<span class="cm"> */</span>
</pre></div>
</div>
<p>or in the corresponding <code class="docutils literal notranslate"><span class="pre">.cc</span></code> file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> *  \file</span>
<span class="cm"> *  \ingroup foo</span>
<span class="cm"> *  Class FooBar implementation.</span>
<span class="cm"> */</span>
</pre></div>
</div>
</li>
<li><p>Mark each associated class as belonging to the group:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> *  \ingroup foo</span>
<span class="cm"> *</span>
<span class="cm"> *  FooBar packet type.</span>
<span class="cm">*/</span>
<span class="k">class</span> <span class="nc">FooBar</span>
</pre></div>
</div>
</li>
<li><p>Did you know <code class="docutils literal notranslate"><span class="pre">typedefs</span></code> can have formal arguments?  This enables
documentation of function pointer signatures:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> *  Bar callback function signature.</span>
<span class="cm"> *</span>
<span class="cm"> *  \param ale The size of a pint of ale, in Imperial ounces.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">*</span> <span class="n">BarCallback</span><span class="p">)(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">ale</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Copy the <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> help strings from the <code class="docutils literal notranslate"><span class="pre">GetTypeId</span></code> method to use
as the brief descriptions of associated members.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\bugid{298}</span></code> will create a link to bug 298 in our Bugzilla.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\p</span> <span class="pre">foo</span></code> in a description will format <code class="docutils literal notranslate"><span class="pre">foo</span></code>
the same as the <code class="docutils literal notranslate"><span class="pre">\param</span> <span class="pre">foo</span></code> parameter, making it clear that you
are referring to an actual argument.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">\RFC{301}</span></code> will create a link to RFC 301.</p></li>
<li><p>Document the direction of function arguments with <code class="docutils literal notranslate"><span class="pre">\param</span> <span class="pre">[in]</span></code>, <em>etc</em>.
The allowed values of the direction token are <code class="docutils literal notranslate"><span class="pre">[in]</span></code>, <code class="docutils literal notranslate"><span class="pre">[out]</span></code>, and
<code class="docutils literal notranslate"><span class="pre">[in,out]</span></code> (note the explicit square brackets), as discussed in the
Doxygen docs for <code class="docutils literal notranslate"><span class="pre">\param</span></code>.</p></li>
<li><p>Document template arguments with <code class="docutils literal notranslate"><span class="pre">\tparam</span></code>, just as you use <code class="docutils literal notranslate"><span class="pre">\param</span></code>
for function arguments.</p></li>
<li><p>For template arguments, indicate if they will be deduced or must be given
explicitly:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * A templated function.</span>
<span class="cm"> * \tparam T \explicit The return type.</span>
<span class="cm"> * \tparam U \deduced The argument type.</span>
<span class="cm"> * \param [in] a The argument.</span>
<span class="cm"> */</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">U</span><span class="o">&gt;</span> <span class="n">T</span> <span class="n">Function</span> <span class="p">(</span><span class="n">U</span> <span class="n">a</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">\tparam</span> <span class="pre">U</span> <span class="pre">\deduced</span></code> because the type <code class="docutils literal notranslate"><span class="pre">U</span></code> can be deduced at
the site where the template is invoked.  Basically deduction can only
be done for function arguments.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">\tparam</span> <span class="pre">T</span> <span class="pre">\explicit</span></code> because the type <code class="docutils literal notranslate"><span class="pre">T</span></code> can’t be deduced;
it must be given explicitly at the invocation site, as in
<code class="docutils literal notranslate"><span class="pre">Create&lt;MyObject&gt;</span> <span class="pre">(...)</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">\internal</span></code> should be used only to set off a discussion of implementation
details, not to mark <code class="docutils literal notranslate"><span class="pre">private</span></code> functions (they are already marked,
as <code class="docutils literal notranslate"><span class="pre">private</span></code>!)</p></li>
<li><p>Don’t create classes with trivial names, such as <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">A</span></code>,
even in test suites.  These cause all instances of the class name
literal `A’ to be rendered as links.</p></li>
</ul>
<p>As noted above, static functions don’t inherit the documentation
of the same functions in the parent class.  <em>ns-3</em> uses a few static
functions ubiquitously; the suggested documentation block for these
cases is:</p>
<ul>
<li><p>Default constructor/destructor:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MyClass</span> <span class="p">();</span>   <span class="c1">//!&lt; Default constructor</span>
<span class="o">~</span><span class="n">MyClass</span> <span class="p">();</span>  <span class="c1">//!&lt; Destructor</span>
</pre></div>
</div>
</li>
<li><p>Dummy destructor and DoDispose:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/** Dummy destructor, see DoDispose. */</span>
<span class="o">~</span><span class="n">MyClass</span> <span class="p">();</span>

<span class="cm">/** Destructor implementation */</span>
<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">DoDispose</span> <span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>GetTypeId:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> *  Register this type.</span>
<span class="cm"> *  \return The object TypeId.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">TypeId</span> <span class="nf">GetTypeId</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>
<span id="document-enable-modules"></span><div class="section" id="enabling-subsets-of-ns3-modules">
<h3>Enabling Subsets of <em>ns-3</em> Modules<a class="headerlink" href="#enabling-subsets-of-ns3-modules" title="Permalink to this headline">¶</a></h3>
<p>As with most software projects, <em>ns-3</em> is ever growing larger in terms of number of modules, lines of code, and memory footprint.  Users, however, may only use a few of those modules at a time.  For this reason, users may want to explicitly enable only the subset of the possible <em>ns-3</em> modules that they actually need for their research.</p>
<p>This chapter discusses how to enable only the <em>ns-3</em> modules that you are interested in using.</p>
<div class="section" id="how-to-enable-a-subset-of-ns3-s-modules">
<h4>How to enable a subset of <em>ns-3</em>’s modules<a class="headerlink" href="#how-to-enable-a-subset-of-ns3-s-modules" title="Permalink to this headline">¶</a></h4>
<p>If shared libraries are being built, then enabling a module will cause at least one library to be built:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>libns3-modulename.so
</pre></div>
</div>
<p>If the module has a test library and test libraries are being built, then</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>libns3-modulename-test.so
</pre></div>
</div>
<p>will be built, too.  Other modules that the module depends on and their test libraries will also be built.</p>
<p>By default, all modules are built in <em>ns-3</em>.  There are two ways to enable a subset of these modules:</p>
<ol class="arabic simple">
<li><p>Using waf’s –enable-modules option</p></li>
<li><p>Using the <em>ns-3</em> configuration file</p></li>
</ol>
<div class="section" id="enable-modules-using-waf-s-enable-modules-option">
<h5>Enable modules using waf’s –enable-modules option<a class="headerlink" href="#enable-modules-using-waf-s-enable-modules-option" title="Permalink to this headline">¶</a></h5>
<p>To enable only the core module with example and tests, for example,
try these commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf clean
$ ./waf configure --enable-examples --enable-tests --enable-modules<span class="o">=</span>core
$ ./waf build
$ <span class="nb">cd</span> build/debug/
$ ls
</pre></div>
</div>
<p>and the following libraries should be present:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bindings  libns3-core.so       ns3      scratch  utils
examples  libns3-core-test.so  samples  src
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">./waf</span> <span class="pre">clean</span></code> step is done here only to make it more obvious which module libraries were built.  You don’t have to do <code class="docutils literal notranslate"><span class="pre">./waf</span> <span class="pre">clean</span></code> in order to enable subsets of modules.</p>
<p>Running test.py will cause only those tests that depend on module core to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>24 of 24 tests passed (24 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
<p>Repeat the above steps for the “network” module instead of the “core” module, and the following will be built, since network depends on core:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bindings  libns3-core.so       libns3-network.so       ns3      scratch  utils
examples  libns3-core-test.so  libns3-network-test.so  samples  src
</pre></div>
</div>
<p>Running test.py will cause those tests that depend on only the core and network modules to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>31 of 31 tests passed (31 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
</div>
<div class="section" id="enable-modules-using-the-ns3-configuration-file">
<h5>Enable modules using the <em>ns-3</em> configuration file<a class="headerlink" href="#enable-modules-using-the-ns3-configuration-file" title="Permalink to this headline">¶</a></h5>
<p>A configuration file, .ns3rc, has been added to <em>ns-3</em> that allows users to specify which modules are to be included in the build.</p>
<p>When enabling a subset of <em>ns-3</em> modules, the precedence rules are as follows:</p>
<ol class="arabic simple">
<li><p>the –enable-modules configure string overrides any .ns3rc file</p></li>
<li><p>the .ns3rc file in the top level <em>ns-3</em> directory is next consulted, if present</p></li>
<li><p>the system searches for ~/.ns3rc if the above two are unspecified</p></li>
</ol>
<p>If none of the above limits the modules to be built, all modules that waf knows about will be built.</p>
<p>The maintained version of the .ns3rc file in the <em>ns-3</em> source code repository resides in the <code class="docutils literal notranslate"><span class="pre">utils</span></code> directory.  The reason for this is if it were in the top-level directory of the repository, it would be prone to accidental checkins from maintainers that enable the modules they want to use.  Therefore, users need to manually copy the .ns3rc from the <code class="docutils literal notranslate"><span class="pre">utils</span></code> directory to their preferred place (top level directory or their home directory) to enable persistent modular build configuration.</p>
<p>Assuming that you are in the top level <em>ns-3</em> directory, you can get a copy of the .ns3rc file that is in the <code class="docutils literal notranslate"><span class="pre">utils</span></code> directory as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cp utils/.ns3rc .
</pre></div>
</div>
<p>The .ns3rc file should now be in your top level <em>ns-3</em> directory, and it contains the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/env python</span>

<span class="c1"># A list of the modules that will be enabled when ns-3 is run.</span>
<span class="c1"># Modules that depend on the listed modules will be enabled also.</span>
<span class="c1">#</span>
<span class="c1"># All modules can be enabled by choosing &#39;all_modules&#39;.</span>
<span class="n">modules_enabled</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;all_modules&#39;</span><span class="p">]</span>

<span class="c1"># Set this equal to true if you want examples to be run.</span>
<span class="n">examples_enabled</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Set this equal to true if you want tests to be run.</span>
<span class="n">tests_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Use your favorite editor to modify the .ns3rc file to only enable the core module with examples and tests like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/env python</span>

<span class="c1"># A list of the modules that will be enabled when ns-3 is run.</span>
<span class="c1"># Modules that depend on the listed modules will be enabled also.</span>
<span class="c1">#</span>
<span class="c1"># All modules can be enabled by choosing &#39;all_modules&#39;.</span>
<span class="n">modules_enabled</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;core&#39;</span><span class="p">]</span>

<span class="c1"># Set this equal to true if you want examples to be run.</span>
<span class="n">examples_enabled</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Set this equal to true if you want tests to be run.</span>
<span class="n">tests_enabled</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Only the core module will be enabled now if you try these commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf clean
$ ./waf configure
$ ./waf build
$ <span class="nb">cd</span> build/debug/
$ ls
</pre></div>
</div>
<p>and the following libraries should be present:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bindings  libns3-core.so       ns3      scratch  utils
examples  libns3-core-test.so  samples  src
</pre></div>
</div>
<p>Note the <code class="docutils literal notranslate"><span class="pre">./waf</span> <span class="pre">clean</span></code> step is done here only to make it more obvious which module libraries were built.  You don’t have to do <code class="docutils literal notranslate"><span class="pre">./waf</span> <span class="pre">clean</span></code> in order to enable subsets of modules.</p>
<p>Running test.py will cause only those tests that depend on module core to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>24 of 24 tests passed (24 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
<p>Repeat the above steps for the “network” module instead of the “core” module, and the following will be built, since network depends on core:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>bindings  libns3-core.so       libns3-network.so       ns3      scratch  utils
examples  libns3-core-test.so  libns3-network-test.so  samples  src
</pre></div>
</div>
<p>Running test.py will cause those tests that depend on only the core and network modules to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>31 of 31 tests passed (31 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-enable-tests"></span><div class="section" id="enabling-disabling-ns3-tests-and-examples">
<h3>Enabling/disabling <em>ns-3</em> Tests and Examples<a class="headerlink" href="#enabling-disabling-ns3-tests-and-examples" title="Permalink to this headline">¶</a></h3>
<p>The <em>ns-3</em> distribution includes many examples and tests that are used to validate the <em>ns-3</em> system.  Users, however, may not always want these examples and tests to be run for their installation of <em>ns-3</em>.</p>
<p>This chapter discusses how to build <em>ns-3</em> with or without its examples and tests.</p>
<div class="section" id="how-to-enable-disable-examples-and-tests-in-ns3">
<h4>How to enable/disable examples and tests in <em>ns-3</em><a class="headerlink" href="#how-to-enable-disable-examples-and-tests-in-ns3" title="Permalink to this headline">¶</a></h4>
<p>There are 3 ways to enable/disable examples and tests in <em>ns-3</em>:</p>
<ol class="arabic simple">
<li><p>Using build.py when <em>ns-3</em> is built for the first time</p></li>
<li><p>Using waf once <em>ns-3</em> has been built</p></li>
<li><p>Using the <em>ns-3</em> configuration file once <em>ns-3</em> has been built</p></li>
</ol>
<div class="section" id="enable-disable-examples-and-tests-using-build-py">
<h5>Enable/disable examples and tests using build.py<a class="headerlink" href="#enable-disable-examples-and-tests-using-build-py" title="Permalink to this headline">¶</a></h5>
<p>You can use build.py to enable/disable examples and tests when <em>ns-3</em> is built for the first time.</p>
<p>By default, examples and tests are not built in <em>ns-3</em>.</p>
<p>From the ns-3-allinone directory, you can build <em>ns-3</em> without any
examples or tests simply by doing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./build.py
</pre></div>
</div>
<p>Running test.py in the top level <em>ns-3</em> directory now will cause no examples or tests to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0 of 0 tests passed (0 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
<p>If you would like build <em>ns-3</em> with examples and tests, then do the following from the ns-3-allinone directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./build.py --enable-examples --enable-tests
</pre></div>
</div>
<p>Running test.py in the top level <em>ns-3</em> directory will cause all of the examples and tests to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>170 of 170 tests passed (170 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
</div>
<div class="section" id="enable-disable-examples-and-tests-using-waf">
<h5>Enable/disable examples and tests using waf<a class="headerlink" href="#enable-disable-examples-and-tests-using-waf" title="Permalink to this headline">¶</a></h5>
<p>You can use waf to enable/disable examples and tests once <em>ns-3</em> has been built.</p>
<p>By default, examples and tests are not built in <em>ns-3</em>.</p>
<p>From the top level <em>ns-3</em> directory, you can build <em>ns-3</em> without any
examples or tests simply by doing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure
$ ./waf build
</pre></div>
</div>
<p>Running test.py now will cause no examples or tests to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0 of 0 tests passed (0 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
<p>If you would like build <em>ns-3</em> with examples and tests, then do the following from the top level <em>ns-3</em> directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure --enable-examples --enable-tests
$ ./waf build
</pre></div>
</div>
<p>Running test.py will cause all of the examples and tests to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>170 of 170 tests passed (170 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
</div>
<div class="section" id="enable-disable-examples-and-tests-using-the-ns3-configuration-file">
<h5>Enable/disable examples and tests using the <em>ns-3</em> configuration file<a class="headerlink" href="#enable-disable-examples-and-tests-using-the-ns3-configuration-file" title="Permalink to this headline">¶</a></h5>
<p>A configuration file, .ns3rc, has been added to <em>ns-3</em> that allows users to specify whether examples and tests should be built or not.  You can use this file to enable/disable examples and tests once <em>ns-3</em> has been built.</p>
<p>When enabling disabling examples and tests, the precedence rules are as follows:</p>
<ol class="arabic simple">
<li><p>the –enable-examples/–disable-examples configure strings override any .ns3rc file</p></li>
<li><p>the –enable-tests/–disable-tests configure strings override any .ns3rc file</p></li>
<li><p>the .ns3rc file in the top level <em>ns-3</em> directory is next consulted, if present</p></li>
<li><p>the system searches for ~/.ns3rc if the .ns3rc file was not found in the previous step</p></li>
</ol>
<p>If none of the above exists, then examples and tests will not be built.</p>
<p>The maintained version of the .ns3rc file in the <em>ns-3</em> source code repository resides in the <code class="docutils literal notranslate"><span class="pre">utils</span></code> directory.  The reason for this is if it were in the top-level directory of the repository, it would be prone to accidental checkins from maintainers that enable the modules they want to use.  Therefore, users need to manually copy the .ns3rc from the <code class="docutils literal notranslate"><span class="pre">utils</span></code> directory to their preferred place (top level directory or their home directory) to enable persistent enabling of examples and tests.</p>
<p>Assuming that you are in the top level <em>ns-3</em> directory, you can get a copy of the .ns3rc file that is in the <code class="docutils literal notranslate"><span class="pre">utils</span></code> directory as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cp utils/.ns3rc .
</pre></div>
</div>
<p>The .ns3rc file should now be in your top level <em>ns-3</em> directory, and it contains the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/env python</span>

<span class="c1"># A list of the modules that will be enabled when ns-3 is run.</span>
<span class="c1"># Modules that depend on the listed modules will be enabled also.</span>
<span class="c1">#</span>
<span class="c1"># All modules can be enabled by choosing &#39;all_modules&#39;.</span>
<span class="n">modules_enabled</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;all_modules&#39;</span><span class="p">]</span>

<span class="c1"># Set this equal to true if you want examples to be run.</span>
<span class="n">examples_enabled</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Set this equal to true if you want tests to be run.</span>
<span class="n">tests_enabled</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>From the top level <em>ns-3</em> directory, you can build <em>ns-3</em> without any
examples or tests simply by doing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure
$ ./waf build
</pre></div>
</div>
<p>Running test.py now will cause no examples or tests to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>0 of 0 tests passed (0 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
<p>If you would like build <em>ns-3</em> with examples and tests, use your
favorite editor to change the values in the .ns3rc file for
examples_enabled and tests_enabled file to be True:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/env python</span>

<span class="c1"># A list of the modules that will be enabled when ns-3 is run.</span>
<span class="c1"># Modules that depend on the listed modules will be enabled also.</span>
<span class="c1">#</span>
<span class="c1"># All modules can be enabled by choosing &#39;all_modules&#39;.</span>
<span class="n">modules_enabled</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;all_modules&#39;</span><span class="p">]</span>

<span class="c1"># Set this equal to true if you want examples to be run.</span>
<span class="n">examples_enabled</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Set this equal to true if you want tests to be run.</span>
<span class="n">tests_enabled</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>From the top level <em>ns-3</em> directory, you can build <em>ns-3</em> with examples
and tests simply by doing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf configure
$ ./waf build
</pre></div>
</div>
<p>Running test.py will cause all of the examples and tests to be run:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>170 of 170 tests passed (170 passed, 0 skipped, 0 failed, 0 crashed, 0 valgrind errors)
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-troubleshoot"></span><div class="section" id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h3>
<p>This chapter posts some information about possibly common errors in building
or running <em>ns-3</em> programs.</p>
<p>Please note that the wiki
(<a class="reference external" href="http://www.nsnam.org/wiki/Troubleshooting">http://www.nsnam.org/wiki/Troubleshooting</a>) may have contributed
items.</p>
<div class="section" id="build-errors">
<h4>Build errors<a class="headerlink" href="#build-errors" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="run-time-errors">
<h4>Run-time errors<a class="headerlink" href="#run-time-errors" title="Permalink to this headline">¶</a></h4>
<p>Sometimes, errors can occur with a program after a successful build. These are
run-time errors, and can commonly occur when memory is corrupted or pointer
values are unexpectedly null.</p>
<p>Here is an example of what might occur:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run tcp-point-to-point
Entering directory <span class="s1">&#39;/home/tomh/ns-3-nsc/build&#39;</span>
Compilation finished successfully
Command <span class="o">[</span><span class="s1">&#39;/home/tomh/ns-3-nsc/build/debug/examples/tcp-point-to-point&#39;</span><span class="o">]</span> exited with code -11
</pre></div>
</div>
<p>The error message says that the program terminated unsuccessfully, but it is
not clear from this information what might be wrong. To examine more
closely, try running it under the <a class="reference external" href="http://sources.redhat.com/gdb/">gdb debugger</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run tcp-point-to-point --command-template<span class="o">=</span><span class="s2">&quot;gdb %s&quot;</span>
Entering directory <span class="s1">&#39;/home/tomh/ns-3-nsc/build&#39;</span>
Compilation finished successfully
GNU gdb Red Hat Linux <span class="o">(</span><span class="m">6</span>.3.0.0-1.134.fc5rh<span class="o">)</span>
Copyright <span class="m">2004</span> Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type <span class="s2">&quot;show copying&quot;</span> to see the conditions.
There is absolutely no warranty <span class="k">for</span> GDB.  Type <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
This GDB was configured as <span class="s2">&quot;i386-redhat-linux-gnu&quot;</span>...Using host libthread_db
library <span class="s2">&quot;/lib/libthread_db.so.1&quot;</span>.

<span class="o">(</span>gdb<span class="o">)</span> run
Starting program: /home/tomh/ns-3-nsc/build/debug/examples/tcp-point-to-point
Reading symbols from shared object <span class="nb">read</span> from target memory...done.
Loaded system supplied DSO at 0xf5c000

Program received signal SIGSEGV, Segmentation fault.
0x0804aa12 in main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span><span class="m">1</span>, <span class="nv">argv</span><span class="o">=</span>0xbfdfefa4<span class="o">)</span>
    at ../examples/tcp-point-to-point.cc:136
<span class="m">136</span>       Ptr&lt;Socket&gt; <span class="nv">localSocket</span> <span class="o">=</span> socketFactory-&gt;CreateSocket <span class="o">()</span><span class="p">;</span>
<span class="o">(</span>gdb<span class="o">)</span> p localSocket
<span class="nv">$1</span> <span class="o">=</span> <span class="o">{</span><span class="nv">m_ptr</span> <span class="o">=</span> 0x3c5d65<span class="o">}</span>
<span class="o">(</span>gdb<span class="o">)</span> p socketFactory
<span class="nv">$2</span> <span class="o">=</span> <span class="o">{</span><span class="nv">m_ptr</span> <span class="o">=</span> 0x0<span class="o">}</span>
<span class="o">(</span>gdb<span class="o">)</span> quit
The program is running.  Exit anyway? <span class="o">(</span>y or n<span class="o">)</span> y
</pre></div>
</div>
<p>Note first the way the program was invoked– pass the command to run as an
argument to the command template “gdb %s”.</p>
<p>This tells us that there was an attempt to dereference a null pointer
socketFactory.</p>
<p>Let’s look around line 136 of tcp-point-to-point, as gdb suggests:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">SocketFactory</span><span class="o">&gt;</span> <span class="n">socketFactory</span> <span class="o">=</span> <span class="n">n2</span><span class="o">-&gt;</span><span class="n">GetObject</span><span class="o">&lt;</span><span class="n">SocketFactory</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">Tcp</span><span class="o">::</span><span class="n">iid</span><span class="p">);</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Socket</span><span class="o">&gt;</span> <span class="n">localSocket</span> <span class="o">=</span> <span class="n">socketFactory</span><span class="o">-&gt;</span><span class="n">CreateSocket</span> <span class="p">();</span>
<span class="n">localSocket</span><span class="o">-&gt;</span><span class="n">Bind</span> <span class="p">();</span>
</pre></div>
</div>
<p>The culprit here is that the return value of GetObject is not being checked and
may be null.</p>
<p>Sometimes you may need to use the <a class="reference external" href="http://valgrind.org">valgrind memory checker</a> for more subtle errors. Again, you invoke the use of
valgrind similarly:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./waf --run tcp-point-to-point --command-template<span class="o">=</span><span class="s2">&quot;valgrind %s&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-organization">Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-working-with-git">Working with git as a user</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#ns-3-s-git-workflow-in-a-nutshell">ns-3’s Git workflow in a nutshell</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#setup-of-a-personal-repository">Setup of a personal repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#add-the-official-ns-3-repository-as-remote-upstream">Add the official ns-3 repository as remote upstream</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#add-your-forked-repository-as-remote">Add your forked repository as remote</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#keep-in-sync-your-repository-with-latest-ns-3-dev-updates">Keep in sync your repository with latest ns-3-dev updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#start-a-new-branch-to-do-some-work">Start a new branch to do some work</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#edit-and-commit-the-modifications">Edit and commit the modifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#rebase-your-branch-on-top-of-master">Rebase your branch on top of master</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#pushing-your-changes-to-origin">Pushing your changes to origin</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#submit-work-for-review">Submit work for review</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#porting-patches-from-mercurial-repositories-to-git">Porting patches from mercurial repositories to git</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#working-with-git-as-a-maintainer">Working with git as a maintainer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#pushing-your-own-work">Pushing your own work</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#review-and-merge-someone-else-s-work">Review and merge someone else’s work</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#making-a-release">Making a release</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-random-variables">Random Variables</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#quick-overview">Quick Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creating-random-variables">Creating random variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Seeding and independent replications</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#class-randomvariablestream">Class RandomVariableStream</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#base-class-public-api">Base class public API</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#types-of-randomvariables">Types of RandomVariables</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#semantics-of-randomvariablestream-objects">Semantics of RandomVariableStream objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-other-prng">Using other PRNG</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#setting-the-stream-number">Setting the stream number</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#publishing-your-results">Publishing your results</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-hash-functions">Hash Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#incremental-hashing">Incremental Hashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-an-alternative-hash-function">Using an Alternative Hash Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#adding-new-hash-function-implementations">Adding New Hash Function Implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sources-for-hash-functions">Sources for Hash Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-events">Events and Simulator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#event">Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#simulator">Simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#time">Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#scheduler">Scheduler</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-callbacks">Callbacks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#callbacks-motivation">Callbacks Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#callbacks-background">Callbacks Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-the-callback-api">Using the Callback API</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#bound-callbacks">Bound Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#traced-callbacks">Traced Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#callback-locations-in-ns-3">Callback locations in ns-3</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#implementation-details">Implementation details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-object-model">Object model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#object-oriented-behavior">Object-oriented behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#object-base-classes">Object base classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#memory-management-and-class-ptr">Memory management and class Ptr</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#createobject-and-create">CreateObject and Create</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#aggregation">Aggregation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#object-factories">Object factories</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#downcasting">Downcasting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-attributes">Configuration and Attributes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#object-overview">Object Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#implementation-details">Implementation Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configstore">ConfigStore</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-object-names">Object names</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-logging">Logging</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-to-add-logging-to-your-code">How to add logging to your code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#controlling-timestamp-precision">Controlling timestamp precision</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tracing">Tracing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#tracing-motivation">Tracing Motivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-the-tracing-api">Using the Tracing API</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-trace-helpers">Using Trace Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tracing-implementation-details">Tracing implementation details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-data-collection">Data Collection</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-data-collection-overview">Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-data-collection-helpers">Data Collection Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-probe">Probes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-collector">Collectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-aggregator">Aggregators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-adaptor">Adaptors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-scope-and-limitations">Scope/Limitations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-statistics">Statistical Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#goals">Goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#to-do">To-Do</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#approach">Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-realtime">RealTime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#behavior">Behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#implementation">Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-helpers">Helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-utilities">Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#print-introspected-doxygen">Print-introspected-doxygen</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#bench-simulator">Bench-simulator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-gnuplot">Making Plots using the Gnuplot Class</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#creating-plots-using-the-gnuplot-class">Creating Plots Using the Gnuplot Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#an-example-program-that-uses-the-gnuplot-class">An Example Program that Uses the Gnuplot Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#an-example-2-dimensional-plot">An Example 2-Dimensional Plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#an-example-2-dimensional-plot-with-error-bars">An Example 2-Dimensional Plot with Error Bars</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#an-example-3-dimensional-plot">An Example 3-Dimensional Plot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-python">Using Python to Run <em>ns-3</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#an-example-python-script-that-runs-ns3">An Example Python Script that Runs <em>ns-3</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-python-scripts">Running Python Scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#caveats">Caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#working-with-python-bindings">Working with Python Bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#more-information-for-developers">More Information for Developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-tests">Tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-test-overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-test-background">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-test-framework">Testing framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-how-to-write-tests">How to write tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-support">Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-new-models">Creating a new <em>ns-3</em> model</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-new-modules">Adding a New Module to <em>ns-3</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-documentation">Creating Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-enable-modules">Enabling Subsets of <em>ns-3</em> Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-enable-tests">Enabling/disabling <em>ns-3</em> Tests and Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-troubleshoot">Troubleshooting</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="#">Manual</a><span class="navelem">&nbsp;</span></li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2006-2019.
      Last updated on Apr 29, 2020 18:24.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.2.
    </div>
  </body>
</html>