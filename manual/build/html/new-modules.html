
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.7. Adding a New Module to ns-3 &#8212; Manual</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/default.css?v=bb97339c" />
    <script src="_static/documentation_options.js?v=316584e3"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4.8. Creating Documentation" href="documentation.html" />
    <link rel="prev" title="4.6. Creating a new ns-3 model" href="new-models.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico"
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="html";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>


  </head><body>
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0" width="100%">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectlogo">
              <a id="ns3_home1"
                 href="http://www.nsnam.org/">
                 <img alt="ns-3 Logo" style="background-color: unset;"
                      src="_static/ns-3-inverted-notext-small.png"/>
              </a>
            </td>
            <td id="projecttext">
              <div id="projectbrief">A Discrete-Event Network Simulator</div>
              <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
            </td>

            <td id="ns3-menu">
              <div class="menu">
                <ul >
                  <li style="background-image:none">
                    <a id="ns3_home2"
                         href="http://www.nsnam.org/"
                         >&nbsp;&nbsp;Home</a>
                  </li>
                  <li><span
                        onmouseover="mopen('mTuts')"
                        onmouseout="mclosetime()"
                          >Tutorials &nbsp;&#x25BC;</span>
                      <div id="mTuts"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_tut"
                           href="/docs/tutorial/html/index.html"
                            >English</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDocs')"
                        onmouseout="mclosetime()"
                          >Documentation &nbsp;&#x25BC;</span>
                      <div id="mDocs"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_ins"
                           href="/docs/installation/html/index.html"
                           >Installation</a><br/>
                        <a id="ns3_man"
                           href="/docs/manual/html/index.html"
                           >Manual</a><br/>
                        <a id="ns3_mod"
                           href="/docs/models/html/index.html"
                           >Models</a><br/>
                        <a id="ns3_con"
                           href="/docs/contributing/html/index.html"
                           >Contributing</a><br/>
                        <a id="ns3_wiki"
                           href="http://www.nsnam.org/wiki"
                           >Wiki</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDev')"
                        onmouseout="mclosetime()"
                          >Development &nbsp;&#x25BC;</span>
                      <div id="mDev"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_api"
                           href="/docs/doxygen/html/index.html"
                           >API Docs</a><br/>
                        <a id="ns3_bugs"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/issues"
                           >Issue Tracker</a><br/>
                        <a id="ns3_merge"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/merge_requests"
                           >Merge Requests</a><br/>
                      </div>
                  </li>
                </ul>
              </div>
            </td>

            <td id="projectsection">
              <span style="margin-right:10px">Manual</span>
            </td>
          </tr>
        </tbody>
      </table>
      <script  type="text/javascript">ns3_write_links()</script>
    </div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="documentation.html" title="4.8. Creating Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="new-models.html" title="4.6. Creating a new ns-3 model"
             accesskey="P">previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Manual</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="develop.html" accesskey="U"><span class="section-number">4. </span>Developer Tools</a><span class="navelem">&nbsp;</span></li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.7. </span>Adding a New Module to <em>ns-3</em></a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="adding-a-new-module-to-ns3">
<span id="id1"></span><h1><span class="section-number">4.7. </span>Adding a New Module to <em>ns-3</em><a class="headerlink" href="#adding-a-new-module-to-ns3" title="Link to this heading">¶</a></h1>
<p>When you have created a group of related classes, examples, and tests,
they can be combined together into an <em>ns-3</em> module so that they can be
used with existing <em>ns-3</em> modules and by other researchers.</p>
<p>This chapter walks you through the steps necessary to add a new module
to <em>ns-3</em>.</p>
<section id="step-0-module-layout">
<span id="step-0"></span><h2><span class="section-number">4.7.1. </span>Step 0 - Module Layout<a class="headerlink" href="#step-0-module-layout" title="Link to this heading">¶</a></h2>
<p>All modules can be found in the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory.  Each module can be
found in a directory that has the same name as the module.  For
example, the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> module can be found here: <code class="docutils literal notranslate"><span class="pre">src/spectrum</span></code>.
We’ll be quoting from the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> module for illustration.</p>
<p>A prototypical module has the following directory structure and
required files:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>src/
  module-name/
    bindings/
    doc/
    examples/
      CMakeLists.txt
    helper/
    model/
    test/
      examples-to-run.py
    CMakeLists.txt
</pre></div>
</div>
<p>Not all directories will be present in each module.</p>
</section>
<section id="step-1-create-a-module-skeleton">
<h2><span class="section-number">4.7.2. </span>Step 1 - Create a Module Skeleton<a class="headerlink" href="#step-1-create-a-module-skeleton" title="Link to this heading">¶</a></h2>
<p>A python program is provided in the <code class="docutils literal notranslate"><span class="pre">utils</span></code> directory that
will create a skeleton for a new module.  For the purposes
of this discussion we will assume that your new module
is called <code class="docutils literal notranslate"><span class="pre">new-module</span></code>.  From the top directory, do the following
to create the new module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./utils/create-module.py<span class="w"> </span>new-module
</pre></div>
</div>
<p>By default <code class="docutils literal notranslate"><span class="pre">create-module.py</span></code> creates the module skeleton in the
<code class="docutils literal notranslate"><span class="pre">src</span></code> directory.  However, it can also create modules in <code class="docutils literal notranslate"><span class="pre">contrib</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./utils/create-module.py<span class="w"> </span>contrib/new-contrib
</pre></div>
</div>
<p>Let’s assume we’ve created our new module in <code class="docutils literal notranslate"><span class="pre">src</span></code>.
<code class="docutils literal notranslate"><span class="pre">cd</span></code> into <code class="docutils literal notranslate"><span class="pre">src/new-module</span></code>; you will find this directory layout:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cd new-module
$ ls
doc examples  helper  model  test  CMakeLists.txt
</pre></div>
</div>
<p>In more detail, the <code class="docutils literal notranslate"><span class="pre">create-module.py</span></code> script will create the
directories as well as initial skeleton <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">.h</span></code>, <code class="docutils literal notranslate"><span class="pre">.cc</span></code>
and <code class="docutils literal notranslate"><span class="pre">.rst</span></code> files.  The complete module with skeleton files looks like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>src/
  new-module/
    doc/
  new-module.rst
examples/
  new-module-example.cc
  CMakeLists.txt
helper/
  new-module-helper.cc
  new-module-helper.h
model/
  new-module.cc
  new-module.h
test/
  new-module-test-suite.cc
CMakeLists.txt
</pre></div>
</div>
<p>(If required the <code class="docutils literal notranslate"><span class="pre">bindings/</span></code> directory listed in
<a class="reference internal" href="#step-0"><span class="std std-ref">Step-0</span></a> will be created automatically during
the build.)</p>
<p>We next walk through how to customize this module.  Informing <code class="docutils literal notranslate"><span class="pre">ns3</span></code>
about the files which make up your module is done by editing the two
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files.  We will walk through the main steps in this chapter.</p>
<p>All <em>ns-3</em> modules depend on the <code class="docutils literal notranslate"><span class="pre">core</span></code> module and usually on
other modules.  This dependency is specified in the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file
(at the top level of the module, not the separate <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file
in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> directory!).  In the skeleton <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>
the call that will declare your new module to <code class="docutils literal notranslate"><span class="pre">ns3</span></code> will look
like this (before editing):</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">build_lib</span><span class="p">(</span>
<span class="w">  </span><span class="s">LIBNAME</span><span class="w"> </span><span class="s">new-module</span>
<span class="w">  </span><span class="s">SOURCE_FILES</span><span class="w"> </span><span class="s">helper/new-module-helper.cc</span>
<span class="w">               </span><span class="s">model/new-module.cc</span>
<span class="w">  </span><span class="s">HEADER_FILES</span><span class="w"> </span><span class="s">helper/new-module-helper.h</span>
<span class="w">               </span><span class="s">model/new-module.h</span>
<span class="w">  </span><span class="s">LIBRARIES_TO_LINK</span><span class="w"> </span><span class="o">${</span><span class="nv">libcore</span><span class="o">}</span>
<span class="w">  </span><span class="s">TEST_SOURCES</span><span class="w"> </span><span class="s">test/new-module-test-suite.cc</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Let’s assume that <code class="docutils literal notranslate"><span class="pre">new-module</span></code> depends on the <code class="docutils literal notranslate"><span class="pre">internet</span></code>,
<code class="docutils literal notranslate"><span class="pre">mobility</span></code>, and <code class="docutils literal notranslate"><span class="pre">aodv</span></code> modules.  After editing it the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file
should look like:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">build_lib</span><span class="p">(</span>
<span class="w">  </span><span class="s">LIBNAME</span><span class="w"> </span><span class="s">new-module</span>
<span class="w">  </span><span class="s">SOURCE_FILES</span><span class="w"> </span><span class="s">helper/new-module-helper.cc</span>
<span class="w">               </span><span class="s">model/new-module.cc</span>
<span class="w">  </span><span class="s">HEADER_FILES</span><span class="w"> </span><span class="s">helper/new-module-helper.h</span>
<span class="w">               </span><span class="s">model/new-module.h</span>
<span class="w">  </span><span class="s">LIBRARIES_TO_LINK</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libinternet</span><span class="o">}</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libmobility</span><span class="o">}</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libaodv</span><span class="o">}</span>
<span class="w">  </span><span class="s">TEST_SOURCES</span><span class="w"> </span><span class="s">test/new-module-test-suite.cc</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that only first level module dependencies should be listed, which
is why we removed <code class="docutils literal notranslate"><span class="pre">core</span></code>; the <code class="docutils literal notranslate"><span class="pre">internet</span></code> module in turn depends on
<code class="docutils literal notranslate"><span class="pre">core</span></code>.</p>
<p>Your module will most likely have model source files.  Initial skeletons
(which will compile successfully) are created in <code class="docutils literal notranslate"><span class="pre">model/new-module.cc</span></code>
and <code class="docutils literal notranslate"><span class="pre">model/new-module.h</span></code>.</p>
<p>If your module will have helper source files, then they will go into
the <code class="docutils literal notranslate"><span class="pre">helper/</span></code> directory; again, initial skeletons are created
in that directory.</p>
<p>Finally, it is good practice to write tests and examples.  These will
almost certainly be required for new modules to be accepted into
the official <em>ns-3</em> source tree.  A skeleton
test suite and test case is created in the <code class="docutils literal notranslate"><span class="pre">test/</span></code> directory.
The skeleton test suite will contain the below constructor,
which declares a new unit test named <code class="docutils literal notranslate"><span class="pre">new-module</span></code>,
with a single test case consisting of the class <code class="docutils literal notranslate"><span class="pre">NewModuleTestCase1</span></code>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">NewModuleTestSuite</span><span class="o">::</span><span class="n">NewModuleTestSuite</span><span class="p">()</span>
<span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">TestSuite</span><span class="p">(</span><span class="s">&quot;new-module&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">UNIT</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">AddTestCase</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">NewModuleTestCase1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="step-3-declare-source-files">
<h2><span class="section-number">4.7.3. </span>Step 3 - Declare Source Files<a class="headerlink" href="#step-3-declare-source-files" title="Link to this heading">¶</a></h2>
<p>The public header and source code files for your new module
should be specified in the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file by modifying it with
your text editor.</p>
<p>As an example, after declaring the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> module,
the <code class="docutils literal notranslate"><span class="pre">src/spectrum/CMakeLists.txt</span></code> specifies the source code files
with the following:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">source_files</span>
<span class="w">  </span><span class="s">helper/adhoc-aloha-noack-ideal-phy-helper.cc</span>
<span class="w">  </span><span class="s">helper/spectrum-analyzer-helper.cc</span>
<span class="w">  </span><span class="s">helper/spectrum-helper.cc</span>
<span class="w">  </span><span class="s">...</span>
<span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="s">header_files</span>
<span class="w">  </span><span class="s">helper/adhoc-aloha-noack-ideal-phy-helper.h</span>
<span class="w">  </span><span class="s">helper/spectrum-analyzer-helper.h</span>
<span class="w">  </span><span class="s">helper/spectrum-helper.h</span>
<span class="w">  </span><span class="s">...</span>
<span class="p">)</span>

<span class="nb">build_lib</span><span class="p">(</span>
<span class="w">  </span><span class="s">LIBNAME</span><span class="w"> </span><span class="s">spectrum</span>
<span class="w">  </span><span class="s">SOURCE_FILES</span><span class="w"> </span><span class="o">${</span><span class="nv">source_files</span><span class="o">}</span>
<span class="w">  </span><span class="s">HEADER_FILES</span><span class="w"> </span><span class="o">${</span><span class="nv">header_files</span><span class="o">}</span>
<span class="w">  </span><span class="s">LIBRARIES_TO_LINK</span><span class="w"> </span><span class="o">${</span><span class="nv">libpropagation</span><span class="o">}</span>
<span class="w">                    </span><span class="o">${</span><span class="nv">libantenna</span><span class="o">}</span>
<span class="w">  </span><span class="s">TEST_SOURCES</span>
<span class="w">    </span><span class="s">test/spectrum-ideal-phy-test.cc</span>
<span class="w">    </span><span class="s">test/spectrum-interference-test.cc</span>
<span class="w">    </span><span class="s">test/spectrum-value-test.cc</span>
<span class="w">    </span><span class="s">test/spectrum-waveform-generator-test.cc</span>
<span class="w">    </span><span class="s">test/three-gpp-channel-test-suite.cc</span>
<span class="w">    </span><span class="s">test/tv-helper-distribution-test.cc</span>
<span class="w">    </span><span class="s">test/tv-spectrum-transmitter-test.cc</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note: the <code class="docutils literal notranslate"><span class="pre">source_files</span></code> and <code class="docutils literal notranslate"><span class="pre">header_files</span></code> lists are not necessary.
They are used keep the <code class="docutils literal notranslate"><span class="pre">build_lib</span></code> macro readable for modules with many
source files.</p>
<p>The objects resulting from compiling these sources will be assembled
into a link library, which will be linked to any programs relying on this
module.</p>
<p>But how do such programs learn the public API of our new module?  Read on!</p>
</section>
<section id="step-4-declare-public-header-files">
<h2><span class="section-number">4.7.4. </span>Step 4 - Declare Public Header Files<a class="headerlink" href="#step-4-declare-public-header-files" title="Link to this heading">¶</a></h2>
<p>The header files defining the public API of your model and helpers
also should be specified in the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
<p>Continuing with the <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> model illustration,
the public header files are specified with the following stanza.
(Note that the variable <code class="docutils literal notranslate"><span class="pre">header_files</span></code> tells
<code class="docutils literal notranslate"><span class="pre">CMake</span></code> to install this module’s headers with the other <em>ns-3</em> headers):</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="s">header_files</span>
<span class="w">    </span><span class="s">helper/adhoc-aloha-noack-ideal-phy-helper.h</span>
<span class="w">    </span><span class="s">helper/spectrum-analyzer-helper.h</span>
<span class="w">    </span><span class="s">...</span>
<span class="w">    </span><span class="s">model/tv-spectrum-transmitter.h</span>
<span class="w">    </span><span class="s">model/waveform-generator.h</span>
<span class="w">    </span><span class="s">model/wifi-spectrum-value-helper.h</span>
<span class="p">)</span>

<span class="nb">build_lib</span><span class="p">(</span>
<span class="w">  </span><span class="s">LIBNAME</span><span class="w"> </span><span class="s">spectrum</span>
<span class="w">  </span><span class="s">...</span>
<span class="w">  </span><span class="s">HEADER_FILES</span><span class="w"> </span><span class="o">${</span><span class="nv">header_files</span><span class="o">}</span>
<span class="w">  </span><span class="s">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If the list of headers is short, use the following instead:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">build_lib</span><span class="p">(</span>
<span class="w">  </span><span class="s">LIBNAME</span><span class="w"> </span><span class="s">spectrum</span>
<span class="w">  </span><span class="s">...</span>
<span class="w">  </span><span class="s">HEADER_FILES</span>
<span class="w">    </span><span class="s">helper/adhoc-aloha-noack-ideal-phy-helper.h</span>
<span class="w">    </span><span class="s">helper/spectrum-analyzer-helper.h</span>
<span class="w">    </span><span class="s">...</span>
<span class="w">    </span><span class="s">model/tv-spectrum-transmitter.h</span>
<span class="w">    </span><span class="s">model/waveform-generator.h</span>
<span class="w">    </span><span class="s">model/wifi-spectrum-value-helper.h</span>
<span class="w">  </span><span class="s">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Headers made public in this way will be accessible to users of your model
with include statements like</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ns3/spectrum-model.h&quot;</span>
</pre></div>
</div>
<p>Headers used strictly internally in your implementation should not
be included here.  They are still accessible to your implementation by
include statements like</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;my-module-implementation.h&quot;</span>
</pre></div>
</div>
</section>
<section id="step-5-declare-tests">
<h2><span class="section-number">4.7.5. </span>Step 5 - Declare Tests<a class="headerlink" href="#step-5-declare-tests" title="Link to this heading">¶</a></h2>
<p>If your new module has tests, then they must be specified in your
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file by modifying it with your text editor.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> model tests are specified with the following stanza:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nb">build_lib</span><span class="p">(</span>
<span class="w">  </span><span class="s">LIBNAME</span><span class="w"> </span><span class="s">spectrum</span>
<span class="w">  </span><span class="s">...</span>
<span class="w">  </span><span class="s">TEST_SOURCES</span>
<span class="w">    </span><span class="s">test/spectrum-ideal-phy-test.cc</span>
<span class="w">    </span><span class="s">test/spectrum-interference-test.cc</span>
<span class="w">    </span><span class="s">test/spectrum-value-test.cc</span>
<span class="w">    </span><span class="s">test/spectrum-waveform-generator-test.cc</span>
<span class="w">    </span><span class="s">test/three-gpp-channel-test-suite.cc</span>
<span class="w">    </span><span class="s">test/tv-helper-distribution-test.cc</span>
<span class="w">    </span><span class="s">test/tv-spectrum-transmitter-test.cc</span>
<span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="tests.html"><span class="doc">Tests</span></a> for more information on how to write test cases.</p>
</section>
<section id="step-6-declare-examples">
<h2><span class="section-number">4.7.6. </span>Step 6 - Declare Examples<a class="headerlink" href="#step-6-declare-examples" title="Link to this heading">¶</a></h2>
<p>If your new module has examples, then they must be specified in your
<code class="docutils literal notranslate"><span class="pre">examples/CMakeLists.txt</span></code> file.  (The skeleton top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> will
recursively include <code class="docutils literal notranslate"><span class="pre">examples/CMakeLists.txt</span></code> only if the examples were
enabled at configure time.)</p>
<p>The <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> model defines it’s first example in
<code class="docutils literal notranslate"><span class="pre">src/spectrum/examples/CMakeLists.txt</span></code> with</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">build_lib_example</span><span class="p">(</span>
<span class="w">  </span><span class="s">NAME</span><span class="w"> </span><span class="s">adhoc-aloha-ideal-phy</span>
<span class="w">  </span><span class="s">SOURCE_FILES</span><span class="w"> </span><span class="s">adhoc-aloha-ideal-phy.cc</span>
<span class="w">  </span><span class="s">LIBRARIES_TO_LINK</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libspectrum</span><span class="o">}</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libmobility</span><span class="o">}</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libinternet</span><span class="o">}</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libapplications</span><span class="o">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note that the variable <code class="docutils literal notranslate"><span class="pre">libraries_to_link</span></code> is the list of modules that
the program being created depends on; again, don’t forget to include
<code class="docutils literal notranslate"><span class="pre">new-module</span></code> in the list.  It’s best practice to list only the direct
module dependencies, and let <code class="docutils literal notranslate"><span class="pre">CMake</span></code> deduce the full dependency tree.</p>
<p>Occasionally, for clarity, you may want to split the implementation
for your example among several source files.  In this case, just
include those files as additional explicit sources of the example:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">build_lib_example</span><span class="p">(</span>
<span class="w">  </span><span class="s">NAME</span><span class="w"> </span><span class="s">new-module-example</span>
<span class="w">  </span><span class="s">SOURCE_FILES</span><span class="w"> </span><span class="s">new-module-example.cc</span>
<span class="w">  </span><span class="s">LIBRARIES_TO_LINK</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libspectrum</span><span class="o">}</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libmobility</span><span class="o">}</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libinternet</span><span class="o">}</span>
<span class="w">    </span><span class="o">${</span><span class="nv">libapplications</span><span class="o">}</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="step-7-examples-run-as-tests">
<h2><span class="section-number">4.7.7. </span>Step 7 - Examples Run as Tests<a class="headerlink" href="#step-7-examples-run-as-tests" title="Link to this heading">¶</a></h2>
<p>In addition to running explicit test code, the test framework
can also be instrumented to run full example programs to
try to catch regressions in the examples.  However, not all examples
are suitable for regression tests.  The file <code class="docutils literal notranslate"><span class="pre">test/examples-to-run.py</span></code>
controls the invocation of the examples when the test framework runs.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> model examples run by <code class="docutils literal notranslate"><span class="pre">test.py</span></code> are specified in
<code class="docutils literal notranslate"><span class="pre">src/spectrum/test/examples-to-run.py</span></code> using the following
two lists of C++ and Python examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># A list of C++ examples to run in order to ensure that they remain</span>
<span class="c1"># buildable and runnable over time.  Each tuple in the list contains</span>
<span class="c1">#</span>
<span class="c1">#     (example_name, do_run, do_valgrind_run).</span>
<span class="c1">#</span>
<span class="c1"># See test.py for more information.</span>
<span class="n">cpp_examples</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;adhoc-aloha-ideal-phy&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;adhoc-aloha-ideal-phy-with-microwave-oven&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;adhoc-aloha-ideal-phy-matrix-propagation-loss-model&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># A list of Python examples to run in order to ensure that they remain</span>
<span class="c1"># runnable over time.  Each tuple in the list contains</span>
<span class="c1">#</span>
<span class="c1">#     (example_name, do_run).</span>
<span class="c1">#</span>
<span class="c1"># See test.py for more information.</span>
<span class="n">python_examples</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;sample-simulator.py&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>As indicated in the comment, each entry in the C++ list of examples to run
contains the tuple <code class="docutils literal notranslate"><span class="pre">(example_name,</span> <span class="pre">do_run,</span> <span class="pre">do_valgrind_run)</span></code>, where</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">example_name</span></code> is the executable to be run,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">do_run</span></code> is a condition under which to run the example, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">do_valgrind_run</span></code> is a condition under which to run the example
under valgrind.  (This is needed because NSC causes illegal instruction
crashes with some tests when they are run under valgrind.)</p></li>
</ul>
<p>Note that the two conditions are Python statements that
can depend on <code class="docutils literal notranslate"><span class="pre">ns3</span></code> configuration variables.  For example, using the
NSC_ENABLED variable that was defined up until ns-3.35:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s2">&quot;tcp-nsc-lfn&quot;</span><span class="p">,</span> <span class="s2">&quot;NSC_ENABLED == True&quot;</span><span class="p">,</span> <span class="s2">&quot;NSC_ENABLED == False&quot;</span><span class="p">),</span>
</pre></div>
</div>
<p>Each entry in the Python list of examples to run contains the tuple
<code class="docutils literal notranslate"><span class="pre">(example_name,</span> <span class="pre">do_run)</span></code>, where, as for the C++ examples,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">example_name</span></code> is the Python script to be run, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">do_run</span></code> is a condition under which to run the example.</p></li>
</ul>
<p>Again, the condition is a Python statement that can
depend on <code class="docutils literal notranslate"><span class="pre">ns3</span></code> configuration variables.  For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s2">&quot;realtime-udp-echo.py&quot;</span><span class="p">,</span> <span class="s2">&quot;ENABLE_REAL_TIME == False&quot;</span><span class="p">),</span>
</pre></div>
</div>
</section>
<section id="step-8-configure-and-build">
<h2><span class="section-number">4.7.8. </span>Step 8 - Configure and Build<a class="headerlink" href="#step-8-configure-and-build" title="Link to this heading">¶</a></h2>
<p>You can now configure, build and test your module as normal.
You must reconfigure the project as a first step so that <code class="docutils literal notranslate"><span class="pre">ns3</span></code>
caches the new information in your <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files,
or else your new module will not be included in the build.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./ns3<span class="w"> </span>configure<span class="w"> </span>--enable-examples<span class="w"> </span>--enable-tests
$<span class="w"> </span>./ns3<span class="w"> </span>build
$<span class="w"> </span>./test.py
</pre></div>
</div>
<p>Look for your new module’s test suite (and example programs,
if your module has any enabled) in the test output.</p>
</section>
<section id="step-9-python-bindings">
<h2><span class="section-number">4.7.9. </span>Step 9 - Python Bindings<a class="headerlink" href="#step-9-python-bindings" title="Link to this heading">¶</a></h2>
<p>Adding Python bindings to your module is optional.</p>
<p>If you want to include Python bindings (needed only if you want
to write Python ns-3 programs instead of C++ ns-3 programs), you
should scan your module to generate new bindings for the Python
API (covered elsewhere in this manual), and they will be used
if NS3_PYTHON_BINDINGS is set to ON.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">4.7. Adding a New Module to <em>ns-3</em></a><ul>
<li><a class="reference internal" href="#step-0-module-layout">4.7.1. Step 0 - Module Layout</a></li>
<li><a class="reference internal" href="#step-1-create-a-module-skeleton">4.7.2. Step 1 - Create a Module Skeleton</a></li>
<li><a class="reference internal" href="#step-3-declare-source-files">4.7.3. Step 3 - Declare Source Files</a></li>
<li><a class="reference internal" href="#step-4-declare-public-header-files">4.7.4. Step 4 - Declare Public Header Files</a></li>
<li><a class="reference internal" href="#step-5-declare-tests">4.7.5. Step 5 - Declare Tests</a></li>
<li><a class="reference internal" href="#step-6-declare-examples">4.7.6. Step 6 - Declare Examples</a></li>
<li><a class="reference internal" href="#step-7-examples-run-as-tests">4.7.7. Step 7 - Examples Run as Tests</a></li>
<li><a class="reference internal" href="#step-8-configure-and-build">4.7.8. Step 8 - Configure and Build</a></li>
<li><a class="reference internal" href="#step-9-python-bindings">4.7.9. Step 9 - Python Bindings</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="new-models.html"
                          title="previous chapter"><span class="section-number">4.6. </span>Creating a new <em>ns-3</em> model</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="documentation.html"
                          title="next chapter"><span class="section-number">4.8. </span>Creating Documentation</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/new-modules.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="documentation.html" title="4.8. Creating Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="new-models.html" title="4.6. Creating a new ns-3 model"
             >previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Manual</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="develop.html" ><span class="section-number">4. </span>Developer Tools</a><span class="navelem">&nbsp;</span></li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.7. </span>Adding a New Module to <em>ns-3</em></a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2006-2019.
      Last updated on Nov 29, 2023 13:25.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>