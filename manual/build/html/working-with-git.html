
<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.1. Working with Git as a user &#8212; Manual</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/default.css?v=bb97339c" />
    <script src="_static/documentation_options.js?v=951d00fa"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4.3. Working with CMake" href="working-with-cmake.html" />
    <link rel="prev" title="4. Developer Tools" href="develop.html" />
  <link rel="stylesheet" type="text/css"
    href="_static/ns3_stylesheet.css" />
    <link rel="icon" type="image/ico"
      href="_static/favicon.ico" />

  <script type="text/javascript" src="_static/drop-down-menu.js"></script>
  <script type="text/javascript" src="_static/ns3_version.js"></script>
  <script type="text/javascript">var ns3_builder="html";</script>
  <script type="text/javascript" src="_static/ns3_links.js"></script>


  </head><body>
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0" width="100%">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectlogo">
              <a id="ns3_home1"
                 href="http://www.nsnam.org/">
                 <img alt="ns-3 Logo" style="background-color: unset;"
                      src="_static/ns-3-inverted-notext-small.png"/>
              </a>
            </td>
            <td id="projecttext">
              <div id="projectbrief">A Discrete-Event Network Simulator</div>
              <span id="projectnumber"><script type="text/javascript">document.write(ns3_version)</script></span>
            </td>

            <td id="ns3-menu">
              <div class="menu">
                <ul >
                  <li style="background-image:none">
                    <a id="ns3_home2"
                         href="http://www.nsnam.org/"
                         >&nbsp;&nbsp;Home</a>
                  </li>
                  <li><span
                        onmouseover="mopen('mTuts')"
                        onmouseout="mclosetime()"
                          >Tutorials &nbsp;&#x25BC;</span>
                      <div id="mTuts"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_tut"
                           href="/docs/tutorial/html/index.html"
                            >English</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDocs')"
                        onmouseout="mclosetime()"
                          >Documentation &nbsp;&#x25BC;</span>
                      <div id="mDocs"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_ins"
                           href="/docs/installation/html/index.html"
                           >Installation</a><br/>
                        <a id="ns3_man"
                           href="/docs/manual/html/index.html"
                           >Manual</a><br/>
                        <a id="ns3_mod"
                           href="/docs/models/html/index.html"
                           >Models</a><br/>
                        <a id="ns3_con"
                           href="/docs/contributing/html/index.html"
                           >Contributing</a><br/>
                        <a id="ns3_wiki"
                           href="http://www.nsnam.org/wiki"
                           >Wiki</a><br/>
                      </div>
                  </li>
                  <li><span
                        onmouseover="mopen('mDev')"
                        onmouseout="mclosetime()"
                          >Development &nbsp;&#x25BC;</span>
                      <div id="mDev"
                          onmouseover="mcancelclosetime()"
                          onmouseout="mclosetime()">
                        <a id="ns3_api"
                           href="/docs/doxygen/html/index.html"
                           >API Docs</a><br/>
                        <a id="ns3_bugs"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/issues"
                           >Issue Tracker</a><br/>
                        <a id="ns3_merge"
                         href="https://gitlab.com/nsnam/ns-3-dev/-/merge_requests"
                           >Merge Requests</a><br/>
                      </div>
                  </li>
                </ul>
              </div>
            </td>

            <td id="projectsection">
              <span style="margin-right:10px">Manual</span>
            </td>
          </tr>
        </tbody>
      </table>
      <script  type="text/javascript">ns3_write_links()</script>
    </div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="working-with-cmake.html" title="4.3. Working with CMake"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="develop.html" title="4. Developer Tools"
             accesskey="P">previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Manual</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="develop.html" accesskey="U"><span class="section-number">4. </span>Developer Tools</a><span class="navelem">&nbsp;</span></li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.1. </span>Working with Git as a user</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="working-with-git-as-a-user">
<span id="working-with-git"></span><h1><span class="section-number">4.1. </span>Working with Git as a user<a class="headerlink" href="#working-with-git-as-a-user" title="Link to this heading">¶</a></h1>
<p>The ns-3 project used Mercurial in the past as its source code control system, but it has moved to Git in December 2018. Git is a VCS like Mercurial, Subversion or CVS, and it is used to maintain many open-source (and closed-source) projects. While Git and mercurial have a lot of common properties, if you are new to Git you should read first an introduction to it. The most up-to-date guide is the Git Book, at <a class="reference external" href="https://git-scm.com/book/en/v2/Getting-Started-Git-Basics">https://git-scm.com/book/en/v2/Getting-Started-Git-Basics</a>.</p>
<p>The ns-3 project is officially hosted on GitLab.com at <a class="reference external" href="https://gitlab.com/nsnam/">https://gitlab.com/nsnam/</a>.  For convenience and historical reasons, ns-3-dev mirrors are currently posted on Bitbucket.com and GitHub.com, and kept in sync with the official repository periodically via cron jobs.  We recommend that users who have been working from one of these mirrors repoint their remotes so that they pull origin or upstream from GitLab.com (see below explanation about how to configure remotes).</p>
<p>This section of the manual provides common tips for both users and maintainers. Since the first part is shared, in this manual section we will start with a personal repository and then explain what to do in some typical cases. ns-3 users often combine ns-3-dev with other repositories (netanim, apps from the app store).  This manual chapter does not cover this use case; it only focuses on the single ns-3-dev repository.  See other project documentation such as the ns-3 tutorial for descriptions on bundled releases distributed as source archives, or on the bake build tool for managing multiple repositories.  The guidelines listed below also largely pertain to the user who is using (and cloning) bake from the GitLab.com repository.</p>
<section id="ns-3-s-git-workflow-in-a-nutshell">
<h2><span class="section-number">4.1.1. </span>ns-3’s Git workflow in a nutshell<a class="headerlink" href="#ns-3-s-git-workflow-in-a-nutshell" title="Link to this heading">¶</a></h2>
<p>Experienced Git users will not necessarily need instruction on how to set up personal repositories (below).  However, they should be aware of the project’s workflow:</p>
<ul class="simple">
<li><p>The main repository’s <code class="docutils literal notranslate"><span class="pre">master</span></code> branch is the main development branch.  The project maintains only this one branch and strives to maintain a mostly linear history on it.</p></li>
<li><p>Releases are made by creating a branch from the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch and tagging the branch with the release number when ready, and then merging the release branch back to the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch.  Releases can be identified by a Git tag, and a modified <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> file in the branch.  However, the modified <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> file is not merged back to <code class="docutils literal notranslate"><span class="pre">master</span></code>.</p>
<ul>
<li><p>If a hotfix release must be made to update a past release, a new hotfix support branch will be created by branching from the tip of the last relevant release.  Changesets from <code class="docutils literal notranslate"><span class="pre">master</span></code> branch (such as bug fixes) may be cherry-picked to the hotfix branch.  The hotfix release is tagged with the hotfix version number, and merged back to the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch.</p></li>
</ul>
</li>
<li><p>Merges to the ns-3 <code class="docutils literal notranslate"><span class="pre">master</span></code> branch are fast forwarded when possible, and commits can be squashed as appropriate, to maintain a clean linear history.  Merge commits can be avoided in simple cases.</p>
<ul>
<li><p>More complicated merges might not be able to be fast forwarded, with the result that there will be a merge commit upon the merge.</p></li>
</ul>
</li>
<li><p>Maintainers can commit obvious non-critical fixes (documentation improvements, typos etc.) directly into the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch.  Users who are not maintainers can create GitLab.com Merge Requests for small items such as these, for maintainers to review.</p></li>
<li><p>Maintainers can directly commit bug fixes to their maintained modules without review/approval by other maintainers, although a review phase is recommended for non-trivial fixes.  Larger commits that touch multiple modules should be reviewed and approved by the set of affected maintainers.</p></li>
<li><p>When proposing code (new features, bug fixes, etc.) for a module maintained by someone else, the typical workflow will be to fork the <code class="docutils literal notranslate"><span class="pre">nsnam/ns-3-dev.git</span></code> repository, create a local feature branch on your fork, and use GitLab.com to generate a Merge Request towards <code class="docutils literal notranslate"><span class="pre">nsnam/ns-3-dev.git</span></code> when ready.  The Merge Request will then be reviewed, and in response to changes requested or comments from maintainers, authors are are asked to modify their feature branch and rebase to the tip of <code class="docutils literal notranslate"><span class="pre">ns-3-dev.git</span></code> as needed.</p></li>
</ul>
</section>
<section id="setup-of-a-personal-repository">
<h2><span class="section-number">4.1.2. </span>Setup of a personal repository<a class="headerlink" href="#setup-of-a-personal-repository" title="Link to this heading">¶</a></h2>
<p>We will provide two ways, one anonymous (but will impede the creation of merge requests) and the other, preferred, that include forking the repository through the GitLab.com web interface.</p>
<section id="directly-cloning-ns-3-dev">
<span id="id1"></span><h3><span class="section-number">4.1.2.1. </span>Directly cloning ns-3-dev<a class="headerlink" href="#directly-cloning-ns-3-dev" title="Link to this heading">¶</a></h3>
<p>If you go to the official ns-3-dev page, hosted at <a class="reference external" href="https://gitlab.com/nsnam/ns-3-dev">https://gitlab.com/nsnam/ns-3-dev</a>, you can find a button that says <code class="docutils literal notranslate"><span class="pre">Clone</span></code>. If you are not logged in, then you will see only the option of cloning the repository through HTTPS, with this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://gitlab.com/nsnam/ns-3-dev.git
</pre></div>
</div>
<p>If this command exits successfully, you will have a newly created <cite>ns-3-dev</cite> directory with all the source code.</p>
</section>
<section id="forking-ns-3-dev-on-gitlab-com">
<h3><span class="section-number">4.1.2.2. </span>Forking ns-3-dev on GitLab.com<a class="headerlink" href="#forking-ns-3-dev-on-gitlab-com" title="Link to this heading">¶</a></h3>
<p>Assume that you are the user <em>john</em> on GitLab.com and that you want to create a new repository that is synced with nsnam/ns-3-dev.</p>
<ol class="arabic simple">
<li><p>Log into GitLab.com</p></li>
<li><p>Navigate to <a class="reference external" href="https://gitlab.com/nsnam/ns-3-dev">https://gitlab.com/nsnam/ns-3-dev</a></p></li>
<li><p>In the top-right corner of the page, click <code class="docutils literal notranslate"><span class="pre">Fork</span></code>.</p></li>
</ol>
<p>Note that you may only do this once; if you try to fork again, Gitlab will take you to the page of the original fork. So, if you are planning to maintain two or more separate forks (for example, one for your private work, another for maintenance, etc.), you are doing a mistake. Instead, you should add these forks as a remote of your existing directory (see below for adding remotes). Usually, it is a good thing to add the maintainer’s repository as remotes, because it can happen that “bleeding edge” features will appear there before landing in ns-3-dev.</p>
<p>For more information on forking with Gilab, there is plenty of visual documentation (<a class="reference external" href="https://docs.gitlab.com/ee/user/project/repository/forking_workflow.html">https://docs.gitlab.com/ee/user/project/repository/forking_workflow.html</a>). To work with your forked repository, you have two ways: one is a clean clone while the other is meant to re-use an existing ns-3 Git repository.</p>
<section id="clone-your-forked-repository-on-your-machine">
<h4><span class="section-number">4.1.2.2.1. </span>Clone your forked repository on your machine<a class="headerlink" href="#clone-your-forked-repository-on-your-machine" title="Link to this heading">¶</a></h4>
<p>Git is a distributed versioning system. This means that <em>nobody</em> will touch your personal repository, until you do something. Please note that every gitlab user has, at least, two repositories: the first is represented by the repository hosted on gitlab servers, which will be called in the following <code class="docutils literal notranslate"><span class="pre">origin</span></code>. Then, you have your clone on your machine. This means that you could have many clones, on different machines, which points to <code class="docutils literal notranslate"><span class="pre">origin</span></code>.</p>
<p>To clone the newly created fork to your system, go to the homepage of your fork (that should be in the form <cite>https://gitlab.com/your-user-name/ns-3-dev</cite>) and click the <cite>Clone</cite> button. Then, go to your computer’s terminal, and issue the command (please refer to <a class="reference external" href="https://docs.gitlab.com/ee/gitlab-basics/command-line-commands.html#clone-your-project">https://docs.gitlab.com/ee/gitlab-basics/command-line-commands.html#clone-your-project</a> for more documentation):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://gitlab.com/your-user-name/ns-3-dev
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>ns-3-dev
</pre></div>
</div>
<p>In this example we used the HTTPS address because in some place the git + ssh address is blocked by firewalls. If you are not under this constraint, it is recommended to use the git + ssh address to avoid the username/password typing at each request.</p>
</section>
<section id="naming-conventions">
<h4><span class="section-number">4.1.2.2.2. </span>Naming conventions<a class="headerlink" href="#naming-conventions" title="Link to this heading">¶</a></h4>
<p>Git is able to fetch and push changes to several repositories, each of them is called <code class="docutils literal notranslate"><span class="pre">remote</span></code>. With time, you probably will have many remotes, each one with many branches. To avoid confusion, it is recommended to give meaningful names to the remotes. Following the Git terminology, we will use <code class="docutils literal notranslate"><span class="pre">origin</span></code> to indicate the ns-3-dev repository in your personal namespace (your forked version, server-side) and <code class="docutils literal notranslate"><span class="pre">upstream</span></code> to indicate the ns-3-dev repository in the nsnam namespace, server-side.</p>
</section>
</section>
</section>
<section id="add-the-official-ns-3-repository-as-remote-upstream">
<h2><span class="section-number">4.1.3. </span>Add the official ns-3 repository as remote upstream<a class="headerlink" href="#add-the-official-ns-3-repository-as-remote-upstream" title="Link to this heading">¶</a></h2>
<p>You could have already used Git in the past, and therefore already having a ns-3 Git repository somewhere. Or, instead, you could have it cloned for the first time in the step above. In both cases, when you fork/clone a repository, your history is no more bound to the repository itself. At this point, it is your duty to sync your fork with the original repository. The first remote repository we have encountered is <code class="docutils literal notranslate"><span class="pre">origin</span></code>; we must add the official ns-3 repo as another remote repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>upstream<span class="w"> </span>https://gitlab.com/nsnam/ns-3-dev
</pre></div>
</div>
<p>With the command above, we added a remote repository, named upstream, which links to the official ns-3 repo. To show your remote repositories:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>show
</pre></div>
</div>
<p>To see what <code class="docutils literal notranslate"><span class="pre">origin</span></code> is linking to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>show<span class="w"> </span>origin
</pre></div>
</div>
<p>Many options are available; please refer to the Git manual for more.</p>
</section>
<section id="add-your-forked-repository-as-remote">
<h2><span class="section-number">4.1.4. </span>Add your forked repository as remote<a class="headerlink" href="#add-your-forked-repository-as-remote" title="Link to this heading">¶</a></h2>
<p>If you were a user of the old github mirror, you probably have an existing Git repository installed somewhere. In your case, it is not necessary to clone your fork and to port all your work in the new directory; you can add the fork as new remote:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>rename<span class="w"> </span>origin<span class="w"> </span>old-origin
$<span class="w"> </span>git<span class="w"> </span>remote<span class="w"> </span>add<span class="w"> </span>origin<span class="w"> </span>https://gitlab.com/your-user-name/ns-3-dev
</pre></div>
</div>
<p>After these two commands, you will have a remote, named origin, that points
to your forked repository on gitlab.</p>
</section>
<section id="keep-in-sync-your-repository-with-latest-ns-3-dev-updates">
<h2><span class="section-number">4.1.5. </span>Keep in sync your repository with latest ns-3-dev updates<a class="headerlink" href="#keep-in-sync-your-repository-with-latest-ns-3-dev-updates" title="Link to this heading">¶</a></h2>
<p>We assume, from now to the end of this document, that you will not make commits on top of the master branch. It should be kept clean from <em>any</em> personal modifications: all the works must be done in branches. Therefore, to move the current HEAD of the master branch to the latest commit in ns-3-dev, you should do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>master
$<span class="w"> </span>git<span class="w"> </span>fetch<span class="w"> </span>upstream
$<span class="w"> </span>git<span class="w"> </span>pull<span class="w"> </span>upstream<span class="w"> </span>master
</pre></div>
</div>
<p>If you tried a pull which resulted in a conflict and you would like to start over, you can recover with Git reset (but this never happens if you do not commit over master).</p>
</section>
<section id="start-a-new-branch-to-do-some-work">
<h2><span class="section-number">4.1.6. </span>Start a new branch to do some work<a class="headerlink" href="#start-a-new-branch-to-do-some-work" title="Link to this heading">¶</a></h2>
<p>Look at the available branches:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span>-a
</pre></div>
</div>
<p>you should see something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*<span class="w"> </span>master
<span class="w">  </span>remotes/origin/master
<span class="w">  </span>remotes/upstream/master
</pre></div>
</div>
<p>The branch master is your local master branch; remotes/origin/master point at the master branch on your repository located in the Gitlab server, while remotes/nsnam/master points to the official master branch.</p>
<p>Before entering in details on how to create a new branch, we have to explain why it is recommended to do it. First of all, if you put all your work in a separate branch, you can easily see the diff between ns-3 mainline and your feature branch (with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span> <span class="pre">master</span></code>). Also, you can integrate more easily the upstream advancements in your work, and when you wish, you can create a <em>conflict-free</em> merge request, that will ease the maintainer’s job in reviewing your work.</p>
<p>To create a new branch, starting from master, the command is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>master
$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span><span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
</pre></div>
</div>
<p>To switch between branches, remove the -b option. You should now see:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span>-a
<span class="w"> </span>*<span class="w"> </span>master
<span class="w">  </span><span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
<span class="w">  </span>remotes/origin/master
<span class="w">  </span>remotes/upstream/master
</pre></div>
</div>
</section>
<section id="edit-and-commit-the-modifications">
<h2><span class="section-number">4.1.7. </span>Edit and commit the modifications<a class="headerlink" href="#edit-and-commit-the-modifications" title="Link to this heading">¶</a></h2>
<p>After you edit some file, you should commit the difference. As a policy, Git users love small and incremental patches. So, commit early, and commit often: you could rewrite your history later.</p>
<p>Suppose we edited <code class="docutils literal notranslate"><span class="pre">src/internet/model/tcp-socket-base.cc</span></code>. With Git status, we can see the repository status:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>status
<span class="w">   </span>On<span class="w"> </span>branch<span class="w"> </span>tcp-next
<span class="w">   </span>Your<span class="w"> </span>branch<span class="w"> </span>is<span class="w"> </span>up-to-date<span class="w"> </span>with<span class="w"> </span><span class="s1">&#39;mirror/tcp-next&#39;</span>.
<span class="w">   </span>Changes<span class="w"> </span>not<span class="w"> </span>staged<span class="w"> </span><span class="k">for</span><span class="w"> </span>commit:
<span class="w">     </span>modified:<span class="w">   </span>src/internet/model/tcp-socket-base.cc
</pre></div>
</div>
<p>and we can see the edits with git diff:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ git diff

nat@miyamoto ~/Work/ns-3-dev-git (tcp-next)$ git diff
diff --git i/src/internet/model/tcp-socket-base.cc w/src/internet/model/tcp-socket-base.cc
index 1bf0f69..e2298b0 100644
--- i/src/internet/model/tcp-socket-base.cc
+++ w/src/internet/model/tcp-socket-base.cc
@@ -1439,6 +1439,10 @@ TcpSocketBase::ReceivedAck (Ptr&lt;Packet&gt; packet, const TcpHeader&amp; tcpHeader)
       // There is a DupAck
       ++m_dupAckCount;

+      // I&#39;m introducing a subtle bug!
+
+      m_tcb-&gt;m_cWnd = m_tcb-&gt;m_ssThresh;
+
       if (m_tcb-&gt;m_congState == TcpSocketState::CA_OPEN)
         {
           // From Open we go Disorder
</pre></div>
</div>
<p>To create a commit, select the file you want to add to the commit with git add:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>src/internet/model/tcp-socket-base.cc
</pre></div>
</div>
<p>and then commit the result:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;My new TCP broken&quot;</span>
</pre></div>
</div>
<p>Of course, it would be better to have some rules for the commit message: they will be reported in the next subsection.</p>
<section id="commit-message-guidelines">
<h3><span class="section-number">4.1.7.1. </span>Commit message guidelines<a class="headerlink" href="#commit-message-guidelines" title="Link to this heading">¶</a></h3>
<p>The commit title should not go over the 80 char limit. It should be prefixed by the name of the module you are working on, and if it fixes a bug, it should reference it in the commit title. For instance, a good commit title would be:</p>
<blockquote>
<div><p>tcp: My new TCP broken</p>
</div></blockquote>
<p>Another example is:</p>
<blockquote>
<div><p>tcp: (fixes #2322) Corrected the uint32_t wraparound during recovery</p>
</div></blockquote>
<p>In the body message, try to explain what the problem was, and how you resolved that. If it is a new feature, try to describe it at a very high level, and highlight any modifications that changed the behaviour or the interface towards the users or other modules.</p>
</section>
<section id="commit-log">
<h3><span class="section-number">4.1.7.2. </span>Commit log<a class="headerlink" href="#commit-log" title="Link to this heading">¶</a></h3>
<p>You can see the history of the commits with git log. To show a particular commit, copy the sha-id and use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">show</span> <span class="pre">&lt;sha-id&gt;</span></code>. The ID is unique, so it can be referenced in emails or in issues. The next step is useful if you plan to contribute back your changes, but also to keep your feature branch updated with the latest changes from ns-3-dev.</p>
</section>
</section>
<section id="rebase-your-branch-on-top-of-master">
<h2><span class="section-number">4.1.8. </span>Rebase your branch on top of master<a class="headerlink" href="#rebase-your-branch-on-top-of-master" title="Link to this heading">¶</a></h2>
<p>Meanwhile you were busy with your branch, the upstream master could have changed. To rebase your work with the now new master, first of all sync your master branch (pulling the upstream/master branch into your local master branch) as explained before; then</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span><span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
$<span class="w"> </span>git<span class="w"> </span>rebase<span class="w"> </span>master
</pre></div>
</div>
<p>The last command will rewind your work, update the HEAD of your branch to the actual master, and then re-apply all your work. If some of your work conflicts with the actual master, you will be asked to fix these conflicts if automatic merge fails.</p>
</section>
<section id="pushing-your-changes-to-origin">
<h2><span class="section-number">4.1.9. </span>Pushing your changes to origin<a class="headerlink" href="#pushing-your-changes-to-origin" title="Link to this heading">¶</a></h2>
<p>After you have done some work on a branch, if you would like to share it with others, there is nothing better than pushing your work to your origin repository, on Gitlab servers.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span><span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
$<span class="w"> </span>git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span><span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> command can be used every time you need to push something from your computer to a remote repository, except when you propose changes to the main ns-3-dev repository: your changes must pass a review stage.</p>
<p>Please note that for older Git version, the push command looks like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>push<span class="w"> </span>-u<span class="w"> </span>origin<span class="w"> </span><span class="o">[</span>name_of_your_new_branch<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="submit-work-for-review">
<h2><span class="section-number">4.1.10. </span>Submit work for review<a class="headerlink" href="#submit-work-for-review" title="Link to this heading">¶</a></h2>
<p>After you push your branch to origin, you can follow the instructions here <a class="reference external" href="https://docs.gitlab.com/ee/user/project/merge_requests/creating_merge_requests.html">https://docs.gitlab.com/ee/user/project/merge_requests/creating_merge_requests.html</a>
to create a merge request.</p>
<p>It is strongly suggested to rebase your branch on top of upstream/master (or master, if you kept it synced) before submitting your work.
This helps reviewing the code changes proposed in the branch. merge it without conflicts, and it increase the speed of the GitLab CI.</p>
<section id="gitlab-ci-continuous-integration">
<h3><span class="section-number">4.1.10.1. </span>GitLab CI (Continuous Integration)<a class="headerlink" href="#gitlab-ci-continuous-integration" title="Link to this heading">¶</a></h3>
<p>GitLab provides a CI (Continuous Integration) feature. Shortly put, after every push the code is built and tests are run in one of the GitLab servers.</p>
<p>Merge requests are expected to pass the CI, as is to not generate errors or warnings during compilation, to have all the tests passing, and to not generate warnings on the documentation.
Hence, the CI is very important for the workflow. However, sometimes running the Ci is superfluous, for example:</p>
<ul class="simple">
<li><p>You are in the middle of some work (and perhaps you know that there are errors),</p></li>
<li><p>Your changes are not tested by the CI (e.g., changes to the AUTHORS),</p></li>
<li><p>Etc.</p></li>
</ul>
<p>In these cases it is useful to skip the CI to save time, CI runners quota, and energy. This is possible by using the <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">ci.skip</span></code> option:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>push<span class="w"> </span>-o<span class="w"> </span>ci.skip
</pre></div>
</div>
</section>
<section id="gitlab-ci-optimization">
<h3><span class="section-number">4.1.10.2. </span>GitLab CI optimization<a class="headerlink" href="#gitlab-ci-optimization" title="Link to this heading">¶</a></h3>
<p>The GitLab Ci jobs are optimized to take advantage of caches (this is done automatically).</p>
<p>In order to take full advantage of the caches, it is suggested to rebase your branches on top of upstream/master (or your own ‘master’ branch if you keep it synced with the latest commits from upstream/master).</p>
</section>
</section>
<section id="porting-patches-from-mercurial-repositories-to-git">
<h2><span class="section-number">4.1.11. </span>Porting patches from mercurial repositories to Git<a class="headerlink" href="#porting-patches-from-mercurial-repositories-to-git" title="Link to this heading">¶</a></h2>
<p><em>Placeholder section; please improve it.</em></p>
</section>
</section>
<section id="working-with-git-as-a-maintainer">
<h1><span class="section-number">4.2. </span>Working with Git as a maintainer<a class="headerlink" href="#working-with-git-as-a-maintainer" title="Link to this heading">¶</a></h1>
<p>As a maintainer, you are a person who has write access to the main nsnam repository. You could push your own work (without passing from code review) or push someone else’s work. Let’s investigate the two cases.</p>
<section id="pushing-your-own-work">
<h2><span class="section-number">4.2.1. </span>Pushing your own work<a class="headerlink" href="#pushing-your-own-work" title="Link to this heading">¶</a></h2>
<p>Since you have been added to the Developer list on Gitlab (if not, please open an issue) you can use the git + ssh address when adding nsnam as remote. Once you have done that, you can do your modifications to a local branch, then update the master to point to the latest changes of the nsnam repo, and then:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>master
$<span class="w"> </span>git<span class="w"> </span>pull<span class="w"> </span>upstream<span class="w"> </span>master
$<span class="w"> </span>git<span class="w"> </span>merge<span class="w"> </span><span class="o">[</span>your_branch_name<span class="o">]</span>
$<span class="w"> </span>git<span class="w"> </span>push<span class="w"> </span>upstream<span class="w"> </span>master
</pre></div>
</div>
<p>Please note that if you want to keep track of your branch, you can use as command <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">merge</span> <span class="pre">--no-ff</span> <span class="pre">[your_branch_name]</span></code>. It is always recommended to rebase your branch before merging, to have a clean history. That is not a requirement, though: Git perfectly handles a master with parallel merged branches.</p>
</section>
<section id="review-and-merge-someone-else-s-work">
<h2><span class="section-number">4.2.2. </span>Review and merge someone else’s work<a class="headerlink" href="#review-and-merge-someone-else-s-work" title="Link to this heading">¶</a></h2>
<p>Gitlab.com has a plenty of documentation on how to handle merge requests. Please take a look here: <a class="reference external" href="https://docs.gitlab.com/ee/user/project/merge_requests/creating_merge_requests.html">https://docs.gitlab.com/ee/user/project/merge_requests/creating_merge_requests.html</a>.</p>
<p>If you are committing a patch from someone else, and it is not coming through a Merge Request process, you can use the –author=’’ argument to ‘git commit’ to assign authorship to another email address (such as we have done in the past with the Mercurial -u option).</p>
</section>
<section id="making-a-release">
<h2><span class="section-number">4.2.3. </span>Making a release<a class="headerlink" href="#making-a-release" title="Link to this heading">¶</a></h2>
<p>As stated above, the project has adopted a workflow to aim for a mostly
linear history on a single <code class="docutils literal notranslate"><span class="pre">master</span></code> branch.  Releases are branches from
this <code class="docutils literal notranslate"><span class="pre">master</span></code> branch but the branches themselves are not long-lived;
the release branches are merged back to <code class="docutils literal notranslate"><span class="pre">master</span></code> in a special way.  However,
the release branches can be checked out by using the Git tag facility;
a named release such as ‘ns-3.30’ can be checked out on a branch by specifying
the release name ‘ns-3.30’ (or ‘ns-3.30.1’ etc.).</p>
<p>A compact way to represent a Git history is the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>log<span class="w"> </span>--graph<span class="w"> </span>--decorate<span class="w"> </span>--oneline<span class="w"> </span>--all
</pre></div>
</div>
<p>At the point just before the ns-3.34 release, the log looked like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*<span class="w"> </span>9df8ef4<span class="w"> </span><span class="o">(</span>HEAD<span class="w"> </span>-&gt;<span class="w"> </span>master<span class="o">)</span><span class="w"> </span>doc:<span class="w"> </span>Update<span class="w"> </span>ns-3<span class="w"> </span>version<span class="w"> </span><span class="k">in</span><span class="w"> </span>tutorial<span class="w"> </span>examples
*<span class="w"> </span>9319cdd<span class="w"> </span><span class="o">(</span>origin/master,<span class="w"> </span>origin/HEAD<span class="o">)</span><span class="w"> </span>Update<span class="w"> </span>CHANGES.html<span class="w"> </span>and<span class="w"> </span>RELEASE_NOTES
*<span class="w"> </span>8da68b5<span class="w"> </span>wifi:<span class="w"> </span>Fix<span class="w"> </span>typo<span class="w"> </span><span class="k">in</span><span class="w"> </span>channel<span class="w"> </span>access<span class="w"> </span>manager<span class="w"> </span><span class="nb">test</span>
</pre></div>
</div>
<p>We want the release to create a small branch that is merged (in a special
way) back to the mainline, yielding something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*<span class="w"> </span>4b27025<span class="w"> </span><span class="o">(</span>master<span class="o">)</span><span class="w"> </span>Update<span class="w"> </span>release<span class="w"> </span>files<span class="w"> </span>to<span class="w"> </span>start<span class="w"> </span>next<span class="w"> </span>release
*<span class="w">   </span>fd075f6<span class="w"> </span>Merge<span class="w"> </span>ns-3.34-release<span class="w"> </span>branch
<span class="p">|</span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>3fab3cf<span class="w"> </span><span class="o">(</span>HEAD,<span class="w"> </span>tag:<span class="w"> </span>ns-3.34<span class="o">)</span><span class="w"> </span>Update<span class="w"> </span>availability<span class="w"> </span><span class="k">in</span><span class="w"> </span>RELEASE_NOTES
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>c50aaf7<span class="w"> </span>Update<span class="w"> </span>VERSION<span class="w"> </span>and<span class="w"> </span>documentation<span class="w"> </span>tags<span class="w"> </span><span class="k">for</span><span class="w"> </span>ns-3.34<span class="w"> </span>release
<span class="p">|</span>/
*<span class="w"> </span>9df8ef4<span class="w"> </span>doc:<span class="w"> </span>Update<span class="w"> </span>ns-3<span class="w"> </span>version<span class="w"> </span><span class="k">in</span><span class="w"> </span>tutorial<span class="w"> </span>examples
*<span class="w"> </span>9319cdd<span class="w"> </span><span class="o">(</span>origin/master,<span class="w"> </span>origin/HEAD<span class="o">)</span><span class="w"> </span>Update<span class="w"> </span>CHANGES.html<span class="w"> </span>and<span class="w"> </span>RELEASE_NOTES
</pre></div>
</div>
<p>The first commit on the release branch changes the ‘3-dev’ string in VERSION
and the various documentation conf.py files to ‘3.34’.  The second commit
on the release branch updates RELEASE_NOTES to state the URL of the release.</p>
<p>Starting with commit 9df8ef4, the following steps were taken to create the
ns-3.34 release.  First, this commit hash ‘9df8ef4’ will be used later in
the merge process.</p>
<p>First, create a new release branch locally:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span><span class="s1">&#39;ns-3.34-release&#39;</span>
Switched<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>branch<span class="w"> </span><span class="s1">&#39;ns-3.34-release&#39;</span>
</pre></div>
</div>
<p>We change the VERSION field from ‘3-dev’ to ‘3.34’:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/3-dev/3.34/g&#39;</span><span class="w"> </span>VERSION
$<span class="w"> </span>cat<span class="w"> </span>VERSION
<span class="m">3</span>.34
</pre></div>
</div>
<p>We next change the file conf.py in the contributing, installation, tutorial, manual, and models directories
to change the strings ‘ns-3-dev’ to ns-3.34.</p>
<p>When you are done, the ‘git diff –stat’ command should show:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>VERSION<span class="w">                         </span><span class="p">|</span><span class="w"> </span><span class="m">2</span><span class="w"> </span>+-
doc/contributing/source/conf.py<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>++--
doc/installation/source/conf.py<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>++--
doc/manual/source/conf.py<span class="w">       </span><span class="p">|</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>++--
doc/models/source/conf.py<span class="w">       </span><span class="p">|</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>++--
doc/tutorial/source/conf.py<span class="w">     </span><span class="p">|</span><span class="w"> </span><span class="m">4</span><span class="w"> </span>++--
<span class="m">6</span><span class="w"> </span>files<span class="w"> </span>changed,<span class="w"> </span><span class="m">11</span><span class="w"> </span>insertions<span class="o">(</span>+<span class="o">)</span>,<span class="w"> </span><span class="m">11</span><span class="w"> </span>deletions<span class="o">(</span>-<span class="o">)</span>
</pre></div>
</div>
<p>Make a commit of these files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-a<span class="w"> </span>-m<span class="s2">&quot;Update VERSION and documentation tags for ns-3.34 release&quot;</span>
</pre></div>
</div>
<p>Next, make the following change to RELEASE_NOTES.md and commit it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-Release<span class="w"> </span><span class="m">3</span>-dev
--------------
+Release<span class="w"> </span><span class="m">3</span>.34
+------------
+
+###<span class="w"> </span>Availability
+
+This<span class="w"> </span>release<span class="w"> </span>is<span class="w"> </span>available<span class="w"> </span>from:
+&lt;https://www.nsnam.org/release/ns-allinone-3.34.tar.bz2&gt;
</pre></div>
</div>
<p>Commit this change:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;Update availability in RELEASE_NOTES.md&quot;</span><span class="w"> </span>RELEASE_NOTES.md
</pre></div>
</div>
<p>Finally, add a Git annotated tag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span><span class="s1">&#39;ns-3.34&#39;</span><span class="w"> </span>-m<span class="s2">&quot;ns-3.34 release&quot;</span>
</pre></div>
</div>
<p>Now, let’s merge back to <code class="docutils literal notranslate"><span class="pre">master</span></code>.  However, we want to avoid touching
the <code class="docutils literal notranslate"><span class="pre">VERSION</span></code> and <code class="docutils literal notranslate"><span class="pre">conf.py</span></code> files on <code class="docutils literal notranslate"><span class="pre">master</span></code>; we want the RELEASE_NOTES
change and new tag.  We can accomplish this with a special merge as follows.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>master
$<span class="w"> </span>git<span class="w"> </span>merge<span class="w"> </span>--no-commit<span class="w"> </span>--no-ff<span class="w"> </span>ns-3.34-release
Automatic<span class="w"> </span>merge<span class="w"> </span>went<span class="w"> </span>well<span class="p">;</span><span class="w"> </span>stopped<span class="w"> </span>before<span class="w"> </span>committing<span class="w"> </span>as<span class="w"> </span>requested
</pre></div>
</div>
<p>Now, we want to reset VERSION to the previous string, which existed before
we branched.  We can use <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">reset</span></code> on this file and then finish the merge.
Recall its commit hash of <code class="docutils literal notranslate"><span class="pre">9df8ef4</span></code> from above.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>reset<span class="w"> </span>9df8ef4<span class="w"> </span>VERSION
Unstaged<span class="w"> </span>changes<span class="w"> </span>after<span class="w"> </span>reset:
M<span class="w"> </span>VERSION
$<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/3.34/3-dev/g&#39;</span><span class="w"> </span>VERSION
$<span class="w"> </span>cat<span class="w"> </span>VERSION
<span class="m">3</span>-dev
</pre></div>
</div>
<p>Repeat the above resets and change back to <code class="docutils literal notranslate"><span class="pre">3-dev</span></code> for each conf.py file.</p>
<p>Finally, commit the branch and delete our local release branch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;Merge ns-3.34-release branch&quot;</span>
$<span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span>-d<span class="w"> </span>ns-3.34-release
</pre></div>
</div>
<p>The Git history now looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>log<span class="w"> </span>--graph<span class="w"> </span>--decorate<span class="w"> </span>--oneline<span class="w"> </span>--all
*<span class="w">   </span>fd075f6<span class="w"> </span><span class="o">(</span>HEAD<span class="w"> </span>-&gt;<span class="w"> </span>master<span class="o">)</span><span class="w"> </span>Merge<span class="w"> </span>ns-3.34-release<span class="w"> </span>branch
<span class="p">|</span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>3fab3cf<span class="w"> </span><span class="o">(</span>HEAD,<span class="w"> </span>tag:<span class="w"> </span>ns-3.34<span class="o">)</span><span class="w"> </span>Update<span class="w"> </span>availability<span class="w"> </span><span class="k">in</span><span class="w"> </span>RELEASE_NOTES
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>c50aaf7<span class="w"> </span>Update<span class="w"> </span>VERSION<span class="w"> </span>and<span class="w"> </span>documentation<span class="w"> </span>tags<span class="w"> </span><span class="k">for</span><span class="w"> </span>ns-3.34<span class="w"> </span>release
<span class="p">|</span>/
*<span class="w"> </span>9df8ef4<span class="w"> </span>doc:<span class="w"> </span>Update<span class="w"> </span>ns-3<span class="w"> </span>version<span class="w"> </span><span class="k">in</span><span class="w"> </span>tutorial<span class="w"> </span>examples
*<span class="w"> </span>9319cdd<span class="w"> </span><span class="o">(</span>origin/master,<span class="w"> </span>origin/HEAD<span class="o">)</span><span class="w"> </span>Update<span class="w"> </span>CHANGES.html<span class="w"> </span>and<span class="w"> </span>RELEASE_NOTES
</pre></div>
</div>
<p>This may now be pushed to <code class="docutils literal notranslate"><span class="pre">nsnam/ns-3-dev.git</span></code> and development can continue.</p>
<p><strong>Important:</strong>  When pushing to the remote, don’t forget to push the tags:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>push<span class="w"> </span>--follow-tags
</pre></div>
</div>
<p>Future users who want to check out the ns-3.34 release will do something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>my-local-ns-3.34<span class="w"> </span>ns-3.34
Switched<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>branch<span class="w"> </span><span class="s1">&#39;my-local-ns-3.34&#39;</span>
</pre></div>
</div>
<p><strong>Note:</strong>  It is a good idea to avoid naming the new branch the same as the tag
name; in this case, ‘ns-3.34’.</p>
<p>Let’s assume now that master evolves with new features and bugfixes.  They
are committed to <code class="docutils literal notranslate"><span class="pre">master</span></code> on <code class="docutils literal notranslate"><span class="pre">nsnam/ns-3-dev.git</span></code> as usual:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>master
...<span class="w"> </span><span class="o">(</span>some<span class="w"> </span>changes<span class="o">)</span>
$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;make some changes&quot;</span><span class="w"> </span>-a
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;d&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>d
$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>d
$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;Add new feature&quot;</span><span class="w"> </span>d
...<span class="w"> </span><span class="o">(</span>some<span class="w"> </span>more<span class="w"> </span>changes<span class="o">)</span>
$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;some more changes&quot;</span><span class="w"> </span>-a
...<span class="w"> </span><span class="o">(</span>now<span class="w"> </span>fix<span class="w"> </span>a<span class="w"> </span>really<span class="w"> </span>important<span class="w"> </span>bug<span class="o">)</span>
$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;abc&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>a
$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;Fix missing abc bug on file a&quot;</span><span class="w"> </span>a
</pre></div>
</div>
<p>Now the tree looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>log<span class="w"> </span>--graph<span class="w"> </span>--decorate<span class="w"> </span>--oneline<span class="w"> </span>--all
*<span class="w"> </span>ee37d41<span class="w"> </span><span class="o">(</span>HEAD<span class="w"> </span>-&gt;<span class="w"> </span>master<span class="o">)</span><span class="w"> </span>Fix<span class="w"> </span>missing<span class="w"> </span>abc<span class="w"> </span>bug<span class="w"> </span>on<span class="w"> </span>file<span class="w"> </span>a
*<span class="w"> </span>9a3432a<span class="w"> </span>some<span class="w"> </span>more<span class="w"> </span>changes
*<span class="w"> </span>ba28d6d<span class="w"> </span>Add<span class="w"> </span>new<span class="w"> </span>feature
*<span class="w"> </span>e50015a<span class="w"> </span>make<span class="w"> </span>some<span class="w"> </span>changes
*<span class="w">   </span>fd075f6<span class="w"> </span>Merge<span class="w"> </span>ns-3.34-release<span class="w"> </span>branch
<span class="p">|</span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>3fab3cf<span class="w"> </span><span class="o">(</span>tag:<span class="w"> </span>ns-3.34<span class="o">)</span><span class="w"> </span>Update<span class="w"> </span>availability<span class="w"> </span><span class="k">in</span><span class="w"> </span>RELEASE_NOTES
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>c50aaf7<span class="w"> </span>Update<span class="w"> </span>VERSION<span class="w"> </span>and<span class="w"> </span>documentation<span class="w"> </span>tags<span class="w"> </span><span class="k">for</span><span class="w"> </span>ns-3.34<span class="w"> </span>release
<span class="p">|</span>/
*<span class="w"> </span>9df8ef4<span class="w"> </span>doc:<span class="w"> </span>Update<span class="w"> </span>ns-3<span class="w"> </span>version<span class="w"> </span><span class="k">in</span><span class="w"> </span>tutorial<span class="w"> </span>examples
*<span class="w"> </span>9319cdd<span class="w"> </span>Update<span class="w"> </span>CHANGES.html<span class="w"> </span>and<span class="w"> </span>RELEASE_NOTES
</pre></div>
</div>
<p>Let’s assume that the changeset <code class="docutils literal notranslate"><span class="pre">ee37d41</span></code> is considered important to fix in
the ns-3.34 release, but we don’t want the other changes introduced since then.
The solution will be to create a new branch for a hotfix release, and follow
similar steps.  The branch for the hotfix should come from commit <code class="docutils literal notranslate"><span class="pre">3fab3cf</span></code>,
and should cherry-pick commit <code class="docutils literal notranslate"><span class="pre">ee37d41</span></code> (which may require merge if it
doesn’t apply cleanly), and then the hotfix branch can be tagged and merged
as was done before.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>ns-3.34.1-release<span class="w"> </span>ns-3.34
$<span class="w"> </span>git<span class="w"> </span>cherry-pick<span class="w"> </span>ee37d41
...<span class="w"> </span><span class="o">(</span>resolve<span class="w"> </span>any<span class="w"> </span>conflicts<span class="o">)</span>
$<span class="w"> </span>git<span class="w"> </span>add<span class="w"> </span>a
$<span class="w"> </span>git<span class="w"> </span>commit
$<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s/3.34/3.34.1/g&#39;</span><span class="w"> </span>VERSION
$<span class="w"> </span>cat<span class="w"> </span>VERSION
<span class="m">3</span>.34.1
$<span class="w"> </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="s2">&quot;Update VERSION to 3.34.1&quot;</span><span class="w"> </span>VERSION
$<span class="w"> </span>git<span class="w"> </span>tag<span class="w"> </span>-a<span class="w"> </span><span class="s1">&#39;ns-3.34.1&#39;</span><span class="w"> </span>-m<span class="s2">&quot;ns-3.34.1 release&quot;</span>
</pre></div>
</div>
<p>Now the merge:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>master
$<span class="w"> </span>git<span class="w"> </span>merge<span class="w"> </span>--no-commit<span class="w"> </span>--no-ff<span class="w"> </span>ns-3.34.1-release
</pre></div>
</div>
<p>This time we may see something like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Auto-merging<span class="w"> </span>a
CONFLICT<span class="w"> </span><span class="o">(</span>content<span class="o">)</span>:<span class="w"> </span>Merge<span class="w"> </span>conflict<span class="w"> </span><span class="k">in</span><span class="w"> </span>a
Auto-merging<span class="w"> </span>VERSION
CONFLICT<span class="w"> </span><span class="o">(</span>content<span class="o">)</span>:<span class="w"> </span>Merge<span class="w"> </span>conflict<span class="w"> </span><span class="k">in</span><span class="w"> </span>VERSION
Automatic<span class="w"> </span>merge<span class="w"> </span>failed<span class="p">;</span><span class="w"> </span>fix<span class="w"> </span>conflicts<span class="w"> </span>and<span class="w"> </span><span class="k">then</span><span class="w"> </span>commit<span class="w"> </span>the<span class="w"> </span>result.
</pre></div>
</div>
<p>And we can then do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>reset<span class="w"> </span>ee37d41<span class="w"> </span>a
$<span class="w"> </span>git<span class="w"> </span>reset<span class="w"> </span>ee37d41<span class="w"> </span>VERSION
</pre></div>
</div>
<p>Which leaves us with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Unstaged<span class="w"> </span>changes<span class="w"> </span>after<span class="w"> </span>reset:
M<span class="w"> </span>VERSION
M<span class="w"> </span>a
</pre></div>
</div>
<p>We can next hand-edit these files to restore them to original state, so that:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>status
On<span class="w"> </span>branch<span class="w"> </span>master
Your<span class="w"> </span>branch<span class="w"> </span>is<span class="w"> </span>ahead<span class="w"> </span>of<span class="w"> </span><span class="s1">&#39;origin/master&#39;</span><span class="w"> </span>by<span class="w"> </span><span class="m">8</span><span class="w"> </span>commits.
<span class="w">  </span><span class="o">(</span>use<span class="w"> </span><span class="s2">&quot;git push&quot;</span><span class="w"> </span>to<span class="w"> </span>publish<span class="w"> </span>your<span class="w"> </span><span class="nb">local</span><span class="w"> </span>commits<span class="o">)</span>

All<span class="w"> </span>conflicts<span class="w"> </span>fixed<span class="w"> </span>but<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>still<span class="w"> </span>merging.
<span class="w">  </span><span class="o">(</span>use<span class="w"> </span><span class="s2">&quot;git commit&quot;</span><span class="w"> </span>to<span class="w"> </span>conclude<span class="w"> </span>merge<span class="o">)</span>

$<span class="w"> </span>git<span class="w"> </span>commit
$<span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span>-d<span class="w"> </span>ns-3.34.1-release
</pre></div>
</div>
<p>The new log should show something like the below, with parallel Git
history paths until the merge back again:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>log<span class="w"> </span>--graph<span class="w"> </span>--decorate<span class="w"> </span>--oneline<span class="w"> </span>--all
*<span class="w">   </span>815ce6e<span class="w"> </span><span class="o">(</span>HEAD<span class="w"> </span>-&gt;<span class="w"> </span>master<span class="o">)</span><span class="w"> </span>Merge<span class="w"> </span>branch<span class="w"> </span><span class="s1">&#39;ns-3.34.1-release&#39;</span>
<span class="p">|</span><span class="se">\</span>
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>12a29ca<span class="w"> </span><span class="o">(</span>tag:<span class="w"> </span>ns-3.34.1<span class="o">)</span><span class="w"> </span>Update<span class="w"> </span>VERSION<span class="w"> </span>to<span class="w"> </span><span class="m">3</span>.34.1
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>21ebdbf<span class="w"> </span>Fix<span class="w"> </span>missing<span class="w"> </span>abc<span class="w"> </span>bug<span class="w"> </span>on<span class="w"> </span>file<span class="w"> </span>a
*<span class="w"> </span><span class="p">|</span><span class="w"> </span>ee37d41<span class="w"> </span>Fix<span class="w"> </span>missing<span class="w"> </span>abc<span class="w"> </span>bug<span class="w"> </span>on<span class="w"> </span>file<span class="w"> </span>a
*<span class="w"> </span><span class="p">|</span><span class="w"> </span>9a3432a<span class="w"> </span>some<span class="w"> </span>more<span class="w"> </span>changes
*<span class="w"> </span><span class="p">|</span><span class="w"> </span>ba28d6d<span class="w"> </span>Add<span class="w"> </span>new<span class="w"> </span>feature
*<span class="w"> </span><span class="p">|</span><span class="w"> </span>e50015a<span class="w"> </span>make<span class="w"> </span>some<span class="w"> </span>changes
*<span class="w"> </span><span class="p">|</span><span class="w">   </span>fd075f6<span class="w"> </span>Merge<span class="w"> </span>ns-3.34-release<span class="w"> </span>branch
<span class="p">|</span><span class="se">\ \</span>
<span class="p">|</span><span class="w"> </span><span class="p">|</span>/
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>3fab3cf<span class="w"> </span><span class="o">(</span>tag:<span class="w"> </span>ns-3.34<span class="o">)</span><span class="w"> </span>Update<span class="w"> </span>availability<span class="w"> </span><span class="k">in</span><span class="w"> </span>RELEASE_NOTES
<span class="p">|</span><span class="w"> </span>*<span class="w"> </span>c50aaf7<span class="w"> </span>Update<span class="w"> </span>VERSION<span class="w"> </span>and<span class="w"> </span>documentation<span class="w"> </span>tags<span class="w"> </span><span class="k">for</span><span class="w"> </span>ns-3.34<span class="w"> </span>release
<span class="p">|</span>/
*<span class="w"> </span>9df8ef4<span class="w"> </span>doc:<span class="w"> </span>Update<span class="w"> </span>ns-3<span class="w"> </span>version<span class="w"> </span><span class="k">in</span><span class="w"> </span>tutorial<span class="w"> </span>examples
*<span class="w"> </span>9319cdd<span class="w"> </span>Update<span class="w"> </span>CHANGES.html<span class="w"> </span>and<span class="w"> </span>RELEASE_NOTES

$<span class="w"> </span>git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>master:master<span class="w"> </span>--follow-tags
</pre></div>
</div>
<p>And we can continue to commit on top of master going forward.  The two
tags should be found in the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span></code> output (among other tags):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>tag
ns-3.34
ns-3.34.1
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">4.1. Working with Git as a user</a><ul>
<li><a class="reference internal" href="#ns-3-s-git-workflow-in-a-nutshell">4.1.1. ns-3’s Git workflow in a nutshell</a></li>
<li><a class="reference internal" href="#setup-of-a-personal-repository">4.1.2. Setup of a personal repository</a><ul>
<li><a class="reference internal" href="#directly-cloning-ns-3-dev">4.1.2.1. Directly cloning ns-3-dev</a></li>
<li><a class="reference internal" href="#forking-ns-3-dev-on-gitlab-com">4.1.2.2. Forking ns-3-dev on GitLab.com</a><ul>
<li><a class="reference internal" href="#clone-your-forked-repository-on-your-machine">4.1.2.2.1. Clone your forked repository on your machine</a></li>
<li><a class="reference internal" href="#naming-conventions">4.1.2.2.2. Naming conventions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#add-the-official-ns-3-repository-as-remote-upstream">4.1.3. Add the official ns-3 repository as remote upstream</a></li>
<li><a class="reference internal" href="#add-your-forked-repository-as-remote">4.1.4. Add your forked repository as remote</a></li>
<li><a class="reference internal" href="#keep-in-sync-your-repository-with-latest-ns-3-dev-updates">4.1.5. Keep in sync your repository with latest ns-3-dev updates</a></li>
<li><a class="reference internal" href="#start-a-new-branch-to-do-some-work">4.1.6. Start a new branch to do some work</a></li>
<li><a class="reference internal" href="#edit-and-commit-the-modifications">4.1.7. Edit and commit the modifications</a><ul>
<li><a class="reference internal" href="#commit-message-guidelines">4.1.7.1. Commit message guidelines</a></li>
<li><a class="reference internal" href="#commit-log">4.1.7.2. Commit log</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rebase-your-branch-on-top-of-master">4.1.8. Rebase your branch on top of master</a></li>
<li><a class="reference internal" href="#pushing-your-changes-to-origin">4.1.9. Pushing your changes to origin</a></li>
<li><a class="reference internal" href="#submit-work-for-review">4.1.10. Submit work for review</a><ul>
<li><a class="reference internal" href="#gitlab-ci-continuous-integration">4.1.10.1. GitLab CI (Continuous Integration)</a></li>
<li><a class="reference internal" href="#gitlab-ci-optimization">4.1.10.2. GitLab CI optimization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#porting-patches-from-mercurial-repositories-to-git">4.1.11. Porting patches from mercurial repositories to Git</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-git-as-a-maintainer">4.2. Working with Git as a maintainer</a><ul>
<li><a class="reference internal" href="#pushing-your-own-work">4.2.1. Pushing your own work</a></li>
<li><a class="reference internal" href="#review-and-merge-someone-else-s-work">4.2.2. Review and merge someone else’s work</a></li>
<li><a class="reference internal" href="#making-a-release">4.2.3. Making a release</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="develop.html"
                          title="previous chapter"><span class="section-number">4. </span>Developer Tools</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="working-with-cmake.html"
                          title="next chapter"><span class="section-number">4.3. </span>Working with CMake</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/working-with-git.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="working-with-cmake.html" title="4.3. Working with CMake"
             >next</a> |</li>
        <li class="right" >
          <a href="develop.html" title="4. Developer Tools"
             >previous</a> |</li>
    <li class="navelem"><a href="">ns-3</a><span class="navelem">&nbsp;</span></li>
    
        <li class="nav-item nav-item-0"><a href="index.html">Manual</a><span class="navelem">&nbsp;</span></li>

          <li class="nav-item nav-item-1"><a href="develop.html" ><span class="section-number">4. </span>Developer Tools</a><span class="navelem">&nbsp;</span></li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.1. </span>Working with Git as a user</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2006-2019, ns-3 project.
      Last updated on Mar 20, 2024 11:47.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>